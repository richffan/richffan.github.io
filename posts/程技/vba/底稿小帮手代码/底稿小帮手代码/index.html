<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="底稿小帮手代码 - https://richfan.site/posts/%E7%A8%8B%E6%8A%80/vba/%E5%BA%95%E7%A8%BF%E5%B0%8F%E5%B8%AE%E6%89%8B%E4%BB%A3%E7%A0%81/%E5%BA%95%E7%A8%BF%E5%B0%8F%E5%B8%AE%E6%89%8B%E4%BB%A3%E7%A0%81/">
    <meta name="author" content="richfan - https://richfan.site/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>底稿小帮手代码</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://richfan.site/style.min.d252ad53a5e6b2ae6b8c6c1661107189be3668e36c8dd61697bbe008595a7e04.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": true
	}
</div>
    <h1 class="title">
        
            底稿小帮手代码
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2023-05-15&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            14444 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            29 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/%E7%A8%8B%E6%8A%80">程技</a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/vba">VBA</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/vba/%E5%BA%95%E7%A8%BF%E5%B0%8F%E5%B8%AE%E6%89%8B%E4%BB%A3%E7%A0%81/k%E8%AE%BF%E8%B0%88%E6%8F%90%E7%BA%B2/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/vba/%E5%BA%95%E7%A8%BF%E5%B0%8F%E5%B8%AE%E6%89%8B%E4%BB%A3%E7%A0%81/%E6%9B%B4%E6%96%B0/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#a段落处理">a段落处理</a></li>
    <li><a href="#b表单处理">b表单处理</a></li>
    <li><a href="#c数字">c数字</a></li>
    <li><a href="#d文字">d文字</a></li>
    <li><a href="#e大纲">e大纲</a></li>
    <li><a href="#fexcel贴数">fExcel贴数</a></li>
    <li><a href="#g批注">g批注</a></li>
    <li><a href="#h行列校验">h行列校验</a></li>
    <li><a href="#i多表处理">i多表处理</a></li>
    <li><a href="#jsonconverter">JsonConverter</a></li>
    <li><a href="#j页面设置">j页面设置</a></li>
    <li><a href="#k访谈提纲">k访谈提纲</a></li>
    <li><a href="#更新">更新</a></li>
    <li><a href="#类模块">类模块</a></li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h2 id="a段落处理">a段落处理</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">段落处理</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;段落-段落处理-
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> pg <span style="color:#000;font-weight:bold">In</span> Selection.Paragraphs
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> pg.Range.Information(wdWithInTable) <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;-------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> pg.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel1 <span style="color:#000;font-weight:bold">Then</span> <span style="color:#998;font-style:italic">&#39;如果是1级标题用此格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>                    .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)   <span style="color:#998;font-style:italic">&#39;左缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)  <span style="color:#998;font-style:italic">&#39;右缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 2.5        <span style="color:#998;font-style:italic">&#39;段前 2.5磅等于0.5行,如果你的单位为行,则这里乘5
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 2.5         <span style="color:#998;font-style:italic">&#39;段后
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpace1pt5   <span style="color:#998;font-style:italic">&#39;行距,单倍 wdLineSpaceSingle   1.5倍 wdLineSpace1pt5     两倍 wdLineSpaceDouble
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter  <span style="color:#998;font-style:italic">&#39;对齐方式  左对齐:wdAlignParagraphLeft  右对齐:wdAlignParagraphRight  居中:wdAlignParagraphCenter
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)  <span style="color:#998;font-style:italic">&#39;首行缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>                    .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;黑体&#34;</span>   <span style="color:#998;font-style:italic">&#39;中文
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>   <span style="color:#998;font-style:italic">&#39;西文
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>   <span style="color:#998;font-style:italic">&#39;西文
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.Size <span style="color:#000;font-weight:bold">=</span> 20          <span style="color:#998;font-style:italic">&#39;字号三号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>        <span style="color:#998;font-style:italic">&#39;加粗      不加粗填false
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39;-------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">ElseIf</span> pg.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel2 <span style="color:#000;font-weight:bold">Then</span> <span style="color:#998;font-style:italic">&#39;如果是2级标题用此格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>                    .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpace1pt5
</span></span><span style="display:flex;"><span>                    .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify <span style="color:#998;font-style:italic">&#39;两端对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>                    .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;黑体&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.Size <span style="color:#000;font-weight:bold">=</span> 18          <span style="color:#998;font-style:italic">&#39;字号四号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39;-------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">ElseIf</span> pg.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel3 <span style="color:#000;font-weight:bold">Then</span>  <span style="color:#998;font-style:italic">&#39;如果是3级标题用此格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>                    .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpace1pt5
</span></span><span style="display:flex;"><span>                    .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphLeft
</span></span><span style="display:flex;"><span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>                    .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;黑体&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.Size <span style="color:#000;font-weight:bold">=</span> 16          <span style="color:#998;font-style:italic">&#39;字号小四
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39;-------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">ElseIf</span> pg.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel4 <span style="color:#000;font-weight:bold">Then</span>  <span style="color:#998;font-style:italic">&#39;如果是4级标题用此格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>                    .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpace1pt5
</span></span><span style="display:flex;"><span>                    .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify
</span></span><span style="display:flex;"><span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>                    .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;仿宋&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.Size <span style="color:#000;font-weight:bold">=</span> 16          <span style="color:#998;font-style:italic">&#39;字号小四
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39;------------------------------------------------------------------------- 下面是5级以及正文的样式设置
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>                    .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 2.5
</span></span><span style="display:flex;"><span>                    .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpace1pt5
</span></span><span style="display:flex;"><span>                    .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify
</span></span><span style="display:flex;"><span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0.35)  <span style="color:#998;font-style:italic">&#39;首行缩进2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 2  <span style="color:#998;font-style:italic">&#39;首行缩进2
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>                    .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;仿宋&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Font.Size <span style="color:#000;font-weight:bold">=</span> 14          <span style="color:#998;font-style:italic">&#39;字号四号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">表前单位格式</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> pg <span style="color:#000;font-weight:bold">In</span> Selection.Paragraphs
</span></span><span style="display:flex;"><span>        pg.IndentFirstLineCharWidth <span style="color:#000;font-weight:bold">-</span>10000
</span></span><span style="display:flex;"><span>        pg.IndentFirstLineCharWidth 2
</span></span><span style="display:flex;"><span>        pg.Range.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>            .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>            .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>            .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpaceSingle
</span></span><span style="display:flex;"><span>            .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify
</span></span><span style="display:flex;"><span>            .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>            .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .LineUnitBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .LineUnitAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>            .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>            .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>            .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>            .Font.Size <span style="color:#000;font-weight:bold">=</span> 10.5         <span style="color:#998;font-style:italic">&#39;字号五号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphRight
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>            .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">表后注释格式</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> pg <span style="color:#000;font-weight:bold">In</span> Selection.Paragraphs
</span></span><span style="display:flex;"><span>        pg.IndentFirstLineCharWidth <span style="color:#000;font-weight:bold">-</span>10000
</span></span><span style="display:flex;"><span>        pg.IndentFirstLineCharWidth 2
</span></span><span style="display:flex;"><span>        pg.Range.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>            .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>            .RightIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>            .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpaceSingle
</span></span><span style="display:flex;"><span>            .Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify
</span></span><span style="display:flex;"><span>            .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)
</span></span><span style="display:flex;"><span>            .CharacterUnitLeftIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .CharacterUnitRightIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .LineUnitBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .LineUnitAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> pg.Range
</span></span><span style="display:flex;"><span>            .Font.NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>            .Font.NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>            .Font.NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>            .Font.Size <span style="color:#000;font-weight:bold">=</span> 10        <span style="color:#998;font-style:italic">&#39;字号10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> pg.Range.ParagraphFormat
</span></span><span style="display:flex;"><span>            .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>            .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>            .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">自动编号</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)  <span style="color:#998;font-style:italic">&#39;针对样式（一）
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;先选择一片范围再运行代码,会将例如&#34;(一)&#34;此样式的编号换为自动编号,&#34;()&#34;为中文全角符号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;注意只有段落开头为&#34;(一)&#34;样式的编号会替换,段中的编号则不会
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Dim</span> r <span style="color:#000;font-weight:bold">As</span> Range, P <span style="color:#000;font-weight:bold">As</span> Range, tpf, NF, NS, LI, FI
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;================================================== 配置区
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    tpf <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;（[一二三四五六七八九十]@）&#34;</span>  <span style="color:#998;font-style:italic">&#39;通配符
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    NF <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;（%1）&#34;</span>   <span style="color:#998;font-style:italic">&#39;编号格式,%1为编号本身,不能动,只需要编辑%1旁边的格式,比如&#39;(一)&#39;为&#39;（%1）&#39; 或者 &#39;1、&#39;为 &#39;%1、&#39; 或者 &#39;第一章&#39;为&#39;第%1章&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    NS <span style="color:#000;font-weight:bold">=</span> wdListNumberStyleSimpChinNum3  <span style="color:#998;font-style:italic">&#39;编号的样式:wdListNumberStyleArabic阿拉伯数字    wdListNumberStyleSimpChinNum3中文数字
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    LI <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0)    <span style="color:#998;font-style:italic">&#39;左缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    FI <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0.74)   <span style="color:#998;font-style:italic">&#39;首行缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;================================================== 配置区
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> wdSelectionIP <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        MsgBox <span style="color:#d14">&#34;请选择范围！&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> r <span style="color:#000;font-weight:bold">=</span> Selection.Range
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> P <span style="color:#000;font-weight:bold">=</span> Selection.Range
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> ListGalleries(wdNumberGallery).ListTemplates(1).ListLevels(1)  <span style="color:#998;font-style:italic">&#39;设置编号格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .NumberFormat <span style="color:#000;font-weight:bold">=</span> NF
</span></span><span style="display:flex;"><span>        .TrailingCharacter <span style="color:#000;font-weight:bold">=</span> wdTrailingNone
</span></span><span style="display:flex;"><span>        .NumberStyle <span style="color:#000;font-weight:bold">=</span> NS
</span></span><span style="display:flex;"><span>        .NumberPosition <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        .Alignment <span style="color:#000;font-weight:bold">=</span> wdListLevelAlignLeft
</span></span><span style="display:flex;"><span>        .TextPosition <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        .TabPosition <span style="color:#000;font-weight:bold">=</span> wdUndefined
</span></span><span style="display:flex;"><span>        .ResetOnHigher <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        .StartAt <span style="color:#000;font-weight:bold">=</span> 1
</span></span><span style="display:flex;"><span>        .LinkedStyle <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    ListGalleries(wdNumberGallery).ListTemplates(1).Name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> r.Find
</span></span><span style="display:flex;"><span>        .ClearFormatting
</span></span><span style="display:flex;"><span>        .Text <span style="color:#000;font-weight:bold">=</span> tpf
</span></span><span style="display:flex;"><span>        .Forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Do</span> <span style="color:#000;font-weight:bold">While</span> .Execute
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Parent
</span></span><span style="display:flex;"><span>                pat <span style="color:#000;font-weight:bold">=</span> .Text
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> .End <span style="color:#000;font-weight:bold">&gt;</span> P.End <span style="color:#000;font-weight:bold">Then</span> <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Do</span>
</span></span><span style="display:flex;"><span>                ast <span style="color:#000;font-weight:bold">=</span> Asc(ActiveDocument.Range(Start:<span style="color:#000;font-weight:bold">=</span>.Start <span style="color:#000;font-weight:bold">-</span> 1, <span style="color:#000;font-weight:bold">End</span>:<span style="color:#000;font-weight:bold">=</span>.Start))
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> ast <span style="color:#000;font-weight:bold">=</span> 13 <span style="color:#000;font-weight:bold">Or</span> ast <span style="color:#000;font-weight:bold">=</span> 12 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    .ListFormat.ApplyListTemplateWithLevel ListTemplate:<span style="color:#000;font-weight:bold">=</span> _
</span></span><span style="display:flex;"><span>                        ListGalleries(wdNumberGallery).ListTemplates(1), ContinuePreviousList:<span style="color:#000;font-weight:bold">=</span> _
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">True</span>, ApplyTo:<span style="color:#000;font-weight:bold">=</span>wdListApplyToWholeList, DefaultListBehavior:<span style="color:#000;font-weight:bold">=</span> _
</span></span><span style="display:flex;"><span>                        wdWord10ListBehavior
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">With</span> .ParagraphFormat
</span></span><span style="display:flex;"><span>                        .SpaceBeforeAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                        .SpaceAfterAuto <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                        .LeftIndent <span style="color:#000;font-weight:bold">=</span> LI
</span></span><span style="display:flex;"><span>                        .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> FI
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> .Text <span style="color:#000;font-weight:bold">=</span> pat <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        .Delete
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                .Start <span style="color:#000;font-weight:bold">=</span> .End
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    MsgBox <span style="color:#d14">&#34;完成&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">编号转文本</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> kgslist <span style="color:#000;font-weight:bold">As</span> List
</span></span><span style="display:flex;"><span>    i <span style="color:#000;font-weight:bold">=</span> MsgBox(<span style="color:#d14">&#34;点击确定则将该文档下所有编号转为文本&#34;</span>, 1)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> i <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> kgslist <span style="color:#000;font-weight:bold">In</span> ActiveDocument.Lists
</span></span><span style="display:flex;"><span>            kgslist.ConvertNumbersToText
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="b表单处理">b表单处理</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Dim</span> aarr(1 <span style="color:#000;font-weight:bold">To</span> 20), bbrr(1 <span style="color:#000;font-weight:bold">To</span> 30, 1 <span style="color:#000;font-weight:bold">To</span> 30) <span style="color:#998;font-style:italic">&#39;多列调整
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">单表_一键调整</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;单表-格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;功能：光标在表格中处理当前表格；否则处理所有表格！
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>  <span style="color:#998;font-style:italic">&#39;关闭屏幕刷新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.DisplayAlerts <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>  <span style="color:#998;font-style:italic">&#39;关闭提示
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>  <span style="color:#998;font-style:italic">&#39;忽略错误
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;-------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Dim</span> mytable <span style="color:#000;font-weight:bold">As</span> Table, i <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> mytable <span style="color:#000;font-weight:bold">In</span> Selection.Tables
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> mytable
</span></span><span style="display:flex;"><span>            .Shading.ForegroundPatternColor <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic
</span></span><span style="display:flex;"><span>            .Shading.BackgroundPatternColor <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic
</span></span><span style="display:flex;"><span>            Options.DefaultHighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdNoHighlight
</span></span><span style="display:flex;"><span>            .Range.HighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdNoHighlight
</span></span><span style="display:flex;"><span>            .Style <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;表格主题&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderLeft)    <span style="color:#998;font-style:italic">&#39;左框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle   <span style="color:#998;font-style:italic">&#39;设置线条样式    不需要线条则填wdLineStyleNone
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt    <span style="color:#998;font-style:italic">&#39;宽度为1.5
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderRight)   <span style="color:#998;font-style:italic">&#39;右框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle
</span></span><span style="display:flex;"><span>                .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderTop)     <span style="color:#998;font-style:italic">&#39;上框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle
</span></span><span style="display:flex;"><span>                .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderBottom)  <span style="color:#998;font-style:italic">&#39;下框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle
</span></span><span style="display:flex;"><span>                .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderVertical)   <span style="color:#998;font-style:italic">&#39;内部纵向框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle
</span></span><span style="display:flex;"><span>                .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth050pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderHorizontal)   <span style="color:#998;font-style:italic">&#39;内部横向框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle
</span></span><span style="display:flex;"><span>                .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth050pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            .Borders(wdBorderDiagonalDown).LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleNone  <span style="color:#998;font-style:italic">&#39;左上的斜线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Borders(wdBorderDiagonalUp).LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleNone    <span style="color:#998;font-style:italic">&#39;右上的斜线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39;单元格边距
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .TopPadding <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;设置上边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .BottomPadding <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;设置下边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .LeftPadding <span style="color:#000;font-weight:bold">=</span> PixelsToPoints(0, <span style="color:#000;font-weight:bold">True</span>)  <span style="color:#998;font-style:italic">&#39;设置左边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .RightPadding <span style="color:#000;font-weight:bold">=</span> PixelsToPoints(0, <span style="color:#000;font-weight:bold">True</span>) <span style="color:#998;font-style:italic">&#39;设置右边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Spacing <span style="color:#000;font-weight:bold">=</span> PixelsToPoints(0, <span style="color:#000;font-weight:bold">True</span>) <span style="color:#998;font-style:italic">&#39;允许单元格间距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .AllowPageBreaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39;允许断页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39;.AllowAutoFit = True &#39;允许自动重调尺寸
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">With</span> .Rows
</span></span><span style="display:flex;"><span>                .WrapAroundText <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39;取消文字环绕
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;.Alignment = wdAlignRowCenter &#39;表水平居中  wdAlignRowLeft &#39;左对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .AllowBreakAcrossPages <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39;不允许行断页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Height <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0.8) <span style="color:#998;font-style:italic">&#39;行高0.8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .HeightRule <span style="color:#000;font-weight:bold">=</span> wdRowHeightAtLeast <span style="color:#998;font-style:italic">&#39;行高设为最小值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;左面缩进量为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Range
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> .Font <span style="color:#998;font-style:italic">&#39;字体格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>                    .NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Color <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic <span style="color:#998;font-style:italic">&#39;自动字体颜色
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Size <span style="color:#000;font-weight:bold">=</span> 10.5   <span style="color:#998;font-style:italic">&#39;字号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Kerning <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .DisableCharacterSpaceGrid <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>  <span style="color:#998;font-style:italic">&#39;选定段落中的字符与行网格对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> .ParagraphFormat <span style="color:#998;font-style:italic">&#39;段落格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .LineUnitBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .LineUnitAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#998;font-style:italic">&#39;取消首行缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;取消首行缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpaceSingle <span style="color:#998;font-style:italic">&#39;wdLineSpaceSingle &#39;单倍行距  wdLineSpaceExactly &#39;行距固定值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">&#39;&#39;.LineSpacing = 18 &#39;设置行间距为18磅，配合行距固定值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">&#39;.Alignment = wdAlignParagraphCenter &#39;单元格水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .AutoAdjustRightIndent <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>  <span style="color:#998;font-style:italic">&#39;自动调整所选段落的右缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .DisableLineHeightGrid <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>   <span style="color:#998;font-style:italic">&#39;选定段落中的字符与行网格对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                .Cells.VerticalAlignment <span style="color:#000;font-weight:bold">=</span> wdCellAlignVerticalCenter  <span style="color:#998;font-style:italic">&#39;单元格垂直居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> cl <span style="color:#000;font-weight:bold">In</span> .Range.Cells    <span style="color:#998;font-style:italic">&#39;文字靠左，数字靠右,合计居中,序号居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                Acell <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(cl.Range.Start, cl.Range.End <span style="color:#000;font-weight:bold">-</span> 1).Text <span style="color:#998;font-style:italic">&#39;提取文本
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">If</span> IsNumeric(Acell) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    cl.Range.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphRight    <span style="color:#998;font-style:italic">&#39;右对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    cl.Range.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify   <span style="color:#998;font-style:italic">&#39;左对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">If</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;合计&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;总计&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;总 计&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;合 计&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        cl.Range.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter    <span style="color:#998;font-style:italic">&#39;水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                        <span style="color:#000;font-weight:bold">If</span> cl.ColumnIndex <span style="color:#000;font-weight:bold">=</span> .Columns.Count <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            .Columns(cl.ColumnIndex).Select
</span></span><span style="display:flex;"><span>                            Selection.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            cl.Row.Range.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">ElseIf</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;序号&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;序 号&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        .Columns(cl.ColumnIndex).Select
</span></span><span style="display:flex;"><span>                        Selection.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter    <span style="color:#998;font-style:italic">&#39;水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;设置首行格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Rows(1).Select <span style="color:#998;font-style:italic">&#39; 选中第一个单元格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>                .Rows.HeadingFormat <span style="color:#000;font-weight:bold">=</span> wdToggle <span style="color:#998;font-style:italic">&#39;自动标题行重复
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter   <span style="color:#998;font-style:italic">&#39;水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Range.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39;表头加粗黑体
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Shading.ForegroundPatternColor <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic <span style="color:#998;font-style:italic">&#39;首行自动颜色
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Shading.BackgroundPatternColor <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>603923969 <span style="color:#998;font-style:italic">&#39;首行底纹填充,不要底色则删了这行
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;.Borders(wdBorderBottom).LineStyle = xlContinuous
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;.Borders(wdBorderBottom).LineWidth = wdLineWidth50pt
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;自动调整表格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Columns.PreferredWidthType <span style="color:#000;font-weight:bold">=</span> wdPreferredWidthAuto
</span></span><span style="display:flex;"><span>            .AutoFitBehavior (wdAutoFitContent) <span style="color:#998;font-style:italic">&#39;根据内容调整表格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .AutoFitBehavior (wdAutoFitWindow) <span style="color:#998;font-style:italic">&#39;根据窗口调整表格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;---------------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ERR.Clear: <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> 0 <span style="color:#998;font-style:italic">&#39;恢复错误捕捉
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.DisplayAlerts <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>  <span style="color:#998;font-style:italic">&#39;开启提示
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>   <span style="color:#998;font-style:italic">&#39;开启屏幕刷新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">格宽调整_释放</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;列宽调整-多列加载
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Set</span> mytable <span style="color:#000;font-weight:bold">=</span> Selection.Tables(1)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> mytable.Rows.Count
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> j <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> mytable.Rows(i).Cells.Count
</span></span><span style="display:flex;"><span>            mytable.Rows(i).Cells(j).Width <span style="color:#000;font-weight:bold">=</span> bbrr(i, j)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span> j
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">格宽调整_读取</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)  <span style="color:#998;font-style:italic">&#39;列宽调整-多列读取
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Set</span> mytable <span style="color:#000;font-weight:bold">=</span> Selection.Tables(1)
</span></span><span style="display:flex;"><span>    mytable.AutoFitBehavior (wdAutoFitFixed)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> mytable.Rows.Count
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> j <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> mytable.Rows(i).Cells.Count
</span></span><span style="display:flex;"><span>            bbrr(i, j) <span style="color:#000;font-weight:bold">=</span> mytable.Rows(i).Cells(j).Width
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span> j
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">列宽调整_读取</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)   <span style="color:#998;font-style:italic">&#39;列宽调整-单列读取
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection.Tables(1)
</span></span><span style="display:flex;"><span>        ColumnsCounts <span style="color:#000;font-weight:bold">=</span> .Columns.Count
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> ColumnsCounts
</span></span><span style="display:flex;"><span>            aarr(i) <span style="color:#000;font-weight:bold">=</span> .Columns(i).Width
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">列宽调整_释放</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;列宽调整-单列加载
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection.Tables(1)
</span></span><span style="display:flex;"><span>        .AutoFitBehavior (wdAutoFitFixed)
</span></span><span style="display:flex;"><span>        ColumnsCounts <span style="color:#000;font-weight:bold">=</span> .Columns.Count
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> ColumnsCounts
</span></span><span style="display:flex;"><span>            .Columns(i).Width <span style="color:#000;font-weight:bold">=</span> aarr(i)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="c数字">c数字</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">千分位符</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;数字-千分位符
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> i <span style="color:#000;font-weight:bold">As</span> Range, Acell <span style="color:#000;font-weight:bold">As</span> Cell, CR <span style="color:#000;font-weight:bold">As</span> Range
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 2 <span style="color:#000;font-weight:bold">Then</span> <span style="color:#998;font-style:italic">&#39;文档选定
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> i <span style="color:#000;font-weight:bold">In</span> Selection.Words
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(i) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> i <span style="color:#000;font-weight:bold">Like</span> <span style="color:#d14">&#34;####*&#34;</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> i.Next <span style="color:#000;font-weight:bold">Like</span> <span style="color:#d14">&#34;.&#34;</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#000;font-weight:bold">And</span> i.Next(wdWord, 2) <span style="color:#000;font-weight:bold">Like</span> <span style="color:#d14">&#34;#*&#34;</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        i.SetRange Start:<span style="color:#000;font-weight:bold">=</span>i.Start, <span style="color:#000;font-weight:bold">End</span>:<span style="color:#000;font-weight:bold">=</span>i.Next(wdWord, 2).End
</span></span><span style="display:flex;"><span>                        NC <span style="color:#000;font-weight:bold">=</span> Format(i, <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>                        i.Text <span style="color:#000;font-weight:bold">=</span> NC
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                        NC <span style="color:#000;font-weight:bold">=</span> Format(i, <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>                        i.Text <span style="color:#000;font-weight:bold">=</span> NC
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ElseIf</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 4 <span style="color:#000;font-weight:bold">Or</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 5 <span style="color:#000;font-weight:bold">Then</span> <span style="color:#998;font-style:italic">&#39;竖形表格（5为横形表格）
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;            MsgBox CR
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> CR <span style="color:#000;font-weight:bold">Like</span> <span style="color:#d14">&#34;-####*&#34;</span> <span style="color:#000;font-weight:bold">Or</span> <span style="color:#d14">&#34;-####.#*&#34;</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                Yn <span style="color:#000;font-weight:bold">=</span> Format(CR, <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>                CR.Text <span style="color:#000;font-weight:bold">=</span> Yn
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> CR <span style="color:#000;font-weight:bold">Like</span> <span style="color:#d14">&#34;####*&#34;</span> <span style="color:#000;font-weight:bold">Or</span> <span style="color:#d14">&#34;####.#*&#34;</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    Yn <span style="color:#000;font-weight:bold">=</span> Format(CR, <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>                    CR.Text <span style="color:#000;font-weight:bold">=</span> Yn
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span> Acell
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        MsgBox <span style="color:#d14">&#34;您只能选定文本或者表格之一!&#34;</span>, vbOK <span style="color:#000;font-weight:bold">+</span> vbInformation
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    Application.Activate
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">除以一万</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 2 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> IsNumeric(Selection.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            i <span style="color:#000;font-weight:bold">=</span> Selection.Text
</span></span><span style="display:flex;"><span>            P <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">/</span> 10000
</span></span><span style="display:flex;"><span>            q <span style="color:#000;font-weight:bold">=</span> Format(Round(P, 2), <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>            Selection.Text <span style="color:#000;font-weight:bold">=</span> q <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;万&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ElseIf</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 5 <span style="color:#000;font-weight:bold">Or</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 4 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;MsgBox CR
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> CR.Text
</span></span><span style="display:flex;"><span>                P <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">/</span> 10000
</span></span><span style="display:flex;"><span>                q <span style="color:#000;font-weight:bold">=</span> Format(Round(P, 2), <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>                CR.Text <span style="color:#000;font-weight:bold">=</span> q <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;万&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">乘百</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 2 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> IsNumeric(Selection.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            i <span style="color:#000;font-weight:bold">=</span> Selection.Text
</span></span><span style="display:flex;"><span>            P <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">*</span> 100
</span></span><span style="display:flex;"><span>            q <span style="color:#000;font-weight:bold">=</span> Format(Round(P, 2), <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>            Selection.Text <span style="color:#000;font-weight:bold">=</span> q <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;%&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ElseIf</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 5 <span style="color:#000;font-weight:bold">Or</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 4 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;MsgBox CR
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> CR.Text
</span></span><span style="display:flex;"><span>                P <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">*</span> 100
</span></span><span style="display:flex;"><span>                q <span style="color:#000;font-weight:bold">=</span> Format(Round(P, 2), <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>                CR.Text <span style="color:#000;font-weight:bold">=</span> q <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;%&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="d文字">d文字</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">宋体宋体</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;选中范围字体为宋体+宋体
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection.Font
</span></span><span style="display:flex;"><span>        .NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>        .NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>        .NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">宋体罗马</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;文字-宋体罗马
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;选中范围字体为宋体+Times
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection.Font
</span></span><span style="display:flex;"><span>        .NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;仿宋&#34;</span>
</span></span><span style="display:flex;"><span>        .NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>        .NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">楷体加粗</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;文字-楷体加粗
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;选中范围字体为楷体加粗
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection.Font
</span></span><span style="display:flex;"><span>        .NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;楷体&#34;</span>
</span></span><span style="display:flex;"><span>        .NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;楷体&#34;</span>
</span></span><span style="display:flex;"><span>        .NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;楷体&#34;</span>
</span></span><span style="display:flex;"><span>        .Name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;楷体&#34;</span>
</span></span><span style="display:flex;"><span>        .Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">去除空白</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;文字-去除空白
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;删除换行及空格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    Selection.Find.ClearFormatting   <span style="color:#998;font-style:italic">&#39;删除空格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Selection.Find.Replacement.ClearFormatting
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> Selection.Find
</span></span><span style="display:flex;"><span>        .Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>        .Replacement.Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        .Forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .Wrap <span style="color:#000;font-weight:bold">=</span> wdFindStop
</span></span><span style="display:flex;"><span>        .Format <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchCase <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchWholeWord <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchByte <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchSoundsLike <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchAllWordForms <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    Selection.Find.Execute Replace:<span style="color:#000;font-weight:bold">=</span>wdReplaceAll
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    Selection.Find.ClearFormatting   <span style="color:#998;font-style:italic">&#39;删除大空格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Selection.Find.Replacement.ClearFormatting
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> Selection.Find
</span></span><span style="display:flex;"><span>        .Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;　&#34;</span>
</span></span><span style="display:flex;"><span>        .Replacement.Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        .Forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .Wrap <span style="color:#000;font-weight:bold">=</span> wdFindStop
</span></span><span style="display:flex;"><span>        .Format <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchCase <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchWholeWord <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchByte <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchSoundsLike <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchAllWordForms <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    Selection.Find.Execute Replace:<span style="color:#000;font-weight:bold">=</span>wdReplaceAll
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    Selection.Find.Replacement.ClearFormatting    <span style="color:#998;font-style:italic">&#39;删除连续两个回车
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection.Find
</span></span><span style="display:flex;"><span>        .Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;^p^p&#34;</span>
</span></span><span style="display:flex;"><span>        .Replacement.Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;^p&#34;</span>
</span></span><span style="display:flex;"><span>        .Forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .Wrap <span style="color:#000;font-weight:bold">=</span> wdFindStop
</span></span><span style="display:flex;"><span>        .Format <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchCase <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchWholeWord <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchByte <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchSoundsLike <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchAllWordForms <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    Selection.Find.Execute Replace:<span style="color:#000;font-weight:bold">=</span>wdReplaceAll
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">中英文标点互换</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39; 文字-中英文标点互换
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Dim</span> ChineseInterpunction() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, EnglishInterpunction() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> myArray1() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, myArray2() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, strFind <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, strRep <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> msgResult <span style="color:#000;font-weight:bold">As</span> VbMsgBoxResult, n <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Byte</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; 定义一个中文标点的数组对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ChineseInterpunction <span style="color:#000;font-weight:bold">=</span> Array(<span style="color:#d14">&#34;，&#34;</span>, <span style="color:#d14">&#34;。&#34;</span>, <span style="color:#d14">&#34;；&#34;</span>, <span style="color:#d14">&#34;：&#34;</span>, <span style="color:#d14">&#34;？&#34;</span>, <span style="color:#d14">&#34;！&#34;</span>, <span style="color:#d14">&#34;……&#34;</span>, <span style="color:#d14">&#34;—&#34;</span>, <span style="color:#d14">&#34;～&#34;</span>, <span style="color:#d14">&#34;（&#34;</span>, <span style="color:#d14">&#34;）&#34;</span>, <span style="color:#d14">&#34;《&#34;</span>, <span style="color:#d14">&#34;》&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; 定义一个英文标点的数组对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    EnglishInterpunction <span style="color:#000;font-weight:bold">=</span> Array(<span style="color:#d14">&#34;,&#34;</span>, <span style="color:#d14">&#34;.&#34;</span>, <span style="color:#d14">&#34;;&#34;</span>, <span style="color:#d14">&#34;:&#34;</span>, <span style="color:#d14">&#34;?&#34;</span>, <span style="color:#d14">&#34;!&#34;</span>, <span style="color:#d14">&#34;…&#34;</span>, <span style="color:#d14">&#34;-&#34;</span>, <span style="color:#d14">&#34;~&#34;</span>, <span style="color:#d14">&#34;(&#34;</span>, <span style="color:#d14">&#34;)&#34;</span>, <span style="color:#d14">&#34;&amp;lt;&#34;</span>, <span style="color:#d14">&#34;&amp;gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; 提示用户交互的 MSGBOX 对话框
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    msgResult <span style="color:#000;font-weight:bold">=</span> MsgBox(<span style="color:#d14">&#34;您想中英标点互换吗？按 Y 将中文标点转为英文标点，按 N 将英文标点转为中文标点！&#34;</span>, vbYesNoCancel)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> msgResult
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Case</span> vbCancel
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#a61717;background-color:#e3d2d2">&#39; </span><span style="color:#900;font-weight:bold">如果用户选择了取消按钮</span><span style="color:#a61717;background-color:#e3d2d2">，</span>则退出程序运行
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Case</span> vbYes <span style="color:#998;font-style:italic">&#39; 如果用户选择了 YES, 则将中文标点转换为英文标点
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            myArray1 <span style="color:#000;font-weight:bold">=</span> ChineseInterpunction
</span></span><span style="display:flex;"><span>            myArray2 <span style="color:#000;font-weight:bold">=</span> EnglishInterpunction
</span></span><span style="display:flex;"><span>            strFind <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;“(*)”&#34;</span>
</span></span><span style="display:flex;"><span>            strRep <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;\1&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Case</span> vbNo <span style="color:#998;font-style:italic">&#39; 如果用户选择了 NO, 则将英文标点转换为中文标点
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            myArray1 <span style="color:#000;font-weight:bold">=</span> EnglishInterpunction
</span></span><span style="display:flex;"><span>            myArray2 <span style="color:#000;font-weight:bold">=</span> ChineseInterpunction
</span></span><span style="display:flex;"><span>            strFind <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;(*)&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            strRep <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;“\1”&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39; 关闭屏幕更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">For</span> n <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">To</span> UBound(ChineseInterpunction)  <span style="color:#998;font-style:italic">&#39; 从数组的下标到上标间作一个循环
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">With</span> Selection.Find
</span></span><span style="display:flex;"><span>            .ClearFormatting <span style="color:#998;font-style:italic">&#39; 不限定查找格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39; 不使用通配符
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; 查找相应的英文标点，替换为对应的中文标点
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Execute findtext:<span style="color:#000;font-weight:bold">=</span>myArray1(n), replacewith:<span style="color:#000;font-weight:bold">=</span>myArray2(n), Replace:<span style="color:#000;font-weight:bold">=</span>wdReplaceAll
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> Selection.Find
</span></span><span style="display:flex;"><span>        .ClearFormatting <span style="color:#998;font-style:italic">&#39; 不限定查找格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39; 使用通配符
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .Execute findtext:<span style="color:#000;font-weight:bold">=</span>strFind, replacewith:<span style="color:#000;font-weight:bold">=</span>strRep, Replace:<span style="color:#000;font-weight:bold">=</span>wdReplaceAll
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39; 恢复屏幕更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">高亮</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;文字-HighLight
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">If</span> Selection.Range.HighlightColorIndex <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        Selection.Range.HighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdYellow
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        Selection.Range.HighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdNoHighlight
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="e大纲">e大纲</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">大纲一级</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;大纲调整-一级
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Paragraphs.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel1
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">大纲二级</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;大纲调整-二级
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Paragraphs.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel2
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">大纲三级</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;大纲调整-三级
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Paragraphs.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel3
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">大纲四级</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;大纲调整-四级
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Paragraphs.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel4
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">大纲五级</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;大纲调整-五级
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Paragraphs.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevel5
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">大纲正文</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;大纲调整-正文
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Paragraphs.OutlineLevel <span style="color:#000;font-weight:bold">=</span> wdOutlineLevelBodyText
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="fexcel贴数">fExcel贴数</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">粘贴格式文本</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> xl <span style="color:#000;font-weight:bold">=</span> GetObject(, <span style="color:#d14">&#34;excel.application&#34;</span>)
</span></span><span style="display:flex;"><span>    xlr <span style="color:#000;font-weight:bold">=</span> xl.Selection.Rows.Count
</span></span><span style="display:flex;"><span>    xlc <span style="color:#000;font-weight:bold">=</span> xl.Selection.Columns.Count
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        wdc <span style="color:#000;font-weight:bold">=</span> .Information(16)
</span></span><span style="display:flex;"><span>        wdr <span style="color:#000;font-weight:bold">=</span> .Information(13)
</span></span><span style="display:flex;"><span>        rangeselect wdr, wdc, xlr, xlc
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">ReDim</span> arr(1 <span style="color:#000;font-weight:bold">To</span> 1)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> sht <span style="color:#000;font-weight:bold">In</span> .Cells
</span></span><span style="display:flex;"><span>            i <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ReDim</span> Preserve arr(1 <span style="color:#000;font-weight:bold">To</span> i)
</span></span><span style="display:flex;"><span>            arr(i) <span style="color:#000;font-weight:bold">=</span> sht.Range.Font.Underline
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        .CopyFormat
</span></span><span style="display:flex;"><span>        .PasteAndFormat (wdFormatSurroundingFormattingWithEmphasis)
</span></span><span style="display:flex;"><span>        .PasteFormat
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> .Find
</span></span><span style="display:flex;"><span>            .Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>            .Replacement.Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            .Forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>            .Wrap <span style="color:#000;font-weight:bold">=</span> wdFindStop
</span></span><span style="display:flex;"><span>            .Execute Replace:<span style="color:#000;font-weight:bold">=</span>wdReplaceAll
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>        rangeselect wdr, wdc, xlr, xlc
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> sht <span style="color:#000;font-weight:bold">In</span> .Cells
</span></span><span style="display:flex;"><span>            j <span style="color:#000;font-weight:bold">=</span> j <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>            sht.Range.Font.Underline <span style="color:#000;font-weight:bold">=</span> arr(j)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">双下划线</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineDouble <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineNone
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ElseIf</span> Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineNone <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineDouble
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">单下划线</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineSingle <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineNone
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ElseIf</span> Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineNone <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        Selection.Font.Underline <span style="color:#000;font-weight:bold">=</span> wdUnderlineSingle
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">rangeselect</span>(wdr, wdc, xlr, xlc)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>        .Tables(1).Cell(wdr, wdc).Select
</span></span><span style="display:flex;"><span>        .Collapse wdCollapseStart
</span></span><span style="display:flex;"><span>        st <span style="color:#000;font-weight:bold">=</span> .Start
</span></span><span style="display:flex;"><span>        .Tables(1).Cell(wdr <span style="color:#000;font-weight:bold">+</span> xlr <span style="color:#000;font-weight:bold">-</span> 1, wdc <span style="color:#000;font-weight:bold">+</span> xlc <span style="color:#000;font-weight:bold">-</span> 1).Select
</span></span><span style="display:flex;"><span>        .Collapse wdCollapseEnd
</span></span><span style="display:flex;"><span>        ed <span style="color:#000;font-weight:bold">=</span> .End
</span></span><span style="display:flex;"><span>        ActiveDocument.Range(st, ed).Select
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span></code></pre></div><h2 id="g批注">g批注</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">添加批注</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;批注-添加批注
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;添加批注
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39;关闭屏幕更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Selection.Collapse Direction:<span style="color:#000;font-weight:bold">=</span>wdCollapseEnd
</span></span><span style="display:flex;"><span>    ActiveDocument.Comments.Add _
</span></span><span style="display:flex;"><span>        Range:<span style="color:#000;font-weight:bold">=</span>Selection.Range, Text:<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39;恢复屏幕更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">删除批注</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;批注-删除批注
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;删除批注
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> err_msgbox
</span></span><span style="display:flex;"><span>    Selection.Comments(1).Delete
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">err_msgbox</span>:
</span></span><span style="display:flex;"><span>    MsgBox (<span style="color:#d14">&#34;你需要先选中一个批注&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">修订上色</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> oDoc <span style="color:#000;font-weight:bold">As</span> Document
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> oDoc <span style="color:#000;font-weight:bold">=</span> Word.ActiveDocument
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> oRevision <span style="color:#000;font-weight:bold">As</span> Revision
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> oRevision <span style="color:#000;font-weight:bold">In</span> oDoc.Revisions
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> oRevision
</span></span><span style="display:flex;"><span>            t <span style="color:#000;font-weight:bold">=</span> .Range.Text
</span></span><span style="display:flex;"><span>            .Range.HighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdYellow
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="h行列校验">h行列校验</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">选行校验</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;行列校验-选行校验
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    i <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    x <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    n <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> wdSelectionColumn <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells <span style="color:#998;font-style:italic">&#39;求所选列合计数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> Acell.ColumnIndex <span style="color:#000;font-weight:bold">&gt;</span> n <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                n <span style="color:#000;font-weight:bold">=</span> Acell.ColumnIndex
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR1 <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR1.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> CR1.Text <span style="color:#000;font-weight:bold">+</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells <span style="color:#998;font-style:italic">&#39;求所选列最后一行合计数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">Set</span> CR2 <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> Acell.ColumnIndex <span style="color:#000;font-weight:bold">=</span> n <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR2.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    x <span style="color:#000;font-weight:bold">=</span> CR2.Text <span style="color:#000;font-weight:bold">+</span> x
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        P <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">-</span> x
</span></span><span style="display:flex;"><span>        q <span style="color:#000;font-weight:bold">=</span> P <span style="color:#000;font-weight:bold">-</span> x
</span></span><span style="display:flex;"><span>        y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;列校验:&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(P, <span style="color:#d14">&#34;Standard&#34;</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;-&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(x, <span style="color:#d14">&#34;Standard&#34;</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;=&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(q, <span style="color:#d14">&#34;Standard&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;只支持选中表格范围!&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    Application.StatusBar <span style="color:#000;font-weight:bold">=</span> y
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">选列校验</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;行列校验-选列校验
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    i <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    x <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    n <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> wdSelectionColumn <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells <span style="color:#998;font-style:italic">&#39;求所选列合计数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> Acell.RowIndex <span style="color:#000;font-weight:bold">&gt;</span> n <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                n <span style="color:#000;font-weight:bold">=</span> Acell.RowIndex
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR1 <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR1.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> CR1.Text <span style="color:#000;font-weight:bold">+</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells <span style="color:#998;font-style:italic">&#39;求所选列最后一行合计数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">Set</span> CR2 <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> Acell.RowIndex <span style="color:#000;font-weight:bold">=</span> n <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR2.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    x <span style="color:#000;font-weight:bold">=</span> CR2.Text <span style="color:#000;font-weight:bold">+</span> x
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        P <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">-</span> x
</span></span><span style="display:flex;"><span>        q <span style="color:#000;font-weight:bold">=</span> P <span style="color:#000;font-weight:bold">-</span> x
</span></span><span style="display:flex;"><span>        y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;列校验:&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(P, <span style="color:#d14">&#34;Standard&#34;</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;-&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(x, <span style="color:#d14">&#34;Standard&#34;</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;=&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(q, <span style="color:#d14">&#34;Standard&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;只支持选中表格范围!&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    Application.StatusBar <span style="color:#000;font-weight:bold">=</span> y
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">区域求和</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;行列校验-区域求和
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    i <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 5 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> CR.Text <span style="color:#000;font-weight:bold">+</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        i <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;合计:&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(i, <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">ElseIf</span> Selection.Type <span style="color:#000;font-weight:bold">=</span> 4 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> Acell <span style="color:#000;font-weight:bold">In</span> Selection.Cells
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> CR <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(Acell.Range.Start, Acell.Range.End <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsNumeric(CR.Text) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                i <span style="color:#000;font-weight:bold">=</span> CR.Text <span style="color:#000;font-weight:bold">+</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        i <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;合计:&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Format(i, <span style="color:#d14">&#34;#,##0.00;-#,##0.00; &#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        i <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;只支持表格内行或列求和!&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    Application.StatusBar <span style="color:#000;font-weight:bold">=</span> i
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="i多表处理">i多表处理</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">多表_一键调整</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;批量调整表格格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>  <span style="color:#998;font-style:italic">&#39;关闭屏幕刷新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.DisplayAlerts <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>  <span style="color:#998;font-style:italic">&#39;关闭提示
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>  <span style="color:#998;font-style:italic">&#39;忽略错误
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;-------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Dim</span> mytable <span style="color:#000;font-weight:bold">As</span> Table, i <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> mytable <span style="color:#000;font-weight:bold">In</span> ActiveDocument.Tables
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">With</span> mytable
</span></span><span style="display:flex;"><span>            .Shading.ForegroundPatternColor <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic
</span></span><span style="display:flex;"><span>            .Shading.BackgroundPatternColor <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic
</span></span><span style="display:flex;"><span>            Options.DefaultHighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdNoHighlight
</span></span><span style="display:flex;"><span>            .Range.HighlightColorIndex <span style="color:#000;font-weight:bold">=</span> wdNoHighlight
</span></span><span style="display:flex;"><span>            .Style <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;表格主题&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderLeft)
</span></span><span style="display:flex;"><span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle: .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderRight)
</span></span><span style="display:flex;"><span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle: .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderTop)
</span></span><span style="display:flex;"><span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle: .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderBottom)
</span></span><span style="display:flex;"><span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle: .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth150pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Borders(wdBorderVertical)
</span></span><span style="display:flex;"><span>                .LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleSingle: .LineWidth <span style="color:#000;font-weight:bold">=</span> wdLineWidth050pt
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            .Borders(wdBorderDiagonalDown).LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleNone
</span></span><span style="display:flex;"><span>            .Borders(wdBorderDiagonalUp).LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleNone
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;单元格边距
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .TopPadding <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;设置上边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .BottomPadding <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;设置下边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .LeftPadding <span style="color:#000;font-weight:bold">=</span> PixelsToPoints(0, <span style="color:#000;font-weight:bold">True</span>)  <span style="color:#998;font-style:italic">&#39;设置左边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .RightPadding <span style="color:#000;font-weight:bold">=</span> PixelsToPoints(0, <span style="color:#000;font-weight:bold">True</span>) <span style="color:#998;font-style:italic">&#39;设置右边距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Spacing <span style="color:#000;font-weight:bold">=</span> PixelsToPoints(0, <span style="color:#000;font-weight:bold">True</span>) <span style="color:#998;font-style:italic">&#39;允许单元格间距为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .AllowPageBreaks <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39;允许断页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39;.AllowAutoFit = True &#39;允许自动重调尺寸
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">With</span> .Rows
</span></span><span style="display:flex;"><span>                .WrapAroundText <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39;取消文字环绕
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;.Alignment = wdAlignRowCenter &#39;表水平居中  wdAlignRowLeft &#39;左对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .AllowBreakAcrossPages <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39;不允许行断页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Height <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0.8) <span style="color:#998;font-style:italic">&#39;行高0.8
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .HeightRule <span style="color:#000;font-weight:bold">=</span> wdRowHeightAtLeast <span style="color:#998;font-style:italic">&#39;行高设为最小值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .LeftIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;左面缩进量为0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">With</span> .Range
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> .Font <span style="color:#998;font-style:italic">&#39;字体格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .NameFarEast <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>                    .NameAscii <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .NameOther <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Times New Roman&#34;</span>
</span></span><span style="display:flex;"><span>                    .Color <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic <span style="color:#998;font-style:italic">&#39;自动字体颜色
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Size <span style="color:#000;font-weight:bold">=</span> 10.5   <span style="color:#998;font-style:italic">&#39;字号
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .Kerning <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .DisableCharacterSpaceGrid <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>  <span style="color:#998;font-style:italic">&#39;选定段落中的字符与行网格对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">With</span> .ParagraphFormat <span style="color:#998;font-style:italic">&#39;段落格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .LineUnitBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .LineUnitAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .SpaceBefore <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .SpaceAfter <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                    .CharacterUnitFirstLineIndent <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#998;font-style:italic">&#39;取消首行缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .FirstLineIndent <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(0) <span style="color:#998;font-style:italic">&#39;取消首行缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .LineSpacingRule <span style="color:#000;font-weight:bold">=</span> wdLineSpaceSingle <span style="color:#998;font-style:italic">&#39;wdLineSpaceSingle &#39;单倍行距  wdLineSpaceExactly &#39;行距固定值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">&#39;&#39;.LineSpacing = 18 &#39;设置行间距为18磅，配合行距固定值
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#998;font-style:italic">&#39;.Alignment = wdAlignParagraphCenter &#39;单元格水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .AutoAdjustRightIndent <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>  <span style="color:#998;font-style:italic">&#39;自动调整所选段落的右缩进
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    .DisableLineHeightGrid <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>   <span style="color:#998;font-style:italic">&#39;选定段落中的字符与行网格对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>                .Cells.VerticalAlignment <span style="color:#000;font-weight:bold">=</span> wdCellAlignVerticalCenter  <span style="color:#998;font-style:italic">&#39;单元格垂直居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> cl <span style="color:#000;font-weight:bold">In</span> .Range.Cells    <span style="color:#998;font-style:italic">&#39;文字靠左，数字靠右
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                Acell <span style="color:#000;font-weight:bold">=</span> ActiveDocument.Range(cl.Range.Start, cl.Range.End <span style="color:#000;font-weight:bold">-</span> 1).Text <span style="color:#998;font-style:italic">&#39;提取文本
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">If</span> IsNumeric(Acell) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    cl.Range.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphRight    <span style="color:#998;font-style:italic">&#39;右对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    cl.Range.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphJustify   <span style="color:#998;font-style:italic">&#39;左对齐
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">If</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;合计&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;总计&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;总 计&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;合 计&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        cl.Range.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter    <span style="color:#998;font-style:italic">&#39;水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                        <span style="color:#000;font-weight:bold">If</span> cl.ColumnIndex <span style="color:#000;font-weight:bold">=</span> .Columns.Count <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            .Columns(cl.ColumnIndex).Select
</span></span><span style="display:flex;"><span>                            Selection.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            cl.Row.Range.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">ElseIf</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;序号&#34;</span> <span style="color:#000;font-weight:bold">Or</span> Acell <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;序 号&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        .Columns(cl.ColumnIndex).Select
</span></span><span style="display:flex;"><span>                        Selection.ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter    <span style="color:#998;font-style:italic">&#39;水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;设置首行格式
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Rows(1).Select <span style="color:#998;font-style:italic">&#39; 选中第一个单元格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">With</span> Selection
</span></span><span style="display:flex;"><span>                .Rows.HeadingFormat <span style="color:#000;font-weight:bold">=</span> wdToggle <span style="color:#998;font-style:italic">&#39;自动标题行重复
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .ParagraphFormat.Alignment <span style="color:#000;font-weight:bold">=</span> wdAlignParagraphCenter   <span style="color:#998;font-style:italic">&#39;水平居中
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Range.Font.Bold <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39;表头加粗黑体
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Shading.ForegroundPatternColor <span style="color:#000;font-weight:bold">=</span> wdColorAutomatic <span style="color:#998;font-style:italic">&#39;首行自动颜色
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                .Shading.BackgroundPatternColor <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>603923969 <span style="color:#998;font-style:italic">&#39;首行底纹填充
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;.Borders(wdBorderBottom).LineStyle = xlContinuous
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;.Borders(wdBorderBottom).LineWidth = wdLineWidth50pt
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39;自动调整表格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .Columns.PreferredWidthType <span style="color:#000;font-weight:bold">=</span> wdPreferredWidthAuto
</span></span><span style="display:flex;"><span>            .AutoFitBehavior (wdAutoFitContent) <span style="color:#998;font-style:italic">&#39;根据内容调整表格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            .AutoFitBehavior (wdAutoFitWindow) <span style="color:#998;font-style:italic">&#39;根据窗口调整表格
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;---------------------------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ERR.Clear: <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> 0 <span style="color:#998;font-style:italic">&#39;恢复错误捕捉
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.DisplayAlerts <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>  <span style="color:#998;font-style:italic">&#39;开启提示
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>   <span style="color:#998;font-style:italic">&#39;开启屏幕刷新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">多表处理_表格选中</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Dim</span> tempTable <span style="color:#000;font-weight:bold">As</span> Table
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;Application.ScreenUpdating = False
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;判断文档是否被保护
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">If</span> ActiveDocument.ProtectionType <span style="color:#000;font-weight:bold">=</span> wdAllowOnlyFormFields <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        MsgBox <span style="color:#d14">&#34;文档已保护，此时不能选中多个表格！&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;删除所有可编辑的区域
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ActiveDocument.DeleteAllEditableRanges wdEditorEveryone
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;添加可编辑区域
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> tempTable <span style="color:#000;font-weight:bold">In</span> ActiveDocument.Tables
</span></span><span style="display:flex;"><span>        tempTable.Range.Editors.Add wdEditorEveryone
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;选中所有可编辑区域
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ActiveDocument.SelectAllEditableRanges wdEditorEveryone
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;删除所有可编辑的区域
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ActiveDocument.DeleteAllEditableRanges wdEditorEveryone
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;Application.ScreenUpdating = True
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    MsgBox <span style="color:#d14">&#34;完成&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="jsonconverter">JsonConverter</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; VBA-JSON v2.3.1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; (c) Tim Hall - https://github.com/VBA-tools/VBA-JSON
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; JSON Converter for VBA
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Errors:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; 10001 - JSON parse error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @class JsonConverter
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @author tim.hall.engr@gmail.com
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @license MIT (http://www.opensource.org/licenses/mit-license.php)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Based originally on vba-json (with extensive changes)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; BSD license included below
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; JSONLib, http://code.google.com/p/vba-json/
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Copyright (c) 2013, Ryo Yokoyama
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; All rights reserved.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Redistribution and use in source and binary forms, with or without
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; modification, are permitted provided that the following conditions are met:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;     * Redistributions of source code must retain the above copyright
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;       notice, this list of conditions and the following disclaimer.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;     * Redistributions in binary form must reproduce the above copyright
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;       notice, this list of conditions and the following disclaimer in the
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;       documentation and/or other materials provided with the distribution.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;     * Neither the name of the &lt;organization&gt; nor the
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;       names of its contributors may be used to endorse or promote products
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;       derived from this software without specific prior written permission.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &#34;AS IS&#34; AND
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; DISCLAIMED. IN NO EVENT SHALL &lt;COPYRIGHT HOLDER&gt; BE LIABLE FOR ANY
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Option</span> Explicit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; === VBA-UTC Headers
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#If Mac Then</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If VBA7 Then</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; 64-bit Mac (2016)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_popen</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;/usr/lib/libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;popen&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_Command <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> utc_Mode <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>) <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_pclose</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;/usr/lib/libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;pclose&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_File <span style="color:#000;font-weight:bold">As</span> LongPtr) <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_fread</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;/usr/lib/libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;fread&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> utc_Size <span style="color:#000;font-weight:bold">As</span> LongPtr, <span style="color:#000;font-weight:bold">ByVal</span> utc_Number <span style="color:#000;font-weight:bold">As</span> LongPtr, <span style="color:#000;font-weight:bold">ByVal</span> utc_File <span style="color:#000;font-weight:bold">As</span> LongPtr) <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_feof</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;/usr/lib/libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;feof&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_File <span style="color:#000;font-weight:bold">As</span> LongPtr) <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; 32-bit Mac
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_popen</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;popen&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_Command <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> utc_Mode <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_pclose</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;pclose&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_File <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_fread</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;fread&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> utc_Size <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>, <span style="color:#000;font-weight:bold">ByVal</span> utc_Number <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>, <span style="color:#000;font-weight:bold">ByVal</span> utc_File <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_feof</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;libc.dylib&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;feof&#34;</span> _
</span></span><span style="display:flex;"><span>            (<span style="color:#000;font-weight:bold">ByVal</span> utc_File <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#ElseIf VBA7 Then</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; http://msdn.microsoft.com/en-us/library/windows/desktop/ms724421.aspx
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; http://msdn.microsoft.com/en-us/library/windows/desktop/ms724949.aspx
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; http://msdn.microsoft.com/en-us/library/windows/desktop/ms725485.aspx
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_GetTimeZoneInformation</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;kernel32&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;GetTimeZoneInformation&#34;</span> _
</span></span><span style="display:flex;"><span>            (utc_lpTimeZoneInformation <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_SystemTimeToTzSpecificLocalTime</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;kernel32&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;SystemTimeToTzSpecificLocalTime&#34;</span> _
</span></span><span style="display:flex;"><span>            (utc_lpTimeZoneInformation <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION, utc_lpUniversalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME, utc_lpLocalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_TzSpecificLocalTimeToSystemTime</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;kernel32&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;TzSpecificLocalTimeToSystemTime&#34;</span> _
</span></span><span style="display:flex;"><span>            (utc_lpTimeZoneInformation <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION, utc_lpLocalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME, utc_lpUniversalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_GetTimeZoneInformation</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;kernel32&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;GetTimeZoneInformation&#34;</span> _
</span></span><span style="display:flex;"><span>            (utc_lpTimeZoneInformation <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_SystemTimeToTzSpecificLocalTime</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;kernel32&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;SystemTimeToTzSpecificLocalTime&#34;</span> _
</span></span><span style="display:flex;"><span>            (utc_lpTimeZoneInformation <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION, utc_lpUniversalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME, utc_lpLocalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_TzSpecificLocalTimeToSystemTime</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;kernel32&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;TzSpecificLocalTimeToSystemTime&#34;</span> _
</span></span><span style="display:flex;"><span>            (utc_lpTimeZoneInformation <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION, utc_lpLocalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME, utc_lpUniversalTime <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Then</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#If VBA7 Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Private</span> Type utc_ShellResult
</span></span><span style="display:flex;"><span>                utc_Output <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>                utc_ExitCode <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> Type
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Private</span> Type utc_ShellResult
</span></span><span style="display:flex;"><span>                utc_Output <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>                utc_ExitCode <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> Type
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> Type utc_SYSTEMTIME
</span></span><span style="display:flex;"><span>            utc_wYear <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wMonth <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wDayOfWeek <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wDay <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wHour <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wMinute <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wSecond <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_wMilliseconds <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> Type
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> Type utc_TIME_ZONE_INFORMATION
</span></span><span style="display:flex;"><span>            utc_Bias <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>            utc_StandardName(0 <span style="color:#000;font-weight:bold">To</span> 31) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_StandardDate <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME
</span></span><span style="display:flex;"><span>            utc_StandardBias <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>            utc_DaylightName(0 <span style="color:#000;font-weight:bold">To</span> 31) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            utc_DaylightDate <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME
</span></span><span style="display:flex;"><span>            utc_DaylightBias <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> Type
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; === End VBA-UTC
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> Type json_Options
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; VBA only stores 15 significant digits, so any numbers larger than that are truncated
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; This can lead to issues when BIGINT&#39;s are used (e.g. for Ids or Credit Cards), as they will be invalid above 15 digits
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; See: http://support.microsoft.com/kb/269370
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; By default, VBA-JSON will use String for numbers longer than 15 characters that contain only digits
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; to override set `JsonConverter.JsonOptions.UseDoubleForLargeNumbers = True`
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        UseDoubleForLargeNumbers <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; The JSON standard requires object keys to be quoted (&#34; or &#39;), use this option to allow unquoted keys
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        AllowUnquotedKeys <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; The solidus (/) is not required to be escaped, use this option to escape them as \/ in ConvertToJson
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        EscapeSolidus <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> Type
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Public</span> JsonOptions <span style="color:#000;font-weight:bold">As</span> json_Options
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Public Methods
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Convert JSON string to object (Dictionary/Collection)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @method ParseJson
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {String} json_String
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @return {Object} (Dictionary or Collection)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @throws 10001 - JSON parse error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ParseJson</span>(<span style="color:#000;font-weight:bold">ByVal</span> JsonString <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Object</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        json_Index <span style="color:#000;font-weight:bold">=</span> 1
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Remove vbCr, vbLf, and vbTab from json_String
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        JsonString <span style="color:#000;font-weight:bold">=</span> VBA.Replace(VBA.Replace(VBA.Replace(JsonString, VBA.vbCr, <span style="color:#d14">&#34;&#34;</span>), VBA.vbLf, <span style="color:#d14">&#34;&#34;</span>), VBA.vbTab, <span style="color:#d14">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_SkipSpaces JsonString, json_Index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(JsonString, json_Index, 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;{&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> ParseJson <span style="color:#000;font-weight:bold">=</span> json_ParseObject(JsonString, json_Index)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;[&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> ParseJson <span style="color:#000;font-weight:bold">=</span> json_ParseArray(JsonString, json_Index)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Error: Invalid JSON string
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                ERR.Raise 10001, <span style="color:#d14">&#34;JSONConverter&#34;</span>, json_ParseErrorMessage(JsonString, json_Index, <span style="color:#d14">&#34;Expecting &#39;{&#39; or &#39;[&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Convert object (Dictionary/Collection/Array) to JSON
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @method ConvertToJson
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {Variant} JsonValue (Dictionary, Collection, or Array)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {Integer|String} Whitespace &#34;Pretty&#34; print json with given number of spaces per indentation (Integer) or given string
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @return {String}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ConvertToJson</span>(<span style="color:#000;font-weight:bold">ByVal</span> JsonValue <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, <span style="color:#000;font-weight:bold">Optional</span> <span style="color:#000;font-weight:bold">ByVal</span> Whitespace <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, <span style="color:#000;font-weight:bold">Optional</span> <span style="color:#000;font-weight:bold">ByVal</span> json_CurrentIndentation <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span> <span style="color:#000;font-weight:bold">=</span> 0) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_BufferPosition <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_BufferLength <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_LBound <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_UBound <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_IsFirstItem <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Index2D <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_LBound2D <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_UBound2D <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_IsFirstItem2D <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_DateStr <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Converted <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_SkipItem <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_PrettyPrint <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Indentation <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_InnerIndentation <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_LBound <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1
</span></span><span style="display:flex;"><span>        json_UBound <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1
</span></span><span style="display:flex;"><span>        json_IsFirstItem <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        json_LBound2D <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1
</span></span><span style="display:flex;"><span>        json_UBound2D <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1
</span></span><span style="display:flex;"><span>        json_IsFirstItem2D <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        json_PrettyPrint <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Not</span> IsMissing(Whitespace)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> VBA.VarType(JsonValue)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbNull
</span></span><span style="display:flex;"><span>                ConvertToJson <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;null&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbDate
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                json_DateStr <span style="color:#000;font-weight:bold">=</span> ConvertToIso(VBA.CDate(JsonValue))
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                ConvertToJson <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> json_DateStr <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbString
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; String (or large number encoded as string)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> JsonOptions.UseDoubleForLargeNumbers <span style="color:#000;font-weight:bold">And</span> json_StringIsLargeNumber(JsonValue) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    ConvertToJson <span style="color:#000;font-weight:bold">=</span> JsonValue
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    ConvertToJson <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> json_Encode(JsonValue) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbBoolean
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> JsonValue <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    ConvertToJson <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    ConvertToJson <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbArray <span style="color:#000;font-weight:bold">To</span> VBA.vbArray <span style="color:#000;font-weight:bold">+</span> VBA.vbByte
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> VBA.VarType(Whitespace) <span style="color:#000;font-weight:bold">=</span> VBA.vbString <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.String<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1, Whitespace)
</span></span><span style="display:flex;"><span>                        json_InnerIndentation <span style="color:#000;font-weight:bold">=</span> VBA.String<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 2, Whitespace)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                        json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>((json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1) <span style="color:#000;font-weight:bold">*</span> Whitespace)
</span></span><span style="display:flex;"><span>                        json_InnerIndentation <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>((json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 2) <span style="color:#000;font-weight:bold">*</span> Whitespace)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Array
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                json_BufferAppend json_Buffer, <span style="color:#d14">&#34;[&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                json_LBound <span style="color:#000;font-weight:bold">=</span> LBound(JsonValue, 1)
</span></span><span style="display:flex;"><span>                json_UBound <span style="color:#000;font-weight:bold">=</span> UBound(JsonValue, 1)
</span></span><span style="display:flex;"><span>                json_LBound2D <span style="color:#000;font-weight:bold">=</span> LBound(JsonValue, 2)
</span></span><span style="display:flex;"><span>                json_UBound2D <span style="color:#000;font-weight:bold">=</span> UBound(JsonValue, 2)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> json_LBound <span style="color:#000;font-weight:bold">&gt;=</span> 0 <span style="color:#000;font-weight:bold">And</span> json_UBound <span style="color:#000;font-weight:bold">&gt;=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">For</span> json_Index <span style="color:#000;font-weight:bold">=</span> json_LBound <span style="color:#000;font-weight:bold">To</span> json_UBound
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> json_IsFirstItem <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            json_IsFirstItem <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; Append comma to previous line
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            json_BufferAppend json_Buffer, <span style="color:#d14">&#34;,&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> json_LBound2D <span style="color:#000;font-weight:bold">&gt;=</span> 0 <span style="color:#000;font-weight:bold">And</span> json_UBound2D <span style="color:#000;font-weight:bold">&gt;=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; 2D Array
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                json_BufferAppend json_Buffer, vbNewLine, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;[&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">For</span> json_Index2D <span style="color:#000;font-weight:bold">=</span> json_LBound2D <span style="color:#000;font-weight:bold">To</span> json_UBound2D
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">If</span> json_IsFirstItem2D <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                    json_IsFirstItem2D <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                                    json_BufferAppend json_Buffer, <span style="color:#d14">&#34;,&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                                
</span></span><span style="display:flex;"><span>                                json_Converted <span style="color:#000;font-weight:bold">=</span> ConvertToJson(JsonValue(json_Index, json_Index2D), Whitespace, json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 2)
</span></span><span style="display:flex;"><span>                                
</span></span><span style="display:flex;"><span>                                <span style="color:#998;font-style:italic">&#39; For Arrays/Collections, undefined (Empty/Nothing) is treated as null
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                                <span style="color:#000;font-weight:bold">If</span> json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                    <span style="color:#998;font-style:italic">&#39; (nest to only check if converted = &#34;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                                    <span style="color:#000;font-weight:bold">If</span> json_IsUndefined(JsonValue(json_Index, json_Index2D)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                        json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;null&#34;</span>
</span></span><span style="display:flex;"><span>                                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                                
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                    json_Converted <span style="color:#000;font-weight:bold">=</span> vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> json_InnerIndentation <span style="color:#000;font-weight:bold">&amp;</span> json_Converted
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                                
</span></span><span style="display:flex;"><span>                                json_BufferAppend json_Buffer, json_Converted, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">Next</span> json_Index2D
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                json_BufferAppend json_Buffer, vbNewLine, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;]&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_IsFirstItem2D <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; 1D Array
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            json_Converted <span style="color:#000;font-weight:bold">=</span> ConvertToJson(JsonValue(json_Index), Whitespace, json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; For Arrays/Collections, undefined (Empty/Nothing) is treated as null
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            <span style="color:#000;font-weight:bold">If</span> json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                <span style="color:#998;font-style:italic">&#39; (nest to only check if converted = &#34;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                                <span style="color:#000;font-weight:bold">If</span> json_IsUndefined(JsonValue(json_Index)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                    json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;null&#34;</span>
</span></span><span style="display:flex;"><span>                                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                json_Converted <span style="color:#000;font-weight:bold">=</span> vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> json_Converted
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, json_Converted, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Next</span> json_Index
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> 0
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_BufferAppend json_Buffer, vbNewLine, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> VBA.VarType(Whitespace) <span style="color:#000;font-weight:bold">=</span> VBA.vbString <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.String<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation, Whitespace)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                        json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation <span style="color:#000;font-weight:bold">*</span> Whitespace)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                json_BufferAppend json_Buffer, json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;]&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                ConvertToJson <span style="color:#000;font-weight:bold">=</span> json_BufferToString(json_Buffer, json_BufferPosition)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Dictionary or Collection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbObject
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> VBA.VarType(Whitespace) <span style="color:#000;font-weight:bold">=</span> VBA.vbString <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.String<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1, Whitespace)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                        json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>((json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1) <span style="color:#000;font-weight:bold">*</span> Whitespace)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">If</span> VBA.TypeName(JsonValue) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Dictionary&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_BufferAppend json_Buffer, <span style="color:#d14">&#34;{&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> json_Key <span style="color:#000;font-weight:bold">In</span> JsonValue.Keys
</span></span><span style="display:flex;"><span>                        <span style="color:#998;font-style:italic">&#39; For Objects, undefined (Empty/Nothing) is not added to object
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                        json_Converted <span style="color:#000;font-weight:bold">=</span> ConvertToJson(JsonValue(json_Key), Whitespace, json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            json_SkipItem <span style="color:#000;font-weight:bold">=</span> json_IsUndefined(JsonValue(json_Key))
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            json_SkipItem <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> json_SkipItem <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">If</span> json_IsFirstItem <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                json_IsFirstItem <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                                json_BufferAppend json_Buffer, <span style="color:#d14">&#34;,&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                json_Converted <span style="color:#000;font-weight:bold">=</span> vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> json_Key <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;&#34;&#34;: &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> json_Converted
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                                json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> json_Key <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;&#34;&#34;:&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> json_Converted
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                            
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, json_Converted, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Next</span> json_Key
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        json_BufferAppend json_Buffer, vbNewLine, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> VBA.VarType(Whitespace) <span style="color:#000;font-weight:bold">=</span> VBA.vbString <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.String<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation, Whitespace)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation <span style="color:#000;font-weight:bold">*</span> Whitespace)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    json_BufferAppend json_Buffer, json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;}&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; Collection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">ElseIf</span> VBA.TypeName(JsonValue) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Collection&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_BufferAppend json_Buffer, <span style="color:#d14">&#34;[&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">For</span> <span style="color:#000;font-weight:bold">Each</span> json_Value <span style="color:#000;font-weight:bold">In</span> JsonValue
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> json_IsFirstItem <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            json_IsFirstItem <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, <span style="color:#d14">&#34;,&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        json_Converted <span style="color:#000;font-weight:bold">=</span> ConvertToJson(json_Value, Whitespace, json_CurrentIndentation <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#998;font-style:italic">&#39; For Arrays/Collections, undefined (Empty/Nothing) is treated as null
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                        <span style="color:#000;font-weight:bold">If</span> json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; (nest to only check if converted = &#34;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            <span style="color:#000;font-weight:bold">If</span> json_IsUndefined(json_Value) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                                json_Converted <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;null&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            json_Converted <span style="color:#000;font-weight:bold">=</span> vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> json_Converted
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        json_BufferAppend json_Buffer, json_Converted, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Next</span> json_Value
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> json_PrettyPrint <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        json_BufferAppend json_Buffer, vbNewLine, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">If</span> VBA.VarType(Whitespace) <span style="color:#000;font-weight:bold">=</span> VBA.vbString <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                            json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.String<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation, Whitespace)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                            json_Indentation <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_CurrentIndentation <span style="color:#000;font-weight:bold">*</span> Whitespace)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    json_BufferAppend json_Buffer, json_Indentation <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;]&#34;</span>, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                ConvertToJson <span style="color:#000;font-weight:bold">=</span> json_BufferToString(json_Buffer, json_BufferPosition)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbInteger, VBA.vbLong, VBA.vbSingle, VBA.vbDouble, VBA.vbCurrency, VBA.vbDecimal
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Number (use decimals for numbers)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                ConvertToJson <span style="color:#000;font-weight:bold">=</span> VBA.Replace(JsonValue, <span style="color:#d14">&#34;,&#34;</span>, <span style="color:#d14">&#34;.&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; vbEmpty, vbError, vbDataObject, vbByte, vbUserDefinedType
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39; Use VBA&#39;s built-in to-string
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>                ConvertToJson <span style="color:#000;font-weight:bold">=</span> JsonValue
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> 0
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Private Functions
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseObject</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> Dictionary
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_NextChar <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> json_ParseObject <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">New</span> Dictionary
</span></span><span style="display:flex;"><span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">&lt;&gt;</span> <span style="color:#d14">&#34;{&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            ERR.Raise 10001, <span style="color:#d14">&#34;JSONConverter&#34;</span>, json_ParseErrorMessage(json_String, json_Index, <span style="color:#d14">&#34;Expecting &#39;{&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Do</span>
</span></span><span style="display:flex;"><span>                json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;}&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>                <span style="color:#900;font-weight:bold">ElseIf</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;,&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                    json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                json_Key <span style="color:#000;font-weight:bold">=</span> json_ParseKey(json_String, json_Index)
</span></span><span style="display:flex;"><span>                json_NextChar <span style="color:#000;font-weight:bold">=</span> json_Peek(json_String, json_Index)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> json_NextChar <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;[&#34;</span> <span style="color:#000;font-weight:bold">Or</span> json_NextChar <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;{&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Set</span> json_ParseObject.Item(json_Key) <span style="color:#000;font-weight:bold">=</span> json_ParseValue(json_String, json_Index)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    json_ParseObject.Item(json_Key) <span style="color:#000;font-weight:bold">=</span> json_ParseValue(json_String, json_Index)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseArray</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> Collection
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> json_ParseArray <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">New</span> Collection
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">&lt;&gt;</span> <span style="color:#d14">&#34;[&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            ERR.Raise 10001, <span style="color:#d14">&#34;JSONConverter&#34;</span>, json_ParseErrorMessage(json_String, json_Index, <span style="color:#d14">&#34;Expecting &#39;[&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Do</span>
</span></span><span style="display:flex;"><span>                json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;]&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>                <span style="color:#900;font-weight:bold">ElseIf</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;,&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                    json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                json_ParseArray.Add json_ParseValue(json_String, json_Index)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseValue</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;{&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> json_ParseValue <span style="color:#000;font-weight:bold">=</span> json_ParseObject(json_String, json_Index)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;[&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> json_ParseValue <span style="color:#000;font-weight:bold">=</span> json_ParseArray(json_String, json_Index)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span>, <span style="color:#d14">&#34;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>                json_ParseValue <span style="color:#000;font-weight:bold">=</span> json_ParseString(json_String, json_Index)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 4) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;true&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_ParseValue <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 4
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">ElseIf</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 5) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;false&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_ParseValue <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 5
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">ElseIf</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 4) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;null&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_ParseValue <span style="color:#000;font-weight:bold">=</span> Null
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 4
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">ElseIf</span> VBA.InStr(<span style="color:#d14">&#34;+-0123456789&#34;</span>, VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_ParseValue <span style="color:#000;font-weight:bold">=</span> json_ParseNumber(json_String, json_Index)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    ERR.Raise 10001, <span style="color:#d14">&#34;JSONConverter&#34;</span>, json_ParseErrorMessage(json_String, json_Index, <span style="color:#d14">&#34;Expecting &#39;STRING&#39;, &#39;NUMBER&#39;, null, true, false, &#39;{&#39;, or &#39;[&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseString</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Quote <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Char <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Code <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_BufferPosition <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_BufferLength <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Store opening quote to look for matching closing quote
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        json_Quote <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)
</span></span><span style="display:flex;"><span>        json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Do</span> <span style="color:#000;font-weight:bold">While</span> json_Index <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">And</span> json_Index <span style="color:#000;font-weight:bold">&lt;=</span> Len(json_String)
</span></span><span style="display:flex;"><span>            json_Char <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> json_Char
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;\&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; Escaped string, \\, or \/
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                    json_Char <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> json_Char
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span>, <span style="color:#d14">&#34;\&#34;</span>, <span style="color:#d14">&#34;/&#34;</span>, <span style="color:#d14">&#34;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, json_Char, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;b&#34;</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, vbBack, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;f&#34;</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, vbFormFeed, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;n&#34;</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, vbCrLf, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;r&#34;</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, vbCr, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, vbTab, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;u&#34;</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; Unicode character escape (e.g. \u00a9 = Copyright)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                            json_Code <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 4)
</span></span><span style="display:flex;"><span>                            json_BufferAppend json_Buffer, VBA.ChrW(VBA.Val(<span style="color:#d14">&#34;&amp;h&#34;</span> <span style="color:#000;font-weight:bold">+</span> json_Code)), json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 4
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> json_Quote
</span></span><span style="display:flex;"><span>                    json_ParseString <span style="color:#000;font-weight:bold">=</span> json_BufferToString(json_Buffer, json_BufferPosition)
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>                <span style="color:#900;font-weight:bold">Case</span> <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    json_BufferAppend json_Buffer, json_Char, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseNumber</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Char <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_IsLargeNumber <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Do</span> <span style="color:#000;font-weight:bold">While</span> json_Index <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">And</span> json_Index <span style="color:#000;font-weight:bold">&lt;=</span> Len(json_String)
</span></span><span style="display:flex;"><span>            json_Char <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> VBA.InStr(<span style="color:#d14">&#34;+-0123456789.eE&#34;</span>, json_Char) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Unlikely to have massive number, so use simple append rather than buffer here
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                json_Value <span style="color:#000;font-weight:bold">=</span> json_Value <span style="color:#000;font-weight:bold">&amp;</span> json_Char
</span></span><span style="display:flex;"><span>                json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">&#39; Excel only stores 15 significant digits, so any numbers larger than that are truncated
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39; This can lead to issues when BIGINT&#39;s are used (e.g. for Ids or Credit Cards), as they will be invalid above 15 digits
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39; See: http://support.microsoft.com/kb/269370
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39; Fix: Parse -&gt; String, Convert -&gt; String longer than 15/16 characters containing only numbers and decimal points -&gt; Number
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#998;font-style:italic">&#39; (decimal doesn&#39;t factor into significant digit count, so if present check for 15 digits + decimal = 16)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                json_IsLargeNumber <span style="color:#000;font-weight:bold">=</span> IIf(InStr(json_Value, <span style="color:#d14">&#34;.&#34;</span>), Len(json_Value) <span style="color:#000;font-weight:bold">&gt;=</span> 17, Len(json_Value) <span style="color:#000;font-weight:bold">&gt;=</span> 16)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> JsonOptions.UseDoubleForLargeNumbers <span style="color:#000;font-weight:bold">And</span> json_IsLargeNumber <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_ParseNumber <span style="color:#000;font-weight:bold">=</span> json_Value
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; VBA.Val does not use regional settings, so guard for comma is not needed
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_ParseNumber <span style="color:#000;font-weight:bold">=</span> VBA.Val(json_Value)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>            <span style="color:#900;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseKey</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Parse key with single or double quotes
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;&#34;</span> <span style="color:#000;font-weight:bold">Or</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#39;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            json_ParseKey <span style="color:#000;font-weight:bold">=</span> json_ParseString(json_String, json_Index)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">ElseIf</span> JsonOptions.AllowUnquotedKeys <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> json_Char <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Do</span> <span style="color:#000;font-weight:bold">While</span> json_Index <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">And</span> json_Index <span style="color:#000;font-weight:bold">&lt;=</span> Len(json_String)
</span></span><span style="display:flex;"><span>                json_Char <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> (json_Char <span style="color:#000;font-weight:bold">&lt;&gt;</span> <span style="color:#d14">&#34; &#34;</span>) <span style="color:#000;font-weight:bold">And</span> (json_Char <span style="color:#000;font-weight:bold">&lt;&gt;</span> <span style="color:#d14">&#34;:&#34;</span>) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    json_ParseKey <span style="color:#000;font-weight:bold">=</span> json_ParseKey <span style="color:#000;font-weight:bold">&amp;</span> json_Char
</span></span><span style="display:flex;"><span>                    json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Do</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            ERR.Raise 10001, <span style="color:#d14">&#34;JSONConverter&#34;</span>, json_ParseErrorMessage(json_String, json_Index, <span style="color:#d14">&#34;Expecting &#39;&#34;&#34;&#39; or &#39;&#39;&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Check for colon and skip if present or throw if not present
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">&lt;&gt;</span> <span style="color:#d14">&#34;:&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            ERR.Raise 10001, <span style="color:#d14">&#34;JSONConverter&#34;</span>, json_ParseErrorMessage(json_String, json_Index, <span style="color:#d14">&#34;Expecting &#39;:&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_IsUndefined</span>(<span style="color:#000;font-weight:bold">ByVal</span> json_Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Empty / Nothing -&gt; undefined
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> VBA.VarType(json_Value)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbEmpty
</span></span><span style="display:flex;"><span>                json_IsUndefined <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Case</span> VBA.vbObject
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> VBA.TypeName(json_Value)
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Case</span> <span style="color:#d14">&#34;Empty&#34;</span>, <span style="color:#d14">&#34;Nothing&#34;</span>
</span></span><span style="display:flex;"><span>                        json_IsUndefined <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_Encode</span>(<span style="color:#000;font-weight:bold">ByVal</span> json_Text <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Reference: http://www.ietf.org/rfc/rfc4627.txt
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Escape: &#34;, \, /, backspace, form feed, line feed, carriage return, tab
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">Dim</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Char <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_AscCode <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_BufferPosition <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_BufferLength <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> json_Index <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> VBA.Len(json_Text)
</span></span><span style="display:flex;"><span>            json_Char <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_Text, json_Index, 1)
</span></span><span style="display:flex;"><span>            json_AscCode <span style="color:#000;font-weight:bold">=</span> VBA.AscW(json_Char)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; When AscW returns a negative number, it returns the twos complement form of that number.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; To convert the twos complement notation into normal binary notation, add 0xFFF to the return result.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; https://support.microsoft.com/en-us/kb/272138
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">If</span> json_AscCode <span style="color:#000;font-weight:bold">&lt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                json_AscCode <span style="color:#000;font-weight:bold">=</span> json_AscCode <span style="color:#000;font-weight:bold">+</span> 65536
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; From spec, &#34;, \, and control characters must be escaped (solidus is optional)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> json_AscCode
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 34
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; &#34; -&gt; 34 -&gt; \&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 92
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; \ -&gt; 92 -&gt; \\
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\\&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 47
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; / -&gt; 47 -&gt; \/ (optional)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">If</span> JsonOptions.EscapeSolidus <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                        json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\/&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 8
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; backspace -&gt; 8 -&gt; \b
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\b&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 12
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; form feed -&gt; 12 -&gt; \f
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\f&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 10
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; line feed -&gt; 10 -&gt; \n
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 13
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; carriage return -&gt; 13 -&gt; \r
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\r&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 9
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; tab -&gt; 9 -&gt; \t
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\t&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 0 <span style="color:#000;font-weight:bold">To</span> 31, 127 <span style="color:#000;font-weight:bold">To</span> 65535
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; Non-ascii characters -&gt; convert to 4-digit hex
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    json_Char <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;\u&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> VBA.Right<span style="color:#a61717;background-color:#e3d2d2">$</span>(<span style="color:#d14">&#34;0000&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> VBA.Hex<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_AscCode), 4)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            json_BufferAppend json_Buffer, json_Char, json_BufferPosition, json_BufferLength
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span> json_Index
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_Encode <span style="color:#000;font-weight:bold">=</span> json_BufferToString(json_Buffer, json_BufferPosition)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_Peek</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>, <span style="color:#000;font-weight:bold">Optional</span> json_NumberOfCharacters <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span> <span style="color:#000;font-weight:bold">=</span> 1) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; &#34;Peek&#34; at the next number of characters without incrementing json_Index (ByVal instead of ByRef)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        json_SkipSpaces json_String, json_Index
</span></span><span style="display:flex;"><span>        json_Peek <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, json_NumberOfCharacters)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">json_SkipSpaces</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Increment index to skip over spaces
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">Do</span> <span style="color:#000;font-weight:bold">While</span> json_Index <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">And</span> json_Index <span style="color:#000;font-weight:bold">&lt;=</span> VBA.Len(json_String) <span style="color:#000;font-weight:bold">And</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_Index, 1) <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>            json_Index <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_StringIsLargeNumber</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Check if the given string is considered a &#34;large number&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; (See json_ParseNumber)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_Length <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_CharIndex <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        json_Length <span style="color:#000;font-weight:bold">=</span> VBA.Len(json_String)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Length with be at least 16 characters and assume will be less than 100 characters
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">If</span> json_Length <span style="color:#000;font-weight:bold">&gt;=</span> 16 <span style="color:#000;font-weight:bold">And</span> json_Length <span style="color:#000;font-weight:bold">&lt;=</span> 100 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> json_CharCode <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            json_StringIsLargeNumber <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> json_CharIndex <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> json_Length
</span></span><span style="display:flex;"><span>                json_CharCode <span style="color:#000;font-weight:bold">=</span> VBA.Asc(VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_CharIndex, 1))
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> json_CharCode
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; Look for .|0-9|E|e
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">Case</span> 46, 48 <span style="color:#000;font-weight:bold">To</span> 57, 69, 101
</span></span><span style="display:flex;"><span>                        <span style="color:#998;font-style:italic">&#39; Continue through characters
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">Case</span> <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                        json_StringIsLargeNumber <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>                <span style="color:#900;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span> json_CharIndex
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_ParseErrorMessage</span>(json_String <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByRef</span> json_Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>, ErrorMessage <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Provide detailed parse error message, including details of where and what occurred
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Example:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Error parsing JSON:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; {&#34;abcde&#34;:True}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;          ^
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Expecting &#39;STRING&#39;, &#39;NUMBER&#39;, null, true, false, &#39;{&#39;, or &#39;[&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_StartIndex <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_StopIndex <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Include 10 characters before and after error (if possible)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        json_StartIndex <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">-</span> 10
</span></span><span style="display:flex;"><span>        json_StopIndex <span style="color:#000;font-weight:bold">=</span> json_Index <span style="color:#000;font-weight:bold">+</span> 10
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> json_StartIndex <span style="color:#000;font-weight:bold">&lt;=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            json_StartIndex <span style="color:#000;font-weight:bold">=</span> 1
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> json_StopIndex <span style="color:#000;font-weight:bold">&gt;</span> VBA.Len(json_String) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            json_StopIndex <span style="color:#000;font-weight:bold">=</span> VBA.Len(json_String)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_ParseErrorMessage <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Error parsing JSON:&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> VBA.vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>            VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_String, json_StartIndex, json_StopIndex <span style="color:#000;font-weight:bold">-</span> json_StartIndex <span style="color:#000;font-weight:bold">+</span> 1) <span style="color:#000;font-weight:bold">&amp;</span> VBA.vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>            VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_Index <span style="color:#000;font-weight:bold">-</span> json_StartIndex) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;^&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> VBA.vbNewLine <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>            ErrorMessage
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">json_BufferAppend</span>(<span style="color:#000;font-weight:bold">ByRef</span> json_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, _
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ByRef</span> json_Append <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, _
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ByRef</span> json_BufferPosition <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>, _
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ByRef</span> json_BufferLength <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; VBA can be slow to append strings due to allocating a new string for each append
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Instead of using the traditional append, allocate a large empty string and then copy string at append position
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Example:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer: &#34;abc  &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Append: &#34;def&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer Position: 3
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer Length: 5
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer position + Append length &gt; Buffer length -&gt; Append chunk of blank space to buffer
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer: &#34;abc       &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer Length: 10
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Put &#34;def&#34; into buffer at position 3 (0-based)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Buffer: &#34;abcdef    &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Approach based on cStringBuilder from vbAccelerator
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; http://www.vbaccelerator.com/home/VB/Code/Techniques/RunTime_Debug_Tracing/VB6_Tracer_Utility_zip_cStringBuilder_cls.asp
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; and clsStringAppend from Philip Swannell
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; https://github.com/VBA-tools/VBA-JSON/pull/82
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_AppendLength <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> json_LengthPlusPosition <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        json_AppendLength <span style="color:#000;font-weight:bold">=</span> VBA.Len(json_Append)
</span></span><span style="display:flex;"><span>        json_LengthPlusPosition <span style="color:#000;font-weight:bold">=</span> json_AppendLength <span style="color:#000;font-weight:bold">+</span> json_BufferPosition
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> json_LengthPlusPosition <span style="color:#000;font-weight:bold">&gt;</span> json_BufferLength <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Appending would overflow buffer, add chunk
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; (double buffer length or append length, whichever is bigger)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">Dim</span> json_AddedLength <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>            json_AddedLength <span style="color:#000;font-weight:bold">=</span> IIf(json_AppendLength <span style="color:#000;font-weight:bold">&gt;</span> json_BufferLength, json_AppendLength, json_BufferLength)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            json_Buffer <span style="color:#000;font-weight:bold">=</span> json_Buffer <span style="color:#000;font-weight:bold">&amp;</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_AddedLength)
</span></span><span style="display:flex;"><span>            json_BufferLength <span style="color:#000;font-weight:bold">=</span> json_BufferLength <span style="color:#000;font-weight:bold">+</span> json_AddedLength
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Note: Namespacing with VBA.Mid$ doesn&#39;t work properly here, throwing compile error:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">&#39; Function call on left-hand side of assignment must return Variant or Object
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_Buffer, json_BufferPosition <span style="color:#000;font-weight:bold">+</span> 1, json_AppendLength) <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">CStr</span>(json_Append)
</span></span><span style="display:flex;"><span>        json_BufferPosition <span style="color:#000;font-weight:bold">=</span> json_BufferPosition <span style="color:#000;font-weight:bold">+</span> json_AppendLength
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">json_BufferToString</span>(<span style="color:#000;font-weight:bold">ByRef</span> json_Buffer <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> json_BufferPosition <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> json_BufferPosition <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            json_BufferToString <span style="color:#000;font-weight:bold">=</span> VBA.Left<span style="color:#a61717;background-color:#e3d2d2">$</span>(json_Buffer, json_BufferPosition)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; VBA-UTC v1.0.6
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; (c) Tim Hall - https://github.com/VBA-tools/VBA-UtcConverter
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; UTC/ISO 8601 Converter for VBA
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Errors:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; 10011 - UTC parsing error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; 10012 - UTC conversion error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; 10013 - ISO 8601 parsing error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; 10014 - ISO 8601 conversion error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @module UtcConverter
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @author tim.hall.engr@gmail.com
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @license MIT (http://www.opensource.org/licenses/mit-license.php)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; (Declarations moved to top)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Public Methods
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Parse UTC date to local date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @method ParseUtc
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {Date} UtcDate
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @return {Date} Local date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @throws 10011 - UTC parsing error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ParseUtc</span>(utc_UtcDate <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> utc_ErrorHandling
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Then</span>
</span></span><span style="display:flex;"><span>            ParseUtc <span style="color:#000;font-weight:bold">=</span> utc_ConvertDate(utc_UtcDate)
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_TimeZoneInfo <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_LocalDate <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            utc_GetTimeZoneInformation utc_TimeZoneInfo
</span></span><span style="display:flex;"><span>            utc_SystemTimeToTzSpecificLocalTime utc_TimeZoneInfo, utc_DateToSystemTime(utc_UtcDate), utc_LocalDate
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            ParseUtc <span style="color:#000;font-weight:bold">=</span> utc_SystemTimeToDate(utc_LocalDate)
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">utc_ErrorHandling</span>:
</span></span><span style="display:flex;"><span>        ERR.Raise 10011, <span style="color:#d14">&#34;UtcConverter.ParseUtc&#34;</span>, <span style="color:#d14">&#34;UTC parsing error: &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Number <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34; - &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Description
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Convert local date to UTC date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @method ConvertToUrc
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {Date} utc_LocalDate
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @return {Date} UTC date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @throws 10012 - UTC conversion error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ConvertToUtc</span>(utc_LocalDate <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> utc_ErrorHandling
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Then</span>
</span></span><span style="display:flex;"><span>            ConvertToUtc <span style="color:#000;font-weight:bold">=</span> utc_ConvertDate(utc_LocalDate, utc_ConvertToUtc:<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_TimeZoneInfo <span style="color:#000;font-weight:bold">As</span> utc_TIME_ZONE_INFORMATION
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_UtcDate <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            utc_GetTimeZoneInformation utc_TimeZoneInfo
</span></span><span style="display:flex;"><span>            utc_TzSpecificLocalTimeToSystemTime utc_TimeZoneInfo, utc_DateToSystemTime(utc_LocalDate), utc_UtcDate
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            ConvertToUtc <span style="color:#000;font-weight:bold">=</span> utc_SystemTimeToDate(utc_UtcDate)
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">utc_ErrorHandling</span>:
</span></span><span style="display:flex;"><span>        ERR.Raise 10012, <span style="color:#d14">&#34;UtcConverter.ConvertToUtc&#34;</span>, <span style="color:#d14">&#34;UTC conversion error: &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Number <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34; - &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Description
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Parse ISO 8601 date string to local date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @method ParseIso
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {Date} utc_IsoString
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @return {Date} Local date
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @throws 10013 - ISO 8601 parsing error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ParseIso</span>(utc_IsoString <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> utc_ErrorHandling
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_Parts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_DateParts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_TimeParts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_OffsetIndex <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_HasOffset <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_NegativeOffset <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_OffsetParts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> utc_Offset <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        utc_Parts <span style="color:#000;font-weight:bold">=</span> VBA.Split(utc_IsoString, <span style="color:#d14">&#34;T&#34;</span>)
</span></span><span style="display:flex;"><span>        utc_DateParts <span style="color:#000;font-weight:bold">=</span> VBA.Split(utc_Parts(0), <span style="color:#d14">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>        ParseIso <span style="color:#000;font-weight:bold">=</span> VBA.DateSerial(VBA.CInt(utc_DateParts(0)), VBA.CInt(utc_DateParts(1)), VBA.CInt(utc_DateParts(2)))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> UBound(utc_Parts) <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> VBA.InStr(utc_Parts(1), <span style="color:#d14">&#34;Z&#34;</span>) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                utc_TimeParts <span style="color:#000;font-weight:bold">=</span> VBA.Split(VBA.Replace(utc_Parts(1), <span style="color:#d14">&#34;Z&#34;</span>, <span style="color:#d14">&#34;&#34;</span>), <span style="color:#d14">&#34;:&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                utc_OffsetIndex <span style="color:#000;font-weight:bold">=</span> VBA.InStr(1, utc_Parts(1), <span style="color:#d14">&#34;+&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> utc_OffsetIndex <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    utc_NegativeOffset <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                    utc_OffsetIndex <span style="color:#000;font-weight:bold">=</span> VBA.InStr(1, utc_Parts(1), <span style="color:#d14">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> utc_OffsetIndex <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    utc_HasOffset <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>                    utc_TimeParts <span style="color:#000;font-weight:bold">=</span> VBA.Split(VBA.Left<span style="color:#a61717;background-color:#e3d2d2">$</span>(utc_Parts(1), utc_OffsetIndex <span style="color:#000;font-weight:bold">-</span> 1), <span style="color:#d14">&#34;:&#34;</span>)
</span></span><span style="display:flex;"><span>                    utc_OffsetParts <span style="color:#000;font-weight:bold">=</span> VBA.Split(VBA.Right<span style="color:#a61717;background-color:#e3d2d2">$</span>(utc_Parts(1), Len(utc_Parts(1)) <span style="color:#000;font-weight:bold">-</span> utc_OffsetIndex), <span style="color:#d14">&#34;:&#34;</span>)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> UBound(utc_OffsetParts)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> 0
</span></span><span style="display:flex;"><span>                            utc_Offset <span style="color:#000;font-weight:bold">=</span> TimeSerial(VBA.CInt(utc_OffsetParts(0)), 0, 0)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> 1
</span></span><span style="display:flex;"><span>                            utc_Offset <span style="color:#000;font-weight:bold">=</span> TimeSerial(VBA.CInt(utc_OffsetParts(0)), VBA.CInt(utc_OffsetParts(1)), 0)
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">Case</span> 2
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">&#39; VBA.Val does not use regional settings, use for seconds to avoid decimal/comma issues
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                            utc_Offset <span style="color:#000;font-weight:bold">=</span> TimeSerial(VBA.CInt(utc_OffsetParts(0)), VBA.CInt(utc_OffsetParts(1)), Int(VBA.Val(utc_OffsetParts(2))))
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">If</span> utc_NegativeOffset <span style="color:#000;font-weight:bold">Then</span>: utc_Offset <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>utc_Offset
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    utc_TimeParts <span style="color:#000;font-weight:bold">=</span> VBA.Split(utc_Parts(1), <span style="color:#d14">&#34;:&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Select</span> <span style="color:#000;font-weight:bold">Case</span> UBound(utc_TimeParts)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 0
</span></span><span style="display:flex;"><span>                    ParseIso <span style="color:#000;font-weight:bold">=</span> ParseIso <span style="color:#000;font-weight:bold">+</span> VBA.TimeSerial(VBA.CInt(utc_TimeParts(0)), 0, 0)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 1
</span></span><span style="display:flex;"><span>                    ParseIso <span style="color:#000;font-weight:bold">=</span> ParseIso <span style="color:#000;font-weight:bold">+</span> VBA.TimeSerial(VBA.CInt(utc_TimeParts(0)), VBA.CInt(utc_TimeParts(1)), 0)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Case</span> 2
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">&#39; VBA.Val does not use regional settings, use for seconds to avoid decimal/comma issues
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    ParseIso <span style="color:#000;font-weight:bold">=</span> ParseIso <span style="color:#000;font-weight:bold">+</span> VBA.TimeSerial(VBA.CInt(utc_TimeParts(0)), VBA.CInt(utc_TimeParts(1)), Int(VBA.Val(utc_TimeParts(2))))
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Select</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            ParseIso <span style="color:#000;font-weight:bold">=</span> ParseUtc(ParseIso)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> utc_HasOffset <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                ParseIso <span style="color:#000;font-weight:bold">=</span> ParseIso <span style="color:#000;font-weight:bold">-</span> utc_Offset
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">utc_ErrorHandling</span>:
</span></span><span style="display:flex;"><span>        ERR.Raise 10013, <span style="color:#d14">&#34;UtcConverter.ParseIso&#34;</span>, <span style="color:#d14">&#34;ISO 8601 parsing error for &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> utc_IsoString <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;: &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Number <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34; - &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Description
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Convert local date to ISO 8601 string
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @method ConvertToIso
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @param {Date} utc_LocalDate
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @return {Date} ISO 8601 string
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; @throws 10014 - ISO 8601 conversion error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ConvertToIso</span>(utc_LocalDate <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> utc_ErrorHandling
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        ConvertToIso <span style="color:#000;font-weight:bold">=</span> VBA.Format<span style="color:#a61717;background-color:#e3d2d2">$</span>(ConvertToUtc(utc_LocalDate), <span style="color:#d14">&#34;yyyy-mm-ddTHH:mm:ss.000Z&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">utc_ErrorHandling</span>:
</span></span><span style="display:flex;"><span>        ERR.Raise 10014, <span style="color:#d14">&#34;UtcConverter.ConvertToIso&#34;</span>, <span style="color:#d14">&#34;ISO 8601 conversion error: &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Number <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34; - &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> ERR.Description
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; Private Functions
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Then</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_ConvertDate</span>(utc_Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>, <span style="color:#000;font-weight:bold">Optional</span> utc_ConvertToUtc <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_ShellCommand <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_Result <span style="color:#000;font-weight:bold">As</span> utc_ShellResult
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_Parts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_DateParts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_TimeParts() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> utc_ConvertToUtc <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                utc_ShellCommand <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;date -ur `date -jf &#39;%Y-%m-%d %H:%M:%S&#39; &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;&#39;&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> VBA.Format<span style="color:#a61717;background-color:#e3d2d2">$</span>(utc_Value, <span style="color:#d14">&#34;yyyy-mm-dd HH:mm:ss&#34;</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;&#39; &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34; +&#39;%s&#39;` +&#39;%Y-%m-%d %H:%M:%S&#39;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                utc_ShellCommand <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;date -jf &#39;%Y-%m-%d %H:%M:%S %z&#39; &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;&#39;&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> VBA.Format<span style="color:#a61717;background-color:#e3d2d2">$</span>(utc_Value, <span style="color:#d14">&#34;yyyy-mm-dd HH:mm:ss&#34;</span>) <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34; +0000&#39; &#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> _
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;+&#39;%Y-%m-%d %H:%M:%S&#39;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            utc_Result <span style="color:#000;font-weight:bold">=</span> utc_ExecuteInShell(utc_ShellCommand)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> utc_Result.utc_Output <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                ERR.Raise 10015, <span style="color:#d14">&#34;UtcConverter.utc_ConvertDate&#34;</span>, <span style="color:#d14">&#34;&#39;date&#39; command failed&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                utc_Parts <span style="color:#000;font-weight:bold">=</span> Split(utc_Result.utc_Output, <span style="color:#d14">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>                utc_DateParts <span style="color:#000;font-weight:bold">=</span> Split(utc_Parts(0), <span style="color:#d14">&#34;-&#34;</span>)
</span></span><span style="display:flex;"><span>                utc_TimeParts <span style="color:#000;font-weight:bold">=</span> Split(utc_Parts(1), <span style="color:#d14">&#34;:&#34;</span>)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                utc_ConvertDate <span style="color:#000;font-weight:bold">=</span> DateSerial(utc_DateParts(0), utc_DateParts(1), utc_DateParts(2)) <span style="color:#000;font-weight:bold">+</span> _
</span></span><span style="display:flex;"><span>                    TimeSerial(utc_TimeParts(0), utc_TimeParts(1), utc_TimeParts(2))
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_ExecuteInShell</span>(utc_ShellCommand <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>) <span style="color:#000;font-weight:bold">As</span> utc_ShellResult
</span></span><span style="display:flex;"><span>            <span style="color:#999;font-weight:bold;font-style:italic">#If VBA7 Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Dim</span> utc_File <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Dim</span> utc_Read <span style="color:#000;font-weight:bold">As</span> LongPtr
</span></span><span style="display:flex;"><span>            <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Dim</span> utc_File <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Dim</span> utc_Read <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>            <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> utc_Chunk <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">GoTo</span> utc_ErrorHandling
</span></span><span style="display:flex;"><span>            utc_File <span style="color:#000;font-weight:bold">=</span> utc_popen(utc_ShellCommand, <span style="color:#d14">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> utc_File <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">Then</span>: <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#900;font-weight:bold">Do</span> <span style="color:#000;font-weight:bold">While</span> utc_feof(utc_File) <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>                utc_Chunk <span style="color:#000;font-weight:bold">=</span> VBA.Space<span style="color:#a61717;background-color:#e3d2d2">$</span>(50)
</span></span><span style="display:flex;"><span>                utc_Read <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">CLng</span>(utc_fread(utc_Chunk, 1, Len(utc_Chunk) <span style="color:#000;font-weight:bold">-</span> 1, utc_File))
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> utc_Read <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    utc_Chunk <span style="color:#000;font-weight:bold">=</span> VBA.Left<span style="color:#a61717;background-color:#e3d2d2">$</span>(utc_Chunk, <span style="color:#000;font-weight:bold">CLng</span>(utc_Read))
</span></span><span style="display:flex;"><span>                    utc_ExecuteInShell.utc_Output <span style="color:#000;font-weight:bold">=</span> utc_ExecuteInShell.utc_Output <span style="color:#000;font-weight:bold">&amp;</span> utc_Chunk
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Loop</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>utc_ErrorHandling:
</span></span><span style="display:flex;"><span>            utc_ExecuteInShell.utc_ExitCode <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">CLng</span>(utc_pclose(utc_File))
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_DateToSystemTime</span>(utc_Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>) <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wYear <span style="color:#000;font-weight:bold">=</span> VBA.year(utc_Value)
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wMonth <span style="color:#000;font-weight:bold">=</span> VBA.month(utc_Value)
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wDay <span style="color:#000;font-weight:bold">=</span> VBA.Day(utc_Value)
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wHour <span style="color:#000;font-weight:bold">=</span> VBA.Hour(utc_Value)
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wMinute <span style="color:#000;font-weight:bold">=</span> VBA.Minute(utc_Value)
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wSecond <span style="color:#000;font-weight:bold">=</span> VBA.Second(utc_Value)
</span></span><span style="display:flex;"><span>            utc_DateToSystemTime.utc_wMilliseconds <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">utc_SystemTimeToDate</span>(utc_Value <span style="color:#000;font-weight:bold">As</span> utc_SYSTEMTIME) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Date</span>
</span></span><span style="display:flex;"><span>            utc_SystemTimeToDate <span style="color:#000;font-weight:bold">=</span> DateSerial(utc_Value.utc_wYear, utc_Value.utc_wMonth, utc_Value.utc_wDay) <span style="color:#000;font-weight:bold">+</span> _
</span></span><span style="display:flex;"><span>                TimeSerial(utc_Value.utc_wHour, utc_Value.utc_wMinute, utc_Value.utc_wSecond)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span></code></pre></div><h2 id="j页面设置">j页面设置</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">附注页面</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;页面-页面设置
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.PageSetup
</span></span><span style="display:flex;"><span>        .Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientPortrait
</span></span><span style="display:flex;"><span>        .TopMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.54)
</span></span><span style="display:flex;"><span>        .BottomMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.54)
</span></span><span style="display:flex;"><span>        .LeftMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(3.17)
</span></span><span style="display:flex;"><span>        .RightMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.7)
</span></span><span style="display:flex;"><span>        .HeaderDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.5)
</span></span><span style="display:flex;"><span>        .FooterDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.75)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">封面页面</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;页面-页面设置
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.PageSetup
</span></span><span style="display:flex;"><span>        .Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientPortrait
</span></span><span style="display:flex;"><span>        .TopMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(6.06)
</span></span><span style="display:flex;"><span>        .BottomMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.54)
</span></span><span style="display:flex;"><span>        .LeftMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.24)
</span></span><span style="display:flex;"><span>        .RightMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.27)
</span></span><span style="display:flex;"><span>        .HeaderDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.5)
</span></span><span style="display:flex;"><span>        .FooterDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.75)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">正文页面</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;页面-页面设置
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.PageSetup
</span></span><span style="display:flex;"><span>        .Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientPortrait
</span></span><span style="display:flex;"><span>        .TopMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(5)
</span></span><span style="display:flex;"><span>        .BottomMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2)
</span></span><span style="display:flex;"><span>        .LeftMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(3)
</span></span><span style="display:flex;"><span>        .RightMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(3)
</span></span><span style="display:flex;"><span>        .HeaderDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.5)
</span></span><span style="display:flex;"><span>        .FooterDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.75)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">插入横页</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;页面-插入横页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Selection.InsertBreak Type:<span style="color:#000;font-weight:bold">=</span>wdSectionBreakNextPage
</span></span><span style="display:flex;"><span>    Selection.InsertBreak Type:<span style="color:#000;font-weight:bold">=</span>wdSectionBreakNextPage
</span></span><span style="display:flex;"><span>    Selection.GoTo What:<span style="color:#000;font-weight:bold">=</span>wdGoToPage, Which:<span style="color:#000;font-weight:bold">=</span>wdGoToPrevious, Count:<span style="color:#000;font-weight:bold">=</span>1, Name:<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    Selection.Find.ClearFormatting
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> Selection.Find
</span></span><span style="display:flex;"><span>        .Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>        .Replacement.Text <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        .Forward <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .Wrap <span style="color:#000;font-weight:bold">=</span> wdFindContinue
</span></span><span style="display:flex;"><span>        .Format <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchCase <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchWholeWord <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchByte <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .CorrectHangulEndings <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        .HanjaPhoneticHangul <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchWildcards <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchSoundsLike <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .MatchAllWordForms <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> Selection.PageSetup.Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientPortrait <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        Selection.PageSetup.Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientLandscape
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        Selection.PageSetup.Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientPortrait
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">插入页码</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl) <span style="color:#998;font-style:italic">&#39;页面-插入页码
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">False</span> <span style="color:#998;font-style:italic">&#39;关闭屏幕更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    ActiveDocument.Sections(1).Footers(wdHeaderFooterPrimary).PageNumbers.Add PageNumberAlignment:<span style="color:#000;font-weight:bold">=</span>wdAlignPageNumberCenter, FirstPage:<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.Sections(1).Footers(wdHeaderFooterPrimary) <span style="color:#998;font-style:italic">&#39;进入页脚编辑状态
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .Range.Font.Size <span style="color:#000;font-weight:bold">=</span> 9
</span></span><span style="display:flex;"><span>        .Range.Font.Name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>        .Range.Collapse Direction:<span style="color:#000;font-weight:bold">=</span>wdCollapseEnd
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.Sections(1).Headers(wdHeaderFooterPrimary).Range <span style="color:#998;font-style:italic">&#39;进入页脚编辑状态
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .Delete <span style="color:#998;font-style:italic">&#39;删除页眉中的内容
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .ParagraphFormat.Borders(wdBorderBottom).LineStyle <span style="color:#000;font-weight:bold">=</span> wdLineStyleNone <span style="color:#998;font-style:italic">&#39;取消页眉段落下边框线
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    Application.ScreenUpdating <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span> <span style="color:#998;font-style:italic">&#39;恢复屏幕更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="k访谈提纲">k访谈提纲</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">插入访谈</span>(x)
</span></span><span style="display:flex;"><span>    Path <span style="color:#000;font-weight:bold">=</span> ActiveDocument.AttachedTemplate.FullName
</span></span><span style="display:flex;"><span>    Application.Templates(Path).BuildingBlockEntries(x).Insert Where:<span style="color:#000;font-weight:bold">=</span>Selection.Range, RichText:<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.PageSetup
</span></span><span style="display:flex;"><span>        .Orientation <span style="color:#000;font-weight:bold">=</span> wdOrientPortrait
</span></span><span style="display:flex;"><span>        .TopMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.54)
</span></span><span style="display:flex;"><span>        .BottomMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.54)
</span></span><span style="display:flex;"><span>        .LeftMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(3.17)
</span></span><span style="display:flex;"><span>        .RightMargin <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(2.7)
</span></span><span style="display:flex;"><span>        .HeaderDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1)
</span></span><span style="display:flex;"><span>        .FooterDistance <span style="color:#000;font-weight:bold">=</span> CentimetersToPoints(1.3)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    ActiveWindow.ActivePane.View.SeekView <span style="color:#000;font-weight:bold">=</span> wdSeekCurrentPageHeader
</span></span><span style="display:flex;"><span>    Selection.WholeStory
</span></span><span style="display:flex;"><span>    Selection.Delete
</span></span><span style="display:flex;"><span>    Application.Templates(Path).BuildingBlockEntries(<span style="color:#d14">&#34;访谈页眉&#34;</span>).Insert Where:<span style="color:#000;font-weight:bold">=</span>Selection.Range, RichText:<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    ActiveWindow.ActivePane.View.SeekView <span style="color:#000;font-weight:bold">=</span> wdSeekMainDocument
</span></span><span style="display:flex;"><span>    Selection.WholeStory
</span></span><span style="display:flex;"><span>    Selection.Range.ListFormat.RemoveNumbers NumberType:<span style="color:#000;font-weight:bold">=</span>wdNumberParagraph
</span></span><span style="display:flex;"><span>    ActiveDocument.Sections(1).Footers(wdHeaderFooterPrimary).PageNumbers.Add PageNumberAlignment:<span style="color:#000;font-weight:bold">=</span>wdAlignPageNumberCenter, FirstPage:<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> ActiveDocument.Sections(1).Footers(wdHeaderFooterPrimary) <span style="color:#998;font-style:italic">&#39;进入页脚编辑状态
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        .Range.Font.Size <span style="color:#000;font-weight:bold">=</span> 9
</span></span><span style="display:flex;"><span>        .Range.Font.Name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;宋体&#34;</span>
</span></span><span style="display:flex;"><span>        .Range.Collapse Direction:<span style="color:#000;font-weight:bold">=</span>wdCollapseEnd
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">财务负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;财务负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">采购负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;采购负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">人力负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;人力负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">生产负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;生产负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">投融资负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;投融资负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">销售负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;销售负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">研发负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;研发负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">总经理</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;总经理&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">独立董事</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;独立董事&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">内审负责人</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Call</span> 插入访谈(<span style="color:#d14">&#34;内审负责人&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div><h2 id="更新">更新</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Declare</span> PtrSafe <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ShellExecute</span> <span style="color:#000;font-weight:bold">Lib</span> <span style="color:#d14">&#34;shell32.dll&#34;</span> <span style="color:#000;font-weight:bold">Alias</span> <span style="color:#d14">&#34;ShellExecuteA&#34;</span> (<span style="color:#000;font-weight:bold">ByVal</span> hwnd <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>, <span style="color:#000;font-weight:bold">ByVal</span> lpOperation <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> lpFile <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> lpParameters <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> lpDirectory <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>, <span style="color:#000;font-weight:bold">ByVal</span> nShowCmd <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">获取标签名</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl, <span style="color:#000;font-weight:bold">ByRef</span> returnedVal)
</span></span><span style="display:flex;"><span>    returnedVal <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;报告小帮手 V2.6&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">获取标签日期</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl, <span style="color:#000;font-weight:bold">ByRef</span> returnedVal)
</span></span><span style="display:flex;"><span>    returnedVal <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;20220814更新&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">签名</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl, <span style="color:#000;font-weight:bold">ByRef</span> returnedVal)
</span></span><span style="display:flex;"><span>    returnedVal <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;公众号：茶瓜子的休闲馆&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">检查更新</span>(control <span style="color:#000;font-weight:bold">As</span> IRibbonControl)
</span></span><span style="display:flex;"><span>    本地 <span style="color:#000;font-weight:bold">=</span> Val(ThisVersion)
</span></span><span style="display:flex;"><span>    最新 <span style="color:#000;font-weight:bold">=</span> Val(Getver)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">If</span> 本地 <span style="color:#000;font-weight:bold">&lt;&gt;</span> 最新 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>        y <span style="color:#000;font-weight:bold">=</span> MsgBox(<span style="color:#d14">&#34;存在新版本，是否进入主页查看最新版？&#34;</span>, vbYesNo)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> y <span style="color:#000;font-weight:bold">=</span> 6 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            OpenWeb
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>        MsgBox <span style="color:#d14">&#34;当前版本为最新版&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">ThisVersion</span>()
</span></span><span style="display:flex;"><span>    ThisVersion <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;2.6&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">Getver</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> Json <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Object</span>
</span></span><span style="display:flex;"><span>    URL <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;http://api.gzaudit.com/xbs/wd/&#34;</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#000;font-weight:bold">=</span> GetData(URL, <span style="color:#d14">&#34;UTF-8&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> Json <span style="color:#000;font-weight:bold">=</span> JsonConverter.ParseJson(res)
</span></span><span style="display:flex;"><span>    Getver <span style="color:#000;font-weight:bold">=</span> Json(<span style="color:#d14">&#34;版本&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">OpenWeb</span>()
</span></span><span style="display:flex;"><span>  ShellExecute 0<span style="color:#000;font-weight:bold">&amp;</span>, vbNullString, <span style="color:#d14">&#34;www.gzaudit.com&#34;</span>, vbNullString, vbNullString, vbNormalFocus
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">GetData</span>(StrUrl, CodePageX)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> oHtml <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Object</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> oHtml <span style="color:#000;font-weight:bold">=</span> VBA.CreateObject(<span style="color:#d14">&#34;WinHttp.WinHttpRequest.5.1&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> sUrl <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>    sUrl <span style="color:#000;font-weight:bold">=</span> StrUrl
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> sCharset <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>    sCharset <span style="color:#000;font-weight:bold">=</span> CodePageX
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> oHtml
</span></span><span style="display:flex;"><span>        .Open <span style="color:#d14">&#34;GET&#34;</span>, sUrl, <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        .setRequestHeader <span style="color:#d14">&#34;User-Agent&#34;</span>, <span style="color:#d14">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span>        .Send
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39;获取返回的字节数组
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        bResult <span style="color:#000;font-weight:bold">=</span> .ResponseBody
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39;按照指定的字符编码显示
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        sResult <span style="color:#000;font-weight:bold">=</span> BytesToStr(bResult, CodePageX)
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39;Debug.Print sResult
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    GetData <span style="color:#000;font-weight:bold">=</span> sResult
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> oHtml <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Nothing</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">BytesToStr</span>(strBody, CodeBase)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Dim</span> objStream
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> objStream <span style="color:#000;font-weight:bold">=</span> CreateObject(<span style="color:#d14">&#34;Adodb.Stream&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">With</span> objStream
</span></span><span style="display:flex;"><span>        .Type <span style="color:#000;font-weight:bold">=</span> 1
</span></span><span style="display:flex;"><span>        .Mode <span style="color:#000;font-weight:bold">=</span> 3
</span></span><span style="display:flex;"><span>        .Open
</span></span><span style="display:flex;"><span>        .Write strBody
</span></span><span style="display:flex;"><span>        .Position <span style="color:#000;font-weight:bold">=</span> 0
</span></span><span style="display:flex;"><span>        .Type <span style="color:#000;font-weight:bold">=</span> 2
</span></span><span style="display:flex;"><span>        .Charset <span style="color:#000;font-weight:bold">=</span> CodeBase <span style="color:#998;font-style:italic">&#39;&#34;GB2312&#34; &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        BytesToStr <span style="color:#000;font-weight:bold">=</span> .ReadText
</span></span><span style="display:flex;"><span>        .Close
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">With</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Set</span> objStream <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Nothing</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span></code></pre></div><h2 id="类模块">类模块</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vb" data-lang="vb"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Dictionary v1.2.0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; (c) Tim Hall - https://github.com/timhall/VBA-Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Drop-in replacement for Scripting.Dictionary on Mac
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @author: tim.hall.engr@gmail.com
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @license: MIT (http://www.opensource.org/licenses/mit-license.php
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Option</span> Explicit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Constants and Private Variables
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#Const</span> UseScriptingDictionaryIfAvailable <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&#39; KeyValue 0: FormattedKey, 1: OriginalKey, 2: Value
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">Private</span> pKeyValues <span style="color:#000;font-weight:bold">As</span> Collection
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> pKeys() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> pItems() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> pCompareMode <span style="color:#000;font-weight:bold">As</span> CompareMethod
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> pDictionary <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Object</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Types
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Enum</span> <span style="color:#458;font-weight:bold">CompareMethod</span>
</span></span><span style="display:flex;"><span>    BinaryCompare <span style="color:#000;font-weight:bold">=</span> vbBinaryCompare
</span></span><span style="display:flex;"><span>    TextCompare <span style="color:#000;font-weight:bold">=</span> vbTextCompare
</span></span><span style="display:flex;"><span>    DatabaseCompare <span style="color:#000;font-weight:bold">=</span> vbDatabaseCompare
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Enum</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Properties
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Get</span> CompareMode() <span style="color:#000;font-weight:bold">As</span> CompareMethod
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        CompareMode <span style="color:#000;font-weight:bold">=</span> pCompareMode
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        CompareMode <span style="color:#000;font-weight:bold">=</span> pDictionary.CompareMode
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Let</span> CompareMode(Value <span style="color:#000;font-weight:bold">As</span> CompareMethod)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.Count <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Can&#39;t change CompareMode for Dictionary that contains data
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; http://msdn.microsoft.com/en-us/library/office/gg278481(v=office.15).aspx
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            ERR.Raise 5 <span style="color:#998;font-style:italic">&#39; Invalid procedure call or argument
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        pCompareMode <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        pDictionary.CompareMode <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Get</span> Count() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        Count <span style="color:#000;font-weight:bold">=</span> pKeyValues.Count
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        Count <span style="color:#000;font-weight:bold">=</span> pDictionary.Count
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Get</span> Item(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> KeyValue <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        KeyValue <span style="color:#000;font-weight:bold">=</span> GetKeyValue(Key)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> IsEmpty(KeyValue) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsObject(KeyValue(2)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> Item <span style="color:#000;font-weight:bold">=</span> KeyValue(2)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                Item <span style="color:#000;font-weight:bold">=</span> KeyValue(2)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Not found -&gt; Returns Empty
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> IsObject(pDictionary.Item(Key)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Set</span> Item <span style="color:#000;font-weight:bold">=</span> pDictionary.Item(Key)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            Item <span style="color:#000;font-weight:bold">=</span> pDictionary.Item(Key)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Let</span> Item(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.Exists(Key) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            ReplaceKeyValue GetKeyValue(Key), Key, Value
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            AddKeyValue Key, Value
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        pDictionary.Item(Key) <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Set</span> Item(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.Exists(Key) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            ReplaceKeyValue GetKeyValue(Key), Key, Value
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            AddKeyValue Key, Value
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> pDictionary.Item(Key) <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Property</span> <span style="color:#900;font-weight:bold">Let</span> Key(Previous <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Updated <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> KeyValue <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        KeyValue <span style="color:#000;font-weight:bold">=</span> GetKeyValue(Previous)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> IsEmpty(KeyValue) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            ReplaceKeyValue KeyValue, Updated, KeyValue(2)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        pDictionary.Key(Previous) <span style="color:#000;font-weight:bold">=</span> Updated
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Property</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Public Methods
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Add an item with the given key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @param {Variant} Key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @param {Variant} Item
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">Add</span>(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Item <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> <span style="color:#000;font-weight:bold">Me</span>.Exists(Key) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            AddKeyValue Key, Item
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; This key is already associated with an element of this collection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            ERR.Raise 457
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        pDictionary.Add Key, Item
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Check if an item exists for the given key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @param {Variant} Key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @return {Boolean}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">Exists</span>(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Boolean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        Exists <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Not</span> IsEmpty(GetKeyValue(Key))
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        Exists <span style="color:#000;font-weight:bold">=</span> pDictionary.Exists(Key)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Get an array of all items
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @return {Variant}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">Items</span>() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.Count <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            Items <span style="color:#000;font-weight:bold">=</span> pItems
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Split(&#34;&#34;) creates initialized empty array that matches Dictionary Keys and Items
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Items <span style="color:#000;font-weight:bold">=</span> Split(<span style="color:#d14">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        Items <span style="color:#000;font-weight:bold">=</span> pDictionary.Items
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Get an array of all keys
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @return {Variant}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">Keys</span>() <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.Count <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            Keys <span style="color:#000;font-weight:bold">=</span> pKeys
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Split(&#34;&#34;) creates initialized empty array that matches Dictionary Keys and Items
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Keys <span style="color:#000;font-weight:bold">=</span> Split(<span style="color:#d14">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        Keys <span style="color:#000;font-weight:bold">=</span> pDictionary.Keys
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Remove an item for the given key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; @param {Variant} Key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">Remove</span>(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> KeyValue <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        KeyValue <span style="color:#000;font-weight:bold">=</span> GetKeyValue(Key)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Not</span> IsEmpty(KeyValue) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            RemoveKeyValue KeyValue
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Application-defined or object-defined error
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            ERR.Raise 32811
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        pDictionary.Remove Key
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Remove all items
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; --------------------------------------------- &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">Public</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">RemoveAll</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> pKeyValues <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">New</span> Collection
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Erase</span> pKeys
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Erase</span> pItems
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        pDictionary.RemoveAll
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; Private Functions
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&#39; ============================================= &#39;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">GetKeyValue</span>(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">On</span> <span style="color:#000;font-weight:bold">Error</span> <span style="color:#000;font-weight:bold">Resume</span> <span style="color:#000;font-weight:bold">Next</span>
</span></span><span style="display:flex;"><span>        GetKeyValue <span style="color:#000;font-weight:bold">=</span> pKeyValues(GetFormattedKey(Key))
</span></span><span style="display:flex;"><span>        ERR.Clear
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">AddKeyValue</span>(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, <span style="color:#000;font-weight:bold">Optional</span> Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.Count <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ReDim</span> pKeys(0 <span style="color:#000;font-weight:bold">To</span> 0)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ReDim</span> pItems(0 <span style="color:#000;font-weight:bold">To</span> 0)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ReDim</span> Preserve pKeys(0 <span style="color:#000;font-weight:bold">To</span> UBound(pKeys) <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">ReDim</span> Preserve pItems(0 <span style="color:#000;font-weight:bold">To</span> UBound(pItems) <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> FormattedKey <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        FormattedKey <span style="color:#000;font-weight:bold">=</span> GetFormattedKey(Key)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> Index <span style="color:#000;font-weight:bold">&gt;</span> 0 <span style="color:#000;font-weight:bold">And</span> Index <span style="color:#000;font-weight:bold">&lt;=</span> pKeyValues.Count <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> i <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> UBound(pKeys) <span style="color:#000;font-weight:bold">To</span> Index <span style="color:#000;font-weight:bold">Step</span> <span style="color:#000;font-weight:bold">-</span>1
</span></span><span style="display:flex;"><span>                pKeys(i) <span style="color:#000;font-weight:bold">=</span> pKeys(i <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> IsObject(pItems(i <span style="color:#000;font-weight:bold">-</span> 1)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Set</span> pItems(i) <span style="color:#000;font-weight:bold">=</span> pItems(i <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    pItems(i) <span style="color:#000;font-weight:bold">=</span> pItems(i <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            pKeys(Index <span style="color:#000;font-weight:bold">-</span> 1) <span style="color:#000;font-weight:bold">=</span> Key
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsObject(Value) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> pItems(Index <span style="color:#000;font-weight:bold">-</span> 1) <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                pItems(Index <span style="color:#000;font-weight:bold">-</span> 1) <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            pKeyValues.Add Array(FormattedKey, Key, Value), FormattedKey, before:<span style="color:#000;font-weight:bold">=</span>Index
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            pKeys(UBound(pKeys)) <span style="color:#000;font-weight:bold">=</span> Key
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> IsObject(Value) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Set</span> pItems(UBound(pItems)) <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                pItems(UBound(pItems)) <span style="color:#000;font-weight:bold">=</span> Value
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            pKeyValues.Add Array(FormattedKey, Key, Value), FormattedKey
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">ReplaceKeyValue</span>(KeyValue <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, Value <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> i <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">To</span> UBound(pKeys)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> pKeys(i) <span style="color:#000;font-weight:bold">=</span> KeyValue(1) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                Index <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">+</span> 1
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Exit</span> <span style="color:#000;font-weight:bold">For</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Remove existing value
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        RemoveKeyValue KeyValue, Index
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&#39; Add new key value back
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        AddKeyValue Key, Value, Index
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">RemoveKeyValue</span>(KeyValue <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>, <span style="color:#000;font-weight:bold">Optional</span> <span style="color:#000;font-weight:bold">ByVal</span> Index <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Dim</span> i <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Long</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> Index <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span>1 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">To</span> UBound(pKeys)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> pKeys(i) <span style="color:#000;font-weight:bold">=</span> KeyValue(1) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    Index <span style="color:#000;font-weight:bold">=</span> i
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>            Index <span style="color:#000;font-weight:bold">=</span> Index <span style="color:#000;font-weight:bold">-</span> 1
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> Index <span style="color:#000;font-weight:bold">&gt;=</span> 0 <span style="color:#000;font-weight:bold">And</span> Index <span style="color:#000;font-weight:bold">&lt;=</span> UBound(pKeys) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> Index <span style="color:#000;font-weight:bold">To</span> UBound(pKeys) <span style="color:#000;font-weight:bold">-</span> 1
</span></span><span style="display:flex;"><span>                pKeys(i) <span style="color:#000;font-weight:bold">=</span> pKeys(i <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> IsObject(pItems(i <span style="color:#000;font-weight:bold">+</span> 1)) <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">Set</span> pItems(i) <span style="color:#000;font-weight:bold">=</span> pItems(i <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                    pItems(i) <span style="color:#000;font-weight:bold">=</span> pItems(i <span style="color:#000;font-weight:bold">+</span> 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> UBound(pKeys) <span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Erase</span> pKeys
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">Erase</span> pItems
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">ReDim</span> Preserve pKeys(0 <span style="color:#000;font-weight:bold">To</span> UBound(pKeys) <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">ReDim</span> Preserve pItems(0 <span style="color:#000;font-weight:bold">To</span> UBound(pItems) <span style="color:#000;font-weight:bold">-</span> 1)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        pKeyValues.Remove KeyValue(0)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Function</span> <span style="color:#900;font-weight:bold">GetFormattedKey</span>(Key <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Variant</span>) <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>        GetFormattedKey <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">CStr</span>(Key)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">If</span> <span style="color:#000;font-weight:bold">Me</span>.CompareMode <span style="color:#000;font-weight:bold">=</span> CompareMethod.BinaryCompare <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&#39; Collection does not have method of setting key comparison
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; So case-sensitive keys aren&#39;t supported by default
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39; -&gt; Approach: Append lowercase characters to original key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39;    AbC -&gt; AbC__b, abc -&gt; abc__abc, ABC -&gt; ABC
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39;    Won&#39;t work in very strange cases, but should work for now
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">&#39;    AbBb -&gt; AbBb__bb matches AbbB -&gt; AbbB__bb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">Dim</span> Lowercase <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            Lowercase <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> i <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> Ascii <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">Integer</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Dim</span> <span style="color:#458;font-weight:bold">Char</span> <span style="color:#000;font-weight:bold">As</span> <span style="color:#458;font-weight:bold">String</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">For</span> i <span style="color:#000;font-weight:bold">=</span> 1 <span style="color:#000;font-weight:bold">To</span> Len(GetFormattedKey)
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">Char</span> <span style="color:#000;font-weight:bold">=</span> VBA.Mid<span style="color:#a61717;background-color:#e3d2d2">$</span>(GetFormattedKey, i, 1)
</span></span><span style="display:flex;"><span>                Ascii <span style="color:#000;font-weight:bold">=</span> Asc(<span style="color:#458;font-weight:bold">Char</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">If</span> Ascii <span style="color:#000;font-weight:bold">&gt;=</span> 97 <span style="color:#000;font-weight:bold">And</span> Ascii <span style="color:#000;font-weight:bold">&lt;=</span> 122 <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                    Lowercase <span style="color:#000;font-weight:bold">=</span> Lowercase <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#458;font-weight:bold">Char</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">Next</span> i
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">If</span> Lowercase <span style="color:#000;font-weight:bold">&lt;&gt;</span> <span style="color:#d14">&#34;&#34;</span> <span style="color:#000;font-weight:bold">Then</span>
</span></span><span style="display:flex;"><span>                GetFormattedKey <span style="color:#000;font-weight:bold">=</span> GetFormattedKey <span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#d14">&#34;__&#34;</span> <span style="color:#000;font-weight:bold">&amp;</span> Lowercase
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">If</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Function</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">Class_Initialize</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> pKeyValues <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">New</span> Collection
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Erase</span> pKeys
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Erase</span> pItems
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> pDictionary <span style="color:#000;font-weight:bold">=</span> CreateObject(<span style="color:#d14">&#34;Scripting.Dictionary&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">Private</span> <span style="color:#000;font-weight:bold">Sub</span> <span style="color:#900;font-weight:bold">Class_Terminate</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#If Mac Or Not UseScriptingDictionaryIfAvailable Then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> pKeyValues <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Nothing</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#Else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">Set</span> pDictionary <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">Nothing</span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-weight:bold;font-style:italic">#End If</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">End</span> <span style="color:#000;font-weight:bold">Sub</span>
</span></span></code></pre></div>
    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/vba/%E5%BA%95%E7%A8%BF%E5%B0%8F%E5%B8%AE%E6%89%8B%E4%BB%A3%E7%A0%81/k%E8%AE%BF%E8%B0%88%E6%8F%90%E7%BA%B2/">← k访谈提纲</a></div>
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/vba/%E5%BA%95%E7%A8%BF%E5%B0%8F%E5%B8%AE%E6%89%8B%E4%BB%A3%E7%A0%81/%E6%9B%B4%E6%96%B0/">更新  →</a></div>
</div>
    
    

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        京ICP备2022007001号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
