<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="第四章 函数式编程 - https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ch4-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">
    <meta name="author" content="richfan - https://richfan.site/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>第四章 函数式编程</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://richfan.site/style.min.d252ad53a5e6b2ae6b8c6c1661107189be3668e36c8dd61697bbe008595a7e04.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": true
	}
</div>
    <h1 class="title">
        
            第四章 函数式编程
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2023-09-25&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-09-25&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            11629 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            24 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/%E7%A8%8B%E6%8A%80">程技</a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/python">python</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ch10-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#41-什么是函数式编程">4.1 什么是函数式编程</a>
      <ul>
        <li><a href="#411-定义">4.1.1 定义</a></li>
        <li><a href="#412-特点">4.1.2 特点</a></li>
        <li><a href="#413-好处">4.1.3 好处</a></li>
      </ul>
    </li>
    <li><a href="#42-高阶函数">4.2 高阶函数</a>
      <ul>
        <li><a href="#421-mapreduce">4.2.1 map/reduce</a></li>
        <li><a href="#422-filter">4.2.2 filter</a></li>
        <li><a href="#423-sorted">4.2.3 sorted</a></li>
      </ul>
    </li>
    <li><a href="#43-返回函数">4.3 返回函数</a>
      <ul>
        <li><a href="#431-函数作为返回值">4.3.1 函数作为返回值</a></li>
        <li><a href="#432-闭包">4.3.2 闭包</a></li>
      </ul>
    </li>
    <li><a href="#44-匿名函数">4.4 匿名函数</a></li>
    <li><a href="#45-装饰器">4.5 装饰器</a></li>
    <li><a href="#46-偏函数">4.6 偏函数</a></li>
    <li><a href="#47-参考资料">4.7 参考资料</a></li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <p>函数是 Python 内建支持的一种封装，我们通过把大段代码拆成函数，通过一层一层的函数调用，就可以把复杂任务分解成简单的任务，这种分解可以称之为面向过程的程序设计。函数就是面向过程的程序设计的基本单元。</p>
<p>而函数式编程（请注意多了一个“式”字）—— Functional Programming，虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。</p>
<p>我们首先要搞明白计算机（Computer）和计算（Compute）的概念。</p>
<p>在计算机的层次上，CPU 执行的是加减乘除的<code>指令代码</code>，以及各种条件判断和跳转指令，所以，汇编语言是最贴近计算机的语言。</p>
<p>而计算则指数学意义上的计算，越是抽象的计算，离计算机硬件越远。</p>
<p>对应到编程语言，就是越低级的语言，越贴近计算机，抽象程度低，执行效率高，比如 C 语言；越高级的语言，越贴近计算，抽象程度高，执行效率低，比如 Lisp 语言。</p>
<blockquote>
<p>🎁🎉 诞生 50 多年之后，<a href="http://en.wikipedia.org/wiki/Functional_programming">函数式编程</a>（functional programming）开始获得越来越多的关注。不仅最古老的函数式语言 Lisp 重获青春，而且新的函数式语言层出不穷，比如 Erlang、clojure、Scala、F# 等等。目前最当红的 Python、Ruby、Javascript，对函数式编程的支持都很强，就连老牌的面向对象的 Java、面向过程的 PHP，都忙不迭地加入对匿名函数的支持。越来越多的迹象表明，函数式编程已经不再是学术界的最爱，开始大踏步地在业界投入实用。也许继&quot;面向对象编程&quot;之后，&ldquo;函数式编程&quot;会成为下一个编程的主流范式（paradigm）。</p>
</blockquote>
<h2 id="41-什么是函数式编程">4.1 什么是函数式编程</h2>
<p>函数式编程就是一种抽象程度很高的编程范式，纯粹的函数式编程语言编写的函数没有变量，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。</p>
<p>🔊 函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！</p>
<p>Python 对函数式编程提供部分支持。由于 Python 允许使用变量，因此，Python 不是纯函数式编程语言。</p>
<h3 id="411-定义">4.1.1 定义</h3>
<p>简单说，&ldquo;函数式编程&quot;是一种<a href="http://en.wikipedia.org/wiki/Programming_paradigm">&ldquo;编程范式&rdquo;</a>（programming paradigm），也就是如何编写程序的方法论。它属于<a href="http://en.wikipedia.org/wiki/Structured_programming">&ldquo;结构化编程&rdquo;</a>的一种，主要思想是把运算过程尽量写成一系列嵌套的函数调用。</p>
<p>举例来说，现在有这样一个数学表达式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#099">1</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">2</span>) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">3</span> <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">4</span>
</span></span></code></pre></div><p>传统的过程式编程，可能这样写：</p>
<pre tabindex="0"><code>var a = 1 + 2;
var b = a * 3;
var c = b - 4;
</code></pre><p>函数式编程要求使用函数，我们可以把<strong>运算过程</strong>定义为不同的函数，然后写成下面这样：</p>
<pre tabindex="0"><code>var result = subtract(multiply(add(1,2), 3), 4);
</code></pre><p>这就是函数式编程。</p>
<h3 id="412-特点">4.1.2 特点</h3>
<p>函数式编程具有五个鲜明的特点。</p>
<h4 id="-函数是第一等公民">① 函数是&quot;第一等公民&rdquo;</h4>
<p>所谓<a href="http://en.wikipedia.org/wiki/First-class_function">&ldquo;第一等公民&rdquo;</a>（first class），指的是函数与其他数据类型一样，处于平等地位，可以赋值给其他变量，也可以作为参数，传入另一个函数，或者作为别的函数的返回值。</p>
<p>举例来说，下面代码中的 print 变量就是一个函数，可以作为另一个函数的参数。</p>
<pre tabindex="0"><code>var print = function(i){ 
	console.log(i);
};
[1,2,3].forEach(print);
</code></pre><h4 id="-只用表达式不用语句">② 只用&quot;表达式&rdquo;，不用&quot;语句&quot;</h4>
<p>&ldquo;表达式&rdquo;（expression）是一个单纯的运算过程，总是有返回值；&ldquo;语句&rdquo;（statement）是执行某种操作，没有返回值。函数式编程要求，只使用表达式，不使用语句。也就是说，每一步都是单纯的运算，而且都有返回值。</p>
<p>原因是函数式编程的开发动机，一开始就是为了处理运算（computation），不考虑系统的读写（I/O）。&ldquo;语句&quot;属于对系统的读写操作，所以就被排斥在外。</p>
<p>当然，实际应用中，不做 I/O 是不可能的。因此，编程过程中，函数式编程只要求把 I/O 限制到最小，不要有不必要的读写行为，保持计算过程的单纯性。</p>
<h4 id="-没有副作用">③ 没有&quot;副作用&rdquo;</h4>
<p>所谓<a href="http://en.wikipedia.org/wiki/Side_effect_(computer_science)">&ldquo;副作用&rdquo;</a>（side effect），指的是函数内部与外部互动（最典型的情况，就是修改全局变量的值），产生运算以外的其他结果。</p>
<p>函数式编程强调没有&quot;副作用&quot;，意味着函数要保持独立，所有功能就是返回一个新的值，没有其他行为，尤其是不得修改外部变量的值。</p>
<h4 id="-不修改状态">④ 不修改状态</h4>
<p>上一点已经提到，函数式编程只是返回新的值，不修改系统变量。因此，不修改变量，也是它的一个重要特点。</p>
<p>在其他类型的语言中，变量往往用来保存&quot;状态&quot;（state）。不修改变量，意味着状态不能保存在变量中。函数式编程使用参数保存状态，最好的例子就是递归。下面的代码是一个将字符串逆序排列的函数，它演示了不同的参数如何决定了运算所处的&quot;状态&quot;。</p>
<pre tabindex="0"><code>function reverse(string) {
　　　　if(string.length == 0) {
　　　　　　return string;
　　　　} else {
　　　　　　return reverse(string.substring(1, string.length)) + string.substring(0, 1);
　　　　}
　　}
</code></pre><p>由于使用了递归，函数式语言的运行速度比较慢，这是它长期不能在业界推广的主要原因。</p>
<h4 id="-引用透明">⑤ 引用透明</h4>
<p>引用透明（Referential transparency），指的是函数的运行不依赖于外部变量或&quot;状态&quot;，只依赖于输入的参数，任何时候只要参数相同，引用函数所得到的返回值总是相同的。</p>
<p>有了前面的第三点和第四点，这点是很显然的。其他类型的语言，函数的返回值往往与系统状态有关，不同的状态之下，返回值是不一样的。这就叫&quot;引用不透明&quot;，很不利于观察和理解程序的行为。</p>
<h3 id="413-好处">4.1.3 好处</h3>
<p>函数式编程到底有什么好处，为什么会变得越来越流行？</p>
<h4 id="-代码简洁开发快速">① 代码简洁，开发快速</h4>
<p>函数式编程大量使用函数，减少了代码的重复，因此程序比较短，开发速度较快。</p>
<h4 id="-接近自然语言易于理解">② 接近自然语言，易于理解</h4>
<p>函数式编程的自由度很高，可以写出很接近自然语言的代码。</p>
<p>前文曾经将表达式 (1 + 2) * 3 - 4，写成函数式语言：</p>
<pre tabindex="0"><code>subtract(multiply(add(1,2), 3), 4)
</code></pre><p>对它进行变形，不难得到另一种写法：</p>
<pre tabindex="0"><code>add(1,2).multiply(3).subtract(4)
</code></pre><p>这基本就是自然语言的表达了。再看下面的代码，大家应该一眼就能明白它的意思吧：</p>
<pre tabindex="0"><code>merge([1,2],[3,4]).sort().search(&#34;2&#34;)
</code></pre><p>因此，函数式编程的代码更容易理解。</p>
<h4 id="-更方便的代码管理">③ 更方便的代码管理</h4>
<p>函数式编程不依赖、也不会改变外界的状态，只要给定输入参数，返回的结果必定相同。因此，每一个函数都可以被看做独立单元，很有利于进行单元测试（unit testing）和除错（debugging），以及模块化组合。</p>
<h4 id="-易于并发编程">④ 易于&quot;并发编程&quot;</h4>
<p>函数式编程不需要考虑&quot;死锁&quot;（deadlock），因为它不修改变量，所以根本不存在&quot;锁&quot;线程的问题。不必担心一个线程的数据，被另一个线程修改，所以可以很放心地把工作分摊到多个线程，部署&quot;并发编程&quot;（concurrency）。</p>
<p>请看下面的代码：</p>
<pre tabindex="0"><code>var s1 = Op1();
var s2 = Op2();
var s3 = concat(s1, s2);
</code></pre><p>由于 s1 和 s2 互不干扰，不会修改变量，谁先执行是无所谓的，所以可以放心地增加线程，把它们分配在两个线程上完成。其他类型的语言就做不到这一点，因为 s1 可能会修改系统状态，而 s2 可能会用到这些状态，所以必须保证 s2 在 s1 之后运行，自然也就不能部署到其他线程上了。</p>
<p>多核 CPU 是将来的潮流，所以函数式编程的这个特性非常重要。</p>
<h4 id="-代码的热升级">⑤ 代码的热升级</h4>
<p>函数式编程没有副作用，只要保证接口不变，内部实现是外部无关的。所以，可以在运行状态下直接升级代码，不需要重启，也不需要停机。<a href="http://en.wikipedia.org/wiki/Erlang_(programming_language)">Erlang</a> 语言早就证明了这一点，它是瑞典爱立信公司为了管理电话系统而开发的，电话系统的升级当然是不能停机的。</p>
<blockquote>
<p>下面进行具体函数具体示例介绍：</p>
</blockquote>
<h2 id="42-高阶函数">4.2 高阶函数</h2>
<p>高阶函数英文叫 Higher-order function。什么是高阶函数？我们以实际代码为例子，一步一步深入概念。</p>
<p><strong>（1）变量可以指向函数</strong></p>
<p>以 Python 内置的求绝对值的函数<code>abs()</code>为例，调用该函数用以下代码：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">abs</span>(<span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span>) <span style="color:#998;font-style:italic"># 10</span>
</span></span></code></pre></div><p>但是，如果只写<code>abs</code>呢？</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717093944.png" alt="函数"></p>
<p>可见，<code>abs(-10)</code>是函数调用，而<code>abs</code>是函数本身。</p>
<p>要获得函数调用结果，我们可以把结果赋值给变量：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>x <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">abs</span>(<span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span>x <span style="color:#998;font-style:italic"># 10</span>
</span></span></code></pre></div><p>但是，如果把函数本身赋值给变量呢？</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717102556.png" alt="image-20200717102554966"></p>
<p>结论：函数本身也可以赋值给变量，即：变量可以指向函数。</p>
<p>如果一个变量指向了一个函数，那么，可否通过该变量来调用这个函数？用代码验证一下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">abs</span>
</span></span><span style="display:flex;"><span>f(<span style="color:#099">10</span>) <span style="color:#998;font-style:italic"># 10</span>
</span></span></code></pre></div><p>成功！说明变量<code>f</code>现在已经指向了<code>abs</code>函数本身。直接调用<code>abs()</code>函数和调用变量<code>f()</code>完全相同。</p>
<p><strong>（2）函数名也是变量</strong></p>
<p>那么函数名是什么呢？函数名其实就是指向函数的变量！对于<code>abs()</code>这个函数，完全可以把函数名<code>abs</code>看成变量，它指向一个可以计算绝对值的函数！</p>
<p>如果把<code>abs</code>指向其他对象，会有什么情况发生？</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717103810.png" alt="报错"></p>
<p>把<code>abs</code>指向<code>10</code>后，就无法通过<code>abs(-10)</code>调用该函数了！因为<code>abs</code>这个变量已经不指向求绝对值函数而是指向一个整数<code>10</code>！</p>
<p>当然实际代码绝对不能这么写，这里是为了说明函数名也是变量。要恢复<code>abs</code>函数，请重启 Python 交互环境。</p>
<p>注：由于<code>abs</code>函数实际上是定义在<code>import builtins</code>模块中的，所以要让修改<code>abs</code>变量的指向在其它模块也生效，要用<code>import builtins; builtins.abs = 10</code>。</p>
<p><strong>（3）传入函数</strong></p>
<p>既然变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p>
<p>一个最简单的高阶函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">add</span>(x, y, f):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> f(x) <span style="color:#000;font-weight:bold">+</span> f(y)
</span></span></code></pre></div><p>当我们调用<code>add(-5, 6, abs)</code>时，参数<code>x</code>，<code>y</code>和<code>f</code>分别接收<code>-5</code>，<code>6</code>和<code>abs</code>，根据函数定义，我们可以推导计算过程为：</p>
<pre tabindex="0"><code>x = -5
y = 6
f = abs
f(x) + f(y) ==&gt; abs(-5) + abs(6) ==&gt; 11
return 11
</code></pre><p>验证一下：</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717104540.png" alt="效果图"></p>
<p>👕 编写高阶函数，就是让函数的参数能够接收别的函数。</p>
<blockquote>
<p>小结：</p>
</blockquote>
<p>把函数作为参数传入，这样的函数称为高阶函数，函数式编程就是指这种高度抽象的编程范式。</p>
<h3 id="421-mapreduce">4.2.1 map/reduce</h3>
<p>Python 内建了<code>map()</code>和<code>reduce()</code>函数。</p>
<p>如果你读过 Google 的那篇大名鼎鼎的论文“<a href="http://research.google.com/archive/mapreduce.html">MapReduce: Simplified Data Processing on Large Clusters</a>”，你就能大概明白 map/reduce 的概念。</p>
<h4 id="-map">① map</h4>
<p>我们先看 map。<code>map()</code>函数接收两个参数，一个是函数，一个是<code>Iterable</code>，<code>map</code>将传入的函数依次作用到序列的每个元素，并把结果作为新的<code>Iterator</code>返回。</p>
<p>举例说明，比如我们有一个函数 $ f(x)=x^2$，要把这个函数作用在一个 list <code>[1, 2, 3, 4, 5, 6, 7, 8, 9]</code>上，就可以用<code>map()</code>实现如下：</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717105309.png" alt="image-20200717105308037"></p>
<p>现在，我们用 Python 代码实现：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> x
</span></span><span style="display:flex;"><span>r <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">map</span>(f, [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">8</span>, <span style="color:#099">9</span>])
</span></span><span style="display:flex;"><span><span style="color:#0086b3">list</span>(r)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717105515.png" alt="image-20200717105513962"></p>
<p><code>map()</code>传入的第一个参数是<code>f</code>，即函数对象本身。由于结果<code>r</code>是一个<code>Iterator</code>，<code>Iterator</code>是惰性序列，因此通过<code>list()</code>函数让它把整个序列都计算出来并返回一个list。</p>
<p>你可能会想，不需要<code>map()</code>函数，写一个循环，也可以计算出结果：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">8</span>, <span style="color:#099">9</span>]:
</span></span><span style="display:flex;"><span>    L<span style="color:#000;font-weight:bold">.</span>append(f(n))
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L)
</span></span></code></pre></div><p>的确可以，但是，从上面的循环代码，能一眼看明白“把 f(x) 作用在 list 的每一个元素并把结果生成一个新的  list”吗？</p>
<p>所以，<code>map()</code>作为高阶函数，事实上它把运算规则抽象了，因此，我们不但可以计算简单的 $ f(x)=x^2$，还可以计算任意复杂的函数，比如，把这个 list 所有数字转为字符串：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">list</span>(<span style="color:#0086b3">map</span>(<span style="color:#0086b3">str</span>, [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">8</span>, <span style="color:#099">9</span>]))
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717110351.png" alt="image-20200717110350309"></p>
<p>只需要一行代码。</p>
<h4 id="-reduce">② reduce</h4>
<p>再看<code>reduce</code>的用法。<code>reduce</code>把一个函数作用在一个序列<code>[x1, x2, x3, ...]</code>上，这个函数必须接收两个参数，<code>reduce</code>把结果继续和序列的下一个元素做累积计算，其效果就是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>reduce(f, [x1, x2, x3, x4]) <span style="color:#000;font-weight:bold">=</span> f(f(f(x1, x2), x3), x4)
</span></span></code></pre></div><p>比方说对一个序列求和，就可以用<code>reduce</code>实现：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">add</span>(x, y):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">+</span> y
</span></span><span style="display:flex;"><span>reduce(add, [<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>]) <span style="color:#998;font-style:italic"># 25</span>
</span></span></code></pre></div><p>当然求和运算可以直接用 Python 内建函数<code>sum()</code>，没必要动用<code>reduce</code>。</p>
<p>但是如果要把序列<code>[1, 3, 5, 7, 9]</code>变换成整数<code>13579</code>，<code>reduce</code>就可以派上用场：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>(x, y):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">+</span> y
</span></span><span style="display:flex;"><span>reduce(fn, [<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>]) <span style="color:#998;font-style:italic"># 13579</span>
</span></span></code></pre></div><p>这个例子本身没多大用处，但是，如果考虑到字符串<code>str</code>也是一个序列，对上面的例子稍加改动，配合<code>map()</code>，我们就可以写出把<code>str</code>转换为<code>int</code>的函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>(x, y):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">+</span> y
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">char2num</span>(s):
</span></span><span style="display:flex;"><span>    digits <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;0&#39;</span>: <span style="color:#099">0</span>, <span style="color:#d14">&#39;1&#39;</span>: <span style="color:#099">1</span>, <span style="color:#d14">&#39;2&#39;</span>: <span style="color:#099">2</span>, <span style="color:#d14">&#39;3&#39;</span>: <span style="color:#099">3</span>, <span style="color:#d14">&#39;4&#39;</span>: <span style="color:#099">4</span>, <span style="color:#d14">&#39;5&#39;</span>: <span style="color:#099">5</span>, <span style="color:#d14">&#39;6&#39;</span>: <span style="color:#099">6</span>, <span style="color:#d14">&#39;7&#39;</span>: <span style="color:#099">7</span>, <span style="color:#d14">&#39;8&#39;</span>: <span style="color:#099">8</span>, <span style="color:#d14">&#39;9&#39;</span>: <span style="color:#099">9</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> digits[s]
</span></span><span style="display:flex;"><span>reduce(fn, <span style="color:#0086b3">map</span>(char2num, <span style="color:#d14">&#39;13579&#39;</span>)) <span style="color:#998;font-style:italic"># 13579</span>
</span></span></code></pre></div><p>整理成一个<code>str2int</code>的函数就是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DIGITS <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;0&#39;</span>: <span style="color:#099">0</span>, <span style="color:#d14">&#39;1&#39;</span>: <span style="color:#099">1</span>, <span style="color:#d14">&#39;2&#39;</span>: <span style="color:#099">2</span>, <span style="color:#d14">&#39;3&#39;</span>: <span style="color:#099">3</span>, <span style="color:#d14">&#39;4&#39;</span>: <span style="color:#099">4</span>, <span style="color:#d14">&#39;5&#39;</span>: <span style="color:#099">5</span>, <span style="color:#d14">&#39;6&#39;</span>: <span style="color:#099">6</span>, <span style="color:#d14">&#39;7&#39;</span>: <span style="color:#099">7</span>, <span style="color:#d14">&#39;8&#39;</span>: <span style="color:#099">8</span>, <span style="color:#d14">&#39;9&#39;</span>: <span style="color:#099">9</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">str2int</span>(s):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>(x, y):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">+</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">char2num</span>(s):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> DIGITS[s]
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> reduce(fn, <span style="color:#0086b3">map</span>(char2num, s))
</span></span></code></pre></div><p>还可以用 lambda 函数进一步简化成：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DIGITS <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;0&#39;</span>: <span style="color:#099">0</span>, <span style="color:#d14">&#39;1&#39;</span>: <span style="color:#099">1</span>, <span style="color:#d14">&#39;2&#39;</span>: <span style="color:#099">2</span>, <span style="color:#d14">&#39;3&#39;</span>: <span style="color:#099">3</span>, <span style="color:#d14">&#39;4&#39;</span>: <span style="color:#099">4</span>, <span style="color:#d14">&#39;5&#39;</span>: <span style="color:#099">5</span>, <span style="color:#d14">&#39;6&#39;</span>: <span style="color:#099">6</span>, <span style="color:#d14">&#39;7&#39;</span>: <span style="color:#099">7</span>, <span style="color:#d14">&#39;8&#39;</span>: <span style="color:#099">8</span>, <span style="color:#d14">&#39;9&#39;</span>: <span style="color:#099">9</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">char2num</span>(s):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> DIGITS[s]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">str2int</span>(s):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> reduce(<span style="color:#000;font-weight:bold">lambda</span> x, y: x <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">+</span> y, <span style="color:#0086b3">map</span>(char2num, s))
</span></span></code></pre></div><p>也就是说，假设 Python 没有提供<code>int()</code>函数，你完全可以自己写一个把字符串转化为整数的函数，而且只需要几行代码！</p>
<blockquote>
<p>练习题：</p>
</blockquote>
<p>【第一题】利用<code>map()</code>函数，把用户输入的不规范的英文名字，变为首字母大写，其他小写的规范名字。输入：<code>['adam', 'LISA', 'barT']</code>，输出：<code>['Adam', 'Lisa', 'Bart']</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">normalize</span>(name):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> name[<span style="color:#099">0</span>]<span style="color:#000;font-weight:bold">.</span>upper() <span style="color:#000;font-weight:bold">+</span> name[<span style="color:#099">1</span>:]<span style="color:#000;font-weight:bold">.</span>lower()
</span></span></code></pre></div><p>或者也挺好：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">normalize</span>(name):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> name<span style="color:#000;font-weight:bold">.</span>title()  <span style="color:#998;font-style:italic">#title()函数 首字母大写  其他字母小写</span>
</span></span></code></pre></div><p>或者也挺好：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">normalize</span>(name):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> name<span style="color:#000;font-weight:bold">.</span>capitalize()
</span></span></code></pre></div><p>测试：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 测试:</span>
</span></span><span style="display:flex;"><span>L1 <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;adam&#39;</span>, <span style="color:#d14">&#39;LISA&#39;</span>, <span style="color:#d14">&#39;barT&#39;</span>]
</span></span><span style="display:flex;"><span>L2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">map</span>(normalize, L1))
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L2)
</span></span></code></pre></div><p>【第二题】Python 提供的<code>sum()</code>函数可以接受一个 list 并求和，请编写一个<code>prod()</code>函数，可以接受一个 list 并利用<code>reduce()</code>求积：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">prod</span>(L):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> reduce(<span style="color:#000;font-weight:bold">lambda</span> x, y: x <span style="color:#000;font-weight:bold">*</span> y, L)
</span></span></code></pre></div><p>测试：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;3 * 5 * 7 * 9 =&#39;</span>, prod([<span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>]))
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> prod([<span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>]) <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">945</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试成功!&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试失败!&#39;</span>)
</span></span></code></pre></div><p>【第三题】利用<code>map</code>和<code>reduce</code>编写一个<code>str2float</code>函数，把字符串<code>'123.456'</code>转换成浮点数<code>123.456</code>：</p>
<p>法一：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">str2float</span>(s):
</span></span><span style="display:flex;"><span>    digits <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;0&#39;</span>: <span style="color:#099">0</span>, <span style="color:#d14">&#39;1&#39;</span>: <span style="color:#099">1</span>, <span style="color:#d14">&#39;2&#39;</span>: <span style="color:#099">2</span>, <span style="color:#d14">&#39;3&#39;</span>: <span style="color:#099">3</span>, <span style="color:#d14">&#39;4&#39;</span>: <span style="color:#099">4</span>, <span style="color:#d14">&#39;5&#39;</span>: <span style="color:#099">5</span>, <span style="color:#d14">&#39;6&#39;</span>: <span style="color:#099">6</span>, <span style="color:#d14">&#39;7&#39;</span>: <span style="color:#099">7</span>, <span style="color:#d14">&#39;8&#39;</span>: <span style="color:#099">8</span>, <span style="color:#d14">&#39;9&#39;</span>: <span style="color:#099">9</span>}    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">char2num</span>(c):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> digits[c]
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>(x, y):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">+</span> y
</span></span><span style="display:flex;"><span>    pos <span style="color:#000;font-weight:bold">=</span> s<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> pos <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#099">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> (reduce(fn, <span style="color:#0086b3">map</span>(char2num, s[:pos])) <span style="color:#000;font-weight:bold">+</span> reduce(fn, <span style="color:#0086b3">map</span>(char2num, s[pos <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>:])) <span style="color:#000;font-weight:bold">*</span> (<span style="color:#099">10</span> <span style="color:#000;font-weight:bold">**</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#0086b3">len</span>(s[pos <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>:]))) 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> reduce(fn, <span style="color:#0086b3">map</span>(char2num, s))
</span></span></code></pre></div><p>法二：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">functools</span> <span style="color:#000;font-weight:bold">import</span> reduce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DIGITS <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;0&#39;</span>:<span style="color:#099">0</span>, <span style="color:#d14">&#39;1&#39;</span>:<span style="color:#099">1</span>, <span style="color:#d14">&#39;2&#39;</span>:<span style="color:#099">2</span>, <span style="color:#d14">&#39;3&#39;</span>:<span style="color:#099">3</span>, <span style="color:#d14">&#39;4&#39;</span>:<span style="color:#099">4</span>, <span style="color:#d14">&#39;5&#39;</span>:<span style="color:#099">5</span>, <span style="color:#d14">&#39;6&#39;</span>:<span style="color:#099">6</span>, <span style="color:#d14">&#39;7&#39;</span>:<span style="color:#099">7</span>, <span style="color:#d14">&#39;8&#39;</span>:<span style="color:#099">8</span>, <span style="color:#d14">&#39;9&#39;</span>:<span style="color:#099">9</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">str2float</span>(s):   
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">str2num</span>(s):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> DIGITS[s]
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>(x, y):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">+</span> y
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#d14">&#39;.&#39;</span> <span style="color:#000;font-weight:bold">in</span> s:
</span></span><span style="display:flex;"><span>        nPos <span style="color:#000;font-weight:bold">=</span> s<span style="color:#000;font-weight:bold">.</span>find(<span style="color:#d14">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>        s1 <span style="color:#000;font-weight:bold">=</span> s[:nPos]
</span></span><span style="display:flex;"><span>        s2 <span style="color:#000;font-weight:bold">=</span> s[nPos<span style="color:#000;font-weight:bold">+</span><span style="color:#099">1</span>:]
</span></span><span style="display:flex;"><span>        n1 <span style="color:#000;font-weight:bold">=</span> reduce(fn, <span style="color:#0086b3">map</span>(str2num, s1))
</span></span><span style="display:flex;"><span>        n2 <span style="color:#000;font-weight:bold">=</span> reduce(fn, <span style="color:#0086b3">map</span>(str2num, s2))
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> n1 <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">0.1</span> <span style="color:#000;font-weight:bold">**</span> <span style="color:#0086b3">len</span>(s2) <span style="color:#000;font-weight:bold">*</span> n2
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> ruduce(fn, <span style="color:#0086b3">map</span>(str2num, s))
</span></span></code></pre></div><p>测试：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;str2float(</span><span style="color:#d14">\&#39;</span><span style="color:#d14">123.456</span><span style="color:#d14">\&#39;</span><span style="color:#d14">) =&#39;</span>, str2float(<span style="color:#d14">&#39;123.456&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">abs</span>(str2float(<span style="color:#d14">&#39;123.456&#39;</span>) <span style="color:#000;font-weight:bold">-</span> <span style="color:#099">123.456</span>) <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0.00001</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试成功!&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试失败!&#39;</span>)
</span></span></code></pre></div><h3 id="422-filter">4.2.2 filter</h3>
<p>Python 内建的<code>filter()</code>函数用于过滤序列。</p>
<p>和<code>map()</code>类似，<code>filter()</code>也接收一个函数和一个序列。和<code>map()</code>不同的是，<code>filter()</code>把传入的函数依次作用于每个元素，然后根据返回值是<code>True</code>还是<code>False</code>决定保留还是丢弃该元素。</p>
<p>例如，在一个 list 中，删掉偶数，只保留奇数，可以这么写：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">is_odd</span>(n):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> n <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">list</span>(<span style="color:#0086b3">filter</span>(is_odd, [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">9</span>, <span style="color:#099">10</span>, <span style="color:#099">15</span>]))
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 结果: [1, 5, 9, 15]</span>
</span></span></code></pre></div><p>把一个序列中的空字符串删掉，可以这么写：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">not_empty</span>(s):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> s <span style="color:#000;font-weight:bold">and</span> s<span style="color:#000;font-weight:bold">.</span>strip()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">list</span>(<span style="color:#0086b3">filter</span>(not_empty, [<span style="color:#d14">&#39;A&#39;</span>, <span style="color:#d14">&#39;&#39;</span>, <span style="color:#d14">&#39;B&#39;</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#d14">&#39;C&#39;</span>, <span style="color:#d14">&#39;  &#39;</span>]))
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 结果: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span>
</span></span></code></pre></div><p>可见用<code>filter()</code>这个高阶函数，关键在于正确实现一个“筛选”函数。</p>
<p>注意到<code>filter()</code>函数返回的是一个<code>Iterator</code>，也就是一个惰性序列，所以要强迫<code>filter()</code>完成计算结果，需要用<code>list()</code>函数获得所有结果并返回list。</p>
<h4 id="-用-filter-求素数">① 用 filter 求素数</h4>
<p>计算<a href="http://baike.baidu.com/view/10626.htm">素数</a>的一个方法是<a href="http://baike.baidu.com/view/3784258.htm">埃氏筛法</a>，它的算法理解起来非常简单：</p>
<p>首先，列出从<code>2</code>开始的所有自然数，构造一个序列：</p>
<p>2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, &hellip;</p>
<p>取序列的第一个数<code>2</code>，它一定是素数，然后用<code>2</code>把序列的<code>2</code>的倍数筛掉：</p>
<p>3, <del>4</del>, 5, <del>6</del>, 7, <del>8</del>, 9, <del>10</del>, 11, <del>12</del>, 13, <del>14</del>, 15, <del>16</del>, 17, <del>18</del>, 19, <del>20</del>, &hellip;</p>
<p>取新序列的第一个数<code>3</code>，它一定是素数，然后用<code>3</code>把序列的<code>3</code>的倍数筛掉：</p>
<p>5, <del>6</del>, 7, <del>8</del>, <del>9</del>, <del>10</del>, 11, <del>12</del>, 13, <del>14</del>, <del>15</del>, <del>16</del>, 17, <del>18</del>, 19, <del>20</del>, &hellip;</p>
<p>取新序列的第一个数<code>5</code>，然后用<code>5</code>把序列的<code>5</code>的倍数筛掉：</p>
<p>7, <del>8</del>, <del>9</del>, <del>10</del>, 11, <del>12</del>, 13, <del>14</del>, <del>15</del>, <del>16</del>, 17, <del>18</del>, 19, <del>20</del>, &hellip;</p>
<p>不断筛下去，就可以得到所有的素数。</p>
<p>用 Python 来实现这个算法，可以先构造一个从<code>3</code>开始的奇数序列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_odd_iter</span>():
</span></span><span style="display:flex;"><span>    n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        n <span style="color:#000;font-weight:bold">=</span> n <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">yield</span> n
</span></span></code></pre></div><p>注意这是一个生成器，并且是一个无限序列。</p>
<p>然后定义一个筛选函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">_not_divisible</span>(n):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">lambda</span> x: x <span style="color:#000;font-weight:bold">%</span> n <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>
</span></span></code></pre></div><p>最后，定义一个生成器，不断返回下一个素数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">primes</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">yield</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>    it <span style="color:#000;font-weight:bold">=</span> _odd_iter() <span style="color:#998;font-style:italic"># 初始序列</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>        n <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">next</span>(it) <span style="color:#998;font-style:italic"># 返回序列的第一个数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">yield</span> n
</span></span><span style="display:flex;"><span>        it <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">filter</span>(_not_divisible(n), it) <span style="color:#998;font-style:italic"># 构造新序列</span>
</span></span></code></pre></div><p>这个生成器先返回第一个素数<code>2</code>，然后，利用<code>filter()</code>不断产生筛选后的新的序列。</p>
<p>由于<code>primes()</code>也是一个无限序列，所以调用时需要设置一个退出循环的条件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 打印1000以内的素数:</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> primes():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> n <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">1000</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(n)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">break</span>
</span></span></code></pre></div><p>注意到<code>Iterator</code>是惰性计算的序列，所以我们可以用 Python 表示“全体自然数”，“全体素数”这样的序列，而代码非常简洁。</p>
<blockquote>
<p>练习题：</p>
</blockquote>
<p>回数是指从左向右读和从右向左读都是一样的数，例如<code>12321</code>，<code>909</code>。请利用<code>filter()</code>筛选出回数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">is_palindrome</span>(n):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">str</span>(n) <span style="color:#000;font-weight:bold">==</span> <span style="color:#0086b3">str</span>(n)[::<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>]
</span></span></code></pre></div><p>测试：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 测试:</span>
</span></span><span style="display:flex;"><span>output <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">filter</span>(is_palindrome, <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">1000</span>))
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;1~1000:&#39;</span>, <span style="color:#0086b3">list</span>(output))
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">filter</span>(is_palindrome, <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">200</span>))) <span style="color:#000;font-weight:bold">==</span> [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">8</span>, <span style="color:#099">9</span>, <span style="color:#099">11</span>, <span style="color:#099">22</span>, <span style="color:#099">33</span>, <span style="color:#099">44</span>, <span style="color:#099">55</span>, <span style="color:#099">66</span>, <span style="color:#099">77</span>, <span style="color:#099">88</span>, <span style="color:#099">99</span>, <span style="color:#099">101</span>, <span style="color:#099">111</span>, <span style="color:#099">121</span>, <span style="color:#099">131</span>, <span style="color:#099">141</span>, <span style="color:#099">151</span>, <span style="color:#099">161</span>, <span style="color:#099">171</span>, <span style="color:#099">181</span>, <span style="color:#099">191</span>]:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试成功!&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试失败!&#39;</span>)
</span></span></code></pre></div><blockquote>
<p>小结：</p>
</blockquote>
<p><code>filter()</code>的作用是从一个序列中筛出符合条件的元素。由于<code>filter()</code>使用了惰性计算，所以只有在取<code>filter()</code>结果的时候，才会真正筛选并每次返回下一个筛出的元素。</p>
<h3 id="423-sorted">4.2.3 sorted</h3>
<h4 id="-排序算法">① 排序算法</h4>
<p>排序也是在程序中经常用到的算法。无论使用冒泡排序还是快速排序，排序的核心是比较两个元素的大小。如果是数字，我们可以直接比较，但如果是字符串或者两个 dict呢？直接比较数学上的大小是没有意义的，因此，比较的过程必须通过函数抽象出来。</p>
<p>Python 内置的<code>sorted()</code>函数就可以对 list 进行排序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">sorted</span>([<span style="color:#099">36</span>, <span style="color:#099">5</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">12</span>, <span style="color:#099">9</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">21</span>])
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717175610.png" alt="image-20200717175608860"></p>
<p>此外，<code>sorted()</code>函数也是一个高阶函数，它还可以接收一个<code>key</code>函数来实现自定义的排序，例如按绝对值大小排序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">sorted</span>([<span style="color:#099">36</span>, <span style="color:#099">5</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">12</span>, <span style="color:#099">9</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">21</span>], key<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">abs</span>)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717175739.png" alt="image-20200717175738112"></p>
<p>key 指定的函数将作用于 list 的每一个元素上，并根据 key 函数返回的结果进行排序。对比原始的 list 和经过<code>key=abs</code>处理过的 list：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">list</span> <span style="color:#000;font-weight:bold">=</span> [<span style="color:#099">36</span>, <span style="color:#099">5</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">12</span>, <span style="color:#099">9</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">21</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>keys <span style="color:#000;font-weight:bold">=</span> [<span style="color:#099">36</span>, <span style="color:#099">5</span>,  <span style="color:#099">12</span>, <span style="color:#099">9</span>,  <span style="color:#099">21</span>]
</span></span></code></pre></div><p>然后<code>sorted()</code>函数按照 keys 进行排序，并按照对应关系返回 list 相应的元素：</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180026.png" alt="image-20200717180025283"></p>
<p>我们再看一个字符串排序的例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">sorted</span>([<span style="color:#d14">&#39;bob&#39;</span>, <span style="color:#d14">&#39;about&#39;</span>, <span style="color:#d14">&#39;Zoo&#39;</span>, <span style="color:#d14">&#39;Credit&#39;</span>])
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180117.png" alt="image-20200717180116413"></p>
<p>默认情况下，对字符串排序，是按照 ASCII 的大小比较的，由于<code>'Z' &lt; 'a'</code>，结果，大写字母<code>Z</code>会排在小写字母<code>a</code>的前面。</p>
<p>现在，我们提出排序应该忽略大小写，按照字母序排序。要实现这个算法，不必对现有代码大加改动，只要我们能用一个 key 函数把字符串映射为忽略大小写排序即可。忽略大小写来比较两个字符串，实际上就是先把字符串都变成大写（或者都变成小写），再比较。</p>
<p>这样，我们给<code>sorted</code>传入 key 函数，即可实现忽略大小写的排序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">sorted</span>([<span style="color:#d14">&#39;bob&#39;</span>, <span style="color:#d14">&#39;about&#39;</span>, <span style="color:#d14">&#39;Zoo&#39;</span>, <span style="color:#d14">&#39;Credit&#39;</span>], key<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span><span style="color:#000;font-weight:bold">.</span>lower)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180306.png" alt="image-20200717180305192"></p>
<p>要进行反向排序，不必改动 key 函数，可以传入第三个参数<code>reverse=True</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#0086b3">sorted</span>([<span style="color:#d14">&#39;bob&#39;</span>, <span style="color:#d14">&#39;about&#39;</span>, <span style="color:#d14">&#39;Zoo&#39;</span>, <span style="color:#d14">&#39;Credit&#39;</span>], key<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">str</span><span style="color:#000;font-weight:bold">.</span>lower, reverse<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180421.png" alt="image-20200717180420727"></p>
<p>从上述例子可以看出，高阶函数的抽象能力是非常强大的，而且，核心代码可以保持得非常简洁。</p>
<blockquote>
<p>小结：</p>
</blockquote>
<p><code>sorted()</code>也是一个高阶函数。用<code>sorted()</code>排序的关键在于实现一个映射函数。</p>
<blockquote>
<p>练习题：</p>
</blockquote>
<p>假设我们用一组 tuple 表示学生名字和成绩：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [(<span style="color:#d14">&#39;Bob&#39;</span>, <span style="color:#099">75</span>), (<span style="color:#d14">&#39;Adam&#39;</span>, <span style="color:#099">92</span>), (<span style="color:#d14">&#39;Bart&#39;</span>, <span style="color:#099">66</span>), (<span style="color:#d14">&#39;Lisa&#39;</span>, <span style="color:#099">88</span>)]
</span></span></code></pre></div><p>请用<code>sorted()</code>对上述列表分别按名字升序排序，再按成绩从高到低排序。</p>
<p><strong>（1）按名字升序排序</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [(<span style="color:#d14">&#39;Bob&#39;</span>, <span style="color:#099">75</span>), (<span style="color:#d14">&#39;Adam&#39;</span>, <span style="color:#099">92</span>), (<span style="color:#d14">&#39;Bart&#39;</span>, <span style="color:#099">66</span>), (<span style="color:#d14">&#39;Lisa&#39;</span>, <span style="color:#099">88</span>)]
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">by_name</span>(t):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> t[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>L2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">sorted</span>(L, key<span style="color:#000;font-weight:bold">=</span>by_name)
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L2)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717205003.png" alt="image-20200717205002143"></p>
<p><strong>（2）按成绩从高到低排序</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [(<span style="color:#d14">&#39;Bob&#39;</span>, <span style="color:#099">75</span>), (<span style="color:#d14">&#39;Adam&#39;</span>, <span style="color:#099">92</span>), (<span style="color:#d14">&#39;Bart&#39;</span>, <span style="color:#099">66</span>), (<span style="color:#d14">&#39;Lisa&#39;</span>, <span style="color:#099">88</span>)]
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">by_name</span>(t):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span>t[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>L2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">sorted</span>(L, key<span style="color:#000;font-weight:bold">=</span>by_name)
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L2)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717205111.png" alt="image-20200717205111010"></p>
<h2 id="43-返回函数">4.3 返回函数</h2>
<h3 id="431-函数作为返回值">4.3.1 函数作为返回值</h3>
<p>高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回。</p>
<p>我们来实现一个可变参数的求和。通常情况下，求和的函数是这样定义的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">calc_sum</span>(<span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>    ax <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> args:
</span></span><span style="display:flex;"><span>        ax <span style="color:#000;font-weight:bold">=</span> ax <span style="color:#000;font-weight:bold">+</span> n
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> ax
</span></span></code></pre></div><p>但是，如果不需要立刻求和，而是在后面的代码中，根据需要再计算怎么办？可以不返回求和的结果，而是返回求和的函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">lazy_sum</span>(<span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">sum</span>():
</span></span><span style="display:flex;"><span>        ax <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> args:
</span></span><span style="display:flex;"><span>            ax <span style="color:#000;font-weight:bold">=</span> ax <span style="color:#000;font-weight:bold">+</span> n
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> ax
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">sum</span>
</span></span></code></pre></div><p>当我们调用<code>lazy_sum()</code>时，返回的并不是求和结果，而是求和函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f <span style="color:#000;font-weight:bold">=</span> lazy_sum(<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>function lazy_sum<span style="color:#000;font-weight:bold">.&lt;</span><span style="color:#0086b3">locals</span><span style="color:#000;font-weight:bold">&gt;.</span>sum at <span style="color:#099">0x101c6ed90</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>调用函数<code>f</code>时，才真正计算求和的结果：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f()
</span></span><span style="display:flex;"><span><span style="color:#099">25</span>
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200718150943.png" alt="image-20200718150942158"></p>
<p>在这个例子中，我们在函数<code>lazy_sum</code>中又定义了函数<code>sum</code>，并且，内部函数<code>sum</code>可以引用外部函数<code>lazy_sum</code>的参数和局部变量，当<code>lazy_sum</code>返回函数<code>sum</code>时，相关参数和变量都保存在返回的函数中，这种称为“闭包（Closure）”的程序结构拥有极大的威力。</p>
<p>请再注意一点，当我们调用<code>lazy_sum()</code>时，每次调用都会返回一个新的函数，即使传入相同的参数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f1 <span style="color:#000;font-weight:bold">=</span> lazy_sum(<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f2 <span style="color:#000;font-weight:bold">=</span> lazy_sum(<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">9</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f1<span style="color:#000;font-weight:bold">==</span>f2
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f1()<span style="color:#000;font-weight:bold">==</span>f2()
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">True</span>
</span></span></code></pre></div><p><code>f1()</code>和<code>f2()</code>的调用结果互不影响。</p>
<h3 id="432-闭包">4.3.2 闭包</h3>
<p>注意到返回的函数在其定义内部引用了局部变量<code>args</code>，所以，当一个函数返回了一个函数后，其内部的局部变量还被新函数引用，所以，闭包用起来简单，实现起来可不容易。</p>
<p>另一个需要注意的问题是，返回的函数并没有立刻执行，而是直到调用了<code>f()</code>才执行。我们来看一个例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">count</span>():
</span></span><span style="display:flex;"><span>    fs <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">4</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>():
</span></span><span style="display:flex;"><span>             <span style="color:#000;font-weight:bold">return</span> i<span style="color:#000;font-weight:bold">*</span>i
</span></span><span style="display:flex;"><span>        fs<span style="color:#000;font-weight:bold">.</span>append(f)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> fs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f1, f2, f3 <span style="color:#000;font-weight:bold">=</span> count()
</span></span></code></pre></div><p>在上面的例子中，每次循环，都创建了一个新的函数，然后，把创建的 3 个函数都返回了。</p>
<p>你可能认为调用<code>f1()</code>，<code>f2()</code>和<code>f3()</code>结果应该是<code>1</code>，<code>4</code>，<code>9</code>，但实际结果是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f1()
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f2()
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f3()
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>
</span></span></code></pre></div><p>全部都是<code>9</code>！原因就在于返回的函数引用了变量<code>i</code>，但它并非立刻执行。等到 3 个函数都返回时，它们所引用的变量<code>i</code>已经变成了<code>3</code>，因此最终结果为<code>9</code>。</p>
<p>!&gt; 返回闭包时牢记一点：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</p>
<p>如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">count</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>(j):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">g</span>():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> j<span style="color:#000;font-weight:bold">*</span>j
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> g
</span></span><span style="display:flex;"><span>    fs <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">4</span>):
</span></span><span style="display:flex;"><span>        fs<span style="color:#000;font-weight:bold">.</span>append(f(i)) <span style="color:#998;font-style:italic"># f(i)立刻被执行，因此i的当前值被传入f()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> fs
</span></span></code></pre></div><p>再看看结果：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f1, f2, f3 <span style="color:#000;font-weight:bold">=</span> count()
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f1()
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f2()
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f3()
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>
</span></span></code></pre></div><p>缺点是代码较长，可利用 lambda 函数缩短代码。</p>
<blockquote>
<p>练习题：</p>
</blockquote>
<p>利用闭包返回一个计数器函数，每次调用它返回递增整数：</p>
<ul>
<li>法一：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">createCounter</span>():
</span></span><span style="display:flex;"><span>    i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">counter</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">nonlocal</span> i  <span style="color:#998;font-style:italic">#这句声明是闭包函数应用同名变量的重点。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">True</span>:
</span></span><span style="display:flex;"><span>            i <span style="color:#000;font-weight:bold">=</span> i <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> counter
</span></span></code></pre></div><ul>
<li>法二：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 选择数值可变但是地址不变的变量类型——数组</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">createCounter</span>():
</span></span><span style="display:flex;"><span>    i <span style="color:#000;font-weight:bold">=</span> [<span style="color:#099">0</span>] <span style="color:#998;font-style:italic"># 初始化数组    </span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">counter</span>():
</span></span><span style="display:flex;"><span>        i[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span> <span style="color:#998;font-style:italic">#不修改数组， 尽修改数组中元素数值， 数组的地址不变        </span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> i[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> counter
</span></span></code></pre></div><ul>
<li>法三：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 也可以选择dict类型变量，与数组同理， 主要不改变变量引用地址即可</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">createCounter</span>():
</span></span><span style="display:flex;"><span>    i <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;a&#39;</span>:<span style="color:#099">0</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">counter</span>():
</span></span><span style="display:flex;"><span>        i[<span style="color:#d14">&#39;a&#39;</span>] <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> i[<span style="color:#d14">&#39;a&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> counter
</span></span></code></pre></div><ul>
<li>测试：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 测试:</span>
</span></span><span style="display:flex;"><span>counterA <span style="color:#000;font-weight:bold">=</span> createCounter()
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(counterA(), counterA(), counterA(), counterA(), counterA()) <span style="color:#998;font-style:italic"># 1 2 3 4 5</span>
</span></span><span style="display:flex;"><span>counterB <span style="color:#000;font-weight:bold">=</span> createCounter()
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> [counterB(), counterB(), counterB(), counterB()] <span style="color:#000;font-weight:bold">==</span> [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>]:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试通过!&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试失败!&#39;</span>)
</span></span></code></pre></div><blockquote>
<p>小结：</p>
</blockquote>
<p>一个函数可以返回一个计算结果，也可以返回一个函数。</p>
<p>返回一个函数时，牢记该函数并未执行，返回函数中不要引用任何可能会变化的变量。</p>
<h2 id="44-匿名函数">4.4 匿名函数</h2>
<p>当我们在传入函数时，有些时候，不需要显式地定义函数，直接传入匿名函数更方便。</p>
<p>在 Python 中，对匿名函数提供了有限支持。还是以<code>map()</code>函数为例，计算 $f(x)=x^2$ 时，除了定义一个<code>f(x)</code>的函数外，还可以直接传入匿名函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">list</span>(<span style="color:#0086b3">map</span>(<span style="color:#000;font-weight:bold">lambda</span> x: x <span style="color:#000;font-weight:bold">*</span> x, [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">8</span>, <span style="color:#099">9</span>]))
</span></span></code></pre></div><p>通过对比可以看出，匿名函数<code>lambda x: x * x</code>实际上就是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> x
</span></span></code></pre></div><p>关键字<code>lambda</code>表示匿名函数，冒号前面的<code>x</code>表示函数参数。</p>
<p>匿名函数有个限制，就是只能有一个表达式，不用写<code>return</code>，返回值就是该表达式的结果。</p>
<p>用匿名函数有个好处，因为函数没有名字，不必担心函数名冲突。此外，匿名函数也是一个函数对象，也可以把匿名函数赋值给一个变量，再利用变量来调用该函数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">lambda</span> x: x <span style="color:#000;font-weight:bold">*</span> x
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>function <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">lambda</span><span style="color:#000;font-weight:bold">&gt;</span> at <span style="color:#099">0x101c6ef28</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f(<span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">25</span>
</span></span></code></pre></div><p>同样，也可以把匿名函数作为返回值返回，比如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">build</span>(x, y):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">lambda</span>: x <span style="color:#000;font-weight:bold">*</span> x <span style="color:#000;font-weight:bold">+</span> y <span style="color:#000;font-weight:bold">*</span> y
</span></span></code></pre></div><blockquote>
<p>练习题：</p>
</blockquote>
<p>请用匿名函数改造下面的代码：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">is_odd</span>(n):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> n <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">filter</span>(is_odd, <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">20</span>)))
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L)
</span></span></code></pre></div><p>用匿名函数改造：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">filter</span>(<span style="color:#000;font-weight:bold">lambda</span> x: x <span style="color:#000;font-weight:bold">%</span><span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">1</span>, <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">20</span>)))
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L)
</span></span></code></pre></div><p>那如果用列表生成式改造呢？</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [x <span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>,<span style="color:#099">20</span>) <span style="color:#000;font-weight:bold">if</span> x <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L)
</span></span></code></pre></div><blockquote>
<p>小结：</p>
</blockquote>
<p>Python 对匿名函数的支持有限，只有一些简单的情况下可以使用匿名函数。</p>
<h2 id="45-装饰器">4.5 装饰器</h2>
<p>由于函数也是一个对象，而且函数对象可以被赋值给变量，所以，通过变量也能调用该函数。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">now</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;2020-07-19&#39;</span>)
</span></span><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> now
</span></span><span style="display:flex;"><span>f() <span style="color:#998;font-style:italic"># 结果：2020-07-19</span>
</span></span></code></pre></div><p>函数对象有一个<code>__name__</code>属性，可以拿到函数的名字：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> now<span style="color:#000;font-weight:bold">.</span>__name__
</span></span><span style="display:flex;"><span><span style="color:#d14">&#39;now&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> f<span style="color:#000;font-weight:bold">.</span>__name__
</span></span><span style="display:flex;"><span><span style="color:#d14">&#39;now&#39;</span>
</span></span></code></pre></div><p>现在，假设我们要增强<code>now()</code>函数的功能，比如，在函数调用前后自动打印日志，但又不希望修改<code>now()</code>函数的定义，这种在代码运行期间动态增加功能的方式，称之为“装饰器”（Decorator）。</p>
<p>本质上，decorator 就是一个返回函数的高阶函数。所以，我们要定义一个能打印日志的 decorator，可以定义如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(func):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;call </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> func<span style="color:#000;font-weight:bold">.</span>__name__)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span></code></pre></div><p>观察上面的<code>log</code>，因为它是一个 decorator，所以接受一个函数作为参数，并返回一个函数。我们要借助 Python 的 @ 语法，把 decorator 置于函数的定义处：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@log</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">now</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;2020-07-19&#39;</span>)
</span></span></code></pre></div><p>调用<code>now()</code>函数，不仅会运行<code>now()</code>函数本身，还会在运行<code>now()</code>函数前打印一行日志：</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719083113.png" alt="image-20200719083104800"></p>
<p>把<code>@log</code>放到<code>now()</code>函数的定义处，相当于执行了语句：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>now <span style="color:#000;font-weight:bold">=</span> log(now)
</span></span></code></pre></div><p>由于<code>log()</code>是一个 decorator，返回一个函数，所以，原来的<code>now()</code>函数仍然存在，只是现在同名的<code>now</code>变量指向了新的函数，于是调用<code>now()</code>将执行新函数，即在<code>log()</code>函数中返回的<code>wrapper()</code>函数。</p>
<p><code>wrapper()</code>函数的参数定义是<code>(*args, **kw)</code>，因此，<code>wrapper()</code>函数可以接受任意参数的调用。在<code>wrapper()</code>函数内，首先打印日志，再紧接着调用原始函数。</p>
<p>如果 decorator 本身需要传入参数，那就需要编写一个返回 decorator 的高阶函数，写出来会更复杂。比如，要自定义 log 的文本：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(text):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">decorator</span>(func):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> (text, func<span style="color:#000;font-weight:bold">.</span>__name__))
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> decorator
</span></span></code></pre></div><p>这个 3 层嵌套的 decorator 用法如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@log</span>(<span style="color:#d14">&#39;execute&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">now</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;2020-07-19&#39;</span>)
</span></span></code></pre></div><p>执行结果如下：</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719084715.png" alt="image-20200719084700178"></p>
<p>和两层嵌套的 decorator 相比，3 层嵌套的效果是这样的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> now <span style="color:#000;font-weight:bold">=</span> log(<span style="color:#d14">&#39;execute&#39;</span>)(now)
</span></span></code></pre></div><p>我们来剖析上面的语句，首先执行<code>log('execute')</code>，返回的是<code>decorator</code>函数，再调用返回的函数，参数是<code>now</code>函数，返回值最终是<code>wrapper</code>函数。</p>
<p>以上两种 decorator 的定义都没有问题，但还差最后一步。因为我们讲了函数也是对象，它有<code>__name__</code>等属性，但你去看经过 decorator 装饰之后的函数，它们的<code>__name__</code>已经从原来的<code>'now'</code>变成了<code>'wrapper'</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> now<span style="color:#000;font-weight:bold">.</span>__name__
</span></span><span style="display:flex;"><span><span style="color:#d14">&#39;wrapper&#39;</span>
</span></span></code></pre></div><p>因为返回的那个<code>wrapper()</code>函数名字就是<code>'wrapper'</code>，所以，需要把原始函数的<code>__name__</code>等属性复制到<code>wrapper()</code>函数中，否则，有些依赖函数签名的代码执行就会出错。</p>
<p>不需要编写<code>wrapper.__name__ = func.__name__</code>这样的代码，Python 内置的<code>functools.wraps</code>就是干这个事的，所以，一个完整的 decorator 的写法如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(func):
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@functools.wraps</span>(func)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;call </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> func<span style="color:#000;font-weight:bold">.</span>__name__)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span></code></pre></div><p>或者针对带参数的 decorator：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(text):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">decorator</span>(func):
</span></span><span style="display:flex;"><span>        <span style="color:#3c5d5d;font-weight:bold">@functools.wraps</span>(func)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>            <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> (text, func<span style="color:#000;font-weight:bold">.</span>__name__))
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> decorator
</span></span></code></pre></div><p><code>import functools</code>是导入<code>functools</code>模块。模块的概念稍候讲解。现在，只需记住在定义<code>wrapper()</code>的前面加上<code>@functools.wraps(func)</code>即可。</p>
<blockquote>
<p>练习题：</p>
</blockquote>
<p>请设计一个 decorator，它可作用于任何函数上，并打印该函数的执行时间：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">time</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">metric</span>(fn):
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@functools.wraps</span>(fn)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>        start_time <span style="color:#000;font-weight:bold">=</span> time<span style="color:#000;font-weight:bold">.</span>time()
</span></span><span style="display:flex;"><span>        e <span style="color:#000;font-weight:bold">=</span> fn(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>        end_time <span style="color:#000;font-weight:bold">=</span> time<span style="color:#000;font-weight:bold">.</span>time()
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> executed in </span><span style="color:#d14">%s</span><span style="color:#d14"> ms&#39;</span> <span style="color:#000;font-weight:bold">%</span> (fn<span style="color:#000;font-weight:bold">.</span>__name__, end_time <span style="color:#000;font-weight:bold">-</span> start_time))
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> e
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span></code></pre></div><p>测试：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 测试</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@metric</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fast</span>(x, y):
</span></span><span style="display:flex;"><span>    time<span style="color:#000;font-weight:bold">.</span>sleep(<span style="color:#099">0.0012</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">+</span> y;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@metric</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">slow</span>(x, y, z):
</span></span><span style="display:flex;"><span>    time<span style="color:#000;font-weight:bold">.</span>sleep(<span style="color:#099">0.1234</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">*</span> y <span style="color:#000;font-weight:bold">*</span> z;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> fast(<span style="color:#099">11</span>, <span style="color:#099">22</span>)
</span></span><span style="display:flex;"><span>s <span style="color:#000;font-weight:bold">=</span> slow(<span style="color:#099">11</span>, <span style="color:#099">22</span>, <span style="color:#099">33</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> f <span style="color:#000;font-weight:bold">!=</span> <span style="color:#099">33</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试失败!&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">elif</span> s <span style="color:#000;font-weight:bold">!=</span> <span style="color:#099">7986</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;测试失败!&#39;</span>)
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719091405.png" alt="image-20200719091357306"></p>
<blockquote>
<p>小结：</p>
</blockquote>
<p>在面向对象（OOP）的设计模式中，decorator 被称为装饰模式。OOP 的装饰模式需要通过继承和组合来实现，而 Python 除了能支持 OOP 的 decorator 外，直接从语法层次支持 decorator。Python 的 decorator 可以用函数实现，也可以用类实现。</p>
<p>decorator 可以增强函数的功能，定义起来虽然有点复杂，但使用起来非常灵活和方便。</p>
<p>再思考一下能否写出一个<code>@log</code>的 decorator，使它既支持：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@log</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">pass</span>
</span></span></code></pre></div><p>又支持：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@log</span>(<span style="color:#d14">&#39;execute&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">pass</span>
</span></span></code></pre></div><p>eg.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(text):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#0086b3">isinstance</span>(text, <span style="color:#0086b3">str</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">decorator</span>(func):
</span></span><span style="display:flex;"><span>            <span style="color:#3c5d5d;font-weight:bold">@functools.wraps</span>(func)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>                <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%s</span><span style="color:#d14">(): &#39;</span> <span style="color:#000;font-weight:bold">%</span> (text, func<span style="color:#000;font-weight:bold">.</span>__name__))
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> decorator
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%s</span><span style="color:#d14">(): &#39;</span> <span style="color:#000;font-weight:bold">%</span> (text, func<span style="color:#000;font-weight:bold">.</span>__name__))
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span></code></pre></div><h2 id="46-偏函数">4.6 偏函数</h2>
<p>Python 的<code>functools</code>模块提供了很多有用的功能，其中一个就是偏函数（Partial function）。要注意，这里的偏函数和数学意义上的偏函数不一样。</p>
<p>在介绍函数参数的时候，我们讲到，通过设定参数的默认值，可以降低函数调用的难度。而偏函数也可以做到这一点。举例如下：</p>
<p><code>int()</code>函数可以把字符串转换为整数，当仅传入字符串时，<code>int()</code>函数默认按十进制转换：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#0086b3">int</span>(<span style="color:#d14">&#39;12345&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">12345</span>
</span></span></code></pre></div><p>但<code>int()</code>函数还提供额外的<code>base</code>参数，默认值为<code>10</code>。如果传入<code>base</code>参数，就可以做 N 进制的转换：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#0086b3">int</span>(<span style="color:#d14">&#39;12345&#39;</span>, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">8</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">5349</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#0086b3">int</span>(<span style="color:#d14">&#39;12345&#39;</span>, <span style="color:#099">16</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">74565</span>
</span></span></code></pre></div><p>假设要转换大量的二进制字符串，每次都传入<code>int(x, base=2)</code>非常麻烦，于是，我们想到，可以定义一个<code>int2()</code>的函数，默认把<code>base=2</code>传进去：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">int2</span>(x, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">int</span>(x, base)
</span></span></code></pre></div><p>这样，我们转换二进制就非常方便了：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> int2(<span style="color:#d14">&#39;1000000&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> int2(<span style="color:#d14">&#39;1010101&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">85</span>
</span></span></code></pre></div><p><code>functools.partial</code>就是帮助我们创建一个偏函数的，不需要我们自己定义<code>int2()</code>，可以直接使用下面的代码创建一个新的函数<code>int2</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> int2 <span style="color:#000;font-weight:bold">=</span> functools<span style="color:#000;font-weight:bold">.</span>partial(<span style="color:#0086b3">int</span>, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> int2(<span style="color:#d14">&#39;1000000&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">64</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> int2(<span style="color:#d14">&#39;1010101&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">85</span>
</span></span></code></pre></div><p>所以，简单总结<code>functools.partial</code>的作用就是，把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，调用这个新函数会更简单。</p>
<p>注意到上面的新的<code>int2</code>函数，仅仅是把<code>base</code>参数重新设定默认值为<code>2</code>，但也可以在函数调用时传入其他值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;&gt;&gt;</span> int2(<span style="color:#d14">&#39;1000000&#39;</span>, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">10</span>)
</span></span><span style="display:flex;"><span><span style="color:#099">1000000</span>
</span></span></code></pre></div><p>最后，创建偏函数时，实际上可以接收函数对象、<code>*args</code>和<code>**kw</code>这 3 个参数，当传入：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>int2 <span style="color:#000;font-weight:bold">=</span> functools<span style="color:#000;font-weight:bold">.</span>partial(<span style="color:#0086b3">int</span>, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>)
</span></span></code></pre></div><p>实际上固定了 int() 函数的关键字参数<code>base</code>，也就是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>int2(<span style="color:#d14">&#39;10010&#39;</span>)
</span></span></code></pre></div><p>相当于：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>kw <span style="color:#000;font-weight:bold">=</span> { <span style="color:#d14">&#39;base&#39;</span>: <span style="color:#099">2</span> }
</span></span><span style="display:flex;"><span><span style="color:#0086b3">int</span>(<span style="color:#d14">&#39;10010&#39;</span>, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span></code></pre></div><p>当传入：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>max2 <span style="color:#000;font-weight:bold">=</span> functools<span style="color:#000;font-weight:bold">.</span>partial(<span style="color:#0086b3">max</span>, <span style="color:#099">10</span>)
</span></span></code></pre></div><p>实际上会把<code>10</code>作为<code>*args</code>的一部分自动加到左边，也就是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>max2(<span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>)
</span></span></code></pre></div><p>相当于：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>args <span style="color:#000;font-weight:bold">=</span> (<span style="color:#099">10</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>)
</span></span><span style="display:flex;"><span><span style="color:#0086b3">max</span>(<span style="color:#000;font-weight:bold">*</span>args)
</span></span></code></pre></div><p>结果为<code>10</code>。</p>
<p><img src="https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719101153.png" alt="image-20200719101140248"></p>
<blockquote>
<p>小结：</p>
</blockquote>
<p>当函数的参数个数太多，需要简化时，使用<code>functools.partial</code>可以创建一个新的函数，这个新函数可以固定住原函数的部分参数，从而在调用时更简单。</p>
<h2 id="47-参考资料">4.7 参考资料</h2>
<ul>
<li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017328525009056">廖雪峰 - Python 3.x - 函数式编程</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/04/functional_programming.html">阮一峰 - 函数式编程初探</a></li>
</ul>

    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ch10-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/">← 第十章 进程和线程</a></div>
    <div></div>
</div>
    
    

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        京ICP备2022007001号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
