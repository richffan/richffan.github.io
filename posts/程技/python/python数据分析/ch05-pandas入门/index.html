<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="第五章 Pandas 入门 - https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch05-pandas%E5%85%A5%E9%97%A8/">
    <meta name="author" content="richfan - https://richfan.site/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>第五章 Pandas 入门</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://richfan.site/style.min.d252ad53a5e6b2ae6b8c6c1661107189be3668e36c8dd61697bbe008595a7e04.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": true
	}
</div>
    <h1 class="title">
        
            第五章 Pandas 入门
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2023-09-25&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-09-25&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            12577 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            26 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/%E7%A8%8B%E6%8A%80">程技</a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/python">python</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch02-python%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E5%92%8Cipython%E4%BB%A5%E5%8F%8Ajupyternotebooks/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#51-pandas的数据结构介绍">5.1 pandas的数据结构介绍</a>
      <ul>
        <li><a href="#511-series">5.1.1 Series</a></li>
        <li><a href="#512-dataframe">5.1.2 DataFrame</a></li>
        <li><a href="#513-索引对象">5.1.3 索引对象</a></li>
      </ul>
    </li>
    <li><a href="#52-基本功能">5.2 基本功能</a>
      <ul>
        <li><a href="#521-重新索引">5.2.1 重新索引</a></li>
        <li><a href="#522-丢弃指定轴上的项">5.2.2 丢弃指定轴上的项</a></li>
        <li><a href="#523-索引选取和过滤">5.2.3 索引、选取和过滤</a></li>
        <li><a href="#524-用loc和iloc进行选取">5.2.4 用loc和iloc进行选取</a></li>
        <li><a href="#525-整数索引">5.2.5 整数索引</a></li>
        <li><a href="#526-算术运算和数据对齐">5.2.6 算术运算和数据对齐</a></li>
        <li><a href="#527-在算术方法中填充值">5.2.7 在算术方法中填充值</a></li>
        <li><a href="#528-dataframe和series之间的运算">5.2.8 DataFrame和Series之间的运算</a></li>
        <li><a href="#529-函数应用和映射">5.2.9 函数应用和映射</a></li>
        <li><a href="#5210-排序和排名">5.2.10 排序和排名</a></li>
        <li><a href="#5211-带有重复标签的轴索引">5.2.11 带有重复标签的轴索引</a></li>
      </ul>
    </li>
    <li><a href="#53-汇总和计算描述统计">5.3 汇总和计算描述统计</a>
      <ul>
        <li><a href="#531-相关系数与协方差">5.3.1 相关系数与协方差</a></li>
        <li><a href="#532-唯一值值计数以及成员资格">5.3.2 唯一值、值计数以及成员资格</a></li>
      </ul>
    </li>
    <li><a href="#54-总结">5.4 总结</a></li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <p>pandas是本书后续内容的首选库。它含有使<code>数据清洗</code>和<code>分析</code>工作变得更快更简单的数据结构和操作工具。pandas经常和其它工具一同使用，如数值计算工具NumPy和SciPy，分析库statsmodels和scikit-learn，和数据可视化库matplotlib。pandas是基于NumPy数组构建的，特别是基于数组的函数和不使用for循环的数据处理。</p>
<p>虽然pandas采用了大量的NumPy编码风格，但二者最大的不同是pandas是专门为处理表格和混杂数据设计的。而NumPy更适合处理统一的数值数组数据。</p>
<p>自从2010年pandas开源以来，pandas逐渐成长为一个非常大的库，应用于许多真实案例。开发者社区已经有了800个独立的贡献者，他们在解决日常数据问题的同时为这个项目提供贡献。</p>
<p>在本书后续部分中，我将使用下面这样的pandas引入约定：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">1</span>]: <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">pandas</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">pd</span>
</span></span></code></pre></div><p>因此，只要你在代码中看到pd.，就得想到这是pandas。因为Series和DataFrame用的次数非常多，所以将其引入本地命名空间中会更方便：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">2</span>]: <span style="color:#000;font-weight:bold">from</span> <span style="color:#555">pandas</span> <span style="color:#000;font-weight:bold">import</span> Series, DataFrame
</span></span></code></pre></div><h2 id="51-pandas的数据结构介绍">5.1 pandas的数据结构介绍</h2>
<p>要使用pandas，你首先就得熟悉它的两个主要数据结构：<code>Series</code>和<code>DataFrame</code>。虽然它们并不能解决所有问题，但它们为大多数应用<code>提供了一种可靠的、易于使用的基础</code>。</p>
<h3 id="511-series">5.1.1 Series</h3>
<p>Series是一种类似于一维数组的对象，它由一组数据（各种NumPy数据类型）以及一组与之相关的数据标签（即索引）组成。仅由一组数据即可产生最简单的Series：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">11</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">4</span>, <span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>, <span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">12</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">12</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p><strong>Series的字符串表现形式为：索引在左边，值在右边。<strong>由于我们没有为数据指定索引，于是会自动创建一个0到N-1（N为数据的长度）的整数型索引。你可以</strong>通过Series 的values和index属性获取其数组表示形式和索引对象</strong>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">13</span>]: obj<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">13</span>]: array([ <span style="color:#099">4</span>,  <span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>,  <span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">14</span>]: obj<span style="color:#000;font-weight:bold">.</span>index  <span style="color:#998;font-style:italic"># like range(4)</span>
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">14</span>]: RangeIndex(start<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>, stop<span style="color:#000;font-weight:bold">=</span><span style="color:#099">4</span>, step<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span></code></pre></div><p>通常，我们希望所创建的Series带有一个可以对各个数据点进行标记的索引：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">15</span>]: obj2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">4</span>, <span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>, <span style="color:#099">3</span>], index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">16</span>]: obj2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">16</span>]: 
</span></span><span style="display:flex;"><span>d    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>a   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">17</span>]: obj2<span style="color:#000;font-weight:bold">.</span>index
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">17</span>]: Index([<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>)
</span></span></code></pre></div><p>与普通NumPy数组相比，你可以通过索引的方式选取Series中的单个或一组值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">18</span>]: obj2[<span style="color:#d14">&#39;a&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">18</span>]: <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">19</span>]: obj2[<span style="color:#d14">&#39;d&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">20</span>]: obj2[[<span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">20</span>]: 
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>a   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>[&lsquo;c&rsquo;, &lsquo;a&rsquo;, &rsquo;d&rsquo;]是索引列表，即使它包含的是字符串而不是整数。</p>
<p>使用NumPy函数或类似NumPy的运算（如根据布尔型数组进行过滤、标量乘法、应用数学函数等）都会保留索引值的链接：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">21</span>]: obj2[obj2 <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">21</span>]: 
</span></span><span style="display:flex;"><span>d    <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">22</span>]: obj2 <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">22</span>]:
</span></span><span style="display:flex;"><span>d    <span style="color:#099">12</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>a   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>c     <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">23</span>]: np<span style="color:#000;font-weight:bold">.</span>exp(obj2)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">23</span>]: 
</span></span><span style="display:flex;"><span>d     <span style="color:#099">403.428793</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1096.633158</span>
</span></span><span style="display:flex;"><span>a       <span style="color:#099">0.006738</span>
</span></span><span style="display:flex;"><span>c      <span style="color:#099">20.085537</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>还可以将Series看成是一个定长的有序字典，因为它是索引值到数据值的一个映射。它可以用在许多原本需要字典参数的函数中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">24</span>]: <span style="color:#d14">&#39;b&#39;</span> <span style="color:#000;font-weight:bold">in</span> obj2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">24</span>]: <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">25</span>]: <span style="color:#d14">&#39;e&#39;</span> <span style="color:#000;font-weight:bold">in</span> obj2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">25</span>]: <span style="color:#000;font-weight:bold">False</span>
</span></span></code></pre></div><p>如果数据被存放在一个Python字典中，也可以直接通过这个字典来创建Series：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">26</span>]: sdata <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;Ohio&#39;</span>: <span style="color:#099">35000</span>, <span style="color:#d14">&#39;Texas&#39;</span>: <span style="color:#099">71000</span>, <span style="color:#d14">&#39;Oregon&#39;</span>: <span style="color:#099">16000</span>, <span style="color:#d14">&#39;Utah&#39;</span>: <span style="color:#099">5000</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">27</span>]: obj3 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(sdata)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">28</span>]: obj3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">28</span>]: 
</span></span><span style="display:flex;"><span>Ohio      <span style="color:#099">35000</span>
</span></span><span style="display:flex;"><span>Oregon    <span style="color:#099">16000</span>
</span></span><span style="display:flex;"><span>Texas     <span style="color:#099">71000</span>
</span></span><span style="display:flex;"><span>Utah       <span style="color:#099">5000</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>如果只传入一个字典，则结果Series中的索引就是原字典的键（有序排列）。你可以传入排好序的字典的键以改变顺序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">29</span>]: states <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;California&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Oregon&#39;</span>, <span style="color:#d14">&#39;Texas&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">30</span>]: obj4 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(sdata, index<span style="color:#000;font-weight:bold">=</span>states)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">31</span>]: obj4
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">31</span>]: 
</span></span><span style="display:flex;"><span>California        NaN
</span></span><span style="display:flex;"><span>Ohio          <span style="color:#099">35000.0</span>
</span></span><span style="display:flex;"><span>Oregon        <span style="color:#099">16000.0</span>
</span></span><span style="display:flex;"><span>Texas         <span style="color:#099">71000.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>在这个例子中，sdata中跟states索引相匹配的那3个值会被找出来并放到相应的位置上，但由于&quot;California&quot;所对应的sdata值找不到，所以其结果就为NaN（即“非数字”（not a number），在pandas中，它用于表示缺失或NA值）。因为‘Utah’不在states中，它被从结果中除去。</p>
<p>我将使用缺失（missing）或NA表示缺失数据。pandas的isnull和notnull函数可用于检测缺失数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">32</span>]: pd<span style="color:#000;font-weight:bold">.</span>isnull(obj4)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">32</span>]: 
</span></span><span style="display:flex;"><span>California     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>Ohio          <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>Oregon        <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>Texas         <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">bool</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">33</span>]: pd<span style="color:#000;font-weight:bold">.</span>notnull(obj4)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">33</span>]: 
</span></span><span style="display:flex;"><span>California    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>Ohio           <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>Oregon         <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>Texas          <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">bool</span>
</span></span></code></pre></div><p>Series也有类似的实例方法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">34</span>]: obj4<span style="color:#000;font-weight:bold">.</span>isnull()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">34</span>]: 
</span></span><span style="display:flex;"><span>California     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>Ohio          <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>Oregon        <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>Texas         <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">bool</span>
</span></span></code></pre></div><p><strong>我将在第7章详细讲解如何处理缺失数据</strong>。</p>
<p>对于许多应用而言，Series最重要的一个功能是，<code>它会根据运算的索引标签自动对齐数据</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">35</span>]: obj3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">35</span>]: 
</span></span><span style="display:flex;"><span>Ohio      <span style="color:#099">35000</span>
</span></span><span style="display:flex;"><span>Oregon    <span style="color:#099">16000</span>
</span></span><span style="display:flex;"><span>Texas     <span style="color:#099">71000</span>
</span></span><span style="display:flex;"><span>Utah       <span style="color:#099">5000</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">36</span>]: obj4
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">36</span>]: 
</span></span><span style="display:flex;"><span>California        NaN
</span></span><span style="display:flex;"><span>Ohio          <span style="color:#099">35000.0</span>
</span></span><span style="display:flex;"><span>Oregon        <span style="color:#099">16000.0</span>
</span></span><span style="display:flex;"><span>Texas         <span style="color:#099">71000.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">37</span>]: obj3 <span style="color:#000;font-weight:bold">+</span> obj4
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">37</span>]: 
</span></span><span style="display:flex;"><span>California         NaN
</span></span><span style="display:flex;"><span>Ohio           <span style="color:#099">70000.0</span>
</span></span><span style="display:flex;"><span>Oregon         <span style="color:#099">32000.0</span>
</span></span><span style="display:flex;"><span>Texas         <span style="color:#099">142000.0</span>
</span></span><span style="display:flex;"><span>Utah               NaN
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>数据对齐功能将在后面详细讲解。如果你使用过数据库，你可以认为是类似join的操作。</p>
<p>Series对象本身及其索引都有一个name属性，该属性跟pandas其他的关键功能关系非常密切：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">38</span>]: obj4<span style="color:#000;font-weight:bold">.</span>name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;population&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">39</span>]: obj4<span style="color:#000;font-weight:bold">.</span>index<span style="color:#000;font-weight:bold">.</span>name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;state&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">40</span>]: obj4
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">40</span>]: 
</span></span><span style="display:flex;"><span>state
</span></span><span style="display:flex;"><span>California        NaN
</span></span><span style="display:flex;"><span>Ohio          <span style="color:#099">35000.0</span>
</span></span><span style="display:flex;"><span>Oregon        <span style="color:#099">16000.0</span>
</span></span><span style="display:flex;"><span>Texas         <span style="color:#099">71000.0</span>
</span></span><span style="display:flex;"><span>Name: population, dtype: float64
</span></span></code></pre></div><p>Series的索引可以通过赋值的方式就地修改：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">41</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">41</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">42</span>]: obj<span style="color:#000;font-weight:bold">.</span>index <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;Bob&#39;</span>, <span style="color:#d14">&#39;Steve&#39;</span>, <span style="color:#d14">&#39;Jeff&#39;</span>, <span style="color:#d14">&#39;Ryan&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">43</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">43</span>]: 
</span></span><span style="display:flex;"><span>Bob      <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>Steve    <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>Jeff    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>Ryan     <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><h3 id="512-dataframe">5.1.2 DataFrame</h3>
<p>DataFrame是一个表格型的数据结构，它含有一组有序的列，每列可以是不同的值类型（数值、字符串、布尔值等）。DataFrame既有行索引也有列索引，它可以被看做由Series组成的字典（共用同一个索引）。DataFrame中的数据是以一个或多个二维块存放的（而不是列表、字典或别的一维数据结构）。有关DataFrame内部的技术细节远远超出了本书所讨论的范围。</p>
<blockquote>
<p>笔记：虽然DataFrame是以二维结构保存数据的，但你仍然可以轻松地将其表示为更高维度的数据（层次化索引的表格型结构，这是pandas中许多高级数据处理功能的关键要素，我们会在第8章讨论这个问题）。</p>
</blockquote>
<p>建DataFrame的办法有很多，最常用的一种是直接传入一个由等长列表或NumPy数组组成的字典：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>data <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;state&#39;</span>: [<span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Nevada&#39;</span>, <span style="color:#d14">&#39;Nevada&#39;</span>, <span style="color:#d14">&#39;Nevada&#39;</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;year&#39;</span>: [<span style="color:#099">2000</span>, <span style="color:#099">2001</span>, <span style="color:#099">2002</span>, <span style="color:#099">2001</span>, <span style="color:#099">2002</span>, <span style="color:#099">2003</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#39;pop&#39;</span>: [<span style="color:#099">1.5</span>, <span style="color:#099">1.7</span>, <span style="color:#099">3.6</span>, <span style="color:#099">2.4</span>, <span style="color:#099">2.9</span>, <span style="color:#099">3.2</span>]}
</span></span><span style="display:flex;"><span>frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(data)
</span></span></code></pre></div><p>结果DataFrame会自动加上索引（跟Series一样），且全部列会被有序排列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">45</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">45</span>]: 
</span></span><span style="display:flex;"><span>   pop   state  year
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1.5</span>    Ohio  <span style="color:#099">2000</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1.7</span>    Ohio  <span style="color:#099">2001</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">3.6</span>    Ohio  <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">2.4</span>  Nevada  <span style="color:#099">2001</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">2.9</span>  Nevada  <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>  <span style="color:#099">3.2</span>  Nevada  <span style="color:#099">2003</span>
</span></span></code></pre></div><p>如果你使用的是Jupyter notebook，pandas DataFrame对象会以对浏览器友好的HTML表格的方式呈现。</p>
<p>对于特别大的DataFrame，head方法会选取前五行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">46</span>]: frame<span style="color:#000;font-weight:bold">.</span>head()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">46</span>]: 
</span></span><span style="display:flex;"><span>   pop   state  year
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1.5</span>    Ohio  <span style="color:#099">2000</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1.7</span>    Ohio  <span style="color:#099">2001</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">3.6</span>    Ohio  <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">2.4</span>  Nevada  <span style="color:#099">2001</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">2.9</span>  Nevada  <span style="color:#099">2002</span>
</span></span></code></pre></div><p>如果指定了列序列，则DataFrame的列就会按照指定顺序进行排列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">47</span>]: pd<span style="color:#000;font-weight:bold">.</span>DataFrame(data, columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;year&#39;</span>, <span style="color:#d14">&#39;state&#39;</span>, <span style="color:#d14">&#39;pop&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">47</span>]: 
</span></span><span style="display:flex;"><span>   year   state  pop
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">2000</span>    Ohio  <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">2001</span>    Ohio  <span style="color:#099">1.7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">2002</span>    Ohio  <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">2001</span>  Nevada  <span style="color:#099">2.4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">2002</span>  Nevada  <span style="color:#099">2.9</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>  <span style="color:#099">2003</span>  Nevada  <span style="color:#099">3.2</span>
</span></span></code></pre></div><p>如果传入的列在数据中找不到，就会在结果中产生缺失值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">48</span>]: frame2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(data, columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;year&#39;</span>, <span style="color:#d14">&#39;state&#39;</span>, <span style="color:#d14">&#39;pop&#39;</span>, <span style="color:#d14">&#39;debt&#39;</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:                       index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;one&#39;</span>, <span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;three&#39;</span>, <span style="color:#d14">&#39;four&#39;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:                              <span style="color:#d14">&#39;five&#39;</span>, <span style="color:#d14">&#39;six&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">49</span>]: frame2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">49</span>]: 
</span></span><span style="display:flex;"><span>       year   state  pop debt
</span></span><span style="display:flex;"><span>one    <span style="color:#099">2000</span>    Ohio  <span style="color:#099">1.5</span>  NaN
</span></span><span style="display:flex;"><span>two    <span style="color:#099">2001</span>    Ohio  <span style="color:#099">1.7</span>  NaN
</span></span><span style="display:flex;"><span>three  <span style="color:#099">2002</span>    Ohio  <span style="color:#099">3.6</span>  NaN
</span></span><span style="display:flex;"><span>four   <span style="color:#099">2001</span>  Nevada  <span style="color:#099">2.4</span>  NaN
</span></span><span style="display:flex;"><span>five   <span style="color:#099">2002</span>  Nevada  <span style="color:#099">2.9</span>  NaN
</span></span><span style="display:flex;"><span>six    <span style="color:#099">2003</span>  Nevada  <span style="color:#099">3.2</span>  NaN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">50</span>]: frame2<span style="color:#000;font-weight:bold">.</span>columns
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">50</span>]: Index([<span style="color:#d14">&#39;year&#39;</span>, <span style="color:#d14">&#39;state&#39;</span>, <span style="color:#d14">&#39;pop&#39;</span>, <span style="color:#d14">&#39;debt&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>)
</span></span></code></pre></div><p>通过类似字典标记的方式或属性的方式，可以将DataFrame的列获取为一个Series：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">51</span>]: frame2[<span style="color:#d14">&#39;state&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">51</span>]: 
</span></span><span style="display:flex;"><span>one        Ohio
</span></span><span style="display:flex;"><span>two        Ohio
</span></span><span style="display:flex;"><span>three      Ohio
</span></span><span style="display:flex;"><span>four     Nevada
</span></span><span style="display:flex;"><span>five     Nevada
</span></span><span style="display:flex;"><span>six      Nevada
</span></span><span style="display:flex;"><span>Name: state, dtype: <span style="color:#0086b3">object</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">52</span>]: frame2<span style="color:#000;font-weight:bold">.</span>year
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">52</span>]: 
</span></span><span style="display:flex;"><span>one      <span style="color:#099">2000</span>
</span></span><span style="display:flex;"><span>two      <span style="color:#099">2001</span>
</span></span><span style="display:flex;"><span>three    <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span>four     <span style="color:#099">2001</span>
</span></span><span style="display:flex;"><span>five     <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span>six      <span style="color:#099">2003</span>
</span></span><span style="display:flex;"><span>Name: year, dtype: int64
</span></span></code></pre></div><blockquote>
<p>笔记：IPython提供了类似属性的访问（即frame2.year）和tab补全。
frame2[column]适用于任何列的名，但是frame2.column只有在列名是一个合理的Python变量名时才适用。</p>
</blockquote>
<p>注意，返回的Series拥有原DataFrame相同的索引，且其name属性也已经被相应地设置好了。</p>
<p>行也可以通过位置或名称的方式进行获取，比如用loc属性（稍后将对此进行详细讲解）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">53</span>]: frame2<span style="color:#000;font-weight:bold">.</span>loc[<span style="color:#d14">&#39;three&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">53</span>]: 
</span></span><span style="display:flex;"><span>year     <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span>state    Ohio
</span></span><span style="display:flex;"><span>pop       <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span>debt      NaN
</span></span><span style="display:flex;"><span>Name: three, dtype: <span style="color:#0086b3">object</span>
</span></span></code></pre></div><p>列可以通过赋值的方式进行修改。例如，我们可以给那个空的&quot;debt&quot;列赋上一个标量值或一组值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">54</span>]: frame2[<span style="color:#d14">&#39;debt&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">55</span>]: frame2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">55</span>]: 
</span></span><span style="display:flex;"><span>       year   state  pop  debt
</span></span><span style="display:flex;"><span>one    <span style="color:#099">2000</span>    Ohio  <span style="color:#099">1.5</span>  <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>two    <span style="color:#099">2001</span>    Ohio  <span style="color:#099">1.7</span>  <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>three  <span style="color:#099">2002</span>    Ohio  <span style="color:#099">3.6</span>  <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>four   <span style="color:#099">2001</span>  Nevada  <span style="color:#099">2.4</span>  <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>five   <span style="color:#099">2002</span>  Nevada  <span style="color:#099">2.9</span>  <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>six    <span style="color:#099">2003</span>  Nevada  <span style="color:#099">3.2</span>  <span style="color:#099">16.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">56</span>]: frame2[<span style="color:#d14">&#39;debt&#39;</span>] <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">6.</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">57</span>]: frame2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">57</span>]: 
</span></span><span style="display:flex;"><span>       year   state  pop  debt
</span></span><span style="display:flex;"><span>one    <span style="color:#099">2000</span>    Ohio  <span style="color:#099">1.5</span>   <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>two    <span style="color:#099">2001</span>    Ohio  <span style="color:#099">1.7</span>   <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>three  <span style="color:#099">2002</span>    Ohio  <span style="color:#099">3.6</span>   <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>four   <span style="color:#099">2001</span>  Nevada  <span style="color:#099">2.4</span>   <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>five   <span style="color:#099">2002</span>  Nevada  <span style="color:#099">2.9</span>   <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>six    <span style="color:#099">2003</span>  Nevada  <span style="color:#099">3.2</span>   <span style="color:#099">5.0</span>
</span></span></code></pre></div><p>将列表或数组赋值给某个列时，其长度必须跟DataFrame的长度相匹配。如果赋值的是一个Series，就会精确匹配DataFrame的索引，所有的空位都将被填上缺失值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">58</span>]: val <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.2</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.5</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.7</span>], index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;four&#39;</span>, <span style="color:#d14">&#39;five&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">59</span>]: frame2[<span style="color:#d14">&#39;debt&#39;</span>] <span style="color:#000;font-weight:bold">=</span> val
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">60</span>]: frame2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">60</span>]: 
</span></span><span style="display:flex;"><span>       year   state  pop  debt
</span></span><span style="display:flex;"><span>one    <span style="color:#099">2000</span>    Ohio  <span style="color:#099">1.5</span>   NaN
</span></span><span style="display:flex;"><span>two    <span style="color:#099">2001</span>    Ohio  <span style="color:#099">1.7</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.2</span>
</span></span><span style="display:flex;"><span>three  <span style="color:#099">2002</span>    Ohio  <span style="color:#099">3.6</span>   NaN
</span></span><span style="display:flex;"><span>four   <span style="color:#099">2001</span>  Nevada  <span style="color:#099">2.4</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span>five   <span style="color:#099">2002</span>  Nevada  <span style="color:#099">2.9</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.7</span>
</span></span><span style="display:flex;"><span>six    <span style="color:#099">2003</span>  Nevada  <span style="color:#099">3.2</span>   NaN
</span></span></code></pre></div><p>为不存在的列赋值会创建出一个新列。关键字del用于删除列。</p>
<p>作为del的例子，我先添加一个新的布尔值的列，state是否为&rsquo;Ohio&rsquo;：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">61</span>]: frame2[<span style="color:#d14">&#39;eastern&#39;</span>] <span style="color:#000;font-weight:bold">=</span> frame2<span style="color:#000;font-weight:bold">.</span>state <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;Ohio&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">62</span>]: frame2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">62</span>]: 
</span></span><span style="display:flex;"><span>       year   state  pop  debt  eastern
</span></span><span style="display:flex;"><span>one    <span style="color:#099">2000</span>    Ohio  <span style="color:#099">1.5</span>   NaN     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>two    <span style="color:#099">2001</span>    Ohio  <span style="color:#099">1.7</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.2</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>three  <span style="color:#099">2002</span>    Ohio  <span style="color:#099">3.6</span>   NaN     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>four   <span style="color:#099">2001</span>  Nevada  <span style="color:#099">2.4</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.5</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>five   <span style="color:#099">2002</span>  Nevada  <span style="color:#099">2.9</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.7</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>six    <span style="color:#099">2003</span>  Nevada  <span style="color:#099">3.2</span>   NaN    <span style="color:#000;font-weight:bold">False</span>
</span></span></code></pre></div><blockquote>
<p>注意：不能用frame2.eastern创建新的列。</p>
</blockquote>
<p><strong>del方法可以用来删除这列</strong>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">63</span>]: <span style="color:#000;font-weight:bold">del</span> frame2[<span style="color:#d14">&#39;eastern&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">64</span>]: frame2<span style="color:#000;font-weight:bold">.</span>columns
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">64</span>]: Index([<span style="color:#d14">&#39;year&#39;</span>, <span style="color:#d14">&#39;state&#39;</span>, <span style="color:#d14">&#39;pop&#39;</span>, <span style="color:#d14">&#39;debt&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>)
</span></span></code></pre></div><blockquote>
<p>注意：通过索引方式返回的列只是相应数据的视图而已，并不是副本。因此，对返回的Series所做的任何就地修改全都会反映到源DataFrame上。通过Series的copy方法即可指定复制列。</p>
</blockquote>
<p>另一种常见的数据形式是嵌套字典：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">65</span>]: pop <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;Nevada&#39;</span>: {<span style="color:#099">2001</span>: <span style="color:#099">2.4</span>, <span style="color:#099">2002</span>: <span style="color:#099">2.9</span>},
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">....</span>:        <span style="color:#d14">&#39;Ohio&#39;</span>: {<span style="color:#099">2000</span>: <span style="color:#099">1.5</span>, <span style="color:#099">2001</span>: <span style="color:#099">1.7</span>, <span style="color:#099">2002</span>: <span style="color:#099">3.6</span>}}
</span></span></code></pre></div><p>如果嵌套字典传给DataFrame，pandas就会被解释为：外层字典的键作为列，内层键则作为行索引：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">66</span>]: frame3 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(pop)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">67</span>]: frame3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">67</span>]: 
</span></span><span style="display:flex;"><span>      Nevada  Ohio
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span>     NaN   <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2001</span>     <span style="color:#099">2.4</span>   <span style="color:#099">1.7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2002</span>     <span style="color:#099">2.9</span>   <span style="color:#099">3.6</span>
</span></span></code></pre></div><p>你也可以使用类似NumPy数组的方法，对DataFrame进行转置（交换行和列）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">68</span>]: frame3<span style="color:#000;font-weight:bold">.</span>T
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">68</span>]: 
</span></span><span style="display:flex;"><span>        <span style="color:#099">2000</span>  <span style="color:#099">2001</span>  <span style="color:#099">2002</span>
</span></span><span style="display:flex;"><span>Nevada   NaN   <span style="color:#099">2.4</span>   <span style="color:#099">2.9</span>
</span></span><span style="display:flex;"><span>Ohio     <span style="color:#099">1.5</span>   <span style="color:#099">1.7</span>   <span style="color:#099">3.6</span>
</span></span></code></pre></div><p>内层字典的键会被合并、排序以形成最终的索引。如果明确指定了索引，则不会这样：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">69</span>]: pd<span style="color:#000;font-weight:bold">.</span>DataFrame(pop, index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#099">2001</span>, <span style="color:#099">2002</span>, <span style="color:#099">2003</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">69</span>]: 
</span></span><span style="display:flex;"><span>      Nevada  Ohio
</span></span><span style="display:flex;"><span><span style="color:#099">2001</span>     <span style="color:#099">2.4</span>   <span style="color:#099">1.7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2002</span>     <span style="color:#099">2.9</span>   <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2003</span>     NaN   NaN
</span></span></code></pre></div><p>由Series组成的字典差不多也是一样的用法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">70</span>]: pdata <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;Ohio&#39;</span>: frame3[<span style="color:#d14">&#39;Ohio&#39;</span>][:<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>],
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">....</span>:          <span style="color:#d14">&#39;Nevada&#39;</span>: frame3[<span style="color:#d14">&#39;Nevada&#39;</span>][:<span style="color:#099">2</span>]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">71</span>]: pd<span style="color:#000;font-weight:bold">.</span>DataFrame(pdata)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">71</span>]: 
</span></span><span style="display:flex;"><span>      Nevada  Ohio
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span>     NaN   <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2001</span>     <span style="color:#099">2.4</span>   <span style="color:#099">1.7</span>
</span></span></code></pre></div><p>表5-1列出了DataFrame构造函数所能接受的各种数据。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240.png" alt=""></p>
<p>如果设置了DataFrame的index和columns的name属性，则这些信息也会被显示出来：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">72</span>]: frame3<span style="color:#000;font-weight:bold">.</span>index<span style="color:#000;font-weight:bold">.</span>name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;year&#39;</span>; frame3<span style="color:#000;font-weight:bold">.</span>columns<span style="color:#000;font-weight:bold">.</span>name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;state&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">73</span>]: frame3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">73</span>]: 
</span></span><span style="display:flex;"><span>state  Nevada  Ohio
</span></span><span style="display:flex;"><span>year
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span>      NaN   <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2001</span>      <span style="color:#099">2.4</span>   <span style="color:#099">1.7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2002</span>      <span style="color:#099">2.9</span>   <span style="color:#099">3.6</span>
</span></span></code></pre></div><p>跟Series一样，values属性也会以二维ndarray的形式返回DataFrame中的数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">74</span>]: frame3<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">74</span>]: 
</span></span><span style="display:flex;"><span>array([[ nan,  <span style="color:#099">1.5</span>],
</span></span><span style="display:flex;"><span>       [ <span style="color:#099">2.4</span>,  <span style="color:#099">1.7</span>],
</span></span><span style="display:flex;"><span>       [ <span style="color:#099">2.9</span>,  <span style="color:#099">3.6</span>]])
</span></span></code></pre></div><p>如果DataFrame各列的数据类型不同，则值数组的dtype就会选用能兼容所有列的数据类型：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">75</span>]: frame2<span style="color:#000;font-weight:bold">.</span>values
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">75</span>]:
</span></span><span style="display:flex;"><span>array([[<span style="color:#099">2000</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#099">1.5</span>, nan],
</span></span><span style="display:flex;"><span>       [<span style="color:#099">2001</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#099">1.7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.2</span>],
</span></span><span style="display:flex;"><span>       [<span style="color:#099">2002</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#099">3.6</span>, nan],
</span></span><span style="display:flex;"><span>       [<span style="color:#099">2001</span>, <span style="color:#d14">&#39;Nevada&#39;</span>, <span style="color:#099">2.4</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.5</span>],
</span></span><span style="display:flex;"><span>       [<span style="color:#099">2002</span>, <span style="color:#d14">&#39;Nevada&#39;</span>, <span style="color:#099">2.9</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.7</span>],
</span></span><span style="display:flex;"><span>       [<span style="color:#099">2003</span>, <span style="color:#d14">&#39;Nevada&#39;</span>, <span style="color:#099">3.2</span>, nan]], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">object</span>)
</span></span></code></pre></div><h3 id="513-索引对象">5.1.3 索引对象</h3>
<p>pandas的索引对象负责管理轴标签和其他元数据（比如轴名称等）。构建Series或DataFrame时，所用到的任何数组或其他序列的标签都会被转换成一个Index：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">76</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(<span style="color:#0086b3">range</span>(<span style="color:#099">3</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">77</span>]: index <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>index
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">78</span>]: index
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">78</span>]: Index([<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">79</span>]: index[<span style="color:#099">1</span>:]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">79</span>]: Index([<span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>)
</span></span></code></pre></div><p>Index对象是不可变的，因此用户不能对其进行修改：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>index[<span style="color:#099">1</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;d&#39;</span>  <span style="color:#998;font-style:italic"># TypeError</span>
</span></span></code></pre></div><p>不可变可以使Index对象在多个数据结构之间安全共享：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">80</span>]: labels <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Index(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">81</span>]: labels
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">81</span>]: Int64Index([<span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">2</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;int64&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">82</span>]: obj2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">1.5</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.5</span>, <span style="color:#099">0</span>], index<span style="color:#000;font-weight:bold">=</span>labels)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">83</span>]: obj2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">83</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">84</span>]: obj2<span style="color:#000;font-weight:bold">.</span>index <span style="color:#000;font-weight:bold">is</span> labels
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">84</span>]: <span style="color:#000;font-weight:bold">True</span>
</span></span></code></pre></div><blockquote>
<p>注意：虽然用户不需要经常使用Index的功能，但是因为一些操作会生成包含被索引化的数据，理解它们的工作原理是很重要的。</p>
</blockquote>
<p>除了类似于数组，Index的功能也类似一个固定大小的集合：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">85</span>]: frame3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">85</span>]: 
</span></span><span style="display:flex;"><span>state  Nevada  Ohio
</span></span><span style="display:flex;"><span>year               
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span>      NaN   <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2001</span>      <span style="color:#099">2.4</span>   <span style="color:#099">1.7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2002</span>      <span style="color:#099">2.9</span>   <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">86</span>]: frame3<span style="color:#000;font-weight:bold">.</span>columns
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">86</span>]: Index([<span style="color:#d14">&#39;Nevada&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>, name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;state&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">87</span>]: <span style="color:#d14">&#39;Ohio&#39;</span> <span style="color:#000;font-weight:bold">in</span> frame3<span style="color:#000;font-weight:bold">.</span>columns
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">87</span>]: <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">88</span>]: <span style="color:#099">2003</span> <span style="color:#000;font-weight:bold">in</span> frame3<span style="color:#000;font-weight:bold">.</span>index
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">88</span>]: <span style="color:#000;font-weight:bold">False</span>
</span></span></code></pre></div><p>与python的集合不同，pandas的Index可以包含重复的标签：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">89</span>]: dup_labels <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Index([<span style="color:#d14">&#39;foo&#39;</span>, <span style="color:#d14">&#39;foo&#39;</span>, <span style="color:#d14">&#39;bar&#39;</span>, <span style="color:#d14">&#39;bar&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">90</span>]: dup_labels
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">90</span>]: Index([<span style="color:#d14">&#39;foo&#39;</span>, <span style="color:#d14">&#39;foo&#39;</span>, <span style="color:#d14">&#39;bar&#39;</span>, <span style="color:#d14">&#39;bar&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;object&#39;</span>)
</span></span></code></pre></div><p>选择重复的标签，会显示所有的结果。</p>
<p>每个索引都有一些方法和属性，它们可用于设置逻辑并回答有关该索引所包含的数据的常见问题。表5-2列出了这些函数。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240.jpeg" alt=""></p>
<h2 id="52-基本功能">5.2 基本功能</h2>
<p>本节中，我将介绍操作Series和DataFrame中的数据的基本手段。后续章节将更加深入地挖掘pandas在数据分析和处理方面的功能。本书不是pandas库的详尽文档，主要关注的是最重要的功能，那些不大常用的内容（也就是那些更深奥的内容）就交给你自己去摸索吧。</p>
<h3 id="521-重新索引">5.2.1 重新索引</h3>
<p>pandas对象的一个重要方法是<code>reindex</code>，其作用是创建一个新对象，它的数据符合<code>新的索引</code>。看下面的例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">91</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">4.5</span>, <span style="color:#099">7.2</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5.3</span>, <span style="color:#099">3.6</span>], index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">92</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">92</span>]: 
</span></span><span style="display:flex;"><span>d    <span style="color:#099">4.5</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">7.2</span>
</span></span><span style="display:flex;"><span>a   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5.3</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>用该Series的reindex将会根据新索引进行重排。如果某个索引值当前不存在，就引入缺失值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">93</span>]: obj2 <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>reindex([<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;e&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">94</span>]: obj2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">94</span>]: 
</span></span><span style="display:flex;"><span>a   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5.3</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">7.2</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">4.5</span>
</span></span><span style="display:flex;"><span>e    NaN
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>对于时间序列这样的有序数据，重新索引时可能需要做一些插值处理。method选项即可达到此目的，例如，使用ffill可以实现前向值填充：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">95</span>]: obj3 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#d14">&#39;blue&#39;</span>, <span style="color:#d14">&#39;purple&#39;</span>, <span style="color:#d14">&#39;yellow&#39;</span>], index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#099">0</span>, <span style="color:#099">2</span>, <span style="color:#099">4</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">96</span>]: obj3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">96</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>      blue
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    purple
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    yellow
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">object</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">97</span>]: obj3<span style="color:#000;font-weight:bold">.</span>reindex(<span style="color:#0086b3">range</span>(<span style="color:#099">6</span>), method<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;ffill&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">97</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>      blue
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>      blue
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    purple
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    purple
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    yellow
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    yellow
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">object</span>
</span></span></code></pre></div><p>借助DataFrame，reindex可以修改（行）索引和列。只传递一个序列时，会重新索引结果的行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">98</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">9</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">3</span>, <span style="color:#099">3</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:                      index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:                      columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Texas&#39;</span>, <span style="color:#d14">&#39;California&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">99</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">99</span>]: 
</span></span><span style="display:flex;"><span>   Ohio  Texas  California
</span></span><span style="display:flex;"><span>a     <span style="color:#099">0</span>      <span style="color:#099">1</span>           <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>c     <span style="color:#099">3</span>      <span style="color:#099">4</span>           <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>d     <span style="color:#099">6</span>      <span style="color:#099">7</span>           <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">100</span>]: frame2 <span style="color:#000;font-weight:bold">=</span> frame<span style="color:#000;font-weight:bold">.</span>reindex([<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">101</span>]: frame2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">101</span>]: 
</span></span><span style="display:flex;"><span>   Ohio  Texas  California
</span></span><span style="display:flex;"><span>a   <span style="color:#099">0.0</span>    <span style="color:#099">1.0</span>         <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>b   NaN    NaN         NaN
</span></span><span style="display:flex;"><span>c   <span style="color:#099">3.0</span>    <span style="color:#099">4.0</span>         <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>d   <span style="color:#099">6.0</span>    <span style="color:#099">7.0</span>         <span style="color:#099">8.0</span>
</span></span></code></pre></div><p>列可以用columns关键字重新索引：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">102</span>]: states <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;Texas&#39;</span>, <span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;California&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">103</span>]: frame<span style="color:#000;font-weight:bold">.</span>reindex(columns<span style="color:#000;font-weight:bold">=</span>states)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">103</span>]: 
</span></span><span style="display:flex;"><span>   Texas  Utah  California
</span></span><span style="display:flex;"><span>a      <span style="color:#099">1</span>   NaN           <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>c      <span style="color:#099">4</span>   NaN           <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>d      <span style="color:#099">7</span>   NaN           <span style="color:#099">8</span>
</span></span></code></pre></div><p>表5-3列出了reindex函数的各参数及说明。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023164044247.jpeg" alt=""></p>
<h3 id="522-丢弃指定轴上的项">5.2.2 丢弃指定轴上的项</h3>
<p>丢弃某条轴上的一个或多个项很简单，只要有一个索引数组或列表即可。由于需要执行一些数据整理和集合逻辑，所以drop方法返回的是一个在指定轴上删除了指定值的新对象：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">105</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">5.</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;e&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">106</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">106</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">107</span>]: new_obj <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>drop(<span style="color:#d14">&#39;c&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">108</span>]: new_obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">108</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">109</span>]: obj<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">109</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>对于DataFrame，可以删除任意轴上的索引值。为了演示，先新建一个DataFrame例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">110</span>]: data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">16</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">4</span>, <span style="color:#099">4</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                     index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Colorado&#39;</span>, <span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;New York&#39;</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                     columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;one&#39;</span>, <span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;three&#39;</span>, <span style="color:#d14">&#39;four&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">111</span>]: data
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">111</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three  four
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>    <span style="color:#099">1</span>      <span style="color:#099">2</span>     <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">4</span>    <span style="color:#099">5</span>      <span style="color:#099">6</span>     <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>    <span style="color:#099">9</span>     <span style="color:#099">10</span>    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>   <span style="color:#099">13</span>     <span style="color:#099">14</span>    <span style="color:#099">15</span>
</span></span></code></pre></div><p>用标签序列调用drop会从行标签（axis 0）删除值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">112</span>]: data<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;Colorado&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">112</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three  four
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>    <span style="color:#099">9</span>     <span style="color:#099">10</span>    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>   <span style="color:#099">13</span>     <span style="color:#099">14</span>    <span style="color:#099">15</span>
</span></span></code></pre></div><p>通过传递axis=1或axis=&lsquo;columns&rsquo;可以删除列的值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">113</span>]: data<span style="color:#000;font-weight:bold">.</span>drop(<span style="color:#d14">&#39;two&#39;</span>, axis<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">113</span>]: 
</span></span><span style="display:flex;"><span>          one  three  four
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>      <span style="color:#099">2</span>     <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">4</span>      <span style="color:#099">6</span>     <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>     <span style="color:#099">10</span>    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>     <span style="color:#099">14</span>    <span style="color:#099">15</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">114</span>]: data<span style="color:#000;font-weight:bold">.</span>drop([<span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;four&#39;</span>], axis<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;columns&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">114</span>]: 
</span></span><span style="display:flex;"><span>          one  three
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>      <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">4</span>      <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>     <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>     <span style="color:#099">14</span>
</span></span></code></pre></div><p>许多函数，如drop，会修改Series或DataFrame的大小或形状，可以就地修改对象，不会返回新的对象：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">115</span>]: obj<span style="color:#000;font-weight:bold">.</span>drop(<span style="color:#d14">&#39;c&#39;</span>, inplace<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">116</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">116</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>小心使用inplace，它会销毁所有被删除的数据。</p>
<h3 id="523-索引选取和过滤">5.2.3 索引、选取和过滤</h3>
<p>Series索引（obj[&hellip;]）的工作方式类似于NumPy数组的索引，只不过Series的索引值不只是整数。下面是几个例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">117</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">4.</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">118</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">118</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">119</span>]: obj[<span style="color:#d14">&#39;b&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">119</span>]: <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">120</span>]: obj[<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">120</span>]: <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">121</span>]: obj[<span style="color:#099">2</span>:<span style="color:#099">4</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">121</span>]: 
</span></span><span style="display:flex;"><span>c    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">122</span>]: obj[[<span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">122</span>]:
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">123</span>]: obj[[<span style="color:#099">1</span>, <span style="color:#099">3</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">123</span>]: 
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">124</span>]: obj[obj <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">124</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>利用标签的切片运算与普通的Python切片运算不同，其末端是包含的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">125</span>]: obj[<span style="color:#d14">&#39;b&#39;</span>:<span style="color:#d14">&#39;c&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">125</span>]:
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>用切片可以对Series的相应部分进行设置：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">126</span>]: obj[<span style="color:#d14">&#39;b&#39;</span>:<span style="color:#d14">&#39;c&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">127</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">127</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>用一个值或序列对DataFrame进行索引其实就是获取一个或多个列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">128</span>]: data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">16</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">4</span>, <span style="color:#099">4</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                     index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Colorado&#39;</span>, <span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;New York&#39;</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                     columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;one&#39;</span>, <span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;three&#39;</span>, <span style="color:#d14">&#39;four&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">129</span>]: data
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">129</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three  four
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>    <span style="color:#099">1</span>      <span style="color:#099">2</span>     <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">4</span>    <span style="color:#099">5</span>      <span style="color:#099">6</span>     <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>    <span style="color:#099">9</span>     <span style="color:#099">10</span>    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>   <span style="color:#099">13</span>     <span style="color:#099">14</span>    <span style="color:#099">15</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">130</span>]: data[<span style="color:#d14">&#39;two&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">130</span>]: 
</span></span><span style="display:flex;"><span>Ohio         <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>Colorado     <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>Utah         <span style="color:#099">9</span>
</span></span><span style="display:flex;"><span>New York    <span style="color:#099">13</span>
</span></span><span style="display:flex;"><span>Name: two, dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">131</span>]: data[[<span style="color:#d14">&#39;three&#39;</span>, <span style="color:#d14">&#39;one&#39;</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">131</span>]: 
</span></span><span style="display:flex;"><span>          three  one
</span></span><span style="display:flex;"><span>Ohio          <span style="color:#099">2</span>    <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>Colorado      <span style="color:#099">6</span>    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>Utah         <span style="color:#099">10</span>    <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>New York     <span style="color:#099">14</span>   <span style="color:#099">12</span>
</span></span></code></pre></div><p>这种索引方式有几个特殊的情况。首先通过切片或布尔型数组选取数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">132</span>]: data[:<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">132</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three  four
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>    <span style="color:#099">1</span>      <span style="color:#099">2</span>     <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">4</span>    <span style="color:#099">5</span>      <span style="color:#099">6</span>     <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">133</span>]: data[data[<span style="color:#d14">&#39;three&#39;</span>] <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">5</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">133</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three  four
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">4</span>    <span style="color:#099">5</span>      <span style="color:#099">6</span>     <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>    <span style="color:#099">9</span>     <span style="color:#099">10</span>    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>   <span style="color:#099">13</span>     <span style="color:#099">14</span>    <span style="color:#099">15</span>
</span></span></code></pre></div><p>选取行的语法data[:2]十分方便。向[ ]传递单一的元素或列表，就可选择列。</p>
<p>另一种用法是通过布尔型DataFrame（比如下面这个由标量比较运算得出的）进行索引：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">134</span>]: data <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">134</span>]: 
</span></span><span style="display:flex;"><span>            one    two  three   four
</span></span><span style="display:flex;"><span>Ohio       <span style="color:#000;font-weight:bold">True</span>   <span style="color:#000;font-weight:bold">True</span>   <span style="color:#000;font-weight:bold">True</span>   <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>Colorado   <span style="color:#000;font-weight:bold">True</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>Utah      <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>New York  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">135</span>]: data[data <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">5</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">136</span>]: data
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">136</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three  four
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>    <span style="color:#099">0</span>      <span style="color:#099">0</span>     <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">0</span>    <span style="color:#099">5</span>      <span style="color:#099">6</span>     <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>    <span style="color:#099">9</span>     <span style="color:#099">10</span>    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>   <span style="color:#099">13</span>     <span style="color:#099">14</span>    <span style="color:#099">15</span>
</span></span></code></pre></div><p>这使得DataFrame的语法与NumPy二维数组的语法很像。</p>
<h3 id="524-用loc和iloc进行选取">5.2.4 用loc和iloc进行选取</h3>
<p>对于DataFrame的行的标签索引，我引入了特殊的标签运算符loc和iloc。它们可以让你用类似NumPy的标记，使用轴标签（loc）或整数索引（iloc），从DataFrame选择行和列的子集。</p>
<p>作为一个初步示例，让我们通过标签选择一行和多列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">137</span>]: data<span style="color:#000;font-weight:bold">.</span>loc[<span style="color:#d14">&#39;Colorado&#39;</span>, [<span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;three&#39;</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">137</span>]: 
</span></span><span style="display:flex;"><span>two      <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>three    <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>Name: Colorado, dtype: int64
</span></span></code></pre></div><p>然后用iloc和整数进行选取：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">138</span>]: data<span style="color:#000;font-weight:bold">.</span>iloc[<span style="color:#099">2</span>, [<span style="color:#099">3</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">138</span>]: 
</span></span><span style="display:flex;"><span>four    <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>one      <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>two      <span style="color:#099">9</span>
</span></span><span style="display:flex;"><span>Name: Utah, dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">139</span>]: data<span style="color:#000;font-weight:bold">.</span>iloc[<span style="color:#099">2</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">139</span>]: 
</span></span><span style="display:flex;"><span>one       <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>two       <span style="color:#099">9</span>
</span></span><span style="display:flex;"><span>three    <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>four     <span style="color:#099">11</span>
</span></span><span style="display:flex;"><span>Name: Utah, dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">140</span>]: data<span style="color:#000;font-weight:bold">.</span>iloc[[<span style="color:#099">1</span>, <span style="color:#099">2</span>], [<span style="color:#099">3</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>]]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">140</span>]: 
</span></span><span style="display:flex;"><span>          four  one  two
</span></span><span style="display:flex;"><span>Colorado     <span style="color:#099">7</span>    <span style="color:#099">0</span>    <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">11</span>    <span style="color:#099">8</span>    <span style="color:#099">9</span>
</span></span></code></pre></div><p>这两个索引函数也适用于一个标签或多个标签的切片：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">141</span>]: data<span style="color:#000;font-weight:bold">.</span>loc[:<span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;two&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">141</span>]: 
</span></span><span style="display:flex;"><span>Ohio        <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">9</span>
</span></span><span style="display:flex;"><span>Name: two, dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">142</span>]: data<span style="color:#000;font-weight:bold">.</span>iloc[:, :<span style="color:#099">3</span>][data<span style="color:#000;font-weight:bold">.</span>three <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">5</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">142</span>]: 
</span></span><span style="display:flex;"><span>          one  two  three
</span></span><span style="display:flex;"><span>Colorado    <span style="color:#099">0</span>    <span style="color:#099">5</span>      <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>Utah        <span style="color:#099">8</span>    <span style="color:#099">9</span>     <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>New York   <span style="color:#099">12</span>   <span style="color:#099">13</span>     <span style="color:#099">14</span>
</span></span></code></pre></div><p>所以，在pandas中，有多个方法可以选取和重新组合数据。对于DataFrame，表5-4进行了总结。后面会看到，还有更多的方法进行层级化索引。</p>
<blockquote>
<p>笔记：在一开始设计pandas时，我觉得用frame[:, col]选取列过于繁琐（也容易出错），因为列的选择是非常常见的操作。我做了些取舍，将花式索引的功能（标签和整数）放到了ix运算符中。在实践中，这会导致许多边缘情况，数据的轴标签是整数，所以pandas团队决定创造loc和iloc运算符分别处理严格基于标签和整数的索引。
ix运算符仍然可用，但并不推荐。</p>
</blockquote>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023171704254.png" alt="表5-4 DataFrame的索引选项"></p>
<h3 id="525-整数索引">5.2.5 整数索引</h3>
<p>处理整数索引的pandas对象常常难住新手，因为它与Python内置的列表和元组的索引语法不同。例如，你可能不认为下面的代码会出错：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ser <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">3.</span>))
</span></span><span style="display:flex;"><span>ser
</span></span><span style="display:flex;"><span>ser[<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>]
</span></span></code></pre></div><p>这里，pandas可以勉强进行整数索引，但是会导致小bug。我们有包含0,1,2的索引，但是引入用户想要的东西（基于标签或位置的索引）很难：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">144</span>]: ser
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">144</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>另外，对于非整数索引，不会产生歧义：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">145</span>]: ser2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">3.</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">146</span>]: ser2[<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">146</span>]: <span style="color:#099">2.0</span>
</span></span></code></pre></div><p>为了进行统一，如果轴索引含有整数，数据选取总会使用标签。为了更准确，请使用loc（标签）或iloc（整数）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">147</span>]: ser[:<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">147</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">148</span>]: ser<span style="color:#000;font-weight:bold">.</span>loc[:<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">148</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">149</span>]: ser<span style="color:#000;font-weight:bold">.</span>iloc[:<span style="color:#099">1</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">149</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><h3 id="526-算术运算和数据对齐">5.2.6 算术运算和数据对齐</h3>
<p>pandas最重要的一个功能是，它可以对不同索引的对象进行算术运算。在将对象相加时，如果存在不同的索引对，则结果的索引就是该索引对的并集。对于有数据库经验的用户，这就像在索引标签上进行自动外连接。看一个简单的例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">150</span>]: s1 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">7.3</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.5</span>, <span style="color:#099">3.4</span>, <span style="color:#099">1.5</span>], index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;e&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">151</span>]: s2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.1</span>, <span style="color:#099">3.6</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.5</span>, <span style="color:#099">4</span>, <span style="color:#099">3.1</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;e&#39;</span>, <span style="color:#d14">&#39;f&#39;</span>, <span style="color:#d14">&#39;g&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">152</span>]: s1
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">152</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">7.3</span>
</span></span><span style="display:flex;"><span>c   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.5</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">3.4</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">153</span>]: s2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">153</span>]: 
</span></span><span style="display:flex;"><span>a   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.1</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3.6</span>
</span></span><span style="display:flex;"><span>e   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.5</span>
</span></span><span style="display:flex;"><span>f    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>g    <span style="color:#099">3.1</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>将它们相加就会产生：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">154</span>]: s1 <span style="color:#000;font-weight:bold">+</span> s2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">154</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">5.2</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">1.1</span>
</span></span><span style="display:flex;"><span>d    NaN
</span></span><span style="display:flex;"><span>e    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>f    NaN
</span></span><span style="display:flex;"><span>g    NaN
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>自动的数据对齐操作在不重叠的索引处引入了NA值。缺失值会在算术运算过程中传播。</p>
<p>对于DataFrame，对齐操作会同时发生在行和列上：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">155</span>]: df1 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">9.</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">3</span>, <span style="color:#099">3</span>)), columns<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">list</span>(<span style="color:#d14">&#39;bcd&#39;</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                    index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Texas&#39;</span>, <span style="color:#d14">&#39;Colorado&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">156</span>]: df2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">12.</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">4</span>, <span style="color:#099">3</span>)), columns<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">list</span>(<span style="color:#d14">&#39;bde&#39;</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                    index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Texas&#39;</span>, <span style="color:#d14">&#39;Oregon&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">157</span>]: df1
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">157</span>]: 
</span></span><span style="display:flex;"><span>            b    c    d
</span></span><span style="display:flex;"><span>Ohio      <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>  <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>Texas     <span style="color:#099">3.0</span>  <span style="color:#099">4.0</span>  <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>Colorado  <span style="color:#099">6.0</span>  <span style="color:#099">7.0</span>  <span style="color:#099">8.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">158</span>]: df2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">158</span>]: 
</span></span><span style="display:flex;"><span>          b     d     e
</span></span><span style="display:flex;"><span>Utah    <span style="color:#099">0.0</span>   <span style="color:#099">1.0</span>   <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#099">3.0</span>   <span style="color:#099">4.0</span>   <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">6.0</span>   <span style="color:#099">7.0</span>   <span style="color:#099">8.0</span>
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">9.0</span>  <span style="color:#099">10.0</span>  <span style="color:#099">11.0</span>
</span></span></code></pre></div><p>把它们相加后将会返回一个新的DataFrame，其索引和列为原来那两个DataFrame的并集：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">159</span>]: df1 <span style="color:#000;font-weight:bold">+</span> df2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">159</span>]: 
</span></span><span style="display:flex;"><span>            b   c     d   e
</span></span><span style="display:flex;"><span>Colorado  NaN NaN   NaN NaN
</span></span><span style="display:flex;"><span>Ohio      <span style="color:#099">3.0</span> NaN   <span style="color:#099">6.0</span> NaN
</span></span><span style="display:flex;"><span>Oregon    NaN NaN   NaN NaN
</span></span><span style="display:flex;"><span>Texas     <span style="color:#099">9.0</span> NaN  <span style="color:#099">12.0</span> NaN
</span></span><span style="display:flex;"><span>Utah      NaN NaN   NaN NaN
</span></span></code></pre></div><p>因为&rsquo;c&rsquo;和&rsquo;e&rsquo;列均不在两个DataFrame对象中，在结果中以缺省值呈现。行也是同样。</p>
<p>如果DataFrame对象相加，没有共用的列或行标签，结果都会是空：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">160</span>]: df1 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;A&#39;</span>: [<span style="color:#099">1</span>, <span style="color:#099">2</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">161</span>]: df2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;B&#39;</span>: [<span style="color:#099">3</span>, <span style="color:#099">4</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">162</span>]: df1
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">162</span>]: 
</span></span><span style="display:flex;"><span>   A
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">163</span>]: df2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">163</span>]: 
</span></span><span style="display:flex;"><span>   B
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">164</span>]: df1 <span style="color:#000;font-weight:bold">-</span> df2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">164</span>]: 
</span></span><span style="display:flex;"><span>    A   B
</span></span><span style="display:flex;"><span><span style="color:#099">0</span> NaN NaN
</span></span><span style="display:flex;"><span><span style="color:#099">1</span> NaN NaN
</span></span></code></pre></div><h3 id="527-在算术方法中填充值">5.2.7 在算术方法中填充值</h3>
<p>在对不同索引的对象进行算术运算时，你可能希望当一个对象中某个轴标签在另一个对象中找不到时填充一个特殊值（比如0）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">165</span>]: df1 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">12.</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">3</span>, <span style="color:#099">4</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                    columns<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">list</span>(<span style="color:#d14">&#39;abcd&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">166</span>]: df2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">20.</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">4</span>, <span style="color:#099">5</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                    columns<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">list</span>(<span style="color:#d14">&#39;abcde&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">167</span>]: df2<span style="color:#000;font-weight:bold">.</span>loc[<span style="color:#099">1</span>, <span style="color:#d14">&#39;b&#39;</span>] <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>nan
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">168</span>]: df1
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">168</span>]: 
</span></span><span style="display:flex;"><span>     a    b     c     d
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>   <span style="color:#099">2.0</span>   <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">4.0</span>  <span style="color:#099">5.0</span>   <span style="color:#099">6.0</span>   <span style="color:#099">7.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">8.0</span>  <span style="color:#099">9.0</span>  <span style="color:#099">10.0</span>  <span style="color:#099">11.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">169</span>]: df2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">169</span>]: 
</span></span><span style="display:flex;"><span>      a     b     c     d     e
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>   <span style="color:#099">0.0</span>   <span style="color:#099">1.0</span>   <span style="color:#099">2.0</span>   <span style="color:#099">3.0</span>   <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>   <span style="color:#099">5.0</span>   NaN   <span style="color:#099">7.0</span>   <span style="color:#099">8.0</span>   <span style="color:#099">9.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">10.0</span>  <span style="color:#099">11.0</span>  <span style="color:#099">12.0</span>  <span style="color:#099">13.0</span>  <span style="color:#099">14.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">15.0</span>  <span style="color:#099">16.0</span>  <span style="color:#099">17.0</span>  <span style="color:#099">18.0</span>  <span style="color:#099">19.0</span>
</span></span></code></pre></div><p>将它们相加时，没有重叠的位置就会产生NA值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">170</span>]: df1 <span style="color:#000;font-weight:bold">+</span> df2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">170</span>]: 
</span></span><span style="display:flex;"><span>      a     b     c     d   e
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>   <span style="color:#099">0.0</span>   <span style="color:#099">2.0</span>   <span style="color:#099">4.0</span>   <span style="color:#099">6.0</span> NaN
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>   <span style="color:#099">9.0</span>   NaN  <span style="color:#099">13.0</span>  <span style="color:#099">15.0</span> NaN
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">18.0</span>  <span style="color:#099">20.0</span>  <span style="color:#099">22.0</span>  <span style="color:#099">24.0</span> NaN
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>   NaN   NaN   NaN   NaN NaN
</span></span></code></pre></div><p>使用df1的add方法，传入df2以及一个fill_value参数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">171</span>]: df1<span style="color:#000;font-weight:bold">.</span>add(df2, fill_value<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">171</span>]: 
</span></span><span style="display:flex;"><span>      a     b     c     d     e
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>   <span style="color:#099">0.0</span>   <span style="color:#099">2.0</span>   <span style="color:#099">4.0</span>   <span style="color:#099">6.0</span>   <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>   <span style="color:#099">9.0</span>   <span style="color:#099">5.0</span>  <span style="color:#099">13.0</span>  <span style="color:#099">15.0</span>   <span style="color:#099">9.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">18.0</span>  <span style="color:#099">20.0</span>  <span style="color:#099">22.0</span>  <span style="color:#099">24.0</span>  <span style="color:#099">14.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">15.0</span>  <span style="color:#099">16.0</span>  <span style="color:#099">17.0</span>  <span style="color:#099">18.0</span>  <span style="color:#099">19.0</span>
</span></span></code></pre></div><p>表5-5列出了Series和DataFrame的算术方法。它们每个都有一个副本，以字母r开头，它会翻转参数。因此这两个语句是等价的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">172</span>]: <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">/</span> df1
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">172</span>]: 
</span></span><span style="display:flex;"><span>          a         b         c         d
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>       inf  <span style="color:#099">1.000000</span>  <span style="color:#099">0.500000</span>  <span style="color:#099">0.333333</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">0.250000</span>  <span style="color:#099">0.200000</span>  <span style="color:#099">0.166667</span>  <span style="color:#099">0.142857</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0.125000</span>  <span style="color:#099">0.111111</span>  <span style="color:#099">0.100000</span>  <span style="color:#099">0.090909</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">173</span>]: df1<span style="color:#000;font-weight:bold">.</span>rdiv(<span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">173</span>]: 
</span></span><span style="display:flex;"><span>          a         b         c         d
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>       inf  <span style="color:#099">1.000000</span>  <span style="color:#099">0.500000</span>  <span style="color:#099">0.333333</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">0.250000</span>  <span style="color:#099">0.200000</span>  <span style="color:#099">0.166667</span>  <span style="color:#099">0.142857</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0.125000</span>  <span style="color:#099">0.111111</span>  <span style="color:#099">0.100000</span>  <span style="color:#099">0.090909</span>
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023172333048.png" alt="表5-5 灵活的算术方法"></p>
<p>与此类似，在对Series或DataFrame重新索引时，也可以指定一个填充值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">174</span>]: df1<span style="color:#000;font-weight:bold">.</span>reindex(columns<span style="color:#000;font-weight:bold">=</span>df2<span style="color:#000;font-weight:bold">.</span>columns, fill_value<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">174</span>]: 
</span></span><span style="display:flex;"><span>     a    b     c     d  e
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>   <span style="color:#099">2.0</span>   <span style="color:#099">3.0</span>  <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">4.0</span>  <span style="color:#099">5.0</span>   <span style="color:#099">6.0</span>   <span style="color:#099">7.0</span>  <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">8.0</span>  <span style="color:#099">9.0</span>  <span style="color:#099">10.0</span>  <span style="color:#099">11.0</span>  <span style="color:#099">0</span>
</span></span></code></pre></div><h3 id="528-dataframe和series之间的运算">5.2.8 DataFrame和Series之间的运算</h3>
<p>跟不同维度的NumPy数组一样，DataFrame和Series之间算术运算也是有明确规定的。先来看一个具有启发性的例子，计算一个二维数组与其某行之间的差：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">175</span>]: arr <span style="color:#000;font-weight:bold">=</span> np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">12.</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">3</span>, <span style="color:#099">4</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">176</span>]: arr
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">176</span>]: 
</span></span><span style="display:flex;"><span>array([[  <span style="color:#099">0.</span>,   <span style="color:#099">1.</span>,   <span style="color:#099">2.</span>,   <span style="color:#099">3.</span>],
</span></span><span style="display:flex;"><span>       [  <span style="color:#099">4.</span>,   <span style="color:#099">5.</span>,   <span style="color:#099">6.</span>,   <span style="color:#099">7.</span>],
</span></span><span style="display:flex;"><span>       [  <span style="color:#099">8.</span>,   <span style="color:#099">9.</span>,  <span style="color:#099">10.</span>,  <span style="color:#099">11.</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">177</span>]: arr[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">177</span>]: array([ <span style="color:#099">0.</span>,  <span style="color:#099">1.</span>,  <span style="color:#099">2.</span>,  <span style="color:#099">3.</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">178</span>]: arr <span style="color:#000;font-weight:bold">-</span> arr[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">178</span>]: 
</span></span><span style="display:flex;"><span>array([[ <span style="color:#099">0.</span>,  <span style="color:#099">0.</span>,  <span style="color:#099">0.</span>,  <span style="color:#099">0.</span>],
</span></span><span style="display:flex;"><span>       [ <span style="color:#099">4.</span>,  <span style="color:#099">4.</span>,  <span style="color:#099">4.</span>,  <span style="color:#099">4.</span>],
</span></span><span style="display:flex;"><span>       [ <span style="color:#099">8.</span>,  <span style="color:#099">8.</span>,  <span style="color:#099">8.</span>,  <span style="color:#099">8.</span>]])
</span></span></code></pre></div><p>当我们从arr减去arr[0]，每一行都会执行这个操作。这就叫做广播（broadcasting），附录A将对此进行详细讲解。DataFrame和Series之间的运算差不多也是如此：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">179</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">12.</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">4</span>, <span style="color:#099">3</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      columns<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">list</span>(<span style="color:#d14">&#39;bde&#39;</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Texas&#39;</span>, <span style="color:#d14">&#39;Oregon&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">180</span>]: series <span style="color:#000;font-weight:bold">=</span> frame<span style="color:#000;font-weight:bold">.</span>iloc[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">181</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">181</span>]: 
</span></span><span style="display:flex;"><span>          b     d     e
</span></span><span style="display:flex;"><span>Utah    <span style="color:#099">0.0</span>   <span style="color:#099">1.0</span>   <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#099">3.0</span>   <span style="color:#099">4.0</span>   <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">6.0</span>   <span style="color:#099">7.0</span>   <span style="color:#099">8.0</span>
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">9.0</span>  <span style="color:#099">10.0</span>  <span style="color:#099">11.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">182</span>]: series
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">182</span>]: 
</span></span><span style="display:flex;"><span>b    <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>Name: Utah, dtype: float64
</span></span></code></pre></div><p>默认情况下，DataFrame和Series之间的算术运算会将Series的索引匹配到DataFrame的列，然后沿着行一直向下广播：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">183</span>]: frame <span style="color:#000;font-weight:bold">-</span> series
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">183</span>]: 
</span></span><span style="display:flex;"><span>          b    d    e
</span></span><span style="display:flex;"><span>Utah    <span style="color:#099">0.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#099">3.0</span>  <span style="color:#099">3.0</span>  <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">6.0</span>  <span style="color:#099">6.0</span>  <span style="color:#099">6.0</span>
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">9.0</span>  <span style="color:#099">9.0</span>  <span style="color:#099">9.0</span>
</span></span></code></pre></div><p>如果某个索引值在DataFrame的列或Series的索引中找不到，则参与运算的两个对象就会被重新索引以形成并集：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">184</span>]: series2 <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(<span style="color:#0086b3">range</span>(<span style="color:#099">3</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;e&#39;</span>, <span style="color:#d14">&#39;f&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">185</span>]: frame <span style="color:#000;font-weight:bold">+</span> series2
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">185</span>]: 
</span></span><span style="display:flex;"><span>          b   d     e   f
</span></span><span style="display:flex;"><span>Utah    <span style="color:#099">0.0</span> NaN   <span style="color:#099">3.0</span> NaN
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#099">3.0</span> NaN   <span style="color:#099">6.0</span> NaN
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">6.0</span> NaN   <span style="color:#099">9.0</span> NaN
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">9.0</span> NaN  <span style="color:#099">12.0</span> NaN
</span></span></code></pre></div><p>如果你希望匹配行且在列上广播，则必须使用算术运算方法。例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">186</span>]: series3 <span style="color:#000;font-weight:bold">=</span> frame[<span style="color:#d14">&#39;d&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">187</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">187</span>]: 
</span></span><span style="display:flex;"><span>          b     d     e
</span></span><span style="display:flex;"><span>Utah    <span style="color:#099">0.0</span>   <span style="color:#099">1.0</span>   <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#099">3.0</span>   <span style="color:#099">4.0</span>   <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">6.0</span>   <span style="color:#099">7.0</span>   <span style="color:#099">8.0</span>
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">9.0</span>  <span style="color:#099">10.0</span>  <span style="color:#099">11.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">188</span>]: series3
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">188</span>]: 
</span></span><span style="display:flex;"><span>Utah       <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>Ohio       <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>Texas      <span style="color:#099">7.0</span>
</span></span><span style="display:flex;"><span>Oregon    <span style="color:#099">10.0</span>
</span></span><span style="display:flex;"><span>Name: d, dtype: float64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">189</span>]: frame<span style="color:#000;font-weight:bold">.</span>sub(series3, axis<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;index&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">189</span>]: 
</span></span><span style="display:flex;"><span>          b    d    e
</span></span><span style="display:flex;"><span>Utah   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>Ohio   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>Texas  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span>Oregon <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>
</span></span></code></pre></div><p>传入的轴号就是希望匹配的轴。在本例中，我们的目的是匹配DataFrame的行索引（axis=&lsquo;index&rsquo; or axis=0）并进行广播。</p>
<h3 id="529-函数应用和映射">5.2.9 函数应用和映射</h3>
<p>NumPy的ufuncs（元素级数组方法）也可用于操作pandas对象：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">190</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>random<span style="color:#000;font-weight:bold">.</span>randn(<span style="color:#099">4</span>, <span style="color:#099">3</span>), columns<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">list</span>(<span style="color:#d14">&#39;bde&#39;</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;Utah&#39;</span>, <span style="color:#d14">&#39;Ohio&#39;</span>, <span style="color:#d14">&#39;Texas&#39;</span>, <span style="color:#d14">&#39;Oregon&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">191</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">191</span>]: 
</span></span><span style="display:flex;"><span>               b         d         e
</span></span><span style="display:flex;"><span>Utah   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.204708</span>  <span style="color:#099">0.478943</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.519439</span>
</span></span><span style="display:flex;"><span>Ohio   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.555730</span>  <span style="color:#099">1.965781</span>  <span style="color:#099">1.393406</span>
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">0.092908</span>  <span style="color:#099">0.281746</span>  <span style="color:#099">0.769023</span>
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">1.246435</span>  <span style="color:#099">1.007189</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.296221</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">192</span>]: np<span style="color:#000;font-weight:bold">.</span>abs(frame)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">192</span>]: 
</span></span><span style="display:flex;"><span>               b         d         e
</span></span><span style="display:flex;"><span>Utah    <span style="color:#099">0.204708</span>  <span style="color:#099">0.478943</span>  <span style="color:#099">0.519439</span>
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#099">0.555730</span>  <span style="color:#099">1.965781</span>  <span style="color:#099">1.393406</span>
</span></span><span style="display:flex;"><span>Texas   <span style="color:#099">0.092908</span>  <span style="color:#099">0.281746</span>  <span style="color:#099">0.769023</span>
</span></span><span style="display:flex;"><span>Oregon  <span style="color:#099">1.246435</span>  <span style="color:#099">1.007189</span>  <span style="color:#099">1.296221</span>
</span></span></code></pre></div><p>另一个常见的操作是，将函数应用到由各列或行所形成的一维数组上。DataFrame的apply方法即可实现此功能：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">193</span>]: f <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">lambda</span> x: x<span style="color:#000;font-weight:bold">.</span>max() <span style="color:#000;font-weight:bold">-</span> x<span style="color:#000;font-weight:bold">.</span>min()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">194</span>]: frame<span style="color:#000;font-weight:bold">.</span>apply(f)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">194</span>]: 
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.802165</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">1.684034</span>
</span></span><span style="display:flex;"><span>e    <span style="color:#099">2.689627</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>这里的函数f，计算了一个Series的最大值和最小值的差，在frame的每列都执行了一次。结果是一个Series，使用frame的列作为索引。</p>
<p>如果传递axis=&lsquo;columns&rsquo;到apply，这个函数会在每行执行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">195</span>]: frame<span style="color:#000;font-weight:bold">.</span>apply(f, axis<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;columns&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">195</span>]:
</span></span><span style="display:flex;"><span>Utah      <span style="color:#099">0.998382</span>
</span></span><span style="display:flex;"><span>Ohio      <span style="color:#099">2.521511</span>
</span></span><span style="display:flex;"><span>Texas     <span style="color:#099">0.676115</span>
</span></span><span style="display:flex;"><span>Oregon    <span style="color:#099">2.542656</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>许多最为常见的数组统计功能都被实现成DataFrame的方法（如sum和mean），因此无需使用apply方法。</p>
<p>传递到apply的函数不是必须返回一个标量，还可以返回由多个值组成的Series：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">196</span>]: <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>(x):
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:     <span style="color:#000;font-weight:bold">return</span> pd<span style="color:#000;font-weight:bold">.</span>Series([x<span style="color:#000;font-weight:bold">.</span>min(), x<span style="color:#000;font-weight:bold">.</span>max()], index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;min&#39;</span>, <span style="color:#d14">&#39;max&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">197</span>]: frame<span style="color:#000;font-weight:bold">.</span>apply(f)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">197</span>]: 
</span></span><span style="display:flex;"><span>            b         d         e
</span></span><span style="display:flex;"><span><span style="color:#0086b3">min</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.555730</span>  <span style="color:#099">0.281746</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.296221</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">max</span>  <span style="color:#099">1.246435</span>  <span style="color:#099">1.965781</span>  <span style="color:#099">1.393406</span>
</span></span></code></pre></div><p>元素级的Python函数也是可以用的。假如你想得到frame中各个浮点值的格式化字符串，使用applymap即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">198</span>]: <span style="color:#0086b3">format</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">lambda</span> x: <span style="color:#d14">&#39;</span><span style="color:#d14">%.2f</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">199</span>]: frame<span style="color:#000;font-weight:bold">.</span>applymap(<span style="color:#0086b3">format</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">199</span>]: 
</span></span><span style="display:flex;"><span>            b     d      e
</span></span><span style="display:flex;"><span>Utah    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.20</span>  <span style="color:#099">0.48</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.52</span>
</span></span><span style="display:flex;"><span>Ohio    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.56</span>  <span style="color:#099">1.97</span>   <span style="color:#099">1.39</span>
</span></span><span style="display:flex;"><span>Texas    <span style="color:#099">0.09</span>  <span style="color:#099">0.28</span>   <span style="color:#099">0.77</span>
</span></span><span style="display:flex;"><span>Oregon   <span style="color:#099">1.25</span>  <span style="color:#099">1.01</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.30</span>
</span></span></code></pre></div><p>之所以叫做applymap，是因为Series有一个用于应用元素级函数的map方法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">200</span>]: frame[<span style="color:#d14">&#39;e&#39;</span>]<span style="color:#000;font-weight:bold">.</span>map(<span style="color:#0086b3">format</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">200</span>]: 
</span></span><span style="display:flex;"><span>Utah      <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.52</span>
</span></span><span style="display:flex;"><span>Ohio       <span style="color:#099">1.39</span>
</span></span><span style="display:flex;"><span>Texas      <span style="color:#099">0.77</span>
</span></span><span style="display:flex;"><span>Oregon    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.30</span>
</span></span><span style="display:flex;"><span>Name: e, dtype: <span style="color:#0086b3">object</span>
</span></span></code></pre></div><h3 id="5210-排序和排名">5.2.10 排序和排名</h3>
<p>根据条件对数据集排序（sorting）也是一种重要的内置运算。要对行或列索引进行排序（按字典顺序），可使用sort_index方法，它将返回一个已排序的新对象：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">201</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(<span style="color:#0086b3">range</span>(<span style="color:#099">4</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">202</span>]: obj<span style="color:#000;font-weight:bold">.</span>sort_index()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">202</span>]:
</span></span><span style="display:flex;"><span>a    <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>对于DataFrame，则可以根据任意一个轴上的索引进行排序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">203</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">8</span>)<span style="color:#000;font-weight:bold">.</span>reshape((<span style="color:#099">2</span>, <span style="color:#099">4</span>)),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;three&#39;</span>, <span style="color:#d14">&#39;one&#39;</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">204</span>]: frame<span style="color:#000;font-weight:bold">.</span>sort_index()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">204</span>]: 
</span></span><span style="display:flex;"><span>       d  a  b  c
</span></span><span style="display:flex;"><span>one    <span style="color:#099">4</span>  <span style="color:#099">5</span>  <span style="color:#099">6</span>  <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>three  <span style="color:#099">0</span>  <span style="color:#099">1</span>  <span style="color:#099">2</span>  <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">205</span>]: frame<span style="color:#000;font-weight:bold">.</span>sort_index(axis<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">205</span>]:
</span></span><span style="display:flex;"><span>       a  b  c  d
</span></span><span style="display:flex;"><span>three  <span style="color:#099">1</span>  <span style="color:#099">2</span>  <span style="color:#099">3</span>  <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>one    <span style="color:#099">5</span>  <span style="color:#099">6</span>  <span style="color:#099">7</span>  <span style="color:#099">4</span>
</span></span></code></pre></div><p>数据默认是按升序排序的，但也可以降序排序：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">206</span>]: frame<span style="color:#000;font-weight:bold">.</span>sort_index(axis<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>, ascending<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">206</span>]: 
</span></span><span style="display:flex;"><span>       d  c  b  a
</span></span><span style="display:flex;"><span>three  <span style="color:#099">0</span>  <span style="color:#099">3</span>  <span style="color:#099">2</span>  <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>one    <span style="color:#099">4</span>  <span style="color:#099">7</span>  <span style="color:#099">6</span>  <span style="color:#099">5</span>
</span></span></code></pre></div><p>若要按值对Series进行排序，可使用其sort_values方法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">207</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">4</span>, <span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>, <span style="color:#099">2</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">208</span>]: obj<span style="color:#000;font-weight:bold">.</span>sort_values()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">208</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>在排序时，任何缺失值默认都会被放到Series的末尾：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">209</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">4</span>, np<span style="color:#000;font-weight:bold">.</span>nan, <span style="color:#099">7</span>, np<span style="color:#000;font-weight:bold">.</span>nan, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>, <span style="color:#099">2</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">210</span>]: obj<span style="color:#000;font-weight:bold">.</span>sort_values()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">210</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">7.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    NaN
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    NaN
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>当排序一个DataFrame时，你可能希望根据一个或多个列中的值进行排序。将一个或多个列的名字传递给sort_values的by选项即可达到该目的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">211</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;b&#39;</span>: [<span style="color:#099">4</span>, <span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>, <span style="color:#099">2</span>], <span style="color:#d14">&#39;a&#39;</span>: [<span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">212</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">212</span>]: 
</span></span><span style="display:flex;"><span>   a  b
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0</span>  <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1</span>  <span style="color:#099">7</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">1</span>  <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">213</span>]: frame<span style="color:#000;font-weight:bold">.</span>sort_values(by<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;b&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">213</span>]: 
</span></span><span style="display:flex;"><span>   a  b
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">1</span>  <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0</span>  <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1</span>  <span style="color:#099">7</span>
</span></span></code></pre></div><p>要根据多个列进行排序，传入名称的列表即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">214</span>]: frame<span style="color:#000;font-weight:bold">.</span>sort_values(by<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">214</span>]: 
</span></span><span style="display:flex;"><span>   a  b
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0</span>  <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">1</span>  <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1</span>  <span style="color:#099">7</span>
</span></span></code></pre></div><p>排名会从1开始一直到数组中有效数据的数量。接下来介绍Series和DataFrame的rank方法。默认情况下，rank是通过“为各组分配一个平均排名”的方式破坏平级关系的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">215</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5</span>, <span style="color:#099">7</span>, <span style="color:#099">4</span>, <span style="color:#099">2</span>, <span style="color:#099">0</span>, <span style="color:#099">4</span>])
</span></span><span style="display:flex;"><span>In [<span style="color:#099">216</span>]: obj<span style="color:#000;font-weight:bold">.</span>rank()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">216</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">6.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">6.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">4.5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>    <span style="color:#099">4.5</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>也可以根据值在原数据中出现的顺序给出排名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">217</span>]: obj<span style="color:#000;font-weight:bold">.</span>rank(method<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;first&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">217</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">6.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">7.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>    <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>这里，条目0和2没有使用平均排名6.5，它们被设成了6和7，因为数据中标签0位于标签2的前面。</p>
<p>你也可以按降序进行排名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Assign tie values the maximum rank in the group</span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">218</span>]: obj<span style="color:#000;font-weight:bold">.</span>rank(ascending<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, method<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;max&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">218</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">7.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    <span style="color:#099">6.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>    <span style="color:#099">4.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>表5-6列出了所有用于破坏平级关系的method选项。DataFrame可以在行或列上计算排名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">219</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;b&#39;</span>: [<span style="color:#099">4.3</span>, <span style="color:#099">7</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3</span>, <span style="color:#099">2</span>], <span style="color:#d14">&#39;a&#39;</span>: [<span style="color:#099">0</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">1</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                       <span style="color:#d14">&#39;c&#39;</span>: [<span style="color:#000;font-weight:bold">-</span><span style="color:#099">2</span>, <span style="color:#099">5</span>, <span style="color:#099">8</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.5</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">220</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">220</span>]: 
</span></span><span style="display:flex;"><span>   a    b    c
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0</span>  <span style="color:#099">4.3</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1</span>  <span style="color:#099">7.0</span>  <span style="color:#099">5.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3.0</span>  <span style="color:#099">8.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">1</span>  <span style="color:#099">2.0</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">221</span>]: frame<span style="color:#000;font-weight:bold">.</span>rank(axis<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;columns&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">221</span>]: 
</span></span><span style="display:flex;"><span>     a    b    c
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">2.0</span>  <span style="color:#099">3.0</span>  <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1.0</span>  <span style="color:#099">3.0</span>  <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">2.0</span>  <span style="color:#099">1.0</span>  <span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">2.0</span>  <span style="color:#099">3.0</span>  <span style="color:#099">1.0</span>
</span></span></code></pre></div><p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023172547701.png" alt="表5-6 排名时用于破坏平级关系的方法"></p>
<h3 id="5211-带有重复标签的轴索引">5.2.11 带有重复标签的轴索引</h3>
<p>直到目前为止，我所介绍的所有范例都有着唯一的轴标签（索引值）。虽然许多pandas函数（如reindex）都要求标签唯一，但这并不是强制性的。我们来看看下面这个简单的带有重复索引值的Series：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">222</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(<span style="color:#0086b3">range</span>(<span style="color:#099">5</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">223</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">223</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>a    <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>索引的is_unique属性可以告诉你它的值是否是唯一的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">224</span>]: obj<span style="color:#000;font-weight:bold">.</span>index<span style="color:#000;font-weight:bold">.</span>is_unique
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">224</span>]: <span style="color:#000;font-weight:bold">False</span>
</span></span></code></pre></div><p>对于带有重复值的索引，数据选取的行为将会有些不同。如果某个索引对应多个值，则返回一个Series；而对应单个值的，则返回一个标量值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">225</span>]: obj[<span style="color:#d14">&#39;a&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">225</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>a    <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">226</span>]: obj[<span style="color:#d14">&#39;c&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">226</span>]: <span style="color:#099">4</span>
</span></span></code></pre></div><p>这样会使代码变复杂，因为索引的输出类型会根据标签是否有重复发生变化。</p>
<p>对DataFrame的行进行索引时也是如此：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">227</span>]: df <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(np<span style="color:#000;font-weight:bold">.</span>random<span style="color:#000;font-weight:bold">.</span>randn(<span style="color:#099">4</span>, <span style="color:#099">3</span>), index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">228</span>]: df
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">228</span>]: 
</span></span><span style="display:flex;"><span>          <span style="color:#099">0</span>         <span style="color:#099">1</span>         <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>a  <span style="color:#099">0.274992</span>  <span style="color:#099">0.228913</span>  <span style="color:#099">1.352917</span>
</span></span><span style="display:flex;"><span>a  <span style="color:#099">0.886429</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.001637</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.371843</span>
</span></span><span style="display:flex;"><span>b  <span style="color:#099">1.669025</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.438570</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.539741</span>
</span></span><span style="display:flex;"><span>b  <span style="color:#099">0.476985</span>  <span style="color:#099">3.248944</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.021228</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">229</span>]: df<span style="color:#000;font-weight:bold">.</span>loc[<span style="color:#d14">&#39;b&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">229</span>]: 
</span></span><span style="display:flex;"><span>          <span style="color:#099">0</span>         <span style="color:#099">1</span>         <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>b  <span style="color:#099">1.669025</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.438570</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.539741</span>
</span></span><span style="display:flex;"><span>b  <span style="color:#099">0.476985</span>  <span style="color:#099">3.248944</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.021228</span>
</span></span></code></pre></div><h2 id="53-汇总和计算描述统计">5.3 汇总和计算描述统计</h2>
<p>pandas对象拥有一组常用的数学和统计方法。它们大部分都属于<code>约简和汇总统计</code>，用于从Series中提取单个值（如sum或mean）或从DataFrame的行或列中提取一个Series。跟对应的NumPy数组方法相比，它们都是基于没有缺失数据的假设而构建的。看一个简单的DataFrame：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">230</span>]: df <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame([[<span style="color:#099">1.4</span>, np<span style="color:#000;font-weight:bold">.</span>nan], [<span style="color:#099">7.1</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">4.5</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                    [np<span style="color:#000;font-weight:bold">.</span>nan, np<span style="color:#000;font-weight:bold">.</span>nan], [<span style="color:#099">0.75</span>, <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.3</span>]],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                   index<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                   columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;one&#39;</span>, <span style="color:#d14">&#39;two&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">231</span>]: df
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">231</span>]: 
</span></span><span style="display:flex;"><span>    one  two
</span></span><span style="display:flex;"><span>a  <span style="color:#099">1.40</span>  NaN
</span></span><span style="display:flex;"><span>b  <span style="color:#099">7.10</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">4.5</span>
</span></span><span style="display:flex;"><span>c   NaN  NaN
</span></span><span style="display:flex;"><span>d  <span style="color:#099">0.75</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.3</span>
</span></span></code></pre></div><p>调用DataFrame的sum方法将会返回一个含有列的和的Series：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">232</span>]: df<span style="color:#000;font-weight:bold">.</span>sum()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">232</span>]: 
</span></span><span style="display:flex;"><span>one    <span style="color:#099">9.25</span>
</span></span><span style="display:flex;"><span>two   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5.80</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>传入axis=&lsquo;columns&rsquo;或axis=1将会按行进行求和运算：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">233</span>]: df<span style="color:#000;font-weight:bold">.</span>sum(axis<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">233</span>]:
</span></span><span style="display:flex;"><span>a    <span style="color:#099">1.40</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">2.60</span>
</span></span><span style="display:flex;"><span>c     NaN
</span></span><span style="display:flex;"><span>d   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.55</span>
</span></span></code></pre></div><p>NA值会自动被排除，除非整个切片（这里指的是行或列）都是NA。通过skipna选项可以禁用该功能：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">234</span>]: df<span style="color:#000;font-weight:bold">.</span>mean(axis<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;columns&#39;</span>, skipna<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">234</span>]: 
</span></span><span style="display:flex;"><span>a      NaN
</span></span><span style="display:flex;"><span>b    <span style="color:#099">1.300</span>
</span></span><span style="display:flex;"><span>c      NaN
</span></span><span style="display:flex;"><span>d   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.275</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>表5-7列出了这些约简方法的常用选项。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023172745492.jpeg" alt=""></p>
<p>有些方法（如idxmin和idxmax）返回的是间接统计（比如达到最小值或最大值的索引）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">235</span>]: df<span style="color:#000;font-weight:bold">.</span>idxmax()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">235</span>]: 
</span></span><span style="display:flex;"><span>one    b
</span></span><span style="display:flex;"><span>two    d
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">object</span>
</span></span></code></pre></div><p>另一些方法则是累计型的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">236</span>]: df<span style="color:#000;font-weight:bold">.</span>cumsum()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">236</span>]: 
</span></span><span style="display:flex;"><span>    one  two
</span></span><span style="display:flex;"><span>a  <span style="color:#099">1.40</span>  NaN
</span></span><span style="display:flex;"><span>b  <span style="color:#099">8.50</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">4.5</span>
</span></span><span style="display:flex;"><span>c   NaN  NaN
</span></span><span style="display:flex;"><span>d  <span style="color:#099">9.25</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">5.8</span>
</span></span></code></pre></div><p>还有一种方法，它既不是约简型也不是累计型。describe就是一个例子，它用于一次性产生多个汇总统计：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">237</span>]: df<span style="color:#000;font-weight:bold">.</span>describe()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">237</span>]: 
</span></span><span style="display:flex;"><span>            one       two
</span></span><span style="display:flex;"><span>count  <span style="color:#099">3.000000</span>  <span style="color:#099">2.000000</span>
</span></span><span style="display:flex;"><span>mean   <span style="color:#099">3.083333</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.900000</span>
</span></span><span style="display:flex;"><span>std    <span style="color:#099">3.493685</span>  <span style="color:#099">2.262742</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">min</span>    <span style="color:#099">0.750000</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">4.500000</span>
</span></span><span style="display:flex;"><span><span style="color:#099">25</span><span style="color:#000;font-weight:bold">%</span>    <span style="color:#099">1.075000</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">3.700000</span>
</span></span><span style="display:flex;"><span><span style="color:#099">50</span><span style="color:#000;font-weight:bold">%</span>    <span style="color:#099">1.400000</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.900000</span>
</span></span><span style="display:flex;"><span><span style="color:#099">75</span><span style="color:#000;font-weight:bold">%</span>    <span style="color:#099">4.250000</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">2.100000</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">max</span>    <span style="color:#099">7.100000</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.300000</span>
</span></span></code></pre></div><p>对于非数值型数据，describe会产生另外一种汇总统计：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">238</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>] <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">239</span>]: obj<span style="color:#000;font-weight:bold">.</span>describe()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">239</span>]: 
</span></span><span style="display:flex;"><span>count     <span style="color:#099">16</span>
</span></span><span style="display:flex;"><span>unique     <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>top        a
</span></span><span style="display:flex;"><span>freq       <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">object</span>
</span></span></code></pre></div><p>表5-8列出了所有与描述统计相关的方法。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023184611242.jpeg" alt=""></p>
<h3 id="531-相关系数与协方差">5.3.1 相关系数与协方差</h3>
<p>有些汇总统计（如相关系数和协方差）是通过参数对计算出来的。我们来看几个DataFrame，它们的数据来自Yahoo!Finance的股票价格和成交量，使用的是pandas-datareader包（可以用conda或pip安装）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>conda install pandas<span style="color:#000;font-weight:bold">-</span>datareader
</span></span></code></pre></div><p>我使用pandas_datareader模块下载了一些股票数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">pandas_datareader.data</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">web</span>
</span></span><span style="display:flex;"><span>all_data <span style="color:#000;font-weight:bold">=</span> {ticker: web<span style="color:#000;font-weight:bold">.</span>get_data_yahoo(ticker)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> ticker <span style="color:#000;font-weight:bold">in</span> [<span style="color:#d14">&#39;AAPL&#39;</span>, <span style="color:#d14">&#39;IBM&#39;</span>, <span style="color:#d14">&#39;MSFT&#39;</span>, <span style="color:#d14">&#39;GOOG&#39;</span>]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>price <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({ticker: data[<span style="color:#d14">&#39;Adj Close&#39;</span>]
</span></span><span style="display:flex;"><span>                     <span style="color:#000;font-weight:bold">for</span> ticker, data <span style="color:#000;font-weight:bold">in</span> all_data<span style="color:#000;font-weight:bold">.</span>items()})
</span></span><span style="display:flex;"><span>volume <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({ticker: data[<span style="color:#d14">&#39;Volume&#39;</span>]
</span></span><span style="display:flex;"><span>                      <span style="color:#000;font-weight:bold">for</span> ticker, data <span style="color:#000;font-weight:bold">in</span> all_data<span style="color:#000;font-weight:bold">.</span>items()})
</span></span></code></pre></div><blockquote>
<p>注意：此时Yahoo! Finance已经不存在了，因为2017年Yahoo!被Verizon收购了。参阅pandas-datareader文档，可以学习最新的功能。</p>
</blockquote>
<p>现在计算价格的百分数变化，时间序列的操作会在第11章介绍：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">242</span>]: returns <span style="color:#000;font-weight:bold">=</span> price<span style="color:#000;font-weight:bold">.</span>pct_change()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">243</span>]: returns<span style="color:#000;font-weight:bold">.</span>tail()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">243</span>]: 
</span></span><span style="display:flex;"><span>                AAPL      GOOG       IBM      MSFT
</span></span><span style="display:flex;"><span>Date                                              
</span></span><span style="display:flex;"><span><span style="color:#099">2016</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">17</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.000680</span>  <span style="color:#099">0.001837</span>  <span style="color:#099">0.002072</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.003483</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2016</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">18</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.000681</span>  <span style="color:#099">0.019616</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.026168</span>  <span style="color:#099">0.007690</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2016</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">19</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.002979</span>  <span style="color:#099">0.007846</span>  <span style="color:#099">0.003583</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.002255</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2016</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">20</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.000512</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.005652</span>  <span style="color:#099">0.001719</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.004867</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2016</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">10</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">21</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.003930</span>  <span style="color:#099">0.003011</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.012474</span>  <span style="color:#099">0.042096</span>
</span></span></code></pre></div><p>Series的corr方法用于计算两个Series中重叠的、非NA的、按索引对齐的值的相关系数。与此类似，cov用于计算协方差：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">244</span>]: returns[<span style="color:#d14">&#39;MSFT&#39;</span>]<span style="color:#000;font-weight:bold">.</span>corr(returns[<span style="color:#d14">&#39;IBM&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">244</span>]: <span style="color:#099">0.49976361144151144</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">245</span>]: returns[<span style="color:#d14">&#39;MSFT&#39;</span>]<span style="color:#000;font-weight:bold">.</span>cov(returns[<span style="color:#d14">&#39;IBM&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">245</span>]: <span style="color:#099">8.8706554797035462e-05</span>
</span></span></code></pre></div><p>因为MSTF是一个合理的Python属性，我们还可以用更简洁的语法选择列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">246</span>]: returns<span style="color:#000;font-weight:bold">.</span>MSFT<span style="color:#000;font-weight:bold">.</span>corr(returns<span style="color:#000;font-weight:bold">.</span>IBM)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">246</span>]: <span style="color:#099">0.49976361144151144</span>
</span></span></code></pre></div><p>另一方面，DataFrame的corr和cov方法将以DataFrame的形式分别返回完整的相关系数或协方差矩阵：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">247</span>]: returns<span style="color:#000;font-weight:bold">.</span>corr()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">247</span>]: 
</span></span><span style="display:flex;"><span>          AAPL      GOOG       IBM      MSFT
</span></span><span style="display:flex;"><span>AAPL  <span style="color:#099">1.000000</span>  <span style="color:#099">0.407919</span>  <span style="color:#099">0.386817</span>  <span style="color:#099">0.389695</span>
</span></span><span style="display:flex;"><span>GOOG  <span style="color:#099">0.407919</span>  <span style="color:#099">1.000000</span>  <span style="color:#099">0.405099</span>  <span style="color:#099">0.465919</span>
</span></span><span style="display:flex;"><span>IBM   <span style="color:#099">0.386817</span>  <span style="color:#099">0.405099</span>  <span style="color:#099">1.000000</span>  <span style="color:#099">0.499764</span>
</span></span><span style="display:flex;"><span>MSFT  <span style="color:#099">0.389695</span>  <span style="color:#099">0.465919</span>  <span style="color:#099">0.499764</span>  <span style="color:#099">1.000000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">248</span>]: returns<span style="color:#000;font-weight:bold">.</span>cov()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">248</span>]: 
</span></span><span style="display:flex;"><span>          AAPL      GOOG       IBM      MSFT
</span></span><span style="display:flex;"><span>AAPL  <span style="color:#099">0.000277</span>  <span style="color:#099">0.000107</span>  <span style="color:#099">0.000078</span>  <span style="color:#099">0.000095</span>
</span></span><span style="display:flex;"><span>GOOG  <span style="color:#099">0.000107</span>  <span style="color:#099">0.000251</span>  <span style="color:#099">0.000078</span>  <span style="color:#099">0.000108</span>
</span></span><span style="display:flex;"><span>IBM   <span style="color:#099">0.000078</span>  <span style="color:#099">0.000078</span>  <span style="color:#099">0.000146</span>  <span style="color:#099">0.000089</span>
</span></span><span style="display:flex;"><span>MSFT  <span style="color:#099">0.000095</span>  <span style="color:#099">0.000108</span>  <span style="color:#099">0.000089</span>  <span style="color:#099">0.000215</span>
</span></span></code></pre></div><p>利用DataFrame的corrwith方法，你可以计算其列或行跟另一个Series或DataFrame之间的相关系数。传入一个Series将会返回一个相关系数值Series（针对各列进行计算）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">249</span>]: returns<span style="color:#000;font-weight:bold">.</span>corrwith(returns<span style="color:#000;font-weight:bold">.</span>IBM)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">249</span>]: 
</span></span><span style="display:flex;"><span>AAPL    <span style="color:#099">0.386817</span>
</span></span><span style="display:flex;"><span>GOOG    <span style="color:#099">0.405099</span>
</span></span><span style="display:flex;"><span>IBM     <span style="color:#099">1.000000</span>
</span></span><span style="display:flex;"><span>MSFT    <span style="color:#099">0.499764</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>传入一个DataFrame则会计算按列名配对的相关系数。这里，我计算百分比变化与成交量的相关系数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">250</span>]: returns<span style="color:#000;font-weight:bold">.</span>corrwith(volume)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">250</span>]: 
</span></span><span style="display:flex;"><span>AAPL   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.075565</span>
</span></span><span style="display:flex;"><span>GOOG   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.007067</span>
</span></span><span style="display:flex;"><span>IBM    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.204849</span>
</span></span><span style="display:flex;"><span>MSFT   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.092950</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>传入axis=&lsquo;columns&rsquo;即可按行进行计算。无论如何，在计算相关系数之前，所有的数据项都会按标签对齐。</p>
<h3 id="532-唯一值值计数以及成员资格">5.3.2 唯一值、值计数以及成员资格</h3>
<p>还有一类方法可以从一维Series的值中抽取信息。看下面的例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">251</span>]: obj <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span></code></pre></div><p>第一个函数是unique，它可以得到Series中的唯一值数组：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">252</span>]: uniques <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>unique()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">253</span>]: uniques
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">253</span>]: array([<span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>], dtype<span style="color:#000;font-weight:bold">=</span><span style="color:#0086b3">object</span>)
</span></span></code></pre></div><p>返回的唯一值是未排序的，如果需要的话，可以对结果再次进行排序（uniques.sort()）。相似的，value_counts用于计算一个Series中各值出现的频率：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">254</span>]: obj<span style="color:#000;font-weight:bold">.</span>value_counts()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">254</span>]: 
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>a    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>为了便于查看，结果Series是按值频率降序排列的。value_counts还是一个顶级pandas方法，可用于任何数组或序列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">255</span>]: pd<span style="color:#000;font-weight:bold">.</span>value_counts(obj<span style="color:#000;font-weight:bold">.</span>values, sort<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">255</span>]: 
</span></span><span style="display:flex;"><span>a    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>b    <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>c    <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>d    <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>dtype: int64
</span></span></code></pre></div><p>isin用于判断矢量化集合的成员资格，可用于过滤Series中或DataFrame列中数据的子集：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">256</span>]: obj
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">256</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    c
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    a
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    d
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    a
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    a
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    b
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>    b
</span></span><span style="display:flex;"><span><span style="color:#099">7</span>    c
</span></span><span style="display:flex;"><span><span style="color:#099">8</span>    c
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">object</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">257</span>]: mask <span style="color:#000;font-weight:bold">=</span> obj<span style="color:#000;font-weight:bold">.</span>isin([<span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">258</span>]: mask
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">258</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#099">7</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#099">8</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">bool</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">259</span>]: obj[mask]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">259</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    c
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>    b
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>    b
</span></span><span style="display:flex;"><span><span style="color:#099">7</span>    c
</span></span><span style="display:flex;"><span><span style="color:#099">8</span>    c
</span></span><span style="display:flex;"><span>dtype: <span style="color:#0086b3">object</span>
</span></span></code></pre></div><p>与isin类似的是Index.get_indexer方法，它可以给你一个索引数组，从可能包含重复值的数组到另一个不同值的数组：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">260</span>]: to_match <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">261</span>]: unique_vals <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([<span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;a&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">262</span>]: pd<span style="color:#000;font-weight:bold">.</span>Index(unique_vals)<span style="color:#000;font-weight:bold">.</span>get_indexer(to_match)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">262</span>]: array([<span style="color:#099">0</span>, <span style="color:#099">2</span>, <span style="color:#099">1</span>, <span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">2</span>])
</span></span></code></pre></div><p>表5-9给出了这几个方法的一些参考信息。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023221621417.png" alt="表5-9 唯一值、值计数、成员资格方法"></p>
<p>有时，你可能希望得到DataFrame中多个相关列的一张柱状图。例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">263</span>]: data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;Qu1&#39;</span>: [<span style="color:#099">1</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      <span style="color:#d14">&#39;Qu2&#39;</span>: [<span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>],
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                      <span style="color:#d14">&#39;Qu3&#39;</span>: [<span style="color:#099">1</span>, <span style="color:#099">5</span>, <span style="color:#099">2</span>, <span style="color:#099">4</span>, <span style="color:#099">4</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">264</span>]: data
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">264</span>]: 
</span></span><span style="display:flex;"><span>   Qu1  Qu2  Qu3
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">1</span>    <span style="color:#099">2</span>    <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">3</span>    <span style="color:#099">3</span>    <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">4</span>    <span style="color:#099">1</span>    <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">3</span>    <span style="color:#099">2</span>    <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    <span style="color:#099">4</span>    <span style="color:#099">3</span>    <span style="color:#099">4</span>
</span></span></code></pre></div><p>将pandas.value_counts传给该DataFrame的apply函数，就会出现：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">265</span>]: result <span style="color:#000;font-weight:bold">=</span> data<span style="color:#000;font-weight:bold">.</span>apply(pd<span style="color:#000;font-weight:bold">.</span>value_counts)<span style="color:#000;font-weight:bold">.</span>fillna(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">266</span>]: result
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">266</span>]: 
</span></span><span style="display:flex;"><span>   Qu1  Qu2  Qu3
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1.0</span>  <span style="color:#099">1.0</span>  <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">0.0</span>  <span style="color:#099">2.0</span>  <span style="color:#099">1.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">2.0</span>  <span style="color:#099">2.0</span>  <span style="color:#099">0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">2.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>  <span style="color:#099">0.0</span>  <span style="color:#099">0.0</span>  <span style="color:#099">1.0</span>
</span></span></code></pre></div><p>这里，结果中的行标签是所有列的唯一值。后面的频率值是每个列中这些值的相应计数。</p>
<h2 id="54-总结">5.4 总结</h2>
<p>在下一章，我们将讨论用pandas读取（或加载）和写入数据集的工具。</p>
<p>之后，我们将更深入地研究使用pandas进行数据清洗、规整、分析和可视化工具。</p>

    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch02-python%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E5%92%8Cipython%E4%BB%A5%E5%8F%8Ajupyternotebooks/">← 第二章 Python 语法基础，IPython 和 Jupyter Notebooks</a></div>
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/">第八章 数据规整：聚合、合并和重塑  →</a></div>
</div>
    
    

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        京ICP备2022007001号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
