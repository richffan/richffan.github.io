<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="第六章 数据加载、存储与文件格式 - https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch06-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E5%AD%98%E5%82%A8%E4%B8%8E%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/">
    <meta name="author" content="richfan - https://richfan.site/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>第六章 数据加载、存储与文件格式</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://richfan.site/style.min.d252ad53a5e6b2ae6b8c6c1661107189be3668e36c8dd61697bbe008595a7e04.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": true
	}
</div>
    <h1 class="title">
        
            第六章 数据加载、存储与文件格式
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2023-09-25&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-09-25&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            9256 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            19 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/%E7%A8%8B%E6%8A%80">程技</a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/python">python</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch11-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#61-读写文本格式的数据">6.1 读写文本格式的数据</a>
      <ul>
        <li><a href="#611-逐块读取文本文件">6.1.1 逐块读取文本文件</a></li>
        <li><a href="#612-将数据写出到文本格式">6.1.2 将数据写出到文本格式</a></li>
        <li><a href="#613-处理分隔符格式">6.1.3 处理分隔符格式</a></li>
        <li><a href="#614-json数据">6.1.4 JSON数据</a></li>
        <li><a href="#615-xml和htmlweb信息收集">6.1.5 XML和HTML：Web信息收集</a></li>
        <li><a href="#616-利用lxmlobjectify解析xml">6.1.6 利用lxml.objectify解析XML</a></li>
      </ul>
    </li>
    <li><a href="#62-二进制数据格式">6.2 二进制数据格式</a>
      <ul>
        <li><a href="#621-使用hdf5格式">6.2.1 使用HDF5格式</a></li>
        <li><a href="#622-读取microsoft-excel文件">6.2.2 读取Microsoft Excel文件</a></li>
      </ul>
    </li>
    <li><a href="#63-web-apis交互">6.3 Web APIs交互</a></li>
    <li><a href="#64-数据库交互">6.4 数据库交互</a></li>
    <li><a href="#65-总结">6.5 总结</a></li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <p>访问数据是使用本书所介绍的这些工具的第一步。我会着重介绍pandas的数据输入与输出，虽然别的库中也有不少以此为目的的工具。</p>
<p>输入输出通常可以划分为几个大类：读取文本文件和其他更高效的磁盘存储格式，加载数据库中的数据，利用Web API操作网络资源。</p>
<h2 id="61-读写文本格式的数据">6.1 读写文本格式的数据</h2>
<p>pandas提供了一些用于将表格型数据读取为DataFrame对象的函数。表6-1对它们进行了总结，其中read_csv和read_table可能会是你今后用得最多的。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201023230549415.png" alt="表6-1 pandas中的解析函数"></p>
<p>我将大致介绍一下这些函数在将文本数据转换为DataFrame时所用到的一些技术。这些函数的选项可以划分为以下几个大类：</p>
<ul>
<li>索引：将一个或多个列当做返回的DataFrame处理，以及是否从文件、用户获取列名。</li>
<li>类型推断和数据转换：包括用户定义值的转换、和自定义的缺失值标记列表等。</li>
<li>日期解析：包括组合功能，比如将分散在多个列中的日期时间信息组合成结果中的单个列。</li>
<li>迭代：支持对大文件进行逐块迭代。</li>
<li>不规整数据问题：跳过一些行、页脚、注释或其他一些不重要的东西（比如由成千上万个逗号隔开的数值数据）。</li>
</ul>
<p>因为工作中实际碰到的数据可能十分混乱，一些数据加载函数（尤其是read_csv）的选项逐渐变得复杂起来。面对不同的参数，感到头痛很正常（read_csv有超过50个参数）。pandas文档有这些参数的例子，如果你感到阅读某个文件很难，可以通过相似的足够多的例子找到正确的参数。</p>
<p>其中一些函数，比如pandas.read_csv，有类型推断功能，因为列数据的类型不属于数据类型。也就是说，你不需要指定列的类型到底是数值、整数、布尔值，还是字符串。其它的数据格式，如HDF5、Feather和msgpack，会在格式中存储数据类型。</p>
<p>日期和其他自定义类型的处理需要多花点工夫才行。首先我们来看一个以逗号分隔的（CSV）文本文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">8</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>ex1<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span>a,b,c,d,message
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">4</span>,hello
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>,<span style="color:#099">6</span>,<span style="color:#099">7</span>,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11</span>,<span style="color:#099">12</span>,foo
</span></span></code></pre></div><blockquote>
<p>笔记：这里，我用的是Unix的cat shell命令将文件的原始内容打印到屏幕上。如果你用的是Windows，你可以使用type达到同样的效果。</p>
</blockquote>
<p>由于该文件以逗号分隔，所以我们可以使用read_csv将其读入一个DataFrame：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">9</span>]: df <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex1.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">10</span>]: df
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">10</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>我们还可以使用read_table，并指定分隔符：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">11</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_table(<span style="color:#d14">&#39;examples/ex1.csv&#39;</span>, sep<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">11</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>并不是所有文件都有标题行。看看下面这个文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">12</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>ex2<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">4</span>,hello
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>,<span style="color:#099">6</span>,<span style="color:#099">7</span>,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11</span>,<span style="color:#099">12</span>,foo
</span></span></code></pre></div><p>读入该文件的办法有两个。你可以让pandas为其分配默认的列名，也可以自己定义列名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">13</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex2.csv&#39;</span>, header<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">None</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">13</span>]: 
</span></span><span style="display:flex;"><span>   <span style="color:#099">0</span>   <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>      <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>  hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>  world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>    foo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">14</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex2.csv&#39;</span>, names<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;message&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">14</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>假设你希望将message列做成DataFrame的索引。你可以明确表示要将该列放到索引4的位置上，也可以通过index_col参数指定&quot;message&quot;：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">15</span>]: names <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>, <span style="color:#d14">&#39;d&#39;</span>, <span style="color:#d14">&#39;message&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">16</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex2.csv&#39;</span>, names<span style="color:#000;font-weight:bold">=</span>names, index_col<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;message&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">16</span>]: 
</span></span><span style="display:flex;"><span>         a   b   c   d
</span></span><span style="display:flex;"><span>message               
</span></span><span style="display:flex;"><span>hello    <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>world    <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>foo      <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>
</span></span></code></pre></div><p>如果希望将多个列做成一个层次化索引，只需传入由列编号或列名组成的列表即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">17</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>csv_mindex<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span>key1,key2,value1,value2
</span></span><span style="display:flex;"><span>one,a,<span style="color:#099">1</span>,<span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>one,b,<span style="color:#099">3</span>,<span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>one,c,<span style="color:#099">5</span>,<span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>one,d,<span style="color:#099">7</span>,<span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>two,a,<span style="color:#099">9</span>,<span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>two,b,<span style="color:#099">11</span>,<span style="color:#099">12</span>
</span></span><span style="display:flex;"><span>two,c,<span style="color:#099">13</span>,<span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>two,d,<span style="color:#099">15</span>,<span style="color:#099">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">18</span>]: parsed <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/csv_mindex.csv&#39;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:                      index_col<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;key1&#39;</span>, <span style="color:#d14">&#39;key2&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">19</span>]: parsed
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">19</span>]: 
</span></span><span style="display:flex;"><span>           value1  value2
</span></span><span style="display:flex;"><span>key1 key2                
</span></span><span style="display:flex;"><span>one  a          <span style="color:#099">1</span>       <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>     b          <span style="color:#099">3</span>       <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>     c          <span style="color:#099">5</span>       <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span>     d          <span style="color:#099">7</span>       <span style="color:#099">8</span>
</span></span><span style="display:flex;"><span>two  a          <span style="color:#099">9</span>      <span style="color:#099">10</span>
</span></span><span style="display:flex;"><span>     b         <span style="color:#099">11</span>      <span style="color:#099">12</span>
</span></span><span style="display:flex;"><span>     c         <span style="color:#099">13</span>      <span style="color:#099">14</span>
</span></span><span style="display:flex;"><span>     d         <span style="color:#099">15</span>      <span style="color:#099">16</span>
</span></span></code></pre></div><p>有些情况下，有些表格可能不是用固定的分隔符去分隔字段的（比如空白符或其它模式）。看看下面这个文本文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">20</span>]: <span style="color:#0086b3">list</span>(<span style="color:#0086b3">open</span>(<span style="color:#d14">&#39;examples/ex3.txt&#39;</span>))
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">20</span>]: 
</span></span><span style="display:flex;"><span>[<span style="color:#d14">&#39;            A         B         C</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;aaa -0.264438 -1.026059 -0.619500</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;bbb  0.927272  0.302904 -0.032399</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;ccc -0.264273 -0.386314 -0.217601</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;ddd -0.871858 -0.348382  1.100491</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>]
</span></span></code></pre></div><p>虽然可以手动对数据进行规整，这里的字段是被数量不同的空白字符间隔开的。这种情况下，你可以传递一个正则表达式作为read_table的分隔符。可以用正则表达式表达为\s+，于是有：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">21</span>]: result <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_table(<span style="color:#d14">&#39;examples/ex3.txt&#39;</span>, sep<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;\s+&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">22</span>]: result
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">22</span>]: 
</span></span><span style="display:flex;"><span>            A         B         C
</span></span><span style="display:flex;"><span>aaa <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.264438</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.026059</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.619500</span>
</span></span><span style="display:flex;"><span>bbb  <span style="color:#099">0.927272</span>  <span style="color:#099">0.302904</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.032399</span>
</span></span><span style="display:flex;"><span>ccc <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.264273</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.386314</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.217601</span>
</span></span><span style="display:flex;"><span>ddd <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.871858</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.348382</span>  <span style="color:#099">1.100491</span>
</span></span></code></pre></div><p>这里，由于列名比数据行的数量少，所以read_table推断第一列应该是DataFrame的索引。</p>
<p>这些解析器函数还有许多参数可以帮助你处理各种各样的异形文件格式（表6-2列出了一些）。比如说，你可以用skiprows跳过文件的第一行、第三行和第四行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">23</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>ex4<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># hey!</span>
</span></span><span style="display:flex;"><span>a,b,c,d,message
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># just wanted to make things more difficult for you</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># who reads CSV files with computers, anyway?</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">4</span>,hello
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>,<span style="color:#099">6</span>,<span style="color:#099">7</span>,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11</span>,<span style="color:#099">12</span>,foo
</span></span><span style="display:flex;"><span>In [<span style="color:#099">24</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex4.csv&#39;</span>, skiprows<span style="color:#000;font-weight:bold">=</span>[<span style="color:#099">0</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">24</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>缺失值处理是文件解析任务中的一个重要组成部分。缺失数据经常是要么没有（空字符串），要么用某个标记值表示。默认情况下，pandas会用一组经常出现的标记值进行识别，比如NA及NULL：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">25</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>ex5<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span>something,a,b,c,d,message
</span></span><span style="display:flex;"><span>one,<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">4</span>,NA
</span></span><span style="display:flex;"><span>two,<span style="color:#099">5</span>,<span style="color:#099">6</span>,,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span>three,<span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11</span>,<span style="color:#099">12</span>,foo
</span></span><span style="display:flex;"><span>In [<span style="color:#099">26</span>]: result <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex5.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">27</span>]: result
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">27</span>]: 
</span></span><span style="display:flex;"><span>  something  a   b     c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>       one  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3.0</span>   <span style="color:#099">4</span>     NaN
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>       two  <span style="color:#099">5</span>   <span style="color:#099">6</span>   NaN   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>     three  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11.0</span>  <span style="color:#099">12</span>     foo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">28</span>]: pd<span style="color:#000;font-weight:bold">.</span>isnull(result)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">28</span>]: 
</span></span><span style="display:flex;"><span>   something      a      b      c      d  message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>      <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>     <span style="color:#000;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>      <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>   <span style="color:#000;font-weight:bold">True</span>  <span style="color:#000;font-weight:bold">False</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>      <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>  <span style="color:#000;font-weight:bold">False</span>    <span style="color:#000;font-weight:bold">False</span>
</span></span></code></pre></div><p>na_values可以用一个列表或集合的字符串表示缺失值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">29</span>]: result <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex5.csv&#39;</span>, na_values<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;NULL&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">30</span>]: result
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">30</span>]: 
</span></span><span style="display:flex;"><span>  something  a   b     c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>       one  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3.0</span>   <span style="color:#099">4</span>     NaN
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>       two  <span style="color:#099">5</span>   <span style="color:#099">6</span>   NaN   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>     three  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11.0</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>字典的各列可以使用不同的NA标记值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">31</span>]: sentinels <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;message&#39;</span>: [<span style="color:#d14">&#39;foo&#39;</span>, <span style="color:#d14">&#39;NA&#39;</span>], <span style="color:#d14">&#39;something&#39;</span>: [<span style="color:#d14">&#39;two&#39;</span>]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">32</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex5.csv&#39;</span>, na_values<span style="color:#000;font-weight:bold">=</span>sentinels)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">32</span>]:
</span></span><span style="display:flex;"><span>something  a   b     c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>       one  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3.0</span>   <span style="color:#099">4</span>     NaN
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>       NaN  <span style="color:#099">5</span>   <span style="color:#099">6</span>   NaN   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>     three  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11.0</span>  <span style="color:#099">12</span>     NaN
</span></span></code></pre></div><p>表6-2列出了pandas.read_csv和pandas.read_table常用的选项。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024084538674.png" alt=""></p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024084606416.png" alt=""></p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024084613844.png" alt=""></p>
<h3 id="611-逐块读取文本文件">6.1.1 逐块读取文本文件</h3>
<p>在处理很大的文件时，或找出大文件中的参数集以便于后续处理时，你可能只想读取文件的一小部分或逐块对文件进行迭代。</p>
<p>在看大文件之前，我们先设置pandas显示地更紧些：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">33</span>]: pd<span style="color:#000;font-weight:bold">.</span>options<span style="color:#000;font-weight:bold">.</span>display<span style="color:#000;font-weight:bold">.</span>max_rows <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">10</span>
</span></span></code></pre></div><p>然后有：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">34</span>]: result <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex6.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">35</span>]: result
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">35</span>]: 
</span></span><span style="display:flex;"><span>           one       two     three      four key
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>     <span style="color:#099">0.467976</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.038649</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.295344</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.824726</span>   L
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.358893</span>  <span style="color:#099">1.404453</span>  <span style="color:#099">0.704965</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.200638</span>   B
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.501840</span>  <span style="color:#099">0.659254</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.421691</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.057688</span>   G
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>     <span style="color:#099">0.204886</span>  <span style="color:#099">1.074134</span>  <span style="color:#099">1.388361</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.982404</span>   R
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>     <span style="color:#099">0.354628</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.133116</span>  <span style="color:#099">0.283763</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.837063</span>   Q
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">...</span>        <span style="color:#000;font-weight:bold">...</span>       <span style="color:#000;font-weight:bold">...</span>       <span style="color:#000;font-weight:bold">...</span>       <span style="color:#000;font-weight:bold">...</span>  <span style="color:#000;font-weight:bold">..</span>
</span></span><span style="display:flex;"><span><span style="color:#099">9995</span>  <span style="color:#099">2.311896</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.417070</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.409599</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.515821</span>   L
</span></span><span style="display:flex;"><span><span style="color:#099">9996</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.479893</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.650419</span>  <span style="color:#099">0.745152</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.646038</span>   E
</span></span><span style="display:flex;"><span><span style="color:#099">9997</span>  <span style="color:#099">0.523331</span>  <span style="color:#099">0.787112</span>  <span style="color:#099">0.486066</span>  <span style="color:#099">1.093156</span>   K
</span></span><span style="display:flex;"><span><span style="color:#099">9998</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.362559</span>  <span style="color:#099">0.598894</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.843201</span>  <span style="color:#099">0.887292</span>   G
</span></span><span style="display:flex;"><span><span style="color:#099">9999</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.096376</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.012999</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.657431</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.573315</span>   <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>[<span style="color:#099">10000</span> rows x <span style="color:#099">5</span> columns]
</span></span><span style="display:flex;"><span>If you want to only read a small
</span></span></code></pre></div><p>如果只想读取几行（避免读取整个文件），通过nrows进行指定即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">36</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex6.csv&#39;</span>, nrows<span style="color:#000;font-weight:bold">=</span><span style="color:#099">5</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">36</span>]: 
</span></span><span style="display:flex;"><span>        one       two     three      four key
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">0.467976</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.038649</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.295344</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.824726</span>   L
</span></span><span style="display:flex;"><span><span style="color:#099">1</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.358893</span>  <span style="color:#099">1.404453</span>  <span style="color:#099">0.704965</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.200638</span>   B
</span></span><span style="display:flex;"><span><span style="color:#099">2</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.501840</span>  <span style="color:#099">0.659254</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.421691</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.057688</span>   G
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">0.204886</span>  <span style="color:#099">1.074134</span>  <span style="color:#099">1.388361</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.982404</span>   R
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">0.354628</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.133116</span>  <span style="color:#099">0.283763</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.837063</span>   Q
</span></span></code></pre></div><p>要逐块读取文件，可以指定chunksize（行数）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">874</span>]: chunker <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;ch06/ex6.csv&#39;</span>, chunksize<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">875</span>]: chunker
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">875</span>]: <span style="color:#000;font-weight:bold">&lt;</span>pandas<span style="color:#000;font-weight:bold">.</span>io<span style="color:#000;font-weight:bold">.</span>parsers<span style="color:#000;font-weight:bold">.</span>TextParser at <span style="color:#099">0x8398150</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>read_csv所返回的这个TextParser对象使你可以根据chunksize对文件进行逐块迭代。比如说，我们可以迭代处理ex6.csv，将值计数聚合到&quot;key&quot;列中，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>chunker <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex6.csv&#39;</span>, chunksize<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tot <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series([])
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> piece <span style="color:#000;font-weight:bold">in</span> chunker:
</span></span><span style="display:flex;"><span>    tot <span style="color:#000;font-weight:bold">=</span> tot<span style="color:#000;font-weight:bold">.</span>add(piece[<span style="color:#d14">&#39;key&#39;</span>]<span style="color:#000;font-weight:bold">.</span>value_counts(), fill_value<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tot <span style="color:#000;font-weight:bold">=</span> tot<span style="color:#000;font-weight:bold">.</span>sort_values(ascending<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span></code></pre></div><p>然后有：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">40</span>]: tot[:<span style="color:#099">10</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">40</span>]: 
</span></span><span style="display:flex;"><span>E    <span style="color:#099">368.0</span>
</span></span><span style="display:flex;"><span>X    <span style="color:#099">364.0</span>
</span></span><span style="display:flex;"><span>L    <span style="color:#099">346.0</span>
</span></span><span style="display:flex;"><span>O    <span style="color:#099">343.0</span>
</span></span><span style="display:flex;"><span>Q    <span style="color:#099">340.0</span>
</span></span><span style="display:flex;"><span>M    <span style="color:#099">338.0</span>
</span></span><span style="display:flex;"><span>J    <span style="color:#099">337.0</span>
</span></span><span style="display:flex;"><span>F    <span style="color:#099">335.0</span>
</span></span><span style="display:flex;"><span>K    <span style="color:#099">334.0</span>
</span></span><span style="display:flex;"><span>H    <span style="color:#099">330.0</span>
</span></span><span style="display:flex;"><span>dtype: float64
</span></span></code></pre></div><p>TextParser还有一个get_chunk方法，它使你可以读取任意大小的块。</p>
<h3 id="612-将数据写出到文本格式">6.1.2 将数据写出到文本格式</h3>
<p>数据也可以被输出为<code>分隔符</code>格式的文本。我们再来看看之前读过的一个CSV文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">41</span>]: data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex5.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">42</span>]: data
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">42</span>]: 
</span></span><span style="display:flex;"><span>  something  a   b     c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>       one  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3.0</span>   <span style="color:#099">4</span>     NaN
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>       two  <span style="color:#099">5</span>   <span style="color:#099">6</span>   NaN   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>     three  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11.0</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>利用DataFrame的<code>to_csv</code>方法，我们可以将数据写到一个以<code>逗号</code>分隔的文件中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">43</span>]: data<span style="color:#000;font-weight:bold">.</span>to_csv(<span style="color:#d14">&#39;examples/out.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">44</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>out<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span>,something,a,b,c,d,message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>,one,<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3.0</span>,<span style="color:#099">4</span>,
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>,two,<span style="color:#099">5</span>,<span style="color:#099">6</span>,,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>,three,<span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11.0</span>,<span style="color:#099">12</span>,foo
</span></span></code></pre></div><p>当然，还可以使用其他分隔符（由于这里直接写出到sys.stdout，所以仅仅是打印出文本结果而已）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">45</span>]: <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">46</span>]: data<span style="color:#000;font-weight:bold">.</span>to_csv(sys<span style="color:#000;font-weight:bold">.</span>stdout, sep<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;|&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">|</span>something<span style="color:#000;font-weight:bold">|</span>a<span style="color:#000;font-weight:bold">|</span>b<span style="color:#000;font-weight:bold">|</span>c<span style="color:#000;font-weight:bold">|</span>d<span style="color:#000;font-weight:bold">|</span>message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span><span style="color:#000;font-weight:bold">|</span>one<span style="color:#000;font-weight:bold">|</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">2</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">3.0</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">4</span><span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">|</span>two<span style="color:#000;font-weight:bold">|</span><span style="color:#099">5</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">6</span><span style="color:#000;font-weight:bold">||</span><span style="color:#099">8</span><span style="color:#000;font-weight:bold">|</span>world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span><span style="color:#000;font-weight:bold">|</span>three<span style="color:#000;font-weight:bold">|</span><span style="color:#099">9</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">10</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">11.0</span><span style="color:#000;font-weight:bold">|</span><span style="color:#099">12</span><span style="color:#000;font-weight:bold">|</span>foo
</span></span></code></pre></div><p>缺失值在输出结果中会被表示为空字符串。你可能希望将其表示为别的标记值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">47</span>]: data<span style="color:#000;font-weight:bold">.</span>to_csv(sys<span style="color:#000;font-weight:bold">.</span>stdout, na_rep<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;NULL&#39;</span>)
</span></span><span style="display:flex;"><span>,something,a,b,c,d,message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>,one,<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3.0</span>,<span style="color:#099">4</span>,NULL
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>,two,<span style="color:#099">5</span>,<span style="color:#099">6</span>,NULL,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>,three,<span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11.0</span>,<span style="color:#099">12</span>,foo
</span></span></code></pre></div><p>如果没有设置其他选项，则会写出行和列的标签。当然，它们也都可以被禁用：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">48</span>]: data<span style="color:#000;font-weight:bold">.</span>to_csv(sys<span style="color:#000;font-weight:bold">.</span>stdout, index<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, header<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>one,<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3.0</span>,<span style="color:#099">4</span>,
</span></span><span style="display:flex;"><span>two,<span style="color:#099">5</span>,<span style="color:#099">6</span>,,<span style="color:#099">8</span>,world
</span></span><span style="display:flex;"><span>three,<span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11.0</span>,<span style="color:#099">12</span>,foo
</span></span></code></pre></div><p>此外，你还可以只写出一部分的列，并以你指定的顺序排列：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">49</span>]: data<span style="color:#000;font-weight:bold">.</span>to_csv(sys<span style="color:#000;font-weight:bold">.</span>stdout, index<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>, columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>])
</span></span><span style="display:flex;"><span>a,b,c
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>,<span style="color:#099">6</span>,
</span></span><span style="display:flex;"><span><span style="color:#099">9</span>,<span style="color:#099">10</span>,<span style="color:#099">11.0</span>
</span></span></code></pre></div><p>Series也有一个to_csv方法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">50</span>]: dates <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>date_range(<span style="color:#d14">&#39;1/1/2000&#39;</span>, periods<span style="color:#000;font-weight:bold">=</span><span style="color:#099">7</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">51</span>]: ts <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>Series(np<span style="color:#000;font-weight:bold">.</span>arange(<span style="color:#099">7</span>), index<span style="color:#000;font-weight:bold">=</span>dates)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">52</span>]: ts<span style="color:#000;font-weight:bold">.</span>to_csv(<span style="color:#d14">&#39;examples/tseries.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">53</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>tseries<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span>,<span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">02</span>,<span style="color:#099">1</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">03</span>,<span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">04</span>,<span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">05</span>,<span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">06</span>,<span style="color:#099">5</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">01</span><span style="color:#000;font-weight:bold">-</span><span style="color:#099">07</span>,<span style="color:#099">6</span>
</span></span></code></pre></div><h3 id="613-处理分隔符格式">6.1.3 处理分隔符格式</h3>
<p>大部分存储在磁盘上的表格型数据都能用pandas.read_table进行加载。然而，有时还是需要做一些手工处理。由于接收到含有畸形行的文件而使read_table出毛病的情况并不少见。为了说明这些基本工具，看看下面这个简单的CSV文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">54</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>ex7<span style="color:#000;font-weight:bold">.</span>csv
</span></span><span style="display:flex;"><span><span style="color:#d14">&#34;a&#34;</span>,<span style="color:#d14">&#34;b&#34;</span>,<span style="color:#d14">&#34;c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#d14">&#34;1&#34;</span>,<span style="color:#d14">&#34;2&#34;</span>,<span style="color:#d14">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#d14">&#34;1&#34;</span>,<span style="color:#d14">&#34;2&#34;</span>,<span style="color:#d14">&#34;3&#34;</span>
</span></span></code></pre></div><p>对于<strong>任何单字符分隔符文件</strong>，可以直接使用Python内置的<code>csv</code>模块。将任意已打开的文件或文件型的对象传给csv.reader：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">csv</span>
</span></span><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#39;examples/ex7.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>reader <span style="color:#000;font-weight:bold">=</span> csv<span style="color:#000;font-weight:bold">.</span>reader(f)
</span></span></code></pre></div><p>对这个reader进行迭代将会为每行产生一个元组（并移除了所有的引号）：对这个reader进行迭代将会为每行产生一个元组（并移除了所有的引号）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">56</span>]: <span style="color:#000;font-weight:bold">for</span> line <span style="color:#000;font-weight:bold">in</span> reader:
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:     <span style="color:#0086b3">print</span>(line)
</span></span><span style="display:flex;"><span>[<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#d14">&#39;b&#39;</span>, <span style="color:#d14">&#39;c&#39;</span>]
</span></span><span style="display:flex;"><span>[<span style="color:#d14">&#39;1&#39;</span>, <span style="color:#d14">&#39;2&#39;</span>, <span style="color:#d14">&#39;3&#39;</span>]
</span></span><span style="display:flex;"><span>[<span style="color:#d14">&#39;1&#39;</span>, <span style="color:#d14">&#39;2&#39;</span>, <span style="color:#d14">&#39;3&#39;</span>]
</span></span></code></pre></div><p>现在，为了使数据格式合乎要求，你需要对其做一些整理工作。我们一步一步来做。首先，读取文件到一个多行的列表中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">57</span>]: <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#39;examples/ex7.csv&#39;</span>) <span style="color:#000;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">....</span>:     lines <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>(csv<span style="color:#000;font-weight:bold">.</span>reader(f))
</span></span></code></pre></div><p>然后，我们将这些行分为<code>标题行</code>和<code>数据行</code>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">58</span>]: header, values <span style="color:#000;font-weight:bold">=</span> lines[<span style="color:#099">0</span>], lines[<span style="color:#099">1</span>:]
</span></span></code></pre></div><p>然后，我们可以用字典构造式和zip(*values)，后者将行转置为列，创建数据列的字典：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">59</span>]: data_dict <span style="color:#000;font-weight:bold">=</span> {h: v <span style="color:#000;font-weight:bold">for</span> h, v <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">zip</span>(header, <span style="color:#0086b3">zip</span>(<span style="color:#000;font-weight:bold">*</span>values))}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">60</span>]: data_dict
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">60</span>]: {<span style="color:#d14">&#39;a&#39;</span>: (<span style="color:#d14">&#39;1&#39;</span>, <span style="color:#d14">&#39;1&#39;</span>), <span style="color:#d14">&#39;b&#39;</span>: (<span style="color:#d14">&#39;2&#39;</span>, <span style="color:#d14">&#39;2&#39;</span>), <span style="color:#d14">&#39;c&#39;</span>: (<span style="color:#d14">&#39;3&#39;</span>, <span style="color:#d14">&#39;3&#39;</span>)}
</span></span></code></pre></div><p>CSV文件的形式有很多。只需定义csv.Dialect的一个子类即可定义出新格式（如专门的分隔符、字符串引用约定、行结束符等）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">my_dialect</span>(csv<span style="color:#000;font-weight:bold">.</span>Dialect):
</span></span><span style="display:flex;"><span>    lineterminator <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;</span><span style="color:#d14">\n</span><span style="color:#d14">&#39;</span>
</span></span><span style="display:flex;"><span>    delimiter <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;;&#39;</span>
</span></span><span style="display:flex;"><span>    quotechar <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&#34;&#39;</span>
</span></span><span style="display:flex;"><span>    quoting <span style="color:#000;font-weight:bold">=</span> csv<span style="color:#000;font-weight:bold">.</span>QUOTE_MINIMAL
</span></span><span style="display:flex;"><span>reader <span style="color:#000;font-weight:bold">=</span> csv<span style="color:#000;font-weight:bold">.</span>reader(f, dialect<span style="color:#000;font-weight:bold">=</span>my_dialect)
</span></span></code></pre></div><p>各个CSV语支的参数也可以用关键字的形式提供给csv.reader，而无需定义子类：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>reader <span style="color:#000;font-weight:bold">=</span> csv<span style="color:#000;font-weight:bold">.</span>reader(f, delimiter<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;|&#39;</span>)
</span></span></code></pre></div><p>可用的选项（csv.Dialect的属性）及其功能如表6-3所示。</p>
<p><img src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201024092934346.png" alt=""></p>
<blockquote>
<p>笔记：对于那些使用复杂分隔符或多字符分隔符的文件，csv模块就无能为力了。这种情况下，你就只能使用字符串的split方法或正则表达式方法re.split进行行拆分和其他整理工作了。</p>
</blockquote>
<p>要手工输出分隔符文件，你可以使用csv.writer。它接受一个已打开且可写的文件对象以及跟csv.reader相同的那些语支和格式化选项：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">open</span>(<span style="color:#d14">&#39;mydata.csv&#39;</span>, <span style="color:#d14">&#39;w&#39;</span>) <span style="color:#000;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>    writer <span style="color:#000;font-weight:bold">=</span> csv<span style="color:#000;font-weight:bold">.</span>writer(f, dialect<span style="color:#000;font-weight:bold">=</span>my_dialect)
</span></span><span style="display:flex;"><span>    writer<span style="color:#000;font-weight:bold">.</span>writerow((<span style="color:#d14">&#39;one&#39;</span>, <span style="color:#d14">&#39;two&#39;</span>, <span style="color:#d14">&#39;three&#39;</span>))
</span></span><span style="display:flex;"><span>    writer<span style="color:#000;font-weight:bold">.</span>writerow((<span style="color:#d14">&#39;1&#39;</span>, <span style="color:#d14">&#39;2&#39;</span>, <span style="color:#d14">&#39;3&#39;</span>))
</span></span><span style="display:flex;"><span>    writer<span style="color:#000;font-weight:bold">.</span>writerow((<span style="color:#d14">&#39;4&#39;</span>, <span style="color:#d14">&#39;5&#39;</span>, <span style="color:#d14">&#39;6&#39;</span>))
</span></span><span style="display:flex;"><span>    writer<span style="color:#000;font-weight:bold">.</span>writerow((<span style="color:#d14">&#39;7&#39;</span>, <span style="color:#d14">&#39;8&#39;</span>, <span style="color:#d14">&#39;9&#39;</span>))
</span></span></code></pre></div><h3 id="614-json数据">6.1.4 JSON数据</h3>
<p>JSON（JavaScript Object Notation的简称）已经成为通过HTTP请求在Web浏览器和其他应用程序之间发送数据的标准格式之一。它是一种比表格型文本格式（如CSV）灵活得多的数据格式。下面是一个例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>obj <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">{&#34;name&#34;: &#34;Wes&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#d14"> &#34;places_lived&#34;: [&#34;United States&#34;, &#34;Spain&#34;, &#34;Germany&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#d14"> &#34;pet&#34;: null,
</span></span></span><span style="display:flex;"><span><span style="color:#d14"> &#34;siblings&#34;: [{&#34;name&#34;: &#34;Scott&#34;, &#34;age&#34;: 30, &#34;pets&#34;: [&#34;Zeus&#34;, &#34;Zuko&#34;]},
</span></span></span><span style="display:flex;"><span><span style="color:#d14">              {&#34;name&#34;: &#34;Katie&#34;, &#34;age&#34;: 38,
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               &#34;pets&#34;: [&#34;Sixes&#34;, &#34;Stache&#34;, &#34;Cisco&#34;]}]
</span></span></span><span style="display:flex;"><span><span style="color:#d14">}
</span></span></span><span style="display:flex;"><span><span style="color:#d14">&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>除其空值null和一些其他的细微差别（如列表末尾不允许存在多余的逗号）之外，JSON非常接近于有效的Python代码。基本类型有对象（字典）、数组（列表）、字符串、数值、布尔值以及null。对象中所有的键都必须是字符串。许多Python库都可以读写JSON数据。我将使用json，因为它是构建于Python标准库中的。通过<code>json.loads</code>即可将JSON字符串转换成Python形式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">62</span>]: <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">json</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">63</span>]: result <span style="color:#000;font-weight:bold">=</span> json<span style="color:#000;font-weight:bold">.</span>loads(obj)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">64</span>]: result
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">64</span>]: 
</span></span><span style="display:flex;"><span>{<span style="color:#d14">&#39;name&#39;</span>: <span style="color:#d14">&#39;Wes&#39;</span>,
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;pet&#39;</span>: <span style="color:#000;font-weight:bold">None</span>,
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;places_lived&#39;</span>: [<span style="color:#d14">&#39;United States&#39;</span>, <span style="color:#d14">&#39;Spain&#39;</span>, <span style="color:#d14">&#39;Germany&#39;</span>],
</span></span><span style="display:flex;"><span> <span style="color:#d14">&#39;siblings&#39;</span>: [{<span style="color:#d14">&#39;age&#39;</span>: <span style="color:#099">30</span>, <span style="color:#d14">&#39;name&#39;</span>: <span style="color:#d14">&#39;Scott&#39;</span>, <span style="color:#d14">&#39;pets&#39;</span>: [<span style="color:#d14">&#39;Zeus&#39;</span>, <span style="color:#d14">&#39;Zuko&#39;</span>]},
</span></span><span style="display:flex;"><span>  {<span style="color:#d14">&#39;age&#39;</span>: <span style="color:#099">38</span>, <span style="color:#d14">&#39;name&#39;</span>: <span style="color:#d14">&#39;Katie&#39;</span>, <span style="color:#d14">&#39;pets&#39;</span>: [<span style="color:#d14">&#39;Sixes&#39;</span>, <span style="color:#d14">&#39;Stache&#39;</span>, <span style="color:#d14">&#39;Cisco&#39;</span>]}]}
</span></span></code></pre></div><p>json.dumps则将Python对象转换成JSON格式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">65</span>]: asjson <span style="color:#000;font-weight:bold">=</span> json<span style="color:#000;font-weight:bold">.</span>dumps(result)
</span></span></code></pre></div><p>如何将（一个或一组）JSON对象转换为DataFrame或其他便于分析的数据结构就由你决定了。最简单方便的方式是：向DataFrame构造器传入一个字典的列表（就是原先的JSON对象），并选取数据字段的子集：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">66</span>]: siblings <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(result[<span style="color:#d14">&#39;siblings&#39;</span>], columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;name&#39;</span>, <span style="color:#d14">&#39;age&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">67</span>]: siblings
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">67</span>]: 
</span></span><span style="display:flex;"><span>    name  age
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  Scott   <span style="color:#099">30</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  Katie   <span style="color:#099">38</span>
</span></span></code></pre></div><p>pandas.read_json可以自动将特别格式的JSON数据集转换为Series或DataFrame。例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">68</span>]: <span style="color:#a61717;background-color:#e3d2d2">!</span>cat examples<span style="color:#000;font-weight:bold">/</span>example<span style="color:#000;font-weight:bold">.</span>json
</span></span><span style="display:flex;"><span>[{<span style="color:#d14">&#34;a&#34;</span>: <span style="color:#099">1</span>, <span style="color:#d14">&#34;b&#34;</span>: <span style="color:#099">2</span>, <span style="color:#d14">&#34;c&#34;</span>: <span style="color:#099">3</span>},
</span></span><span style="display:flex;"><span> {<span style="color:#d14">&#34;a&#34;</span>: <span style="color:#099">4</span>, <span style="color:#d14">&#34;b&#34;</span>: <span style="color:#099">5</span>, <span style="color:#d14">&#34;c&#34;</span>: <span style="color:#099">6</span>},
</span></span><span style="display:flex;"><span> {<span style="color:#d14">&#34;a&#34;</span>: <span style="color:#099">7</span>, <span style="color:#d14">&#34;b&#34;</span>: <span style="color:#099">8</span>, <span style="color:#d14">&#34;c&#34;</span>: <span style="color:#099">9</span>}]
</span></span></code></pre></div><p>pandas.read_json的默认选项假设JSON数组中的每个对象是表格中的一行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">69</span>]: data <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_json(<span style="color:#d14">&#39;examples/example.json&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">70</span>]: data
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">70</span>]: 
</span></span><span style="display:flex;"><span>   a  b  c
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>  <span style="color:#099">2</span>  <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">4</span>  <span style="color:#099">5</span>  <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">7</span>  <span style="color:#099">8</span>  <span style="color:#099">9</span>
</span></span></code></pre></div><p>第7章中关于USDA Food Database的那个例子进一步讲解了JSON数据的读取和处理（包括嵌套记录）。</p>
<p>如果你需要将数据从pandas输出到JSON，可以使用to_json方法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">71</span>]: <span style="color:#0086b3">print</span>(data<span style="color:#000;font-weight:bold">.</span>to_json())
</span></span><span style="display:flex;"><span>{<span style="color:#d14">&#34;a&#34;</span>:{<span style="color:#d14">&#34;0&#34;</span>:<span style="color:#099">1</span>,<span style="color:#d14">&#34;1&#34;</span>:<span style="color:#099">4</span>,<span style="color:#d14">&#34;2&#34;</span>:<span style="color:#099">7</span>},<span style="color:#d14">&#34;b&#34;</span>:{<span style="color:#d14">&#34;0&#34;</span>:<span style="color:#099">2</span>,<span style="color:#d14">&#34;1&#34;</span>:<span style="color:#099">5</span>,<span style="color:#d14">&#34;2&#34;</span>:<span style="color:#099">8</span>},<span style="color:#d14">&#34;c&#34;</span>:{<span style="color:#d14">&#34;0&#34;</span>:<span style="color:#099">3</span>,<span style="color:#d14">&#34;1&#34;</span>:<span style="color:#099">6</span>,<span style="color:#d14">&#34;2&#34;</span>:<span style="color:#099">9</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">72</span>]: <span style="color:#0086b3">print</span>(data<span style="color:#000;font-weight:bold">.</span>to_json(orient<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;records&#39;</span>))
</span></span><span style="display:flex;"><span>[{<span style="color:#d14">&#34;a&#34;</span>:<span style="color:#099">1</span>,<span style="color:#d14">&#34;b&#34;</span>:<span style="color:#099">2</span>,<span style="color:#d14">&#34;c&#34;</span>:<span style="color:#099">3</span>},{<span style="color:#d14">&#34;a&#34;</span>:<span style="color:#099">4</span>,<span style="color:#d14">&#34;b&#34;</span>:<span style="color:#099">5</span>,<span style="color:#d14">&#34;c&#34;</span>:<span style="color:#099">6</span>},{<span style="color:#d14">&#34;a&#34;</span>:<span style="color:#099">7</span>,<span style="color:#d14">&#34;b&#34;</span>:<span style="color:#099">8</span>,<span style="color:#d14">&#34;c&#34;</span>:<span style="color:#099">9</span>}]
</span></span></code></pre></div><h3 id="615-xml和htmlweb信息收集">6.1.5 XML和HTML：Web信息收集</h3>
<p>Python有许多可以读写常见的HTML和XML格式数据的库，包括lxml、Beautiful Soup和html5lib。lxml的速度比较快，但其它的库处理有误的HTML或XML文件更好。</p>
<p>pandas有一个内置的功能，read_html，它可以使用lxml和Beautiful Soup自动将HTML文件中的表格解析为DataFrame对象。为了进行展示，我从美国联邦存款保险公司下载了一个HTML文件（pandas文档中也使用过），它记录了银行倒闭的情况。首先，你需要安装read_html用到的库：</p>
<pre tabindex="0"><code>conda install lxml
pip install beautifulsoup4 html5lib
</code></pre><p>如果你用的不是conda，可以使用<code>pip install lxml</code>。</p>
<p>pandas.read_html有一些选项，默认条件下，它会搜索、尝试解析<table>标签内的的表格数据。结果是一个列表的DataFrame对象：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">73</span>]: tables <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_html(<span style="color:#d14">&#39;examples/fdic_failed_bank_list.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">74</span>]: <span style="color:#0086b3">len</span>(tables)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">74</span>]: <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">75</span>]: failures <span style="color:#000;font-weight:bold">=</span> tables[<span style="color:#099">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">76</span>]: failures<span style="color:#000;font-weight:bold">.</span>head()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">76</span>]: 
</span></span><span style="display:flex;"><span>                      Bank Name             City  ST   CERT  \
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>                   Allied Bank         Mulberry  AR     <span style="color:#099">91</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  The Woodbury Banking Company         Woodbury  GA  <span style="color:#099">11297</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>        First CornerStone Bank  King of Prussia  PA  <span style="color:#099">35312</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>            Trust Company Bank          Memphis  TN   <span style="color:#099">9956</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>    North Milwaukee State Bank        Milwaukee  WI  <span style="color:#099">20364</span>   
</span></span><span style="display:flex;"><span>                 Acquiring Institution        Closing Date       Updated Date  
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>                         Today<span style="color:#d14">&#39;s Bank  September 23, 2016  November 17, 2016  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>                          United Bank     August <span style="color:#099">19</span>, <span style="color:#099">2016</span>  November <span style="color:#099">17</span>, <span style="color:#099">2016</span>  
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  First<span style="color:#000;font-weight:bold">-</span>Citizens Bank <span style="color:#000;font-weight:bold">&amp;</span> Trust Company         May <span style="color:#099">6</span>, <span style="color:#099">2016</span>  September <span style="color:#099">6</span>, <span style="color:#099">2016</span>  
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>           The Bank of Fayette County      April <span style="color:#099">29</span>, <span style="color:#099">2016</span>  September <span style="color:#099">6</span>, <span style="color:#099">2016</span>  
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  First<span style="color:#000;font-weight:bold">-</span>Citizens Bank <span style="color:#000;font-weight:bold">&amp;</span> Trust Company      March <span style="color:#099">11</span>, <span style="color:#099">2016</span>      June <span style="color:#099">16</span>, <span style="color:#099">2016</span>
</span></span></code></pre></div><p>因为failures有许多列，pandas插入了一个换行符\。</p>
<p>这里，我们可以做一些数据清洗和分析（后面章节会进一步讲解），比如计算按年份计算倒闭的银行数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">77</span>]: close_timestamps <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>to_datetime(failures[<span style="color:#d14">&#39;Closing Date&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">78</span>]: close_timestamps<span style="color:#000;font-weight:bold">.</span>dt<span style="color:#000;font-weight:bold">.</span>year<span style="color:#000;font-weight:bold">.</span>value_counts()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">78</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#099">2010</span>    <span style="color:#099">157</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2009</span>    <span style="color:#099">140</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2011</span>     <span style="color:#099">92</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2012</span>     <span style="color:#099">51</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2008</span>     <span style="color:#099">25</span>
</span></span><span style="display:flex;"><span>       <span style="color:#000;font-weight:bold">...</span> 
</span></span><span style="display:flex;"><span><span style="color:#099">2004</span>      <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2001</span>      <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2007</span>      <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2003</span>      <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2000</span>      <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>Name: Closing Date, Length: <span style="color:#099">15</span>, dtype: int64
</span></span></code></pre></div><h3 id="616-利用lxmlobjectify解析xml">6.1.6 利用lxml.objectify解析XML</h3>
<p>XML（Extensible Markup Language）是另一种常见的支持分层、嵌套数据以及元数据的结构化数据格式。本书所使用的这些文件实际上来自于一个很大的XML文档。</p>
<p>前面，我介绍了pandas.read_html函数，它可以使用lxml或Beautiful Soup从HTML解析数据。XML和HTML的结构很相似，但XML更为通用。这里，我会用一个例子演示如何利用lxml从XML格式解析数据。</p>
<p>纽约大都会运输署发布了一些有关其公交和列车服务的数据资料（http://www.mta.info/developers/download.html）。这里，我们将看看包含在一组XML文件中的运行情况数据。每项列车或公交服务都有各自的文件（如Metro-North Railroad的文件是Performance_MNR.xml），其中每条XML记录就是一条月度数据，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;INDICATOR&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;INDICATOR_SEQ&gt;</span>373889<span style="color:#000080">&lt;/INDICATOR_SEQ&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;PARENT_SEQ&gt;&lt;/PARENT_SEQ&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;AGENCY_NAME&gt;</span>Metro-North Railroad<span style="color:#000080">&lt;/AGENCY_NAME&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;INDICATOR_NAME&gt;</span>Escalator Availability<span style="color:#000080">&lt;/INDICATOR_NAME&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;DESCRIPTION&gt;</span>Percent of the time that escalators are operational
</span></span><span style="display:flex;"><span>  systemwide. The availability rate is based on physical observations performed
</span></span><span style="display:flex;"><span>  the morning of regular business days only. This is a new indicator the agency
</span></span><span style="display:flex;"><span>  began reporting in 2009.<span style="color:#000080">&lt;/DESCRIPTION&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;PERIOD_YEAR&gt;</span>2011<span style="color:#000080">&lt;/PERIOD_YEAR&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;PERIOD_MONTH&gt;</span>12<span style="color:#000080">&lt;/PERIOD_MONTH&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;CATEGORY&gt;</span>Service Indicators<span style="color:#000080">&lt;/CATEGORY&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;FREQUENCY&gt;</span>M<span style="color:#000080">&lt;/FREQUENCY&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;DESIRED_CHANGE&gt;</span>U<span style="color:#000080">&lt;/DESIRED_CHANGE&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;INDICATOR_UNIT&gt;</span>%<span style="color:#000080">&lt;/INDICATOR_UNIT&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;DECIMAL_PLACES&gt;</span>1<span style="color:#000080">&lt;/DECIMAL_PLACES&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;YTD_TARGET&gt;</span>97.00<span style="color:#000080">&lt;/YTD_TARGET&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;YTD_ACTUAL&gt;&lt;/YTD_ACTUAL&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;MONTHLY_TARGET&gt;</span>97.00<span style="color:#000080">&lt;/MONTHLY_TARGET&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;MONTHLY_ACTUAL&gt;&lt;/MONTHLY_ACTUAL&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/INDICATOR&gt;</span>
</span></span></code></pre></div><p>我们先用lxml.objectify解析该文件，然后通过getroot得到该XML文件的根节点的引用：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">lxml</span> <span style="color:#000;font-weight:bold">import</span> objectify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>path <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;datasets/mta_perf/Performance_MNR.xml&#39;</span>
</span></span><span style="display:flex;"><span>parsed <span style="color:#000;font-weight:bold">=</span> objectify<span style="color:#000;font-weight:bold">.</span>parse(<span style="color:#0086b3">open</span>(path))
</span></span><span style="display:flex;"><span>root <span style="color:#000;font-weight:bold">=</span> parsed<span style="color:#000;font-weight:bold">.</span>getroot()
</span></span></code></pre></div><p>root.INDICATOR返回一个用于产生各个<INDICATOR>XML元素的生成器。对于每条记录，我们可以用标记名（如YTD_ACTUAL）和数据值填充一个字典（排除几个标记）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>data <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>skip_fields <span style="color:#000;font-weight:bold">=</span> [<span style="color:#d14">&#39;PARENT_SEQ&#39;</span>, <span style="color:#d14">&#39;INDICATOR_SEQ&#39;</span>,
</span></span><span style="display:flex;"><span>               <span style="color:#d14">&#39;DESIRED_CHANGE&#39;</span>, <span style="color:#d14">&#39;DECIMAL_PLACES&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> elt <span style="color:#000;font-weight:bold">in</span> root<span style="color:#000;font-weight:bold">.</span>INDICATOR:
</span></span><span style="display:flex;"><span>    el_data <span style="color:#000;font-weight:bold">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> child <span style="color:#000;font-weight:bold">in</span> elt<span style="color:#000;font-weight:bold">.</span>getchildren():
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> child<span style="color:#000;font-weight:bold">.</span>tag <span style="color:#000;font-weight:bold">in</span> skip_fields:
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>        el_data[child<span style="color:#000;font-weight:bold">.</span>tag] <span style="color:#000;font-weight:bold">=</span> child<span style="color:#000;font-weight:bold">.</span>pyval
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span>append(el_data)
</span></span></code></pre></div><p>最后，将这组字典转换为一个DataFrame：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">81</span>]: perf <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">82</span>]: perf<span style="color:#000;font-weight:bold">.</span>head()
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">82</span>]:
</span></span><span style="display:flex;"><span>Empty DataFrame
</span></span><span style="display:flex;"><span>Columns: []
</span></span><span style="display:flex;"><span>Index: []
</span></span></code></pre></div><p>XML数据可以比本例复杂得多。每个标记都可以有元数据。看看下面这个HTML的链接标签（它也算是一段有效的XML）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">io</span> <span style="color:#000;font-weight:bold">import</span> StringIO
</span></span><span style="display:flex;"><span>tag <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;&lt;a href=&#34;http://www.google.com&#34;&gt;Google&lt;/a&gt;&#39;</span>
</span></span><span style="display:flex;"><span>root <span style="color:#000;font-weight:bold">=</span> objectify<span style="color:#000;font-weight:bold">.</span>parse(StringIO(tag))<span style="color:#000;font-weight:bold">.</span>getroot()
</span></span></code></pre></div><p>现在就可以访问标签或链接文本中的任何字段了（如href）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">84</span>]: root
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">84</span>]: <span style="color:#000;font-weight:bold">&lt;</span>Element a at <span style="color:#099">0x7f6b15817748</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">85</span>]: root<span style="color:#000;font-weight:bold">.</span>get(<span style="color:#d14">&#39;href&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">85</span>]: <span style="color:#d14">&#39;http://www.google.com&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">86</span>]: root<span style="color:#000;font-weight:bold">.</span>text
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">86</span>]: <span style="color:#d14">&#39;Google&#39;</span>
</span></span></code></pre></div><h2 id="62-二进制数据格式">6.2 二进制数据格式</h2>
<p>实现数据的高效二进制格式存储最简单的办法之一是使用Python内置的pickle序列化。pandas对象都有一个用于将数据以pickle格式保存到磁盘上的to_pickle方法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">87</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_csv(<span style="color:#d14">&#39;examples/ex1.csv&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">88</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">88</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">89</span>]: frame<span style="color:#000;font-weight:bold">.</span>to_pickle(<span style="color:#d14">&#39;examples/frame_pickle&#39;</span>)
</span></span></code></pre></div><p>你可以通过pickle直接读取被pickle化的数据，或是使用更为方便的pandas.read_pickle：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">90</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_pickle(<span style="color:#d14">&#39;examples/frame_pickle&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">90</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><blockquote>
<p>注意：pickle仅建议用于短期存储格式。其原因是很难保证该格式永远是稳定的；今天pickle的对象可能无法被后续版本的库unpickle出来。虽然我尽力保证这种事情不会发生在pandas中，但是今后的某个时候说不定还是得“打破”该pickle格式。</p>
</blockquote>
<p>pandas内置支持两个二进制数据格式：HDF5和MessagePack。下一节，我会给出几个HDF5的例子，但我建议你尝试下不同的文件格式，看看它们的速度以及是否适合你的分析工作。pandas或NumPy数据的其它存储格式有：</p>
<ul>
<li>bcolz：一种可压缩的列存储二进制格式，基于Blosc压缩库。</li>
<li>Feather：我与R语言社区的Hadley Wickham设计的一种跨语言的列存储文件格式。Feather使用了Apache Arrow的列式内存格式。</li>
</ul>
<h3 id="621-使用hdf5格式">6.2.1 使用HDF5格式</h3>
<p>HDF5是一种存储大规模科学数组数据的非常好的文件格式。它可以被作为C标准库，带有许多语言的接口，如Java、Python和MATLAB等。HDF5中的HDF指的是层次型数据格式（hierarchical data format）。每个HDF5文件都含有一个文件系统式的节点结构，它使你能够存储多个数据集并支持元数据。与其他简单格式相比，HDF5支持多种压缩器的即时压缩，还能更高效地存储重复模式数据。对于那些非常大的无法直接放入内存的数据集，HDF5就是不错的选择，因为它可以高效地分块读写。</p>
<p>虽然可以用PyTables或h5py库直接访问HDF5文件，pandas提供了更为高级的接口，可以简化存储Series和DataFrame对象。HDFStore类可以像字典一样，处理低级的细节：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">92</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame({<span style="color:#d14">&#39;a&#39;</span>: np<span style="color:#000;font-weight:bold">.</span>random<span style="color:#000;font-weight:bold">.</span>randn(<span style="color:#099">100</span>)})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">93</span>]: store <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>HDFStore(<span style="color:#d14">&#39;mydata.h5&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">94</span>]: store[<span style="color:#d14">&#39;obj1&#39;</span>] <span style="color:#000;font-weight:bold">=</span> frame
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">95</span>]: store[<span style="color:#d14">&#39;obj1_col&#39;</span>] <span style="color:#000;font-weight:bold">=</span> frame[<span style="color:#d14">&#39;a&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">96</span>]: store
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">96</span>]: 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">class</span> <span style="color:#a61717;background-color:#e3d2d2">&#39;</span><span style="color:#458;font-weight:bold">pandas</span><span style="color:#000;font-weight:bold">.</span>io<span style="color:#000;font-weight:bold">.</span>pytables<span style="color:#000;font-weight:bold">.</span>HDFStore<span style="color:#d14">&#39;&gt;</span>
</span></span><span style="display:flex;"><span>File path: mydata<span style="color:#000;font-weight:bold">.</span>h5
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">/</span>obj1                frame        (shape<span style="color:#000;font-weight:bold">-&gt;</span>[<span style="color:#099">100</span>,<span style="color:#099">1</span>])                               
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">/</span>obj1_col            series       (shape<span style="color:#000;font-weight:bold">-&gt;</span>[<span style="color:#099">100</span>])                                 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">/</span>obj2                frame_table  (typ<span style="color:#000;font-weight:bold">-&gt;</span>appendable,nrows<span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#099">100</span>,ncols<span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#099">1</span>,indexers<span style="color:#000;font-weight:bold">-&gt;</span>
</span></span><span style="display:flex;"><span>[index])
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">/</span>obj3                frame_table  (typ<span style="color:#000;font-weight:bold">-&gt;</span>appendable,nrows<span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#099">100</span>,ncols<span style="color:#000;font-weight:bold">-&gt;</span><span style="color:#099">1</span>,indexers<span style="color:#000;font-weight:bold">-&gt;</span>
</span></span><span style="display:flex;"><span>[index])
</span></span></code></pre></div><p>HDF5文件中的对象可以通过与字典一样的API进行获取：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">97</span>]: store[<span style="color:#d14">&#39;obj1&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">97</span>]: 
</span></span><span style="display:flex;"><span>           a
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.204708</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>   <span style="color:#099">0.478943</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.519439</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.555730</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>   <span style="color:#099">1.965781</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">..</span>       <span style="color:#000;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span><span style="color:#099">95</span>  <span style="color:#099">0.795253</span>
</span></span><span style="display:flex;"><span><span style="color:#099">96</span>  <span style="color:#099">0.118110</span>
</span></span><span style="display:flex;"><span><span style="color:#099">97</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.748532</span>
</span></span><span style="display:flex;"><span><span style="color:#099">98</span>  <span style="color:#099">0.584970</span>
</span></span><span style="display:flex;"><span><span style="color:#099">99</span>  <span style="color:#099">0.152677</span>
</span></span><span style="display:flex;"><span>[<span style="color:#099">100</span> rows x <span style="color:#099">1</span> columns]
</span></span></code></pre></div><p>HDFStore支持两种存储模式，&lsquo;fixed&rsquo;和&rsquo;table&rsquo;。后者通常会更慢，但是支持使用特殊语法进行查询操作：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">98</span>]: store<span style="color:#000;font-weight:bold">.</span>put(<span style="color:#d14">&#39;obj2&#39;</span>, frame, <span style="color:#0086b3">format</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">99</span>]: store<span style="color:#000;font-weight:bold">.</span>select(<span style="color:#d14">&#39;obj2&#39;</span>, where<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;index &gt;= 10 and index &lt;= 15&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">99</span>]: 
</span></span><span style="display:flex;"><span>           a
</span></span><span style="display:flex;"><span><span style="color:#099">10</span>  <span style="color:#099">1.007189</span>
</span></span><span style="display:flex;"><span><span style="color:#099">11</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1.296221</span>
</span></span><span style="display:flex;"><span><span style="color:#099">12</span>  <span style="color:#099">0.274992</span>
</span></span><span style="display:flex;"><span><span style="color:#099">13</span>  <span style="color:#099">0.228913</span>
</span></span><span style="display:flex;"><span><span style="color:#099">14</span>  <span style="color:#099">1.352917</span>
</span></span><span style="display:flex;"><span><span style="color:#099">15</span>  <span style="color:#099">0.886429</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">100</span>]: store<span style="color:#000;font-weight:bold">.</span>close()
</span></span></code></pre></div><p>put是store[&lsquo;obj2&rsquo;] = frame方法的显示版本，允许我们设置其它的选项，比如格式。</p>
<p>pandas.read_hdf函数可以快捷使用这些工具：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">101</span>]: frame<span style="color:#000;font-weight:bold">.</span>to_hdf(<span style="color:#d14">&#39;mydata.h5&#39;</span>, <span style="color:#d14">&#39;obj3&#39;</span>, <span style="color:#0086b3">format</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">102</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_hdf(<span style="color:#d14">&#39;mydata.h5&#39;</span>, <span style="color:#d14">&#39;obj3&#39;</span>, where<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;index &lt; 5&#39;</span>])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">102</span>]: 
</span></span><span style="display:flex;"><span>          a
</span></span><span style="display:flex;"><span><span style="color:#099">0</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.204708</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">0.478943</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.519439</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.555730</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">1.965781</span>
</span></span></code></pre></div><blockquote>
<p>笔记：如果你要处理的数据位于远程服务器，比如Amazon S3或HDFS，使用专门为分布式存储（比如Apache Parquet）的二进制格式也许更加合适。Python的Parquet和其它存储格式还在不断的发展之中，所以这本书中没有涉及。</p>
</blockquote>
<p>如果需要本地处理海量数据，我建议你好好研究一下PyTables和h5py，看看它们能满足你的哪些需求。。由于许多数据分析问题都是IO密集型（而不是CPU密集型），利用HDF5这样的工具能显著提升应用程序的效率。</p>
<blockquote>
<p>注意：HDF5不是数据库。它最适合用作“一次写多次读”的数据集。虽然数据可以在任何时候被添加到文件中，但如果同时发生多个写操作，文件就可能会被破坏。</p>
</blockquote>
<h3 id="622-读取microsoft-excel文件">6.2.2 读取Microsoft Excel文件</h3>
<p>pandas的ExcelFile类或pandas.read_excel函数支持读取存储在Excel 2003（或更高版本）中的表格型数据。这两个工具分别使用扩展包xlrd和openpyxl读取XLS和XLSX文件。你可以用pip或conda安装它们。</p>
<p>要使用ExcelFile，通过传递xls或xlsx路径创建一个实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">104</span>]: xlsx <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>ExcelFile(<span style="color:#d14">&#39;examples/ex1.xlsx&#39;</span>)
</span></span></code></pre></div><p>存储在表单中的数据可以read_excel读取到DataFrame（原书这里写的是用parse解析，但代码中用的是read_excel，是个笔误：只换了代码，没有改文字）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">105</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_excel(xlsx, <span style="color:#d14">&#39;Sheet1&#39;</span>)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">105</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>如果要读取一个文件中的多个表单，创建ExcelFile会更快，但你也可以将文件名传递到pandas.read_excel：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">106</span>]: frame <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>read_excel(<span style="color:#d14">&#39;examples/ex1.xlsx&#39;</span>, <span style="color:#d14">&#39;Sheet1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">107</span>]: frame
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">107</span>]: 
</span></span><span style="display:flex;"><span>   a   b   c   d message
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>  <span style="color:#099">1</span>   <span style="color:#099">2</span>   <span style="color:#099">3</span>   <span style="color:#099">4</span>   hello
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">5</span>   <span style="color:#099">6</span>   <span style="color:#099">7</span>   <span style="color:#099">8</span>   world
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">9</span>  <span style="color:#099">10</span>  <span style="color:#099">11</span>  <span style="color:#099">12</span>     foo
</span></span></code></pre></div><p>如果要将pandas数据写入为Excel格式，你必须首先创建一个ExcelWriter，然后使用pandas对象的to_excel方法将数据写入到其中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">108</span>]: writer <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>ExcelWriter(<span style="color:#d14">&#39;examples/ex2.xlsx&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">109</span>]: frame<span style="color:#000;font-weight:bold">.</span>to_excel(writer, <span style="color:#d14">&#39;Sheet1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">110</span>]: writer<span style="color:#000;font-weight:bold">.</span>save()
</span></span></code></pre></div><p>你还可以不使用ExcelWriter，而是传递文件的路径到to_excel：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">111</span>]: frame<span style="color:#000;font-weight:bold">.</span>to_excel(<span style="color:#d14">&#39;examples/ex2.xlsx&#39;</span>)
</span></span></code></pre></div><h2 id="63-web-apis交互">6.3 Web APIs交互</h2>
<p>许多网站都有一些通过JSON或其他格式提供数据的公共API。通过Python访问这些API的办法有不少。一个简单易用的办法（推荐）是requests包（http://docs.python-requests.org）。</p>
<p>为了搜索最新的30个GitHub上的pandas主题，我们可以发一个HTTP GET请求，使用requests扩展库：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">113</span>]: <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">114</span>]: url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;https://api.github.com/repos/pandas-dev/pandas/issues&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">115</span>]: resp <span style="color:#000;font-weight:bold">=</span> requests<span style="color:#000;font-weight:bold">.</span>get(url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">116</span>]: resp
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">116</span>]: <span style="color:#000;font-weight:bold">&lt;</span>Response [<span style="color:#099">200</span>]<span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>响应对象的json方法会返回一个包含被解析过的JSON字典，加载到一个Python对象中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">117</span>]: data <span style="color:#000;font-weight:bold">=</span> resp<span style="color:#000;font-weight:bold">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">118</span>]: data[<span style="color:#099">0</span>][<span style="color:#d14">&#39;title&#39;</span>]
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">118</span>]: <span style="color:#d14">&#39;Period does not round down for frequencies less that 1 hour&#39;</span>
</span></span></code></pre></div><p>data中的每个元素都是一个包含所有GitHub主题页数据（不包含评论）的字典。我们可以直接传递数据到DataFrame，并提取感兴趣的字段：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">119</span>]: issues <span style="color:#000;font-weight:bold">=</span> pd<span style="color:#000;font-weight:bold">.</span>DataFrame(data, columns<span style="color:#000;font-weight:bold">=</span>[<span style="color:#d14">&#39;number&#39;</span>, <span style="color:#d14">&#39;title&#39;</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:                                      <span style="color:#d14">&#39;labels&#39;</span>, <span style="color:#d14">&#39;state&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">120</span>]: issues
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">120</span>]:
</span></span><span style="display:flex;"><span>    number                                              title  \
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>    <span style="color:#099">17666</span>  Period does <span style="color:#000;font-weight:bold">not</span> <span style="color:#0086b3">round</span> down <span style="color:#000;font-weight:bold">for</span> frequencies les<span style="color:#000;font-weight:bold">...</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>    <span style="color:#099">17665</span>           DOC: improve docstring of function where   
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>    <span style="color:#099">17664</span>               COMPAT: skip <span style="color:#099">32</span><span style="color:#000;font-weight:bold">-</span>bit test on <span style="color:#0086b3">int</span> <span style="color:#0086b3">repr</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>    <span style="color:#099">17662</span>                          implement Delegator <span style="color:#000;font-weight:bold">class</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">4    17654  </span><span style="color:#458;font-weight:bold">BUG</span>: Fix series rename called <span style="color:#000;font-weight:bold">with</span> <span style="color:#0086b3">str</span> alterin<span style="color:#000;font-weight:bold">...</span>   
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">..</span>     <span style="color:#000;font-weight:bold">...</span>                                                <span style="color:#000;font-weight:bold">...</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">25</span>   <span style="color:#099">17603</span>  BUG: Correctly localize naive datetime strings<span style="color:#000;font-weight:bold">...</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">26</span>   <span style="color:#099">17599</span>                     core<span style="color:#000;font-weight:bold">.</span>dtypes<span style="color:#000;font-weight:bold">.</span>generic <span style="color:#000;font-weight:bold">--&gt;</span> cython   
</span></span><span style="display:flex;"><span><span style="color:#099">27</span>   <span style="color:#099">17596</span>   Merge cdate_range functionality into bdate_range   
</span></span><span style="display:flex;"><span><span style="color:#099">28</span>   <span style="color:#099">17587</span>  Time Grouper bug fix when applied <span style="color:#000;font-weight:bold">for</span> <span style="color:#0086b3">list</span> gro<span style="color:#000;font-weight:bold">...</span>   
</span></span><span style="display:flex;"><span><span style="color:#099">29</span>   <span style="color:#099">17583</span>  BUG: fix tz<span style="color:#000;font-weight:bold">-</span>aware DatetimeIndex <span style="color:#000;font-weight:bold">+</span> TimedeltaInd<span style="color:#000;font-weight:bold">...</span>   
</span></span><span style="display:flex;"><span>                                               labels state  
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>                                                  []  <span style="color:#0086b3">open</span>  
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>   [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">134699</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.com...  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>   [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">563047854</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github....  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>                                                  []  <span style="color:#0086b3">open</span>  
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>   [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">76811</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.com/...  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">..</span>                                                <span style="color:#000;font-weight:bold">...</span>   <span style="color:#000;font-weight:bold">...</span>  
</span></span><span style="display:flex;"><span><span style="color:#099">25</span>  [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">76811</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.com/...  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">26</span>  [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">49094459</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.c...  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">27</span>  [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">35818298</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.c...  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">28</span>  [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">233160</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.com...  open  </span>
</span></span><span style="display:flex;"><span><span style="color:#099">29</span>  [{<span style="color:#d14">&#39;id&#39;</span>: <span style="color:#099">76811</span>, <span style="color:#d14">&#39;url&#39;</span>: <span style="color:#d14">&#39;https://api.github.com/...  open  </span>
</span></span><span style="display:flex;"><span>[<span style="color:#099">30</span> rows x <span style="color:#099">4</span> columns]
</span></span></code></pre></div><p>花费一些精力，你就可以创建一些更高级的常见的Web API的接口，返回DataFrame对象，方便进行分析。</p>
<h2 id="64-数据库交互">6.4 数据库交互</h2>
<p>在商业场景下，大多数数据可能不是存储在文本或Excel文件中。基于SQL的关系型数据库（如SQL Server、PostgreSQL和MySQL等）使用非常广泛，其它一些数据库也很流行。<strong>数据库的选择通常取决于性能、数据完整性以及应用程序的伸缩性需求。</strong></p>
<p>将数据从SQL加载到DataFrame的过程很简单，此外pandas还有一些能够简化该过程的函数。例如，我将使用SQLite数据库（通过Python内置的sqlite3驱动器）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">121</span>]: <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sqlite3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">122</span>]: query <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   .....: CREATE TABLE test
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   .....: (a VARCHAR(20), b VARCHAR(20),
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   .....:  c REAL,        d INTEGER
</span></span></span><span style="display:flex;"><span><span style="color:#d14">   .....: );&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">123</span>]: con <span style="color:#000;font-weight:bold">=</span> sqlite3<span style="color:#000;font-weight:bold">.</span>connect(<span style="color:#d14">&#39;mydata.sqlite&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">124</span>]: con<span style="color:#000;font-weight:bold">.</span>execute(query)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">124</span>]: <span style="color:#000;font-weight:bold">&lt;</span>sqlite3<span style="color:#000;font-weight:bold">.</span>Cursor at <span style="color:#099">0x7f6b12a50f10</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">125</span>]: con<span style="color:#000;font-weight:bold">.</span>commit()
</span></span></code></pre></div><p>然后插入几行数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">126</span>]: data <span style="color:#000;font-weight:bold">=</span> [(<span style="color:#d14">&#39;Atlanta&#39;</span>, <span style="color:#d14">&#39;Georgia&#39;</span>, <span style="color:#099">1.25</span>, <span style="color:#099">6</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:         (<span style="color:#d14">&#39;Tallahassee&#39;</span>, <span style="color:#d14">&#39;Florida&#39;</span>, <span style="color:#099">2.6</span>, <span style="color:#099">3</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">.....</span>:         (<span style="color:#d14">&#39;Sacramento&#39;</span>, <span style="color:#d14">&#39;California&#39;</span>, <span style="color:#099">1.7</span>, <span style="color:#099">5</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">127</span>]: stmt <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;INSERT INTO test VALUES(?, ?, ?, ?)&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">128</span>]: con<span style="color:#000;font-weight:bold">.</span>executemany(stmt, data)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">128</span>]: <span style="color:#000;font-weight:bold">&lt;</span>sqlite3<span style="color:#000;font-weight:bold">.</span>Cursor at <span style="color:#099">0x7f6b15c66ce0</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>从表中选取数据时，大部分Python SQL驱动器（PyODBC、psycopg2、MySQLdb、pymssql等）都会返回一个元组列表：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">130</span>]: cursor <span style="color:#000;font-weight:bold">=</span> con<span style="color:#000;font-weight:bold">.</span>execute(<span style="color:#d14">&#39;select * from test&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">131</span>]: rows <span style="color:#000;font-weight:bold">=</span> cursor<span style="color:#000;font-weight:bold">.</span>fetchall()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">132</span>]: rows
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">132</span>]: 
</span></span><span style="display:flex;"><span>[(<span style="color:#d14">&#39;Atlanta&#39;</span>, <span style="color:#d14">&#39;Georgia&#39;</span>, <span style="color:#099">1.25</span>, <span style="color:#099">6</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#d14">&#39;Tallahassee&#39;</span>, <span style="color:#d14">&#39;Florida&#39;</span>, <span style="color:#099">2.6</span>, <span style="color:#099">3</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#d14">&#39;Sacramento&#39;</span>, <span style="color:#d14">&#39;California&#39;</span>, <span style="color:#099">1.7</span>, <span style="color:#099">5</span>)]
</span></span></code></pre></div><p>你可以将这个元组列表传给DataFrame构造器，但还需要列名（位于光标的description属性中）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">133</span>]: cursor<span style="color:#000;font-weight:bold">.</span>description
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">133</span>]: 
</span></span><span style="display:flex;"><span>((<span style="color:#d14">&#39;a&#39;</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#d14">&#39;b&#39;</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#d14">&#39;c&#39;</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>),
</span></span><span style="display:flex;"><span> (<span style="color:#d14">&#39;d&#39;</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>, <span style="color:#000;font-weight:bold">None</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">134</span>]: pd<span style="color:#000;font-weight:bold">.</span>DataFrame(rows, columns<span style="color:#000;font-weight:bold">=</span>[x[<span style="color:#099">0</span>] <span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> cursor<span style="color:#000;font-weight:bold">.</span>description])
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">134</span>]: 
</span></span><span style="display:flex;"><span>             a           b     c  d
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>      Atlanta     Georgia  <span style="color:#099">1.25</span>  <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  Tallahassee     Florida  <span style="color:#099">2.60</span>  <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>   Sacramento  California  <span style="color:#099">1.70</span>  <span style="color:#099">5</span>
</span></span></code></pre></div><p>这种数据规整操作相当多，你肯定不想每查一次数据库就重写一次。<a href="http://www.sqlalchemy.org/">SQLAlchemy项目</a>是一个流行的Python SQL工具，它抽象出了SQL数据库中的许多常见差异。pandas有一个read_sql函数，可以让你轻松的从SQLAlchemy连接读取数据。这里，我们用SQLAlchemy连接SQLite数据库，并从之前创建的表读取数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>In [<span style="color:#099">135</span>]: <span style="color:#000;font-weight:bold">import</span> <span style="color:#555">sqlalchemy</span> <span style="color:#000;font-weight:bold">as</span> <span style="color:#555">sqla</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">136</span>]: db <span style="color:#000;font-weight:bold">=</span> sqla<span style="color:#000;font-weight:bold">.</span>create_engine(<span style="color:#d14">&#39;sqlite:///mydata.sqlite&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In [<span style="color:#099">137</span>]: pd<span style="color:#000;font-weight:bold">.</span>read_sql(<span style="color:#d14">&#39;select * from test&#39;</span>, db)
</span></span><span style="display:flex;"><span>Out[<span style="color:#099">137</span>]: 
</span></span><span style="display:flex;"><span>             a           b     c  d
</span></span><span style="display:flex;"><span><span style="color:#099">0</span>      Atlanta     Georgia  <span style="color:#099">1.25</span>  <span style="color:#099">6</span>
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  Tallahassee     Florida  <span style="color:#099">2.60</span>  <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>   Sacramento  California  <span style="color:#099">1.70</span>  <span style="color:#099">5</span>
</span></span></code></pre></div><h2 id="65-总结">6.5 总结</h2>
<p><code>访问数据</code>通常是数据分析的第一步。在本章中，我们已经学了一些有用的工具。在接下来的章节中，我们将深入研究数据规整、数据可视化、时间序列分析和其它主题。</p>

    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/">← 第八章 数据规整：聚合、合并和重塑</a></div>
    <div><a href="https://richfan.site/posts/%E7%A8%8B%E6%8A%80/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch11-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/">第十一章 时间序列  →</a></div>
</div>
    
    

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        京ICP备2022007001号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
