<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>第八章 数据规整：聚合、合并和重塑 - 樊刹</title><meta name="author" content="richfan">
<meta name="author-link" content="https://richfan.site/">
<meta name="description" content="在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。 首先，我会介绍pandas的" /><meta name="keywords" content='python' /><meta itemprop="name" content="第八章 数据规整：聚合、合并和重塑">
<meta itemprop="description" content="在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。 首先，我会介绍pandas的"><meta itemprop="datePublished" content="2023-09-25T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-09-25T00:00:00+00:00" />
<meta itemprop="wordCount" content="10119"><meta itemprop="image" content="http://richfan.site/favicon.svg"/>
<meta itemprop="keywords" content="python," /><meta property="og:title" content="第八章 数据规整：聚合、合并和重塑" />
<meta property="og:description" content="在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。 首先，我会介绍pandas的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://richfan.site/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/" /><meta property="og:image" content="http://richfan.site/favicon.svg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-09-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://richfan.site/favicon.svg"/>

<meta name="twitter:title" content="第八章 数据规整：聚合、合并和重塑"/>
<meta name="twitter:description" content="在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。 首先，我会介绍pandas的"/>
<meta name="application-name" content="樊刹">
<meta name="apple-mobile-web-app-title" content="樊刹"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://richfan.site/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/" /><link rel="prev" href="http://richfan.site/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch02-python%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E5%92%8Cipython%E4%BB%A5%E5%8F%8Ajupyternotebooks/" /><link rel="next" href="http://richfan.site/posts/program/python/python%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ch8-%E9%94%99%E8%AF%AF%E8%B0%83%E8%AF%95%E5%92%8C%E6%B5%8B%E8%AF%95/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "第八章 数据规整：聚合、合并和重塑",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http:\/\/richfan.site\/posts\/program\/python\/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90\/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91\/"
    },"genre": "posts","keywords": "python","wordcount":  10119 ,
    "url": "http:\/\/richfan.site\/posts\/program\/python\/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90\/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91\/","datePublished": "2023-09-25T00:00:00+00:00","dateModified": "2023-09-25T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "richfan"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="/" title="樊刹"><img loading="lazy" src="/favicon.svg" srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" sizes="auto" data-title="樊刹" data-alt="樊刹" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span id="typeit-header-desktop" class="typeit"></span><span class="header-title-post"><i class='fa-solid fa-hand-holding-heart fa-fw'></i></span></a><span id="typeit-header-subtitle-desktop" class="typeit header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-folder-open fa-fw fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/friends/"
                
                
              ><i class="fa-solid fa-users fa-fw fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-info-circle fa-fw fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="樊刹"><img loading="lazy" src="/favicon.svg" srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" sizes="auto" data-title="/favicon.svg" data-alt="/favicon.svg" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span id="typeit-header-title-mobile" class="typeit"></span><span class="header-title-post"><i class='fa-solid fa-hand-holding-heart fa-fw'></i></span></a><span id="typeit-header-subtitle-mobile" class="typeit header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-fw fa-sm" aria-hidden="true"></i> 文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-folder-open fa-fw fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/friends/"
                  
                  
                ><i class="fa-solid fa-users fa-fw fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-info-circle fa-fw fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item"><a href="/" title="樊刹">主页</a></li><li class="breadcrumb-item"><a href="/posts/" title="Posts">Posts</a></li><li class="breadcrumb-item active" aria-current="page">第八章 数据规整：聚合、合并和重塑</li>
    </ol>
  </nav><main class="container"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>第八章 数据规整：聚合、合并和重塑</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><a href="https://richfan.site/" title="作者"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="/avatar.webp" srcset="/avatar.webp, /avatar.webp 1.5x, /avatar.webp 2x" sizes="auto" data-title="richfan" data-alt="richfan" class="avatar" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/>&nbsp;richfan</a></span>
          <span class="post-category">收录于 <a href="/categories/%E7%BC%96%E7%A8%8B/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 编程</a></span></div>
      <div class="post-meta-line"><span title="发布于 2023-09-25 00:00:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2023-09-25">2023-09-25</time></span>&nbsp;<span title="更新于 2023-09-25 00:00:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2023-09-25">2023-09-25</time></span>&nbsp;<span title="10119 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 10200 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 21 分钟</span>&nbsp;<span id="/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/" class="leancloud_visitors comment-visitors" data-flag-title="第八章 数据规整：聚合、合并和重塑">
              <i class="fa-regular fa-eye fa-fw me-1" aria-hidden="true"></i><span class="leancloud-visitors-count">-</span>&nbsp;次阅读
            </span>&nbsp;<span class="comment-count" data-flag-title="第八章 数据规整：聚合、合并和重塑">
              <i class="fa-regular fa-comments fa-fw me-1" aria-hidden="true"></i><span data-xid="/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/" class="valine-comment-count">-</span>&nbsp;条评论
            </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#81-层次化索引">8.1 层次化索引</a>
      <ul>
        <li><a href="#811-重排与分级排序">8.1.1 重排与分级排序</a></li>
        <li><a href="#812-根据级别汇总统计">8.1.2 根据级别汇总统计</a></li>
        <li><a href="#813-使用dataframe的列进行索引">8.1.3 使用DataFrame的列进行索引</a></li>
      </ul>
    </li>
    <li><a href="#82-合并数据集">8.2 合并数据集</a>
      <ul>
        <li><a href="#821-数据库风格的dataframe合并">8.2.1 数据库风格的DataFrame合并</a></li>
        <li><a href="#822-索引上的合并">8.2.2 索引上的合并</a></li>
        <li><a href="#823-轴向连接">8.2.3 轴向连接</a></li>
        <li><a href="#824-合并重叠数据">8.2.4 合并重叠数据</a></li>
      </ul>
    </li>
    <li><a href="#83-重塑和轴向旋转">8.3 重塑和轴向旋转</a>
      <ul>
        <li><a href="#831-重塑层次化索引">8.3.1 重塑层次化索引</a></li>
        <li><a href="#832-将长格式旋转为宽格式">8.3.2 将“长格式”旋转为“宽格式”</a></li>
        <li><a href="#833-将宽格式旋转为长格式">8.3.3 将“宽格式”旋转为“长格式”</a></li>
      </ul>
    </li>
    <li><a href="#84-总结">8.4 总结</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><p>在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。</p>
<p>首先，我会介绍pandas的层次化索引，它广泛用于以上操作。然后，我深入介绍了一些特殊的数据操作。在第14章，你可以看到这些工具的多种应用。</p>
<h2 id="81-层次化索引">8.1 层次化索引</h2>
<p>层次化索引（hierarchical indexing）是pandas的一项重要功能，它使你能在一个轴上拥有多个（两个以上）索引级别。抽象点说，它使你能以低维度形式处理高维度数据。我们先来看一个简单的例子：创建一个Series，并用一个由列表或数组组成的列表作为索引：</p>
<div class="highlight" id="id-1"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span>                  <span class="n">index</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">...</span><span class="p">:</span>                         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.204708</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.478943</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>   <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mi">1</span>    <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mi">2</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>看到的结果是经过美化的带有MultiIndex索引的Series的格式。索引之间的“间隔”表示“直接使用上面的标签”：</p>
<div class="highlight" id="id-2"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">MultiIndex</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">           <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于一个层次化索引的对象，可以使用所谓的部分索引，使用它选取数据子集的操作更简单：</p>
<div class="highlight" id="id-3"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mi">1</span>    <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mi">2</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>有时甚至还可以在“内层”中进行选取：</p>
<div class="highlight" id="id-4"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mf">0.478943</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>层次化索引在数据重塑和基于分组的操作（如透视表生成）中扮演着重要的角色。例如，可以通过unstack方法将这段数据重新安排到一个DataFrame中：</p>
<div class="highlight" id="id-5"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="mi">1</span>         <span class="mi">2</span>         <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">-</span><span class="mf">0.204708</span>  <span class="mf">0.478943</span> <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">-</span><span class="mf">0.555730</span>       <span class="n">NaN</span>  <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mf">1.393406</span>  <span class="mf">0.092908</span>       <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.281746</span>  <span class="mf">0.769023</span></span></span></code></pre></td></tr></table>
</div>
</div><p>unstack的逆运算是stack：</p>
<div class="highlight" id="id-6"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.204708</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.478943</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>   <span class="o">-</span><span class="mf">0.519439</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>   <span class="o">-</span><span class="mf">0.555730</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">1.965781</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="mi">1</span>    <span class="mf">1.393406</span>
</span></span><span class="line"><span class="cl">   <span class="mi">2</span>    <span class="mf">0.092908</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="mi">2</span>    <span class="mf">0.281746</span>
</span></span><span class="line"><span class="cl">   <span class="mi">3</span>    <span class="mf">0.769023</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>stack和unstack将在本章后面详细讲解。</p>
<p>对于一个DataFrame，每条轴都可以有分层索引：</p>
<div class="highlight" id="id-7"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                               <span class="p">[</span><span class="s1">&#39;Green&#39;</span><span class="p">,</span> <span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl">    <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="mi">1</span>     <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl">  <span class="mi">2</span>     <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="mi">1</span>     <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl">  <span class="mi">2</span>     <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span></span></span></code></pre></td></tr></table>
</div>
</div><p>各层都可以有名字（可以是字符串，也可以是别的Python对象）。如果指定了名称，它们就会显示在控制台输出中：</p>
<div class="highlight" id="id-8"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>                   
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意：小心区分索引名state、color与行标签。</p>
</blockquote>
<p>有了部分列索引，因此可以轻松选取列分组：</p>
<div class="highlight" id="id-9"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">color</span>      <span class="n">Green</span>  <span class="n">Red</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>            
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>         <span class="mi">0</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>         <span class="mi">3</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>         <span class="mi">6</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>         <span class="mi">9</span>   <span class="mi">10</span></span></span></code></pre></td></tr></table>
</div>
</div><p>可以单独创建MultiIndex然后复用。上面那个DataFrame中的（带有分级名称）列可以这样创建：</p>
<div class="highlight" id="id-10"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Colorado&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Green&#39;</span><span class="p">,</span> <span class="s1">&#39;Red&#39;</span><span class="p">,</span> <span class="s1">&#39;Green&#39;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">                       <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">])</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="811-重排与分级排序">8.1.1 重排与分级排序</h3>
<p>有时，你需要重新调整某条轴上各级别的顺序，或根据指定级别上的值对数据进行排序。<code>swaplevel</code>接受两个级别编号或名称，并返回一个互换了级别的新对象（但数据不会发生变化）：</p>
<div class="highlight" id="id-11"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key2</span> <span class="n">key1</span>                   
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">a</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">a</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">b</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">b</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span></span></span></code></pre></td></tr></table>
</div>
</div><p>而sort_index则根据单个级别中的值对数据进行排序。交换级别时，常常也会用到sort_index，这样最终结果就是按照指定顺序进行字母排序了：</p>
<div class="highlight" id="id-12"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>                   
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">2</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>      <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span>     <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key2</span> <span class="n">key1</span>                   
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="n">a</span>        <span class="mi">0</span>   <span class="mi">1</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>        <span class="mi">6</span>   <span class="mi">7</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="n">a</span>        <span class="mi">3</span>   <span class="mi">4</span>        <span class="mi">5</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>        <span class="mi">9</span>  <span class="mi">10</span>       <span class="mi">11</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="812-根据级别汇总统计">8.1.2 根据级别汇总统计</h3>
<p>许多对DataFrame和Series的描述和汇总统计都有一个level选项，它用于指定在某条轴上求和的级别。再以上面那个DataFrame为例，我们可以根据行或列上的级别来进行求和：</p>
<div class="highlight" id="id-13"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;key2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>  <span class="n">Ohio</span>     <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span> <span class="n">Green</span> <span class="n">Red</span>    <span class="n">Green</span>
</span></span><span class="line"><span class="cl"><span class="n">key2</span>                    
</span></span><span class="line"><span class="cl"><span class="mi">1</span>         <span class="mi">6</span>   <span class="mi">8</span>       <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>        <span class="mi">12</span>  <span class="mi">14</span>       <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">color</span>      <span class="n">Green</span>  <span class="n">Red</span>
</span></span><span class="line"><span class="cl"><span class="n">key1</span> <span class="n">key2</span>            
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">1</span>         <span class="mi">2</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>         <span class="mi">8</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>        <span class="mi">14</span>    <span class="mi">7</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span>        <span class="mi">20</span>   <span class="mi">10</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这其实是利用了pandas的groupby功能，本书稍后将对其进行详细讲解。</p>
<h3 id="813-使用dataframe的列进行索引">8.1.3 使用DataFrame的列进行索引</h3>
<p>人们经常想要将DataFrame的一个或多个列当做行索引来用，或者可能希望将行索引变成DataFrame的列。以下面这个DataFrame为例：</p>
<div class="highlight" id="id-14"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                             <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">frame</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>  <span class="n">one</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>  <span class="n">one</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="n">one</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mi">3</span>  <span class="mi">4</span>  <span class="n">two</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mi">4</span>  <span class="mi">3</span>  <span class="n">two</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="mi">5</span>  <span class="mi">2</span>  <span class="n">two</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="mi">6</span>  <span class="mi">1</span>  <span class="n">two</span>  <span class="mi">3</span></span></span></code></pre></td></tr></table>
</div>
</div><p>DataFrame的set_index函数会将其一个或多个列转换为行索引，并创建一个新的DataFrame：</p>
<div class="highlight" id="id-15"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">frame2</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">frame2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="n">d</span>      
</span></span><span class="line"><span class="cl"><span class="n">one</span> <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span> <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span></span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况下，那些列会从DataFrame中移除，但也可以将其保留下来：</p>
<div class="highlight" id="id-16"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>  <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="n">d</span>              
</span></span><span class="line"><span class="cl"><span class="n">one</span> <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>  <span class="n">one</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>  <span class="n">one</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="n">one</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span> <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>  <span class="n">two</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>  <span class="n">two</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>  <span class="n">two</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span>  <span class="n">two</span>  <span class="mi">3</span></span></span></code></pre></td></tr></table>
</div>
</div><p>reset_index的功能跟set_index刚好相反，层次化索引的级别会被转移到列里面：</p>
<div class="highlight" id="id-17"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">frame2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">d</span>  <span class="n">a</span>  <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">one</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">one</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">one</span>  <span class="mi">2</span>  <span class="mi">2</span>  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">two</span>  <span class="mi">0</span>  <span class="mi">3</span>  <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">two</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">two</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="n">two</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">1</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="82-合并数据集">8.2 合并数据集</h2>
<p>pandas对象中的数据可以通过一些方式进行合并：</p>
<ul>
<li><code>pandas.merge</code>可根据一个或多个键将不同DataFrame中的行连接起来。SQL或其他关系型数据库的用户对此应该会比较熟悉，因为它实现的就是数据库的join操作。</li>
<li><code>pandas.concat</code>可以沿着一条轴将多个对象堆叠到一起。</li>
<li>实例方法<code>combine_first</code>可以将重复数据拼接在一起，用一个对象中的值填充另一个对象中的缺失值。</li>
</ul>
<p>我将分别对它们进行讲解，并给出一些例子。本书剩余部分的示例中将经常用到它们。</p>
<h3 id="821-数据库风格的dataframe合并">8.2.1 数据库风格的DataFrame合并</h3>
<p>数据集的合并（merge）或连接（join）运算是通过一个或多个键将行连接起来的。这些运算是关系型数据库（基于SQL）的核心。pandas的merge函数是对数据应用这些算法的主要切入点。</p>
<p>以一个简单的例子开始：</p>
<div class="highlight" id="id-18"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">3</span>   <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>      <span class="mi">6</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data2</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">d</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这是一种多对一的合并。df1中的数据有多个被标记为a和b的行，而df2中key列的每个值则仅对应一行。对这些对象调用merge即可得到：</p>
<div class="highlight" id="id-19"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">6</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">a</span>      <span class="mi">0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意，我并没有指明要用哪个列进行连接。如果没有指定，merge就会将重叠列的列名当做键。不过，最好明确指定一下：</p>
<div class="highlight" id="id-20"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">6</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">a</span>      <span class="mi">0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果两个对象的列名不同，也可以分别进行指定：</p>
<div class="highlight" id="id-21"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;lkey&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rkey&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span> <span class="n">df4</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;lkey&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;rkey&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">lkey</span>  <span class="n">data2</span> <span class="n">rkey</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>    <span class="n">b</span>      <span class="mi">1</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>    <span class="n">b</span>      <span class="mi">1</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">6</span>    <span class="n">b</span>      <span class="mi">1</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">2</span>    <span class="n">a</span>      <span class="mi">0</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>    <span class="n">a</span>      <span class="mi">0</span>    <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>    <span class="n">a</span>      <span class="mi">0</span>    <span class="n">a</span></span></span></code></pre></td></tr></table>
</div>
</div><p>可能你已经注意到了，结果里面c和d以及与之相关的数据消失了。默认情况下，merge做的是“内连接”；结果中的键是交集。其他方式还有&quot;left&quot;、&ldquo;right&quot;以及&quot;outer&rdquo;。外连接求取的是键的并集，组合了左连接和右连接的效果：</p>
<div class="highlight" id="id-22"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>    <span class="mf">0.0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>    <span class="mf">1.0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>    <span class="mf">6.0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>    <span class="mf">2.0</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>    <span class="mf">4.0</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>    <span class="mf">5.0</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>    <span class="mf">3.0</span>   <span class="n">c</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>    <span class="n">NaN</span>   <span class="n">d</span>    <span class="mf">2.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>表8-1对这些选项进行了总结。</p>
<p><img loading="lazy" src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235210681.png" srcset="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235210681.png, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235210681.png 1.5x, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235210681.png 2x" sizes="auto" data-title="表8-1 不同的连接类型" data-alt="表8-1 不同的连接类型" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>多对多的合并有些不直观。看下面的例子：</p>
<div class="highlight" id="id-23"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">3</span>   <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data2</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">1</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">2</span>   <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">3</span>   <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">4</span>   <span class="n">d</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>       <span class="mi">0</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>       <span class="mi">0</span>   <span class="n">b</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>       <span class="mi">1</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>       <span class="mi">1</span>   <span class="n">b</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>       <span class="mi">2</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>       <span class="mi">2</span>   <span class="n">a</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>       <span class="mi">3</span>   <span class="n">c</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>       <span class="mi">4</span>   <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>       <span class="mi">4</span>   <span class="n">a</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span>       <span class="mi">5</span>   <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>      <span class="mi">5</span>   <span class="n">b</span>    <span class="mf">3.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>多对多连接产生的是行的笛卡尔积。由于左边的DataFrame有3个&quot;b&quot;行，右边的有2个，所以最终结果中就有6个&quot;b&quot;行。连接方式只影响出现在结果中的不同的键的值：</p>
<div class="highlight" id="id-24"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data1</span> <span class="n">key</span>  <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="mi">0</span>   <span class="n">b</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>      <span class="mi">1</span>   <span class="n">b</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>      <span class="mi">5</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>      <span class="mi">5</span>   <span class="n">b</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>      <span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span>      <span class="mi">4</span>   <span class="n">a</span>      <span class="mi">2</span></span></span></code></pre></td></tr></table>
</div>
</div><p>要根据多个键进行合并，传入一个由列名组成的列表即可：</p>
<div class="highlight" id="id-25"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="s1">&#39;lval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;rval&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key1</span> <span class="n">key2</span>  <span class="n">lval</span>  <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>  <span class="n">one</span>   <span class="mf">1.0</span>   <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">foo</span>  <span class="n">one</span>   <span class="mf">1.0</span>   <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>  <span class="n">two</span>   <span class="mf">2.0</span>   <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">bar</span>  <span class="n">one</span>   <span class="mf">3.0</span>   <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>  <span class="n">two</span>   <span class="n">NaN</span>   <span class="mf">7.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>结果中会出现哪些键组合取决于所选的合并方式，你可以这样来理解：多个键形成一系列元组，并将其当做单个连接键（当然，实际上并不是这么回事）。</p>
<blockquote>
<p>注意：在进行列－列连接时，DataFrame对象中的索引会被丢弃。</p>
</blockquote>
<p>对于合并运算需要考虑的最后一个问题是对重复列名的处理。虽然你可以手工处理列名重叠的问题（查看前面介绍的重命名轴标签），但merge有一个更实用的suffixes选项，用于指定附加到左右两个DataFrame对象的重叠列名上的字符串：</p>
<div class="highlight" id="id-26"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key1</span> <span class="n">key2_x</span>  <span class="n">lval</span> <span class="n">key2_y</span>  <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>    <span class="n">one</span>     <span class="mi">1</span>    <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">foo</span>    <span class="n">one</span>     <span class="mi">1</span>    <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>    <span class="n">two</span>     <span class="mi">2</span>    <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>    <span class="n">two</span>     <span class="mi">2</span>    <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>    <span class="n">one</span>     <span class="mi">3</span>    <span class="n">one</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">bar</span>    <span class="n">one</span>     <span class="mi">3</span>    <span class="n">two</span>     <span class="mi">7</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_left&#39;</span><span class="p">,</span> <span class="s1">&#39;_right&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key1</span> <span class="n">key2_left</span>  <span class="n">lval</span> <span class="n">key2_right</span>  <span class="n">rval</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>       <span class="n">one</span>     <span class="mi">1</span>        <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">foo</span>       <span class="n">one</span>     <span class="mi">1</span>        <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">foo</span>       <span class="n">two</span>     <span class="mi">2</span>        <span class="n">one</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>       <span class="n">two</span>     <span class="mi">2</span>        <span class="n">one</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>       <span class="n">one</span>     <span class="mi">3</span>        <span class="n">one</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">bar</span>       <span class="n">one</span>     <span class="mi">3</span>        <span class="n">two</span>     <span class="mi">7</span></span></span></code></pre></td></tr></table>
</div>
</div><p>merge的参数请参见表8-2。使用DataFrame的行索引合并是下一节的主题。</p>
<p>表8-2 merge函数的参数</p>
<p><img loading="lazy" src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235225177.png" srcset="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235225177.png, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235225177.png 1.5x, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235225177.png 2x" sizes="auto" data-title="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235225177.png" data-alt="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235225177.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><img loading="lazy" src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235230724.png" srcset="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235230724.png, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235230724.png 1.5x, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235230724.png 2x" sizes="auto" data-title="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235230724.png" data-alt="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235230724.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>indicator 添加特殊的列_merge，它可以指明每个行的来源，它的值有left_only、right_only或both，根据每行的合并数据的来源。</p>
<h3 id="822-索引上的合并">8.2.2 索引上的合并</h3>
<p>有时候，DataFrame中的连接键位于其索引中。在这种情况下，你可以传入left_index=True或right_index=True（或两个都传）以说明索引应该被用作连接键：</p>
<div class="highlight" id="id-27"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">left1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">right1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;group_val&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">left1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="n">c</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">right1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left1</span><span class="p">,</span> <span class="n">right1</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>  <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>        <span class="mf">7.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>由于默认的merge方法是求取连接键的交集，因此你可以通过外连接的方式得到它们的并集：</p>
<div class="highlight" id="id-28"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left1</span><span class="p">,</span> <span class="n">right1</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">61</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>  <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="n">c</span>      <span class="mi">5</span>        <span class="n">NaN</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于层次化索引的数据，事情就有点复杂了，因为索引的合并默认是多键合并：</p>
<div class="highlight" id="id-29"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">lefth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                                <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">righth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">index</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                               <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                              <span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">2002</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;event1&#39;</span><span class="p">,</span> <span class="s1">&#39;event2&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">lefth</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data</span>    <span class="n">key1</span>  <span class="n">key2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">1.0</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="mf">2.0</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="mf">3.0</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="mf">4.0</span>  <span class="n">Nevada</span>  <span class="mi">2002</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">righth</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">             <span class="n">event1</span>  <span class="n">event2</span>
</span></span><span class="line"><span class="cl"><span class="n">Nevada</span> <span class="mi">2001</span>       <span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2000</span>       <span class="mi">2</span>       <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>   <span class="mi">2000</span>       <span class="mi">4</span>       <span class="mi">5</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2000</span>       <span class="mi">6</span>       <span class="mi">7</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2001</span>       <span class="mi">8</span>       <span class="mi">9</span>
</span></span><span class="line"><span class="cl">       <span class="mi">2002</span>      <span class="mi">10</span>      <span class="mi">11</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这种情况下，你必须以列表的形式指明用作合并键的多个列（注意用how=&lsquo;outer&rsquo;对重复索引值的处理）：</p>
<div class="highlight" id="id-30"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lefth</span><span class="p">,</span> <span class="n">righth</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">66</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data</span>    <span class="n">key1</span>  <span class="n">key2</span>  <span class="n">event1</span>  <span class="n">event2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>       <span class="mi">4</span>       <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>       <span class="mi">6</span>       <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">1.0</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>       <span class="mi">8</span>       <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="mf">2.0</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>      <span class="mi">10</span>      <span class="mi">11</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="mf">3.0</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>       <span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lefth</span><span class="p">,</span> <span class="n">righth</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>          <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">67</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">data</span>    <span class="n">key1</span>  <span class="n">key2</span>  <span class="n">event1</span>  <span class="n">event2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>     <span class="mf">4.0</span>     <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="mf">0.0</span>    <span class="n">Ohio</span>  <span class="mi">2000</span>     <span class="mf">6.0</span>     <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="mf">1.0</span>    <span class="n">Ohio</span>  <span class="mi">2001</span>     <span class="mf">8.0</span>     <span class="mf">9.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="mf">2.0</span>    <span class="n">Ohio</span>  <span class="mi">2002</span>    <span class="mf">10.0</span>    <span class="mf">11.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="mf">3.0</span>  <span class="n">Nevada</span>  <span class="mi">2001</span>     <span class="mf">0.0</span>     <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="mf">4.0</span>  <span class="n">Nevada</span>  <span class="mi">2002</span>     <span class="n">NaN</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">NaN</span>  <span class="n">Nevada</span>  <span class="mi">2000</span>     <span class="mf">2.0</span>     <span class="mf">3.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>同时使用合并双方的索引也没问题：</p>
<div class="highlight" id="id-31"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">left2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">right2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">],</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Missouri&#39;</span><span class="p">,</span> <span class="s1">&#39;Alabama&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">left2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">70</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">right2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">71</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Missouri</span>  <span class="n">Alabama</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left2</span><span class="p">,</span> <span class="n">right2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">72</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="n">NaN</span>     <span class="n">NaN</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>DataFrame还有一个便捷的join实例方法，它能更为方便地实现按索引合并。它还可用于合并多个带有相同或相似索引的DataFrame对象，但要求没有重叠的列。在上面那个例子中，我们可以编写：</p>
<div class="highlight" id="id-32"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">left2</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="n">NaN</span>     <span class="n">NaN</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>因为一些历史版本的遗留原因，DataFrame的join方法默认使用的是左连接，保留左边表的行索引。它还支持在调用的DataFrame的列上，连接传递的DataFrame索引：</p>
<div class="highlight" id="id-33"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">left1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">right1</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">74</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">key</span>  <span class="n">value</span>  <span class="n">group_val</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>   <span class="n">a</span>      <span class="mi">0</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>   <span class="n">b</span>      <span class="mi">1</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>   <span class="n">a</span>      <span class="mi">2</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>   <span class="n">a</span>      <span class="mi">3</span>        <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>   <span class="n">b</span>      <span class="mi">4</span>        <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>   <span class="n">c</span>      <span class="mi">5</span>        <span class="n">NaN</span></span></span></code></pre></td></tr></table>
</div>
</div><p>最后，对于简单的索引合并，你还可以向join传入一组DataFrame，下一节会介绍更为通用的concat函数，也能实现此功能：</p>
<div class="highlight" id="id-34"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">another</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="p">[</span><span class="mf">11.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">],</span> <span class="p">[</span><span class="mf">16.</span><span class="p">,</span> <span class="mf">17.</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;Oregon&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="n">another</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">76</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">New</span> <span class="n">York</span>  <span class="n">Oregon</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>       <span class="mf">7.0</span>     <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>       <span class="mf">9.0</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>      <span class="mf">11.0</span>    <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>      <span class="mf">16.0</span>    <span class="mf">17.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">left2</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">right2</span><span class="p">,</span> <span class="n">another</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">77</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>  <span class="n">New</span> <span class="n">York</span>  <span class="n">Oregon</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>       <span class="mf">7.0</span>     <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>       <span class="mf">9.0</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>      <span class="mf">11.0</span>    <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">left2</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">right2</span><span class="p">,</span> <span class="n">another</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">78</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Ohio</span>  <span class="n">Nevada</span>  <span class="n">Missouri</span>  <span class="n">Alabama</span>  <span class="n">New</span> <span class="n">York</span>  <span class="n">Oregon</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>   <span class="mf">1.0</span>     <span class="mf">2.0</span>       <span class="n">NaN</span>      <span class="n">NaN</span>       <span class="mf">7.0</span>     <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="mf">7.0</span>      <span class="mf">8.0</span>       <span class="n">NaN</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>   <span class="mf">3.0</span>     <span class="mf">4.0</span>       <span class="mf">9.0</span>     <span class="mf">10.0</span>       <span class="mf">9.0</span>    <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>   <span class="n">NaN</span>     <span class="n">NaN</span>      <span class="mf">11.0</span>     <span class="mf">12.0</span>       <span class="n">NaN</span>     <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>   <span class="mf">5.0</span>     <span class="mf">6.0</span>      <span class="mf">13.0</span>     <span class="mf">14.0</span>      <span class="mf">11.0</span>    <span class="mf">12.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>   <span class="n">NaN</span>     <span class="n">NaN</span>       <span class="n">NaN</span>      <span class="n">NaN</span>      <span class="mf">16.0</span>    <span class="mf">17.0</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="823-轴向连接">8.2.3 轴向连接</h3>
<p>另一种数据合并运算也被称作连接（concatenation）、绑定（binding）或堆叠（stacking）。NumPy的concatenation函数可以用NumPy数组来做：</p>
<div class="highlight" id="id-35"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">arr</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">81</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于pandas对象（如Series和DataFrame），带有标签的轴使你能够进一步推广数组的连接运算。具体点说，你还需要考虑以下这些东西：</p>
<ul>
<li>如果对象在其它轴上的索引不同，我们应该合并这些轴的不同元素还是只使用交集？</li>
<li>连接的数据集是否需要在结果对象中可识别？</li>
<li>连接轴中保存的数据是否需要保留？许多情况下，DataFrame默认的整数标签最好在连接时删掉。</li>
</ul>
<p>pandas的concat函数提供了一种能够解决这些问题的可靠方式。我将给出一些例子来讲解其使用方式。假设有三个没有重叠索引的Series：</p>
<div class="highlight" id="id-36"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对这些对象调用concat可以将值和索引粘合在一起：</p>
<div class="highlight" id="id-37"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">85</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况下，concat是在axis=0上工作的，最终产生一个新的Series。如果传入axis=1，则结果就会变成一个DataFrame（axis=1是列）：</p>
<div class="highlight" id="id-38"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">86</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>    <span class="mi">1</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="n">NaN</span>  <span class="mf">3.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">6.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这种情况下，另外的轴上没有重叠，从索引的有序并集（外连接）上就可以看出来。传入join=&lsquo;inner&rsquo;即可得到它们的交集：</p>
<div class="highlight" id="id-39"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">s4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="n">s4</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">88</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">89</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>  <span class="n">NaN</span>  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>  <span class="n">NaN</span>  <span class="mi">6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">90</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="mi">0</span>  <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mi">0</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mi">1</span>  <span class="mi">1</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在这个例子中，f和g标签消失了，是因为使用的是join=&lsquo;inner&rsquo;选项。</p>
<p>你可以通过join_axes指定要在其它轴上使用的索引：</p>
<div class="highlight" id="id-40"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join_axes</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">91</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>  <span class="n">NaN</span>  <span class="n">NaN</span></span></span></code></pre></td></tr></table>
</div>
</div><p>不过有个问题，参与连接的片段在结果中区分不开。假设你想要在连接轴上创建一个层次化索引。使用keys参数即可达到这个目的：</p>
<div class="highlight" id="id-41"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">93</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="n">f</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl">       <span class="n">g</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">94</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">         <span class="n">a</span>    <span class="n">b</span>    <span class="n">f</span>    <span class="n">g</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">5.0</span>  <span class="mf">6.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果沿着axis=1对Series进行合并，则keys就会成为DataFrame的列头：</p>
<div class="highlight" id="id-42"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">95</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>  <span class="mf">0.0</span>  <span class="n">NaN</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>  <span class="n">NaN</span>  <span class="mf">3.0</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="mf">6.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>同样的逻辑也适用于DataFrame对象：</p>
<div class="highlight" id="id-43"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">98</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">one</span>  <span class="n">two</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="mi">0</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mi">2</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mi">4</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">99</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">three</span>  <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">5</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">7</span>     <span class="mi">8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">,</span> <span class="s1">&#39;level2&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">100</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">level1</span>     <span class="n">level2</span>     
</span></span><span class="line"><span class="cl">     <span class="n">one</span> <span class="n">two</span>  <span class="n">three</span> <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">0</span>   <span class="mi">1</span>    <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>      <span class="mi">2</span>   <span class="mi">3</span>    <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">4</span>   <span class="mi">5</span>    <span class="mf">7.0</span>  <span class="mf">8.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果传入的不是列表而是一个字典，则字典的键就会被当做keys选项的值：</p>
<div class="highlight" id="id-44"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">({</span><span class="s1">&#39;level1&#39;</span><span class="p">:</span> <span class="n">df1</span><span class="p">,</span> <span class="s1">&#39;level2&#39;</span><span class="p">:</span> <span class="n">df2</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">101</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">level1</span>     <span class="n">level2</span>     
</span></span><span class="line"><span class="cl">     <span class="n">one</span> <span class="n">two</span>  <span class="n">three</span> <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>      <span class="mi">0</span>   <span class="mi">1</span>    <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>      <span class="mi">2</span>   <span class="mi">3</span>    <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>      <span class="mi">4</span>   <span class="mi">5</span>    <span class="mf">7.0</span>  <span class="mf">8.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>此外还有两个用于管理层次化索引创建方式的参数（参见表8-3）。举个例子，我们可以用names参数命名创建的轴级别：</p>
<div class="highlight" id="id-45"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">,</span> <span class="s1">&#39;level2&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">102</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">upper</span> <span class="n">level1</span>     <span class="n">level2</span>     
</span></span><span class="line"><span class="cl"><span class="n">lower</span>    <span class="n">one</span> <span class="n">two</span>  <span class="n">three</span> <span class="n">four</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>          <span class="mi">0</span>   <span class="mi">1</span>    <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>          <span class="mi">2</span>   <span class="mi">3</span>    <span class="n">NaN</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>          <span class="mi">4</span>   <span class="mi">5</span>    <span class="mf">7.0</span>  <span class="mf">8.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>最后一个关于DataFrame的问题是，DataFrame的行索引不包含任何相关数据：</p>
<div class="highlight" id="id-46"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">105</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>         <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.246435</span>  <span class="mf">1.007189</span> <span class="o">-</span><span class="mf">1.296221</span>  <span class="mf">0.274992</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">0.228913</span>  <span class="mf">1.352917</span>  <span class="mf">0.886429</span> <span class="o">-</span><span class="mf">2.001637</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="o">-</span><span class="mf">0.371843</span>  <span class="mf">1.669025</span> <span class="o">-</span><span class="mf">0.438570</span> <span class="o">-</span><span class="mf">0.539741</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">106</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">b</span>         <span class="n">d</span>         <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">0.476985</span>  <span class="mf">3.248944</span> <span class="o">-</span><span class="mf">1.021228</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="o">-</span><span class="mf">0.577087</span>  <span class="mf">0.124121</span>  <span class="mf">0.302614</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在这种情况下，传入ignore_index=True即可：</p>
<div class="highlight" id="id-47"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">107</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>         <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.246435</span>  <span class="mf">1.007189</span> <span class="o">-</span><span class="mf">1.296221</span>  <span class="mf">0.274992</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">0.228913</span>  <span class="mf">1.352917</span>  <span class="mf">0.886429</span> <span class="o">-</span><span class="mf">2.001637</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="o">-</span><span class="mf">0.371843</span>  <span class="mf">1.669025</span> <span class="o">-</span><span class="mf">0.438570</span> <span class="o">-</span><span class="mf">0.539741</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span> <span class="o">-</span><span class="mf">1.021228</span>  <span class="mf">0.476985</span>       <span class="n">NaN</span>  <span class="mf">3.248944</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">0.302614</span> <span class="o">-</span><span class="mf">0.577087</span>       <span class="n">NaN</span>  <span class="mf">0.124121</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235319409.png" srcset="https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235319409.png, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235319409.png 1.5x, https://gitee.com/wugenqiang/images/raw/master/02/1240-20201026235319409.png 2x" sizes="auto" data-title="表8-3 concat函数的参数" data-alt="表8-3 concat函数的参数" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="824-合并重叠数据">8.2.4 合并重叠数据</h3>
<p>还有一种数据组合问题不能用简单的合并（merge）或连接（concatenation）运算来处理。比如说，你可能有索引全部或部分重叠的两个数据集。举个有启发性的例子，我们使用NumPy的where函数，它表示一种等价于面向数组的if-else：</p>
<div class="highlight" id="id-48"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">111</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">2.5</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.</span> <span class="p">,</span>  <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">2.</span> <span class="p">,</span>  <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">4.5</span><span class="p">,</span>  <span class="n">nan</span><span class="p">])</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Series有一个combine_first方法，实现的也是一样的功能，还带有pandas的数据对齐：</p>
<div class="highlight" id="id-49"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="n">e</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于DataFrame，combine_first自然也会在列上做同样的事情，因此你可以将其看做：用传递对象中的数据为调用对象的缺失数据“打补丁”：</p>
<div class="highlight" id="id-50"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">df1</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">117</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>   <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>   <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>   <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">5.0</span>  <span class="n">NaN</span>  <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">NaN</span>  <span class="mf">6.0</span>  <span class="mi">14</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">df2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">5.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">4.0</span>  <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">3.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">119</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">a</span>    <span class="n">b</span>     <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>   <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">4.0</span>  <span class="mf">2.0</span>   <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">5.0</span>  <span class="mf">4.0</span>  <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">3.0</span>  <span class="mf">6.0</span>  <span class="mf">14.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>   <span class="n">NaN</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="83-重塑和轴向旋转">8.3 重塑和轴向旋转</h2>
<p>有许多用于重新排列表格型数据的基础运算。这些函数也称作重塑（reshape）或轴向旋转（pivot）运算。</p>
<h3 id="831-重塑层次化索引">8.3.1 重塑层次化索引</h3>
<p>层次化索引为DataFrame数据的重排任务提供了一种具有良好一致性的方式。主要功能有二：</p>
<ul>
<li>stack：将数据的列“旋转”为行。</li>
<li>unstack：将数据的行“旋转”为列。</li>
</ul>
<p>我将通过一系列的范例来讲解这些操作。接下来看一个简单的DataFrame，其中的行列索引均为字符串数组：</p>
<div class="highlight" id="id-51"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span><span class="s1">&#39;Colorado&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                     <span class="n">name</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">121</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">number</span>    <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>                    
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">3</span>    <span class="mi">4</span>      <span class="mi">5</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对该数据使用stack方法即可将列转换为行，得到一个Series：</p>
<div class="highlight" id="id-52"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">123</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>     <span class="n">number</span>
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>      <span class="n">one</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="cl">          <span class="n">two</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="cl">          <span class="n">three</span>     <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>  <span class="n">one</span>       <span class="mi">3</span>
</span></span><span class="line"><span class="cl">          <span class="n">two</span>       <span class="mi">4</span>
</span></span><span class="line"><span class="cl">          <span class="n">three</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于一个层次化索引的Series，你可以用unstack将其重排为一个DataFrame：</p>
<div class="highlight" id="id-53"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">124</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">number</span>    <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>                    
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>        <span class="mi">0</span>    <span class="mi">1</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span>    <span class="mi">3</span>    <span class="mi">4</span>      <span class="mi">5</span></span></span></code></pre></td></tr></table>
</div>
</div><p>默认情况下，unstack操作的是最内层（stack也是如此）。传入分层级别的编号或名称即可对其它级别进行unstack操作：</p>
<div class="highlight" id="id-54"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">125</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>   <span class="n">Ohio</span>  <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span>                
</span></span><span class="line"><span class="cl"><span class="n">one</span>        <span class="mi">0</span>         <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>        <span class="mi">1</span>         <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>      <span class="mi">2</span>         <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">126</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>   <span class="n">Ohio</span>  <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span>                
</span></span><span class="line"><span class="cl"><span class="n">one</span>        <span class="mi">0</span>         <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>        <span class="mi">1</span>         <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>      <span class="mi">2</span>         <span class="mi">5</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果不是所有的级别值都能在各分组中找到的话，则unstack操作可能会引入缺失数据：</p>
<div class="highlight" id="id-55"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">128</span><span class="p">]:</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">129</span><span class="p">]:</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">130</span><span class="p">]:</span> <span class="n">data2</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">130</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="n">a</span>    <span class="mi">0</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="mi">1</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">c</span>    <span class="mi">4</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mi">5</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">131</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">131</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>    <span class="n">b</span>    <span class="n">c</span>    <span class="n">d</span>    <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">2.0</span>  <span class="mf">3.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>  <span class="mf">6.0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>stack默认会滤除缺失数据，因此该运算是可逆的：</p>
<div class="highlight" id="id-56"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">132</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">132</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">       <span class="n">a</span>    <span class="n">b</span>    <span class="n">c</span>    <span class="n">d</span>    <span class="n">e</span>
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">2.0</span>  <span class="mf">3.0</span>  <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>  <span class="mf">5.0</span>  <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">133</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">133</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">c</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">134</span><span class="p">]:</span> <span class="n">data2</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">134</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">one</span>  <span class="n">a</span>    <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">3.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>  <span class="n">a</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl">     <span class="n">b</span>    <span class="n">NaN</span>
</span></span><span class="line"><span class="cl">     <span class="n">c</span>    <span class="mf">4.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">d</span>    <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl">     <span class="n">e</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在对DataFrame进行unstack操作时，作为旋转轴的级别将会成为结果中的最低级别：</p>
<div class="highlight" id="id-57"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">135</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">result</span> <span class="o">+</span> <span class="mi">5</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                   <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;side&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">136</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">side</span>             <span class="n">left</span>  <span class="n">right</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>    <span class="n">number</span>             
</span></span><span class="line"><span class="cl"><span class="n">Ohio</span>     <span class="n">one</span>        <span class="mi">0</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl">         <span class="n">two</span>        <span class="mi">1</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl">         <span class="n">three</span>      <span class="mi">2</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">Colorado</span> <span class="n">one</span>        <span class="mi">3</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl">         <span class="n">two</span>        <span class="mi">4</span>      <span class="mi">9</span>
</span></span><span class="line"><span class="cl">         <span class="n">three</span>      <span class="mi">5</span>     <span class="mi">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">137</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">side</span>   <span class="n">left</span>          <span class="n">right</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span>  <span class="n">Ohio</span> <span class="n">Colorado</span>  <span class="n">Ohio</span> <span class="n">Colorado</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span>                             
</span></span><span class="line"><span class="cl"><span class="n">one</span>       <span class="mi">0</span>        <span class="mi">3</span>     <span class="mi">5</span>        <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>       <span class="mi">1</span>        <span class="mi">4</span>     <span class="mi">6</span>        <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>     <span class="mi">2</span>        <span class="mi">5</span>     <span class="mi">7</span>       <span class="mi">10</span></span></span></code></pre></td></tr></table>
</div>
</div><p>当调用stack，我们可以指明轴的名字：</p>
<div class="highlight" id="id-58"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">138</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">138</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">state</span>         <span class="n">Colorado</span>  <span class="n">Ohio</span>
</span></span><span class="line"><span class="cl"><span class="n">number</span> <span class="n">side</span>                 
</span></span><span class="line"><span class="cl"><span class="n">one</span>    <span class="n">left</span>          <span class="mi">3</span>     <span class="mi">0</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span>         <span class="mi">8</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">two</span>    <span class="n">left</span>          <span class="mi">4</span>     <span class="mi">1</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span>         <span class="mi">9</span>     <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">three</span>  <span class="n">left</span>          <span class="mi">5</span>     <span class="mi">2</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span>        <span class="mi">10</span>     <span class="mi">7</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="832-将长格式旋转为宽格式">8.3.2 将“长格式”旋转为“宽格式”</h3>
<p>多个时间序列数据通常是以所谓的“长格式”（long）或“堆叠格式”（stacked）存储在数据库和CSV中的。我们先加载一些示例数据，做一些时间序列规整和数据清洗：</p>
<div class="highlight" id="id-59"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/macrodata.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">140</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">     <span class="n">year</span>  <span class="n">quarter</span>   <span class="n">realgdp</span>  <span class="n">realcons</span>  <span class="n">realinv</span>  <span class="n">realgovt</span>  <span class="n">realdpi</span>    <span class="n">cpi</span>  \
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">1959.0</span>      <span class="mf">1.0</span>  <span class="mf">2710.349</span>    <span class="mf">1707.4</span>  <span class="mf">286.898</span>   <span class="mf">470.045</span>   <span class="mf">1886.9</span>  <span class="mf">28.98</span>   
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">1959.0</span>      <span class="mf">2.0</span>  <span class="mf">2778.801</span>    <span class="mf">1733.7</span>  <span class="mf">310.859</span>   <span class="mf">481.301</span>   <span class="mf">1919.7</span>  <span class="mf">29.15</span>   
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">1959.0</span>      <span class="mf">3.0</span>  <span class="mf">2775.488</span>    <span class="mf">1751.8</span>  <span class="mf">289.226</span>   <span class="mf">491.260</span>   <span class="mf">1916.4</span>  <span class="mf">29.35</span>   
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">1959.0</span>      <span class="mf">4.0</span>  <span class="mf">2785.204</span>    <span class="mf">1753.7</span>  <span class="mf">299.356</span>   <span class="mf">484.052</span>   <span class="mf">1931.3</span>  <span class="mf">29.37</span>   
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">1960.0</span>      <span class="mf">1.0</span>  <span class="mf">2847.699</span>    <span class="mf">1770.5</span>  <span class="mf">331.722</span>   <span class="mf">462.199</span>   <span class="mf">1955.5</span>  <span class="mf">29.54</span>   
</span></span><span class="line"><span class="cl">      <span class="n">m1</span>  <span class="n">tbilrate</span>  <span class="n">unemp</span>      <span class="n">pop</span>  <span class="n">infl</span>  <span class="n">realint</span>  
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mf">139.7</span>      <span class="mf">2.82</span>    <span class="mf">5.8</span>  <span class="mf">177.146</span>  <span class="mf">0.00</span>     <span class="mf">0.00</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mf">141.7</span>      <span class="mf">3.08</span>    <span class="mf">5.1</span>  <span class="mf">177.830</span>  <span class="mf">2.34</span>     <span class="mf">0.74</span>  
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mf">140.5</span>      <span class="mf">3.82</span>    <span class="mf">5.3</span>  <span class="mf">178.657</span>  <span class="mf">2.74</span>     <span class="mf">1.09</span>  
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="mf">140.0</span>      <span class="mf">4.33</span>    <span class="mf">5.6</span>  <span class="mf">179.386</span>  <span class="mf">0.27</span>     <span class="mf">4.06</span>  
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="mf">139.6</span>      <span class="mf">3.50</span>    <span class="mf">5.2</span>  <span class="mf">180.007</span>  <span class="mf">2.31</span>     <span class="mf">1.19</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">periods</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">quarter</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">142</span><span class="p">]:</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;realgdp&#39;</span><span class="p">,</span> <span class="s1">&#39;infl&#39;</span><span class="p">,</span> <span class="s1">&#39;unemp&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">143</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">144</span><span class="p">]:</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">periods</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="n">ldata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这就是多个时间序列（或者其它带有两个或多个键的可观察数据，这里，我们的键是date和item）的长格式。表中的每行代表一次观察。</p>
<p>关系型数据库（如MySQL）中的数据经常都是这样存储的，因为固定架构（即列名和数据类型）有一个好处：随着表中数据的添加，item列中的值的种类能够增加。在前面的例子中，date和item通常就是主键（用关系型数据库的说法），不仅提供了关系完整性，而且提供了更为简单的查询支持。有的情况下，使用这样的数据会很麻烦，你可能会更喜欢DataFrame，不同的item值分别形成一列，date列中的时间戳则用作索引。DataFrame的pivot方法完全可以实现这个转换：</p>
<div class="highlight" id="id-60"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">147</span><span class="p">]:</span> <span class="n">pivoted</span> <span class="o">=</span> <span class="n">ldata</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">148</span><span class="p">]:</span> <span class="n">pivoted</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">148</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>    <span class="n">realgdp</span>  <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                              
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>   <span class="mf">2710.349</span>    <span class="mf">5.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>   <span class="mf">2778.801</span>    <span class="mf">5.1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>   <span class="mf">2775.488</span>    <span class="mf">5.3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>   <span class="mf">2785.204</span>    <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>   <span class="mf">2847.699</span>    <span class="mf">5.2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">0.14</span>   <span class="mf">2834.390</span>    <span class="mf">5.2</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.70</span>   <span class="mf">2839.022</span>    <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">1.21</span>   <span class="mf">2802.616</span>    <span class="mf">6.3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1961</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span> <span class="o">-</span><span class="mf">0.40</span>   <span class="mf">2819.264</span>    <span class="mf">6.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1961</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">1.47</span>   <span class="mf">2872.005</span>    <span class="mf">7.0</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>          <span class="o">...</span>        <span class="o">...</span>    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="mi">2007</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.75</span>  <span class="mf">13203.977</span>    <span class="mf">4.5</span>
</span></span><span class="line"><span class="cl"><span class="mi">2007</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">3.45</span>  <span class="mf">13321.109</span>    <span class="mf">4.7</span>
</span></span><span class="line"><span class="cl"><span class="mi">2007</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">6.38</span>  <span class="mf">13391.249</span>    <span class="mf">4.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.82</span>  <span class="mf">13366.865</span>    <span class="mf">4.9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">8.53</span>  <span class="mf">13415.266</span>    <span class="mf">5.4</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span> <span class="o">-</span><span class="mf">3.16</span>  <span class="mf">13324.600</span>    <span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mi">2008</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="o">-</span><span class="mf">8.79</span>  <span class="mf">13141.920</span>    <span class="mf">6.9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2009</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.94</span>  <span class="mf">12925.410</span>    <span class="mf">8.1</span>
</span></span><span class="line"><span class="cl"><span class="mi">2009</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">3.37</span>  <span class="mf">12901.504</span>    <span class="mf">9.2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2009</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">3.56</span>  <span class="mf">12990.341</span>    <span class="mf">9.6</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">203</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">columns</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><p>前两个传递的值分别用作行和列索引，最后一个可选值则是用于填充DataFrame的数据列。假设有两个需要同时重塑的数据列：</p>
<div class="highlight" id="id-61"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">149</span><span class="p">]:</span> <span class="n">ldata</span><span class="p">[</span><span class="s1">&#39;value2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ldata</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">150</span><span class="p">]:</span> <span class="n">ldata</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">150</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">        <span class="n">date</span>     <span class="n">item</span>     <span class="n">value</span>    <span class="n">value2</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="n">realgdp</span>  <span class="mf">2710.349</span>  <span class="mf">0.523772</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>     <span class="n">infl</span>     <span class="mf">0.000</span>  <span class="mf">0.000940</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>    <span class="n">unemp</span>     <span class="mf">5.800</span>  <span class="mf">1.343810</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="n">realgdp</span>  <span class="mf">2778.801</span> <span class="o">-</span><span class="mf">0.713544</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>     <span class="n">infl</span>     <span class="mf">2.340</span> <span class="o">-</span><span class="mf">0.831154</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>    <span class="n">unemp</span>     <span class="mf">5.100</span> <span class="o">-</span><span class="mf">2.370232</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="n">realgdp</span>  <span class="mf">2775.488</span> <span class="o">-</span><span class="mf">1.860761</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>     <span class="n">infl</span>     <span class="mf">2.740</span> <span class="o">-</span><span class="mf">0.860757</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>    <span class="n">unemp</span>     <span class="mf">5.300</span>  <span class="mf">0.560145</span>
</span></span><span class="line"><span class="cl"><span class="mi">9</span> <span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="n">realgdp</span>  <span class="mf">2785.204</span> <span class="o">-</span><span class="mf">1.265934</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果忽略最后一个参数，得到的DataFrame就会带有层次化的列：</p>
<div class="highlight" id="id-62"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">151</span><span class="p">]:</span> <span class="n">pivoted</span> <span class="o">=</span> <span class="n">ldata</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">152</span><span class="p">]:</span> <span class="n">pivoted</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">152</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">           <span class="n">value</span>                    <span class="n">value2</span>                    
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>   <span class="n">realgdp</span> <span class="n">unemp</span>      <span class="n">infl</span>   <span class="n">realgdp</span>     <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                                                          
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>  <span class="mf">2710.349</span>   <span class="mf">5.8</span>  <span class="mf">0.000940</span>  <span class="mf">0.523772</span>  <span class="mf">1.343810</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>  <span class="mf">2778.801</span>   <span class="mf">5.1</span> <span class="o">-</span><span class="mf">0.831154</span> <span class="o">-</span><span class="mf">0.713544</span> <span class="o">-</span><span class="mf">2.370232</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>  <span class="mf">2775.488</span>   <span class="mf">5.3</span> <span class="o">-</span><span class="mf">0.860757</span> <span class="o">-</span><span class="mf">1.860761</span>  <span class="mf">0.560145</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>  <span class="mf">2785.204</span>   <span class="mf">5.6</span>  <span class="mf">0.119827</span> <span class="o">-</span><span class="mf">1.265934</span> <span class="o">-</span><span class="mf">1.063512</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>  <span class="mf">2847.699</span>   <span class="mf">5.2</span> <span class="o">-</span><span class="mf">2.359419</span>  <span class="mf">0.332883</span> <span class="o">-</span><span class="mf">0.199543</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">153</span><span class="p">]:</span> <span class="n">pivoted</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">153</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>   <span class="n">realgdp</span>  <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                             
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>  <span class="mf">2710.349</span>    <span class="mf">5.8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>  <span class="mf">2778.801</span>    <span class="mf">5.1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>  <span class="mf">2775.488</span>    <span class="mf">5.3</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>  <span class="mf">2785.204</span>    <span class="mf">5.6</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>  <span class="mf">2847.699</span>    <span class="mf">5.2</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意，pivot其实就是用set_index创建层次化索引，再用unstack重塑：</p>
<div class="highlight" id="id-63"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">154</span><span class="p">]:</span> <span class="n">unstacked</span> <span class="o">=</span> <span class="n">ldata</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">155</span><span class="p">]:</span> <span class="n">unstacked</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">155</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">           <span class="n">value</span>                    <span class="n">value2</span>                    
</span></span><span class="line"><span class="cl"><span class="n">item</span>        <span class="n">infl</span>   <span class="n">realgdp</span> <span class="n">unemp</span>      <span class="n">infl</span>   <span class="n">realgdp</span>     <span class="n">unemp</span>
</span></span><span class="line"><span class="cl"><span class="n">date</span>                                                          
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.00</span>  <span class="mf">2710.349</span>   <span class="mf">5.8</span>  <span class="mf">0.000940</span>  <span class="mf">0.523772</span>  <span class="mf">1.343810</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.34</span>  <span class="mf">2778.801</span>   <span class="mf">5.1</span> <span class="o">-</span><span class="mf">0.831154</span> <span class="o">-</span><span class="mf">0.713544</span> <span class="o">-</span><span class="mf">2.370232</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.74</span>  <span class="mf">2775.488</span>   <span class="mf">5.3</span> <span class="o">-</span><span class="mf">0.860757</span> <span class="o">-</span><span class="mf">1.860761</span>  <span class="mf">0.560145</span>
</span></span><span class="line"><span class="cl"><span class="mi">1959</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">0.27</span>  <span class="mf">2785.204</span>   <span class="mf">5.6</span>  <span class="mf">0.119827</span> <span class="o">-</span><span class="mf">1.265934</span> <span class="o">-</span><span class="mf">1.063512</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>  <span class="mf">2.31</span>  <span class="mf">2847.699</span>   <span class="mf">5.2</span> <span class="o">-</span><span class="mf">2.359419</span>  <span class="mf">0.332883</span> <span class="o">-</span><span class="mf">0.199543</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">0.14</span>  <span class="mf">2834.390</span>   <span class="mf">5.2</span> <span class="o">-</span><span class="mf">0.970736</span> <span class="o">-</span><span class="mf">1.541996</span> <span class="o">-</span><span class="mf">1.307030</span>
</span></span><span class="line"><span class="cl"><span class="mi">1960</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>  <span class="mf">2.70</span>  <span class="mf">2839.022</span>   <span class="mf">5.6</span>  <span class="mf">0.377984</span>  <span class="mf">0.286350</span> <span class="o">-</span><span class="mf">0.753887</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="833-将宽格式旋转为长格式">8.3.3 将“宽格式”旋转为“长格式”</h3>
<p>旋转DataFrame的逆运算是pandas.melt。它不是将一列转换到多个新的DataFrame，而是合并多个列成为一个，产生一个比输入长的DataFrame。看一个例子：</p>
<div class="highlight" id="id-64"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">157</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="n">df</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">158</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">A</span>  <span class="n">B</span>  <span class="n">C</span>  <span class="n">key</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span>  <span class="n">foo</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>  <span class="n">bar</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>  <span class="n">baz</span></span></span></code></pre></td></tr></table>
</div>
</div><p>key列可能是分组指标，其它的列是数据值。当使用pandas.melt，我们必须指明哪些列是分组指标。下面使用key作为唯一的分组指标：</p>
<div class="highlight" id="id-65"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">159</span><span class="p">]:</span> <span class="n">melted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">160</span><span class="p">]:</span> <span class="n">melted</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">160</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">key</span> <span class="n">variable</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>        <span class="n">A</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">bar</span>        <span class="n">A</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">baz</span>        <span class="n">A</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>        <span class="n">B</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>        <span class="n">B</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">baz</span>        <span class="n">B</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>  <span class="n">foo</span>        <span class="n">C</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>  <span class="n">bar</span>        <span class="n">C</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>  <span class="n">baz</span>        <span class="n">C</span>      <span class="mi">9</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用pivot，可以重塑回原来的样子：</p>
<div class="highlight" id="id-66"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">161</span><span class="p">]:</span> <span class="n">reshaped</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">162</span><span class="p">]:</span> <span class="n">reshaped</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">162</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">variable</span>  <span class="n">A</span>  <span class="n">B</span>  <span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span>              
</span></span><span class="line"><span class="cl"><span class="n">bar</span>       <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="n">baz</span>       <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">foo</span>       <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span></span></span></code></pre></td></tr></table>
</div>
</div><p>因为pivot的结果从列创建了一个索引，用作行标签，我们可以使用reset_index将数据移回列：</p>
<div class="highlight" id="id-67"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">163</span><span class="p">]:</span> <span class="n">reshaped</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">163</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl"><span class="n">variable</span>  <span class="n">key</span>  <span class="n">A</span>  <span class="n">B</span>  <span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>         <span class="n">bar</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>         <span class="n">baz</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>         <span class="n">foo</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span></span></span></code></pre></td></tr></table>
</div>
</div><p>你还可以指定列的子集，作为值的列：</p>
<div class="highlight" id="id-68"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">164</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">164</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">key</span> <span class="n">variable</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>  <span class="n">foo</span>        <span class="n">A</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>  <span class="n">bar</span>        <span class="n">A</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>  <span class="n">baz</span>        <span class="n">A</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>  <span class="n">foo</span>        <span class="n">B</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>  <span class="n">bar</span>        <span class="n">B</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>  <span class="n">baz</span>        <span class="n">B</span>      <span class="mi">6</span></span></span></code></pre></td></tr></table>
</div>
</div><p>pandas.melt也可以不用分组指标：</p>
<div class="highlight" id="id-69"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">165</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">165</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">variable</span>  <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>        <span class="n">A</span>      <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>        <span class="n">A</span>      <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>        <span class="n">A</span>      <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>        <span class="n">B</span>      <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>        <span class="n">B</span>      <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>        <span class="n">B</span>      <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>        <span class="n">C</span>      <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>        <span class="n">C</span>      <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>        <span class="n">C</span>      <span class="mi">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">In</span> <span class="p">[</span><span class="mi">166</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">Out</span><span class="p">[</span><span class="mi">166</span><span class="p">]:</span> 
</span></span><span class="line"><span class="cl">  <span class="n">variable</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl"><span class="mi">0</span>      <span class="n">key</span>   <span class="n">foo</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>      <span class="n">key</span>   <span class="n">bar</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>      <span class="n">key</span>   <span class="n">baz</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span>        <span class="n">A</span>     <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>        <span class="n">A</span>     <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>        <span class="n">A</span>     <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>        <span class="n">B</span>     <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>        <span class="n">B</span>     <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="mi">8</span>        <span class="n">B</span>     <span class="mi">6</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="84-总结">8.4 总结</h2>
<p>现在你已经掌握了pandas数据导入、清洗、重塑，我们可以进一步学习<code>matplotlib</code>数据可视化。我们在稍后会回到pandas，学习更高级的分析。</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-09-25 00:00:00">更新于 2023-09-25&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="http://richfan.site/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch08-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%E8%81%9A%E5%90%88%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91/" data-title="第八章 数据规整：聚合、合并和重塑" data-ralateuid="u/6067824622"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/python/' class="post-tag">python</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/program/python/python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/ch02-python%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E5%92%8Cipython%E4%BB%A5%E5%8F%8Ajupyternotebooks/" class="post-nav-item" rel="prev" title="第二章 Python 语法基础，IPython 和 Jupyter Notebooks"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>第二章 Python 语法基础，IPython 和 Jupyter Notebooks</a>
      <a href="/posts/program/python/python%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ch8-%E9%94%99%E8%AF%AF%E8%B0%83%E8%AF%95%E5%92%8C%E6%B5%8B%E8%AF%95/" class="post-nav-item" rel="next" title="第八章 错误、调试和测试">第八章 错误、调试和测试<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
        Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/" rel="external nofollow noopener noreferrer">Valine</a>.
      </noscript></div></article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2020 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="https://richfan.site/"target="_blank" rel="external nofollow noopener noreferrer">richfan</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div><div class="footer-line beian"><span class="gov">京公网安备 11010502049321号</span><span class="icp footer-divider">京ICP备2022007001号-1</span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div><div class="fixed-button view-comments d-none" role="button" aria-label="查看评论"><i class="fa-solid fa-comment fa-fw" aria-hidden="true"></i></div></div><a href="https://github.com/fanrich" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/valine/Valine.min.js"></script><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":true,"expired":false,"valine":{"appId":"UCqeAbhsO8qZMRwuu7ysnv8c-gzGzoHsz","appKey":"ybrvk4jJU0fLRQAgErJuPhoT","avatar":"wavatar","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"","pageSize":10,"placeholder":"你的评论……","recordIP":true,"visitor":true}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"typeit-header-desktop":"樊刹","typeit-header-subtitle-desktop":"不渡尘心","typeit-header-subtitle-mobile":"不渡尘心","typeit-header-title-mobile":"樊刹"},"enablePWA":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},"duration":-1,"loop":false,"speed":100}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
