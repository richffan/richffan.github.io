# ç¬¬å››ç«  å‡½æ•°å¼ç¼–ç¨‹


å‡½æ•°æ˜¯ Python å†…å»ºæ”¯æŒçš„ä¸€ç§å°è£…ï¼Œæˆ‘ä»¬é€šè¿‡æŠŠå¤§æ®µä»£ç æ‹†æˆå‡½æ•°ï¼Œé€šè¿‡ä¸€å±‚ä¸€å±‚çš„å‡½æ•°è°ƒç”¨ï¼Œå°±å¯ä»¥æŠŠå¤æ‚ä»»åŠ¡åˆ†è§£æˆç®€å•çš„ä»»åŠ¡ï¼Œè¿™ç§åˆ†è§£å¯ä»¥ç§°ä¹‹ä¸ºé¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡ã€‚å‡½æ•°å°±æ˜¯é¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡çš„åŸºæœ¬å•å…ƒã€‚

è€Œå‡½æ•°å¼ç¼–ç¨‹ï¼ˆè¯·æ³¨æ„å¤šäº†ä¸€ä¸ªâ€œå¼â€å­—ï¼‰â€”â€” Functional Programmingï¼Œè™½ç„¶ä¹Ÿå¯ä»¥å½’ç»“åˆ°é¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡ï¼Œä½†å…¶æ€æƒ³æ›´æŽ¥è¿‘æ•°å­¦è®¡ç®—ã€‚

æˆ‘ä»¬é¦–å…ˆè¦æžæ˜Žç™½è®¡ç®—æœºï¼ˆComputerï¼‰å’Œè®¡ç®—ï¼ˆComputeï¼‰çš„æ¦‚å¿µã€‚

åœ¨è®¡ç®—æœºçš„å±‚æ¬¡ä¸Šï¼ŒCPU æ‰§è¡Œçš„æ˜¯åŠ å‡ä¹˜é™¤çš„`æŒ‡ä»¤ä»£ç `ï¼Œä»¥åŠå„ç§æ¡ä»¶åˆ¤æ–­å’Œè·³è½¬æŒ‡ä»¤ï¼Œæ‰€ä»¥ï¼Œæ±‡ç¼–è¯­è¨€æ˜¯æœ€è´´è¿‘è®¡ç®—æœºçš„è¯­è¨€ã€‚

è€Œè®¡ç®—åˆ™æŒ‡æ•°å­¦æ„ä¹‰ä¸Šçš„è®¡ç®—ï¼Œè¶Šæ˜¯æŠ½è±¡çš„è®¡ç®—ï¼Œç¦»è®¡ç®—æœºç¡¬ä»¶è¶Šè¿œã€‚

å¯¹åº”åˆ°ç¼–ç¨‹è¯­è¨€ï¼Œå°±æ˜¯è¶Šä½Žçº§çš„è¯­è¨€ï¼Œè¶Šè´´è¿‘è®¡ç®—æœºï¼ŒæŠ½è±¡ç¨‹åº¦ä½Žï¼Œæ‰§è¡Œæ•ˆçŽ‡é«˜ï¼Œæ¯”å¦‚ C è¯­è¨€ï¼›è¶Šé«˜çº§çš„è¯­è¨€ï¼Œè¶Šè´´è¿‘è®¡ç®—ï¼ŒæŠ½è±¡ç¨‹åº¦é«˜ï¼Œæ‰§è¡Œæ•ˆçŽ‡ä½Žï¼Œæ¯”å¦‚ Lisp è¯­è¨€ã€‚

&gt; ðŸŽðŸŽ‰ è¯žç”Ÿ 50 å¤šå¹´ä¹‹åŽï¼Œ[å‡½æ•°å¼ç¼–ç¨‹](http://en.wikipedia.org/wiki/Functional_programming)ï¼ˆfunctional programmingï¼‰å¼€å§‹èŽ·å¾—è¶Šæ¥è¶Šå¤šçš„å…³æ³¨ã€‚ä¸ä»…æœ€å¤è€çš„å‡½æ•°å¼è¯­è¨€ Lisp é‡èŽ·é’æ˜¥ï¼Œè€Œä¸”æ–°çš„å‡½æ•°å¼è¯­è¨€å±‚å‡ºä¸ç©·ï¼Œæ¯”å¦‚ Erlangã€clojureã€Scalaã€F# ç­‰ç­‰ã€‚ç›®å‰æœ€å½“çº¢çš„ Pythonã€Rubyã€Javascriptï¼Œå¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒéƒ½å¾ˆå¼ºï¼Œå°±è¿žè€ç‰Œçš„é¢å‘å¯¹è±¡çš„ Javaã€é¢å‘è¿‡ç¨‹çš„ PHPï¼Œéƒ½å¿™ä¸è¿­åœ°åŠ å…¥å¯¹åŒ¿åå‡½æ•°çš„æ”¯æŒã€‚è¶Šæ¥è¶Šå¤šçš„è¿¹è±¡è¡¨æ˜Žï¼Œå‡½æ•°å¼ç¼–ç¨‹å·²ç»ä¸å†æ˜¯å­¦æœ¯ç•Œçš„æœ€çˆ±ï¼Œå¼€å§‹å¤§è¸æ­¥åœ°åœ¨ä¸šç•ŒæŠ•å…¥å®žç”¨ã€‚ä¹Ÿè®¸ç»§&#34;é¢å‘å¯¹è±¡ç¼–ç¨‹&#34;ä¹‹åŽï¼Œ&#34;å‡½æ•°å¼ç¼–ç¨‹&#34;ä¼šæˆä¸ºä¸‹ä¸€ä¸ªç¼–ç¨‹çš„ä¸»æµèŒƒå¼ï¼ˆparadigmï¼‰ã€‚

## 4.1 ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹

å‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯ä¸€ç§æŠ½è±¡ç¨‹åº¦å¾ˆé«˜çš„ç¼–ç¨‹èŒƒå¼ï¼Œçº¯ç²¹çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„å‡½æ•°æ²¡æœ‰å˜é‡ï¼Œå› æ­¤ï¼Œä»»æ„ä¸€ä¸ªå‡½æ•°ï¼Œåªè¦è¾“å…¥æ˜¯ç¡®å®šçš„ï¼Œè¾“å‡ºå°±æ˜¯ç¡®å®šçš„ï¼Œè¿™ç§çº¯å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºæ²¡æœ‰å‰¯ä½œç”¨ã€‚è€Œå…è®¸ä½¿ç”¨å˜é‡çš„ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œç”±äºŽå‡½æ•°å†…éƒ¨çš„å˜é‡çŠ¶æ€ä¸ç¡®å®šï¼ŒåŒæ ·çš„è¾“å…¥ï¼Œå¯èƒ½å¾—åˆ°ä¸åŒçš„è¾“å‡ºï¼Œå› æ­¤ï¼Œè¿™ç§å‡½æ•°æ˜¯æœ‰å‰¯ä½œç”¨çš„ã€‚

ðŸ”Š å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ï¼Œå…è®¸æŠŠå‡½æ•°æœ¬èº«ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œè¿˜å…è®¸è¿”å›žä¸€ä¸ªå‡½æ•°ï¼

Python å¯¹å‡½æ•°å¼ç¼–ç¨‹æä¾›éƒ¨åˆ†æ”¯æŒã€‚ç”±äºŽ Python å…è®¸ä½¿ç”¨å˜é‡ï¼Œå› æ­¤ï¼ŒPython ä¸æ˜¯çº¯å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ã€‚

### 4.1.1 å®šä¹‰

ç®€å•è¯´ï¼Œ&#34;å‡½æ•°å¼ç¼–ç¨‹&#34;æ˜¯ä¸€ç§[&#34;ç¼–ç¨‹èŒƒå¼&#34;](http://en.wikipedia.org/wiki/Programming_paradigm)ï¼ˆprogramming paradigmï¼‰ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•ç¼–å†™ç¨‹åºçš„æ–¹æ³•è®ºã€‚å®ƒå±žäºŽ[&#34;ç»“æž„åŒ–ç¼–ç¨‹&#34;](http://en.wikipedia.org/wiki/Structured_programming)çš„ä¸€ç§ï¼Œä¸»è¦æ€æƒ³æ˜¯æŠŠè¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°è°ƒç”¨ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼ŒçŽ°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼ï¼š

```python
(1 &#43; 2) * 3 - 4
```

ä¼ ç»Ÿçš„è¿‡ç¨‹å¼ç¼–ç¨‹ï¼Œå¯èƒ½è¿™æ ·å†™ï¼š

```
var a = 1 &#43; 2;
var b = a * 3;
var c = b - 4;
```

å‡½æ•°å¼ç¼–ç¨‹è¦æ±‚ä½¿ç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ**è¿ç®—è¿‡ç¨‹**å®šä¹‰ä¸ºä¸åŒçš„å‡½æ•°ï¼Œç„¶åŽå†™æˆä¸‹é¢è¿™æ ·ï¼š

```
var result = subtract(multiply(add(1,2), 3), 4);
```

è¿™å°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹ã€‚

### 4.1.2 ç‰¹ç‚¹

å‡½æ•°å¼ç¼–ç¨‹å…·æœ‰äº”ä¸ªé²œæ˜Žçš„ç‰¹ç‚¹ã€‚

#### â‘  å‡½æ•°æ˜¯&#34;ç¬¬ä¸€ç­‰å…¬æ°‘&#34;

æ‰€è°“[&#34;ç¬¬ä¸€ç­‰å…¬æ°‘&#34;](http://en.wikipedia.org/wiki/First-class_function)ï¼ˆfirst classï¼‰ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°ä¸Žå…¶ä»–æ•°æ®ç±»åž‹ä¸€æ ·ï¼Œå¤„äºŽå¹³ç­‰åœ°ä½ï¼Œå¯ä»¥èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…ä½œä¸ºåˆ«çš„å‡½æ•°çš„è¿”å›žå€¼ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œä¸‹é¢ä»£ç ä¸­çš„ print å˜é‡å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ã€‚

```
var print = function(i){ 
	console.log(i);
};
[1,2,3].forEach(print);
```

#### â‘¡ åªç”¨&#34;è¡¨è¾¾å¼&#34;ï¼Œä¸ç”¨&#34;è¯­å¥&#34;

&#34;è¡¨è¾¾å¼&#34;ï¼ˆexpressionï¼‰æ˜¯ä¸€ä¸ªå•çº¯çš„è¿ç®—è¿‡ç¨‹ï¼Œæ€»æ˜¯æœ‰è¿”å›žå€¼ï¼›&#34;è¯­å¥&#34;ï¼ˆstatementï¼‰æ˜¯æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›žå€¼ã€‚å‡½æ•°å¼ç¼–ç¨‹è¦æ±‚ï¼Œåªä½¿ç”¨è¡¨è¾¾å¼ï¼Œä¸ä½¿ç”¨è¯­å¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å•çº¯çš„è¿ç®—ï¼Œè€Œä¸”éƒ½æœ‰è¿”å›žå€¼ã€‚

åŽŸå› æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„å¼€å‘åŠ¨æœºï¼Œä¸€å¼€å§‹å°±æ˜¯ä¸ºäº†å¤„ç†è¿ç®—ï¼ˆcomputationï¼‰ï¼Œä¸è€ƒè™‘ç³»ç»Ÿçš„è¯»å†™ï¼ˆI/Oï¼‰ã€‚&#34;è¯­å¥&#34;å±žäºŽå¯¹ç³»ç»Ÿçš„è¯»å†™æ“ä½œï¼Œæ‰€ä»¥å°±è¢«æŽ’æ–¥åœ¨å¤–ã€‚

å½“ç„¶ï¼Œå®žé™…åº”ç”¨ä¸­ï¼Œä¸åš I/O æ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå‡½æ•°å¼ç¼–ç¨‹åªè¦æ±‚æŠŠ I/O é™åˆ¶åˆ°æœ€å°ï¼Œä¸è¦æœ‰ä¸å¿…è¦çš„è¯»å†™è¡Œä¸ºï¼Œä¿æŒè®¡ç®—è¿‡ç¨‹çš„å•çº¯æ€§ã€‚

#### â‘¢ æ²¡æœ‰&#34;å‰¯ä½œç”¨&#34;

æ‰€è°“[&#34;å‰¯ä½œç”¨&#34;](http://en.wikipedia.org/wiki/Side_effect_(computer_science))ï¼ˆside effectï¼‰ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°å†…éƒ¨ä¸Žå¤–éƒ¨äº’åŠ¨ï¼ˆæœ€å…¸åž‹çš„æƒ…å†µï¼Œå°±æ˜¯ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ï¼‰ï¼Œäº§ç”Ÿè¿ç®—ä»¥å¤–çš„å…¶ä»–ç»“æžœã€‚

å‡½æ•°å¼ç¼–ç¨‹å¼ºè°ƒæ²¡æœ‰&#34;å‰¯ä½œç”¨&#34;ï¼Œæ„å‘³ç€å‡½æ•°è¦ä¿æŒç‹¬ç«‹ï¼Œæ‰€æœ‰åŠŸèƒ½å°±æ˜¯è¿”å›žä¸€ä¸ªæ–°çš„å€¼ï¼Œæ²¡æœ‰å…¶ä»–è¡Œä¸ºï¼Œå°¤å…¶æ˜¯ä¸å¾—ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ã€‚

#### â‘£ ä¸ä¿®æ”¹çŠ¶æ€

ä¸Šä¸€ç‚¹å·²ç»æåˆ°ï¼Œå‡½æ•°å¼ç¼–ç¨‹åªæ˜¯è¿”å›žæ–°çš„å€¼ï¼Œä¸ä¿®æ”¹ç³»ç»Ÿå˜é‡ã€‚å› æ­¤ï¼Œä¸ä¿®æ”¹å˜é‡ï¼Œä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ã€‚

åœ¨å…¶ä»–ç±»åž‹çš„è¯­è¨€ä¸­ï¼Œå˜é‡å¾€å¾€ç”¨æ¥ä¿å­˜&#34;çŠ¶æ€&#34;ï¼ˆstateï¼‰ã€‚ä¸ä¿®æ”¹å˜é‡ï¼Œæ„å‘³ç€çŠ¶æ€ä¸èƒ½ä¿å­˜åœ¨å˜é‡ä¸­ã€‚å‡½æ•°å¼ç¼–ç¨‹ä½¿ç”¨å‚æ•°ä¿å­˜çŠ¶æ€ï¼Œæœ€å¥½çš„ä¾‹å­å°±æ˜¯é€’å½’ã€‚ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå°†å­—ç¬¦ä¸²é€†åºæŽ’åˆ—çš„å‡½æ•°ï¼Œå®ƒæ¼”ç¤ºäº†ä¸åŒçš„å‚æ•°å¦‚ä½•å†³å®šäº†è¿ç®—æ‰€å¤„çš„&#34;çŠ¶æ€&#34;ã€‚

```
function reverse(string) {
ã€€ã€€ã€€ã€€if(string.length == 0) {
ã€€ã€€ã€€ã€€ã€€ã€€return string;
ã€€ã€€ã€€ã€€} else {
ã€€ã€€ã€€ã€€ã€€ã€€return reverse(string.substring(1, string.length)) &#43; string.substring(0, 1);
ã€€ã€€ã€€ã€€}
ã€€ã€€}
```

ç”±äºŽä½¿ç”¨äº†é€’å½’ï¼Œå‡½æ•°å¼è¯­è¨€çš„è¿è¡Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™æ˜¯å®ƒé•¿æœŸä¸èƒ½åœ¨ä¸šç•ŒæŽ¨å¹¿çš„ä¸»è¦åŽŸå› ã€‚

#### â‘¤ å¼•ç”¨é€æ˜Ž

å¼•ç”¨é€æ˜Žï¼ˆReferential transparencyï¼‰ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°çš„è¿è¡Œä¸ä¾èµ–äºŽå¤–éƒ¨å˜é‡æˆ–&#34;çŠ¶æ€&#34;ï¼Œåªä¾èµ–äºŽè¾“å…¥çš„å‚æ•°ï¼Œä»»ä½•æ—¶å€™åªè¦å‚æ•°ç›¸åŒï¼Œå¼•ç”¨å‡½æ•°æ‰€å¾—åˆ°çš„è¿”å›žå€¼æ€»æ˜¯ç›¸åŒçš„ã€‚

æœ‰äº†å‰é¢çš„ç¬¬ä¸‰ç‚¹å’Œç¬¬å››ç‚¹ï¼Œè¿™ç‚¹æ˜¯å¾ˆæ˜¾ç„¶çš„ã€‚å…¶ä»–ç±»åž‹çš„è¯­è¨€ï¼Œå‡½æ•°çš„è¿”å›žå€¼å¾€å¾€ä¸Žç³»ç»ŸçŠ¶æ€æœ‰å…³ï¼Œä¸åŒçš„çŠ¶æ€ä¹‹ä¸‹ï¼Œè¿”å›žå€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™å°±å«&#34;å¼•ç”¨ä¸é€æ˜Ž&#34;ï¼Œå¾ˆä¸åˆ©äºŽè§‚å¯Ÿå’Œç†è§£ç¨‹åºçš„è¡Œä¸ºã€‚

### 4.1.3 å¥½å¤„

å‡½æ•°å¼ç¼–ç¨‹åˆ°åº•æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆä¼šå˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Ÿ

#### â‘  ä»£ç ç®€æ´ï¼Œå¼€å‘å¿«é€Ÿ

å‡½æ•°å¼ç¼–ç¨‹å¤§é‡ä½¿ç”¨å‡½æ•°ï¼Œå‡å°‘äº†ä»£ç çš„é‡å¤ï¼Œå› æ­¤ç¨‹åºæ¯”è¾ƒçŸ­ï¼Œå¼€å‘é€Ÿåº¦è¾ƒå¿«ã€‚

#### â‘¡ æŽ¥è¿‘è‡ªç„¶è¯­è¨€ï¼Œæ˜“äºŽç†è§£

å‡½æ•°å¼ç¼–ç¨‹çš„è‡ªç”±åº¦å¾ˆé«˜ï¼Œå¯ä»¥å†™å‡ºå¾ˆæŽ¥è¿‘è‡ªç„¶è¯­è¨€çš„ä»£ç ã€‚

å‰æ–‡æ›¾ç»å°†è¡¨è¾¾å¼ (1 &#43; 2) * 3 - 4ï¼Œå†™æˆå‡½æ•°å¼è¯­è¨€ï¼š

```
subtract(multiply(add(1,2), 3), 4)
```

å¯¹å®ƒè¿›è¡Œå˜å½¢ï¼Œä¸éš¾å¾—åˆ°å¦ä¸€ç§å†™æ³•ï¼š

```
add(1,2).multiply(3).subtract(4)
```

è¿™åŸºæœ¬å°±æ˜¯è‡ªç„¶è¯­è¨€çš„è¡¨è¾¾äº†ã€‚å†çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå¤§å®¶åº”è¯¥ä¸€çœ¼å°±èƒ½æ˜Žç™½å®ƒçš„æ„æ€å§ï¼š

```
merge([1,2],[3,4]).sort().search(&#34;2&#34;)
```

å› æ­¤ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ä»£ç æ›´å®¹æ˜“ç†è§£ã€‚

#### â‘¢ æ›´æ–¹ä¾¿çš„ä»£ç ç®¡ç†

å‡½æ•°å¼ç¼–ç¨‹ä¸ä¾èµ–ã€ä¹Ÿä¸ä¼šæ”¹å˜å¤–ç•Œçš„çŠ¶æ€ï¼Œåªè¦ç»™å®šè¾“å…¥å‚æ•°ï¼Œè¿”å›žçš„ç»“æžœå¿…å®šç›¸åŒã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½å¯ä»¥è¢«çœ‹åšç‹¬ç«‹å•å…ƒï¼Œå¾ˆæœ‰åˆ©äºŽè¿›è¡Œå•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰å’Œé™¤é”™ï¼ˆdebuggingï¼‰ï¼Œä»¥åŠæ¨¡å—åŒ–ç»„åˆã€‚

#### â‘£ æ˜“äºŽ&#34;å¹¶å‘ç¼–ç¨‹&#34;

å‡½æ•°å¼ç¼–ç¨‹ä¸éœ€è¦è€ƒè™‘&#34;æ­»é”&#34;ï¼ˆdeadlockï¼‰ï¼Œå› ä¸ºå®ƒä¸ä¿®æ”¹å˜é‡ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸å­˜åœ¨&#34;é”&#34;çº¿ç¨‹çš„é—®é¢˜ã€‚ä¸å¿…æ‹…å¿ƒä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ”¾å¿ƒåœ°æŠŠå·¥ä½œåˆ†æ‘Šåˆ°å¤šä¸ªçº¿ç¨‹ï¼Œéƒ¨ç½²&#34;å¹¶å‘ç¼–ç¨‹&#34;ï¼ˆconcurrencyï¼‰ã€‚

è¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š

```
var s1 = Op1();
var s2 = Op2();
var s3 = concat(s1, s2);
```

ç”±äºŽ s1 å’Œ s2 äº’ä¸å¹²æ‰°ï¼Œä¸ä¼šä¿®æ”¹å˜é‡ï¼Œè°å…ˆæ‰§è¡Œæ˜¯æ— æ‰€è°“çš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒåœ°å¢žåŠ çº¿ç¨‹ï¼ŒæŠŠå®ƒä»¬åˆ†é…åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸Šå®Œæˆã€‚å…¶ä»–ç±»åž‹çš„è¯­è¨€å°±åšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸º s1 å¯èƒ½ä¼šä¿®æ”¹ç³»ç»ŸçŠ¶æ€ï¼Œè€Œ s2 å¯èƒ½ä¼šç”¨åˆ°è¿™äº›çŠ¶æ€ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯ s2 åœ¨ s1 ä¹‹åŽè¿è¡Œï¼Œè‡ªç„¶ä¹Ÿå°±ä¸èƒ½éƒ¨ç½²åˆ°å…¶ä»–çº¿ç¨‹ä¸Šäº†ã€‚

å¤šæ ¸ CPU æ˜¯å°†æ¥çš„æ½®æµï¼Œæ‰€ä»¥å‡½æ•°å¼ç¼–ç¨‹çš„è¿™ä¸ªç‰¹æ€§éžå¸¸é‡è¦ã€‚

#### â‘¤ ä»£ç çš„çƒ­å‡çº§

å‡½æ•°å¼ç¼–ç¨‹æ²¡æœ‰å‰¯ä½œç”¨ï¼Œåªè¦ä¿è¯æŽ¥å£ä¸å˜ï¼Œå†…éƒ¨å®žçŽ°æ˜¯å¤–éƒ¨æ— å…³çš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥åœ¨è¿è¡ŒçŠ¶æ€ä¸‹ç›´æŽ¥å‡çº§ä»£ç ï¼Œä¸éœ€è¦é‡å¯ï¼Œä¹Ÿä¸éœ€è¦åœæœºã€‚[Erlang](http://en.wikipedia.org/wiki/Erlang_(programming_language)) è¯­è¨€æ—©å°±è¯æ˜Žäº†è¿™ä¸€ç‚¹ï¼Œå®ƒæ˜¯ç‘žå…¸çˆ±ç«‹ä¿¡å…¬å¸ä¸ºäº†ç®¡ç†ç”µè¯ç³»ç»Ÿè€Œå¼€å‘çš„ï¼Œç”µè¯ç³»ç»Ÿçš„å‡çº§å½“ç„¶æ˜¯ä¸èƒ½åœæœºçš„ã€‚

&gt; ä¸‹é¢è¿›è¡Œå…·ä½“å‡½æ•°å…·ä½“ç¤ºä¾‹ä»‹ç»ï¼š

## 4.2 é«˜é˜¶å‡½æ•°

é«˜é˜¶å‡½æ•°è‹±æ–‡å« Higher-order functionã€‚ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°ï¼Ÿæˆ‘ä»¬ä»¥å®žé™…ä»£ç ä¸ºä¾‹å­ï¼Œä¸€æ­¥ä¸€æ­¥æ·±å…¥æ¦‚å¿µã€‚

**ï¼ˆ1ï¼‰å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°**

ä»¥ Python å†…ç½®çš„æ±‚ç»å¯¹å€¼çš„å‡½æ•°`abs()`ä¸ºä¾‹ï¼Œè°ƒç”¨è¯¥å‡½æ•°ç”¨ä»¥ä¸‹ä»£ç ï¼š

```python
abs(-10) # 10
```

ä½†æ˜¯ï¼Œå¦‚æžœåªå†™`abs`å‘¢ï¼Ÿ

![å‡½æ•°](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717093944.png)

å¯è§ï¼Œ`abs(-10)`æ˜¯å‡½æ•°è°ƒç”¨ï¼Œè€Œ`abs`æ˜¯å‡½æ•°æœ¬èº«ã€‚

è¦èŽ·å¾—å‡½æ•°è°ƒç”¨ç»“æžœï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç»“æžœèµ‹å€¼ç»™å˜é‡ï¼š

```python
x = abs(-10)
x # 10
```

ä½†æ˜¯ï¼Œå¦‚æžœæŠŠå‡½æ•°æœ¬èº«èµ‹å€¼ç»™å˜é‡å‘¢ï¼Ÿ

![image-20200717102554966](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717102556.png)

ç»“è®ºï¼šå‡½æ•°æœ¬èº«ä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡ï¼Œå³ï¼šå˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ã€‚

å¦‚æžœä¸€ä¸ªå˜é‡æŒ‡å‘äº†ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆï¼Œå¯å¦é€šè¿‡è¯¥å˜é‡æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Ÿç”¨ä»£ç éªŒè¯ä¸€ä¸‹ï¼š

```python
f = abs
f(10) # 10
```

æˆåŠŸï¼è¯´æ˜Žå˜é‡`f`çŽ°åœ¨å·²ç»æŒ‡å‘äº†`abs`å‡½æ•°æœ¬èº«ã€‚ç›´æŽ¥è°ƒç”¨`abs()`å‡½æ•°å’Œè°ƒç”¨å˜é‡`f()`å®Œå…¨ç›¸åŒã€‚

**ï¼ˆ2ï¼‰å‡½æ•°åä¹Ÿæ˜¯å˜é‡**

é‚£ä¹ˆå‡½æ•°åæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‡½æ•°åå…¶å®žå°±æ˜¯æŒ‡å‘å‡½æ•°çš„å˜é‡ï¼å¯¹äºŽ`abs()`è¿™ä¸ªå‡½æ•°ï¼Œå®Œå…¨å¯ä»¥æŠŠå‡½æ•°å`abs`çœ‹æˆå˜é‡ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå¯ä»¥è®¡ç®—ç»å¯¹å€¼çš„å‡½æ•°ï¼

å¦‚æžœæŠŠ`abs`æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œä¼šæœ‰ä»€ä¹ˆæƒ…å†µå‘ç”Ÿï¼Ÿ

![æŠ¥é”™](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717103810.png)

æŠŠ`abs`æŒ‡å‘`10`åŽï¼Œå°±æ— æ³•é€šè¿‡`abs(-10)`è°ƒç”¨è¯¥å‡½æ•°äº†ï¼å› ä¸º`abs`è¿™ä¸ªå˜é‡å·²ç»ä¸æŒ‡å‘æ±‚ç»å¯¹å€¼å‡½æ•°è€Œæ˜¯æŒ‡å‘ä¸€ä¸ªæ•´æ•°`10`ï¼

å½“ç„¶å®žé™…ä»£ç ç»å¯¹ä¸èƒ½è¿™ä¹ˆå†™ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†è¯´æ˜Žå‡½æ•°åä¹Ÿæ˜¯å˜é‡ã€‚è¦æ¢å¤`abs`å‡½æ•°ï¼Œè¯·é‡å¯ Python äº¤äº’çŽ¯å¢ƒã€‚

æ³¨ï¼šç”±äºŽ`abs`å‡½æ•°å®žé™…ä¸Šæ˜¯å®šä¹‰åœ¨`import builtins`æ¨¡å—ä¸­çš„ï¼Œæ‰€ä»¥è¦è®©ä¿®æ”¹`abs`å˜é‡çš„æŒ‡å‘åœ¨å…¶å®ƒæ¨¡å—ä¹Ÿç”Ÿæ•ˆï¼Œè¦ç”¨`import builtins; builtins.abs = 10`ã€‚

**ï¼ˆ3ï¼‰ä¼ å…¥å‡½æ•°**

æ—¢ç„¶å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°èƒ½æŽ¥æ”¶å˜é‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå‡½æ•°å°±å¯ä»¥æŽ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ç§å‡½æ•°å°±ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ã€‚

ä¸€ä¸ªæœ€ç®€å•çš„é«˜é˜¶å‡½æ•°ï¼š

```python
def add(x, y, f):
    return f(x) &#43; f(y)
```

å½“æˆ‘ä»¬è°ƒç”¨`add(-5, 6, abs)`æ—¶ï¼Œå‚æ•°`x`ï¼Œ`y`å’Œ`f`åˆ†åˆ«æŽ¥æ”¶`-5`ï¼Œ`6`å’Œ`abs`ï¼Œæ ¹æ®å‡½æ•°å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æŽ¨å¯¼è®¡ç®—è¿‡ç¨‹ä¸ºï¼š

```
x = -5
y = 6
f = abs
f(x) &#43; f(y) ==&gt; abs(-5) &#43; abs(6) ==&gt; 11
return 11
```

éªŒè¯ä¸€ä¸‹ï¼š

![æ•ˆæžœå›¾](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717104540.png)

ðŸ‘• ç¼–å†™é«˜é˜¶å‡½æ•°ï¼Œå°±æ˜¯è®©å‡½æ•°çš„å‚æ•°èƒ½å¤ŸæŽ¥æ”¶åˆ«çš„å‡½æ•°ã€‚

&gt; å°ç»“ï¼š

æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¿™æ ·çš„å‡½æ•°ç§°ä¸ºé«˜é˜¶å‡½æ•°ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°±æ˜¯æŒ‡è¿™ç§é«˜åº¦æŠ½è±¡çš„ç¼–ç¨‹èŒƒå¼ã€‚

### 4.2.1 map/reduce

Python å†…å»ºäº†`map()`å’Œ`reduce()`å‡½æ•°ã€‚

å¦‚æžœä½ è¯»è¿‡ Google çš„é‚£ç¯‡å¤§åé¼Žé¼Žçš„è®ºæ–‡â€œ[MapReduce: Simplified Data Processing on Large Clusters](http://research.google.com/archive/mapreduce.html)â€ï¼Œä½ å°±èƒ½å¤§æ¦‚æ˜Žç™½ map/reduce çš„æ¦‚å¿µã€‚

#### â‘  map

æˆ‘ä»¬å…ˆçœ‹ mapã€‚`map()`å‡½æ•°æŽ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯`Iterable`ï¼Œ`map`å°†ä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨åˆ°åºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠç»“æžœä½œä¸ºæ–°çš„`Iterator`è¿”å›žã€‚

ä¸¾ä¾‹è¯´æ˜Žï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•° $ f(x)=x^2$ï¼Œè¦æŠŠè¿™ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ª list `[1, 2, 3, 4, 5, 6, 7, 8, 9]`ä¸Šï¼Œå°±å¯ä»¥ç”¨`map()`å®žçŽ°å¦‚ä¸‹ï¼š

![image-20200717105308037](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717105309.png)

çŽ°åœ¨ï¼Œæˆ‘ä»¬ç”¨ Python ä»£ç å®žçŽ°ï¼š

```python
def f(x):
    return x * x
r = map(f, [1, 2, 3, 4, 5, 6, 7, 8, 9])
list(r)
```

![image-20200717105513962](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717105515.png)

`map()`ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`f`ï¼Œå³å‡½æ•°å¯¹è±¡æœ¬èº«ã€‚ç”±äºŽç»“æžœ`r`æ˜¯ä¸€ä¸ª`Iterator`ï¼Œ`Iterator`æ˜¯æƒ°æ€§åºåˆ—ï¼Œå› æ­¤é€šè¿‡`list()`å‡½æ•°è®©å®ƒæŠŠæ•´ä¸ªåºåˆ—éƒ½è®¡ç®—å‡ºæ¥å¹¶è¿”å›žä¸€ä¸ªlistã€‚

ä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸éœ€è¦`map()`å‡½æ•°ï¼Œå†™ä¸€ä¸ªå¾ªçŽ¯ï¼Œä¹Ÿå¯ä»¥è®¡ç®—å‡ºç»“æžœï¼š

```python
L = []
for n in [1, 2, 3, 4, 5, 6, 7, 8, 9]:
    L.append(f(n))
print(L)
```

çš„ç¡®å¯ä»¥ï¼Œä½†æ˜¯ï¼Œä»Žä¸Šé¢çš„å¾ªçŽ¯ä»£ç ï¼Œèƒ½ä¸€çœ¼çœ‹æ˜Žç™½â€œæŠŠ f(x) ä½œç”¨åœ¨ list çš„æ¯ä¸€ä¸ªå…ƒç´ å¹¶æŠŠç»“æžœç”Ÿæˆä¸€ä¸ªæ–°çš„  listâ€å—ï¼Ÿ

æ‰€ä»¥ï¼Œ`map()`ä½œä¸ºé«˜é˜¶å‡½æ•°ï¼Œäº‹å®žä¸Šå®ƒæŠŠè¿ç®—è§„åˆ™æŠ½è±¡äº†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸ä½†å¯ä»¥è®¡ç®—ç®€å•çš„ $ f(x)=x^2$ï¼Œè¿˜å¯ä»¥è®¡ç®—ä»»æ„å¤æ‚çš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼ŒæŠŠè¿™ä¸ª list æ‰€æœ‰æ•°å­—è½¬ä¸ºå­—ç¬¦ä¸²ï¼š

```python
list(map(str, [1, 2, 3, 4, 5, 6, 7, 8, 9]))
```

![image-20200717110350309](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717110351.png)

åªéœ€è¦ä¸€è¡Œä»£ç ã€‚

#### â‘¡ reduce

å†çœ‹`reduce`çš„ç”¨æ³•ã€‚`reduce`æŠŠä¸€ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ªåºåˆ—`[x1, x2, x3, ...]`ä¸Šï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æŽ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œ`reduce`æŠŠç»“æžœç»§ç»­å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ åšç´¯ç§¯è®¡ç®—ï¼Œå…¶æ•ˆæžœå°±æ˜¯ï¼š

```python
reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)
```

æ¯”æ–¹è¯´å¯¹ä¸€ä¸ªåºåˆ—æ±‚å’Œï¼Œå°±å¯ä»¥ç”¨`reduce`å®žçŽ°ï¼š

```python
from functools import reduce
def add(x, y):
    return x &#43; y
reduce(add, [1, 3, 5, 7, 9]) # 25
```

å½“ç„¶æ±‚å’Œè¿ç®—å¯ä»¥ç›´æŽ¥ç”¨ Python å†…å»ºå‡½æ•°`sum()`ï¼Œæ²¡å¿…è¦åŠ¨ç”¨`reduce`ã€‚

ä½†æ˜¯å¦‚æžœè¦æŠŠåºåˆ—`[1, 3, 5, 7, 9]`å˜æ¢æˆæ•´æ•°`13579`ï¼Œ`reduce`å°±å¯ä»¥æ´¾ä¸Šç”¨åœºï¼š

```python
from functools import reduce
def fn(x, y):
    return x * 10 &#43; y
reduce(fn, [1, 3, 5, 7, 9]) # 13579
```

è¿™ä¸ªä¾‹å­æœ¬èº«æ²¡å¤šå¤§ç”¨å¤„ï¼Œä½†æ˜¯ï¼Œå¦‚æžœè€ƒè™‘åˆ°å­—ç¬¦ä¸²`str`ä¹Ÿæ˜¯ä¸€ä¸ªåºåˆ—ï¼Œå¯¹ä¸Šé¢çš„ä¾‹å­ç¨åŠ æ”¹åŠ¨ï¼Œé…åˆ`map()`ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæŠŠ`str`è½¬æ¢ä¸º`int`çš„å‡½æ•°ï¼š

```python
from functools import reduce
def fn(x, y):
    return x * 10 &#43; y
def char2num(s):
    digits = {&#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4, &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9}
    return digits[s]
reduce(fn, map(char2num, &#39;13579&#39;)) # 13579
```

æ•´ç†æˆä¸€ä¸ª`str2int`çš„å‡½æ•°å°±æ˜¯ï¼š

```python
from functools import reduce

DIGITS = {&#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4, &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9}

def str2int(s):
    def fn(x, y):
        return x * 10 &#43; y
    def char2num(s):
        return DIGITS[s]
    return reduce(fn, map(char2num, s))
```

è¿˜å¯ä»¥ç”¨ lambda å‡½æ•°è¿›ä¸€æ­¥ç®€åŒ–æˆï¼š

```python
from functools import reduce

DIGITS = {&#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4, &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9}

def char2num(s):
    return DIGITS[s]

def str2int(s):
    return reduce(lambda x, y: x * 10 &#43; y, map(char2num, s))
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ Python æ²¡æœ‰æä¾›`int()`å‡½æ•°ï¼Œä½ å®Œå…¨å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªæŠŠå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°çš„å‡½æ•°ï¼Œè€Œä¸”åªéœ€è¦å‡ è¡Œä»£ç ï¼

&gt; ç»ƒä¹ é¢˜ï¼š

ã€ç¬¬ä¸€é¢˜ã€‘åˆ©ç”¨`map()`å‡½æ•°ï¼ŒæŠŠç”¨æˆ·è¾“å…¥çš„ä¸è§„èŒƒçš„è‹±æ–‡åå­—ï¼Œå˜ä¸ºé¦–å­—æ¯å¤§å†™ï¼Œå…¶ä»–å°å†™çš„è§„èŒƒåå­—ã€‚è¾“å…¥ï¼š`[&#39;adam&#39;, &#39;LISA&#39;, &#39;barT&#39;]`ï¼Œè¾“å‡ºï¼š`[&#39;Adam&#39;, &#39;Lisa&#39;, &#39;Bart&#39;]`ï¼š

```python
def normalize(name):
    return name[0].upper() &#43; name[1:].lower()
```

æˆ–è€…ä¹ŸæŒºå¥½ï¼š

```python
def normalize(name):
    return name.title()  #title()å‡½æ•° é¦–å­—æ¯å¤§å†™  å…¶ä»–å­—æ¯å°å†™
```

æˆ–è€…ä¹ŸæŒºå¥½ï¼š

```python
def normalize(name):
    return name.capitalize()
```

æµ‹è¯•ï¼š

```python
# æµ‹è¯•:
L1 = [&#39;adam&#39;, &#39;LISA&#39;, &#39;barT&#39;]
L2 = list(map(normalize, L1))
print(L2)
```

ã€ç¬¬äºŒé¢˜ã€‘Python æä¾›çš„`sum()`å‡½æ•°å¯ä»¥æŽ¥å—ä¸€ä¸ª list å¹¶æ±‚å’Œï¼Œè¯·ç¼–å†™ä¸€ä¸ª`prod()`å‡½æ•°ï¼Œå¯ä»¥æŽ¥å—ä¸€ä¸ª list å¹¶åˆ©ç”¨`reduce()`æ±‚ç§¯ï¼š

```python
from functools import reduce
def prod(L):
    return reduce(lambda x, y: x * y, L)
```

æµ‹è¯•ï¼š

```python
print(&#39;3 * 5 * 7 * 9 =&#39;, prod([3, 5, 7, 9]))
if prod([3, 5, 7, 9]) == 945:
    print(&#39;æµ‹è¯•æˆåŠŸ!&#39;)
else:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
```

ã€ç¬¬ä¸‰é¢˜ã€‘åˆ©ç”¨`map`å’Œ`reduce`ç¼–å†™ä¸€ä¸ª`str2float`å‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸²`&#39;123.456&#39;`è½¬æ¢æˆæµ®ç‚¹æ•°`123.456`ï¼š

æ³•ä¸€ï¼š

```python
from functools import reduce

def str2float(s):
    digits = {&#39;0&#39;: 0, &#39;1&#39;: 1, &#39;2&#39;: 2, &#39;3&#39;: 3, &#39;4&#39;: 4, &#39;5&#39;: 5, &#39;6&#39;: 6, &#39;7&#39;: 7, &#39;8&#39;: 8, &#39;9&#39;: 9}    
    def char2num(c):
        return digits[c]
    def fn(x, y):
        return x * 10 &#43; y
    pos = s.find(&#39;.&#39;)
    if pos &gt;= 0:
        return (reduce(fn, map(char2num, s[:pos])) &#43; reduce(fn, map(char2num, s[pos &#43; 1:])) * (10 ** -len(s[pos &#43; 1:]))) 
    return reduce(fn, map(char2num, s))
```

æ³•äºŒï¼š

```python
from functools import reduce

DIGITS = {&#39;0&#39;:0, &#39;1&#39;:1, &#39;2&#39;:2, &#39;3&#39;:3, &#39;4&#39;:4, &#39;5&#39;:5, &#39;6&#39;:6, &#39;7&#39;:7, &#39;8&#39;:8, &#39;9&#39;:9}

def str2float(s):   
    
    def str2num(s):
        return DIGITS[s]
    def fn(x, y):
        return x * 10 &#43; y
    if &#39;.&#39; in s:
        nPos = s.find(&#39;.&#39;)
        s1 = s[:nPos]
        s2 = s[nPos&#43;1:]
        n1 = reduce(fn, map(str2num, s1))
        n2 = reduce(fn, map(str2num, s2))
        return n1 &#43; 0.1 ** len(s2) * n2
    else:
        return ruduce(fn, map(str2num, s))
```



æµ‹è¯•ï¼š

```python
print(&#39;str2float(\&#39;123.456\&#39;) =&#39;, str2float(&#39;123.456&#39;))
if abs(str2float(&#39;123.456&#39;) - 123.456) &lt; 0.00001:
    print(&#39;æµ‹è¯•æˆåŠŸ!&#39;)
else:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
```

### 4.2.2 filter

Python å†…å»ºçš„`filter()`å‡½æ•°ç”¨äºŽè¿‡æ»¤åºåˆ—ã€‚

å’Œ`map()`ç±»ä¼¼ï¼Œ`filter()`ä¹ŸæŽ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªåºåˆ—ã€‚å’Œ`map()`ä¸åŒçš„æ˜¯ï¼Œ`filter()`æŠŠä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨äºŽæ¯ä¸ªå…ƒç´ ï¼Œç„¶åŽæ ¹æ®è¿”å›žå€¼æ˜¯`True`è¿˜æ˜¯`False`å†³å®šä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒè¯¥å…ƒç´ ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª list ä¸­ï¼Œåˆ æŽ‰å¶æ•°ï¼Œåªä¿ç•™å¥‡æ•°ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```python
def is_odd(n):
    return n % 2 == 1

list(filter(is_odd, [1, 2, 4, 5, 6, 9, 10, 15]))
# ç»“æžœ: [1, 5, 9, 15]
```

æŠŠä¸€ä¸ªåºåˆ—ä¸­çš„ç©ºå­—ç¬¦ä¸²åˆ æŽ‰ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```python
def not_empty(s):
    return s and s.strip()

list(filter(not_empty, [&#39;A&#39;, &#39;&#39;, &#39;B&#39;, None, &#39;C&#39;, &#39;  &#39;]))
# ç»“æžœ: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]
```

å¯è§ç”¨`filter()`è¿™ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå…³é”®åœ¨äºŽæ­£ç¡®å®žçŽ°ä¸€ä¸ªâ€œç­›é€‰â€å‡½æ•°ã€‚

æ³¨æ„åˆ°`filter()`å‡½æ•°è¿”å›žçš„æ˜¯ä¸€ä¸ª`Iterator`ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæƒ°æ€§åºåˆ—ï¼Œæ‰€ä»¥è¦å¼ºè¿«`filter()`å®Œæˆè®¡ç®—ç»“æžœï¼Œéœ€è¦ç”¨`list()`å‡½æ•°èŽ·å¾—æ‰€æœ‰ç»“æžœå¹¶è¿”å›žlistã€‚

#### â‘  ç”¨ filter æ±‚ç´ æ•°

è®¡ç®—[ç´ æ•°](http://baike.baidu.com/view/10626.htm)çš„ä¸€ä¸ªæ–¹æ³•æ˜¯[åŸƒæ°ç­›æ³•](http://baike.baidu.com/view/3784258.htm)ï¼Œå®ƒçš„ç®—æ³•ç†è§£èµ·æ¥éžå¸¸ç®€å•ï¼š

é¦–å…ˆï¼Œåˆ—å‡ºä»Ž`2`å¼€å§‹çš„æ‰€æœ‰è‡ªç„¶æ•°ï¼Œæž„é€ ä¸€ä¸ªåºåˆ—ï¼š

2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...

å–åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°`2`ï¼Œå®ƒä¸€å®šæ˜¯ç´ æ•°ï¼Œç„¶åŽç”¨`2`æŠŠåºåˆ—çš„`2`çš„å€æ•°ç­›æŽ‰ï¼š

3, ~~4~~, 5, ~~6~~, 7, ~~8~~, 9, ~~10~~, 11, ~~12~~, 13, ~~14~~, 15, ~~16~~, 17, ~~18~~, 19, ~~20~~, ...

å–æ–°åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°`3`ï¼Œå®ƒä¸€å®šæ˜¯ç´ æ•°ï¼Œç„¶åŽç”¨`3`æŠŠåºåˆ—çš„`3`çš„å€æ•°ç­›æŽ‰ï¼š

5, ~~6~~, 7, ~~8~~, ~~9~~, ~~10~~, 11, ~~12~~, 13, ~~14~~, ~~15~~, ~~16~~, 17, ~~18~~, 19, ~~20~~, ...

å–æ–°åºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°`5`ï¼Œç„¶åŽç”¨`5`æŠŠåºåˆ—çš„`5`çš„å€æ•°ç­›æŽ‰ï¼š

7, ~~8~~, ~~9~~, ~~10~~, 11, ~~12~~, 13, ~~14~~, ~~15~~, ~~16~~, 17, ~~18~~, 19, ~~20~~, ...

ä¸æ–­ç­›ä¸‹åŽ»ï¼Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„ç´ æ•°ã€‚

ç”¨ Python æ¥å®žçŽ°è¿™ä¸ªç®—æ³•ï¼Œå¯ä»¥å…ˆæž„é€ ä¸€ä¸ªä»Ž`3`å¼€å§‹çš„å¥‡æ•°åºåˆ—ï¼š

```python
def _odd_iter():
    n = 1
    while True:
        n = n &#43; 2
        yield n
```

æ³¨æ„è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ— é™åºåˆ—ã€‚

ç„¶åŽå®šä¹‰ä¸€ä¸ªç­›é€‰å‡½æ•°ï¼š

```python
def _not_divisible(n):
    return lambda x: x % n &gt; 0
```

æœ€åŽï¼Œå®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä¸æ–­è¿”å›žä¸‹ä¸€ä¸ªç´ æ•°ï¼š

```python
def primes():
    yield 2
    it = _odd_iter() # åˆå§‹åºåˆ—
    while True:
        n = next(it) # è¿”å›žåºåˆ—çš„ç¬¬ä¸€ä¸ªæ•°
        yield n
        it = filter(_not_divisible(n), it) # æž„é€ æ–°åºåˆ—
```

è¿™ä¸ªç”Ÿæˆå™¨å…ˆè¿”å›žç¬¬ä¸€ä¸ªç´ æ•°`2`ï¼Œç„¶åŽï¼Œåˆ©ç”¨`filter()`ä¸æ–­äº§ç”Ÿç­›é€‰åŽçš„æ–°çš„åºåˆ—ã€‚

ç”±äºŽ`primes()`ä¹Ÿæ˜¯ä¸€ä¸ªæ— é™åºåˆ—ï¼Œæ‰€ä»¥è°ƒç”¨æ—¶éœ€è¦è®¾ç½®ä¸€ä¸ªé€€å‡ºå¾ªçŽ¯çš„æ¡ä»¶ï¼š

```python
# æ‰“å°1000ä»¥å†…çš„ç´ æ•°:
for n in primes():
    if n &lt; 1000:
        print(n)
    else:
        break
```

æ³¨æ„åˆ°`Iterator`æ˜¯æƒ°æ€§è®¡ç®—çš„åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ Python è¡¨ç¤ºâ€œå…¨ä½“è‡ªç„¶æ•°â€ï¼Œâ€œå…¨ä½“ç´ æ•°â€è¿™æ ·çš„åºåˆ—ï¼Œè€Œä»£ç éžå¸¸ç®€æ´ã€‚

&gt; ç»ƒä¹ é¢˜ï¼š

å›žæ•°æ˜¯æŒ‡ä»Žå·¦å‘å³è¯»å’Œä»Žå³å‘å·¦è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•°ï¼Œä¾‹å¦‚`12321`ï¼Œ`909`ã€‚è¯·åˆ©ç”¨`filter()`ç­›é€‰å‡ºå›žæ•°ï¼š

```python
def is_palindrome(n):
    return str(n) == str(n)[::-1]
```

æµ‹è¯•ï¼š

```python
# æµ‹è¯•:
output = filter(is_palindrome, range(1, 1000))
print(&#39;1~1000:&#39;, list(output))
if list(filter(is_palindrome, range(1, 200))) == [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 22, 33, 44, 55, 66, 77, 88, 99, 101, 111, 121, 131, 141, 151, 161, 171, 181, 191]:
    print(&#39;æµ‹è¯•æˆåŠŸ!&#39;)
else:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
```

&gt; å°ç»“ï¼š

`filter()`çš„ä½œç”¨æ˜¯ä»Žä¸€ä¸ªåºåˆ—ä¸­ç­›å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚ç”±äºŽ`filter()`ä½¿ç”¨äº†æƒ°æ€§è®¡ç®—ï¼Œæ‰€ä»¥åªæœ‰åœ¨å–`filter()`ç»“æžœçš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£ç­›é€‰å¹¶æ¯æ¬¡è¿”å›žä¸‹ä¸€ä¸ªç­›å‡ºçš„å…ƒç´ ã€‚

### 4.2.3 sorted

#### â‘  æŽ’åºç®—æ³•

æŽ’åºä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­ç»å¸¸ç”¨åˆ°çš„ç®—æ³•ã€‚æ— è®ºä½¿ç”¨å†’æ³¡æŽ’åºè¿˜æ˜¯å¿«é€ŸæŽ’åºï¼ŒæŽ’åºçš„æ ¸å¿ƒæ˜¯æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å¤§å°ã€‚å¦‚æžœæ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥æ¯”è¾ƒï¼Œä½†å¦‚æžœæ˜¯å­—ç¬¦ä¸²æˆ–è€…ä¸¤ä¸ª dictå‘¢ï¼Ÿç›´æŽ¥æ¯”è¾ƒæ•°å­¦ä¸Šçš„å¤§å°æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤ï¼Œæ¯”è¾ƒçš„è¿‡ç¨‹å¿…é¡»é€šè¿‡å‡½æ•°æŠ½è±¡å‡ºæ¥ã€‚

Python å†…ç½®çš„`sorted()`å‡½æ•°å°±å¯ä»¥å¯¹ list è¿›è¡ŒæŽ’åºï¼š

```python
sorted([36, 5, -12, 9, -21])
```

![image-20200717175608860](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717175610.png)

æ­¤å¤–ï¼Œ`sorted()`å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒè¿˜å¯ä»¥æŽ¥æ”¶ä¸€ä¸ª`key`å‡½æ•°æ¥å®žçŽ°è‡ªå®šä¹‰çš„æŽ’åºï¼Œä¾‹å¦‚æŒ‰ç»å¯¹å€¼å¤§å°æŽ’åºï¼š

```python
sorted([36, 5, -12, 9, -21], key=abs)
```

![image-20200717175738112](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717175739.png)

key æŒ‡å®šçš„å‡½æ•°å°†ä½œç”¨äºŽ list çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶æ ¹æ® key å‡½æ•°è¿”å›žçš„ç»“æžœè¿›è¡ŒæŽ’åºã€‚å¯¹æ¯”åŽŸå§‹çš„ list å’Œç»è¿‡`key=abs`å¤„ç†è¿‡çš„ listï¼š

```python
list = [36, 5, -12, 9, -21]

keys = [36, 5,  12, 9,  21]
```

ç„¶åŽ`sorted()`å‡½æ•°æŒ‰ç…§ keys è¿›è¡ŒæŽ’åºï¼Œå¹¶æŒ‰ç…§å¯¹åº”å…³ç³»è¿”å›ž list ç›¸åº”çš„å…ƒç´ ï¼š

![image-20200717180025283](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180026.png)

æˆ‘ä»¬å†çœ‹ä¸€ä¸ªå­—ç¬¦ä¸²æŽ’åºçš„ä¾‹å­ï¼š

```python
sorted([&#39;bob&#39;, &#39;about&#39;, &#39;Zoo&#39;, &#39;Credit&#39;])
```

![image-20200717180116413](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180117.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹å­—ç¬¦ä¸²æŽ’åºï¼Œæ˜¯æŒ‰ç…§ ASCII çš„å¤§å°æ¯”è¾ƒçš„ï¼Œç”±äºŽ`&#39;Z&#39; &lt; &#39;a&#39;`ï¼Œç»“æžœï¼Œå¤§å†™å­—æ¯`Z`ä¼šæŽ’åœ¨å°å†™å­—æ¯`a`çš„å‰é¢ã€‚

çŽ°åœ¨ï¼Œæˆ‘ä»¬æå‡ºæŽ’åºåº”è¯¥å¿½ç•¥å¤§å°å†™ï¼ŒæŒ‰ç…§å­—æ¯åºæŽ’åºã€‚è¦å®žçŽ°è¿™ä¸ªç®—æ³•ï¼Œä¸å¿…å¯¹çŽ°æœ‰ä»£ç å¤§åŠ æ”¹åŠ¨ï¼Œåªè¦æˆ‘ä»¬èƒ½ç”¨ä¸€ä¸ª key å‡½æ•°æŠŠå­—ç¬¦ä¸²æ˜ å°„ä¸ºå¿½ç•¥å¤§å°å†™æŽ’åºå³å¯ã€‚å¿½ç•¥å¤§å°å†™æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå®žé™…ä¸Šå°±æ˜¯å…ˆæŠŠå­—ç¬¦ä¸²éƒ½å˜æˆå¤§å†™ï¼ˆæˆ–è€…éƒ½å˜æˆå°å†™ï¼‰ï¼Œå†æ¯”è¾ƒã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬ç»™`sorted`ä¼ å…¥ key å‡½æ•°ï¼Œå³å¯å®žçŽ°å¿½ç•¥å¤§å°å†™çš„æŽ’åºï¼š

```python
sorted([&#39;bob&#39;, &#39;about&#39;, &#39;Zoo&#39;, &#39;Credit&#39;], key=str.lower)
```

![image-20200717180305192](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180306.png)

è¦è¿›è¡Œåå‘æŽ’åºï¼Œä¸å¿…æ”¹åŠ¨ key å‡½æ•°ï¼Œå¯ä»¥ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°`reverse=True`ï¼š

```python
 sorted([&#39;bob&#39;, &#39;about&#39;, &#39;Zoo&#39;, &#39;Credit&#39;], key=str.lower, reverse=True)
```

![image-20200717180420727](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717180421.png)

ä»Žä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œé«˜é˜¶å‡½æ•°çš„æŠ½è±¡èƒ½åŠ›æ˜¯éžå¸¸å¼ºå¤§çš„ï¼Œè€Œä¸”ï¼Œæ ¸å¿ƒä»£ç å¯ä»¥ä¿æŒå¾—éžå¸¸ç®€æ´ã€‚

&gt; å°ç»“ï¼š

`sorted()`ä¹Ÿæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚ç”¨`sorted()`æŽ’åºçš„å…³é”®åœ¨äºŽå®žçŽ°ä¸€ä¸ªæ˜ å°„å‡½æ•°ã€‚

&gt; ç»ƒä¹ é¢˜ï¼š

å‡è®¾æˆ‘ä»¬ç”¨ä¸€ç»„ tuple è¡¨ç¤ºå­¦ç”Ÿåå­—å’Œæˆç»©ï¼š

```python
L = [(&#39;Bob&#39;, 75), (&#39;Adam&#39;, 92), (&#39;Bart&#39;, 66), (&#39;Lisa&#39;, 88)]
```

è¯·ç”¨`sorted()`å¯¹ä¸Šè¿°åˆ—è¡¨åˆ†åˆ«æŒ‰åå­—å‡åºæŽ’åºï¼Œå†æŒ‰æˆç»©ä»Žé«˜åˆ°ä½ŽæŽ’åºã€‚

**ï¼ˆ1ï¼‰æŒ‰åå­—å‡åºæŽ’åº**

```python
L = [(&#39;Bob&#39;, 75), (&#39;Adam&#39;, 92), (&#39;Bart&#39;, 66), (&#39;Lisa&#39;, 88)]
def by_name(t):
    return t[0]
L2 = sorted(L, key=by_name)
print(L2)
```

![image-20200717205002143](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717205003.png)



**ï¼ˆ2ï¼‰æŒ‰æˆç»©ä»Žé«˜åˆ°ä½ŽæŽ’åº**

```python
L = [(&#39;Bob&#39;, 75), (&#39;Adam&#39;, 92), (&#39;Bart&#39;, 66), (&#39;Lisa&#39;, 88)]
def by_name(t):
    return -t[1]
L2 = sorted(L, key=by_name)
print(L2)
```

![image-20200717205111010](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200717205111.png)

## 4.3 è¿”å›žå‡½æ•°

### 4.3.1 å‡½æ•°ä½œä¸ºè¿”å›žå€¼

é«˜é˜¶å‡½æ•°é™¤äº†å¯ä»¥æŽ¥å—å‡½æ•°ä½œä¸ºå‚æ•°å¤–ï¼Œè¿˜å¯ä»¥æŠŠå‡½æ•°ä½œä¸ºç»“æžœå€¼è¿”å›žã€‚

æˆ‘ä»¬æ¥å®žçŽ°ä¸€ä¸ªå¯å˜å‚æ•°çš„æ±‚å’Œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ±‚å’Œçš„å‡½æ•°æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

```python
def calc_sum(*args):
    ax = 0
    for n in args:
        ax = ax &#43; n
    return ax
```

ä½†æ˜¯ï¼Œå¦‚æžœä¸éœ€è¦ç«‹åˆ»æ±‚å’Œï¼Œè€Œæ˜¯åœ¨åŽé¢çš„ä»£ç ä¸­ï¼Œæ ¹æ®éœ€è¦å†è®¡ç®—æ€Žä¹ˆåŠžï¼Ÿå¯ä»¥ä¸è¿”å›žæ±‚å’Œçš„ç»“æžœï¼Œè€Œæ˜¯è¿”å›žæ±‚å’Œçš„å‡½æ•°ï¼š

```python
def lazy_sum(*args):
    def sum():
        ax = 0
        for n in args:
            ax = ax &#43; n
        return ax
    return sum
```

å½“æˆ‘ä»¬è°ƒç”¨`lazy_sum()`æ—¶ï¼Œè¿”å›žçš„å¹¶ä¸æ˜¯æ±‚å’Œç»“æžœï¼Œè€Œæ˜¯æ±‚å’Œå‡½æ•°ï¼š

```python
&gt;&gt;&gt; f = lazy_sum(1, 3, 5, 7, 9)
&gt;&gt;&gt; f
&lt;function lazy_sum.&lt;locals&gt;.sum at 0x101c6ed90&gt;
```

è°ƒç”¨å‡½æ•°`f`æ—¶ï¼Œæ‰çœŸæ­£è®¡ç®—æ±‚å’Œçš„ç»“æžœï¼š

```python
&gt;&gt;&gt; f()
25
```

![image-20200718150942158](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200718150943.png)

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°`lazy_sum`ä¸­åˆå®šä¹‰äº†å‡½æ•°`sum`ï¼Œå¹¶ä¸”ï¼Œå†…éƒ¨å‡½æ•°`sum`å¯ä»¥å¼•ç”¨å¤–éƒ¨å‡½æ•°`lazy_sum`çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼Œå½“`lazy_sum`è¿”å›žå‡½æ•°`sum`æ—¶ï¼Œç›¸å…³å‚æ•°å’Œå˜é‡éƒ½ä¿å­˜åœ¨è¿”å›žçš„å‡½æ•°ä¸­ï¼Œè¿™ç§ç§°ä¸ºâ€œé—­åŒ…ï¼ˆClosureï¼‰â€çš„ç¨‹åºç»“æž„æ‹¥æœ‰æžå¤§çš„å¨åŠ›ã€‚

è¯·å†æ³¨æ„ä¸€ç‚¹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨`lazy_sum()`æ—¶ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›žä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå³ä½¿ä¼ å…¥ç›¸åŒçš„å‚æ•°ï¼š

```python
&gt;&gt;&gt; f1 = lazy_sum(1, 3, 5, 7, 9)
&gt;&gt;&gt; f2 = lazy_sum(1, 3, 5, 7, 9)
&gt;&gt;&gt; f1==f2
False
&gt;&gt;&gt; f1()==f2()
True
```

`f1()`å’Œ`f2()`çš„è°ƒç”¨ç»“æžœäº’ä¸å½±å“ã€‚

### 4.3.2 é—­åŒ…

æ³¨æ„åˆ°è¿”å›žçš„å‡½æ•°åœ¨å…¶å®šä¹‰å†…éƒ¨å¼•ç”¨äº†å±€éƒ¨å˜é‡`args`ï¼Œæ‰€ä»¥ï¼Œå½“ä¸€ä¸ªå‡½æ•°è¿”å›žäº†ä¸€ä¸ªå‡½æ•°åŽï¼Œå…¶å†…éƒ¨çš„å±€éƒ¨å˜é‡è¿˜è¢«æ–°å‡½æ•°å¼•ç”¨ï¼Œæ‰€ä»¥ï¼Œé—­åŒ…ç”¨èµ·æ¥ç®€å•ï¼Œå®žçŽ°èµ·æ¥å¯ä¸å®¹æ˜“ã€‚

å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œè¿”å›žçš„å‡½æ•°å¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç›´åˆ°è°ƒç”¨äº†`f()`æ‰æ‰§è¡Œã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```python
def count():
    fs = []
    for i in range(1, 4):
        def f():
             return i*i
        fs.append(f)
    return fs

f1, f2, f3 = count()
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡å¾ªçŽ¯ï¼Œéƒ½åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç„¶åŽï¼ŒæŠŠåˆ›å»ºçš„ 3 ä¸ªå‡½æ•°éƒ½è¿”å›žäº†ã€‚

ä½ å¯èƒ½è®¤ä¸ºè°ƒç”¨`f1()`ï¼Œ`f2()`å’Œ`f3()`ç»“æžœåº”è¯¥æ˜¯`1`ï¼Œ`4`ï¼Œ`9`ï¼Œä½†å®žé™…ç»“æžœæ˜¯ï¼š

```python
&gt;&gt;&gt; f1()
9
&gt;&gt;&gt; f2()
9
&gt;&gt;&gt; f3()
9
```

å…¨éƒ¨éƒ½æ˜¯`9`ï¼åŽŸå› å°±åœ¨äºŽè¿”å›žçš„å‡½æ•°å¼•ç”¨äº†å˜é‡`i`ï¼Œä½†å®ƒå¹¶éžç«‹åˆ»æ‰§è¡Œã€‚ç­‰åˆ° 3 ä¸ªå‡½æ•°éƒ½è¿”å›žæ—¶ï¼Œå®ƒä»¬æ‰€å¼•ç”¨çš„å˜é‡`i`å·²ç»å˜æˆäº†`3`ï¼Œå› æ­¤æœ€ç»ˆç»“æžœä¸º`9`ã€‚

!&gt; è¿”å›žé—­åŒ…æ—¶ç‰¢è®°ä¸€ç‚¹ï¼šè¿”å›žå‡½æ•°ä¸è¦å¼•ç”¨ä»»ä½•å¾ªçŽ¯å˜é‡ï¼Œæˆ–è€…åŽç»­ä¼šå‘ç”Ÿå˜åŒ–çš„å˜é‡ã€‚

å¦‚æžœä¸€å®šè¦å¼•ç”¨å¾ªçŽ¯å˜é‡æ€Žä¹ˆåŠžï¼Ÿæ–¹æ³•æ˜¯å†åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨è¯¥å‡½æ•°çš„å‚æ•°ç»‘å®šå¾ªçŽ¯å˜é‡å½“å‰çš„å€¼ï¼Œæ— è®ºè¯¥å¾ªçŽ¯å˜é‡åŽç»­å¦‚ä½•æ›´æ”¹ï¼Œå·²ç»‘å®šåˆ°å‡½æ•°å‚æ•°çš„å€¼ä¸å˜ï¼š

```python
def count():
    def f(j):
        def g():
            return j*j
        return g
    fs = []
    for i in range(1, 4):
        fs.append(f(i)) # f(i)ç«‹åˆ»è¢«æ‰§è¡Œï¼Œå› æ­¤içš„å½“å‰å€¼è¢«ä¼ å…¥f()
    return fs
```

å†çœ‹çœ‹ç»“æžœï¼š

```python
&gt;&gt;&gt; f1, f2, f3 = count()
&gt;&gt;&gt; f1()
1
&gt;&gt;&gt; f2()
4
&gt;&gt;&gt; f3()
9
```

ç¼ºç‚¹æ˜¯ä»£ç è¾ƒé•¿ï¼Œå¯åˆ©ç”¨ lambda å‡½æ•°ç¼©çŸ­ä»£ç ã€‚

&gt; ç»ƒä¹ é¢˜ï¼š

åˆ©ç”¨é—­åŒ…è¿”å›žä¸€ä¸ªè®¡æ•°å™¨å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨å®ƒè¿”å›žé€’å¢žæ•´æ•°ï¼š

* æ³•ä¸€ï¼š

```python
def createCounter():
    i = 0
    def counter():
        nonlocal i  #è¿™å¥å£°æ˜Žæ˜¯é—­åŒ…å‡½æ•°åº”ç”¨åŒåå˜é‡çš„é‡ç‚¹ã€‚
        while True:
            i = i &#43; 1
            return i
    return counter
```

* æ³•äºŒï¼š

```python
# é€‰æ‹©æ•°å€¼å¯å˜ä½†æ˜¯åœ°å€ä¸å˜çš„å˜é‡ç±»åž‹â€”â€”æ•°ç»„
def createCounter():
    i = [0] # åˆå§‹åŒ–æ•°ç»„    
    def counter():
        i[0] &#43;= 1 #ä¸ä¿®æ”¹æ•°ç»„ï¼Œ å°½ä¿®æ”¹æ•°ç»„ä¸­å…ƒç´ æ•°å€¼ï¼Œ æ•°ç»„çš„åœ°å€ä¸å˜        
        return i[0]
    return counter
```

* æ³•ä¸‰ï¼š

```python
# ä¹Ÿå¯ä»¥é€‰æ‹©dictç±»åž‹å˜é‡ï¼Œä¸Žæ•°ç»„åŒç†ï¼Œ ä¸»è¦ä¸æ”¹å˜å˜é‡å¼•ç”¨åœ°å€å³å¯
def createCounter():
    i = {&#39;a&#39;:0}
    def counter():
        i[&#39;a&#39;] &#43;= 1        
        return i[&#39;a&#39;]
    return counter
```

* æµ‹è¯•ï¼š

```python
# æµ‹è¯•:
counterA = createCounter()
print(counterA(), counterA(), counterA(), counterA(), counterA()) # 1 2 3 4 5
counterB = createCounter()
if [counterB(), counterB(), counterB(), counterB()] == [1, 2, 3, 4]:
    print(&#39;æµ‹è¯•é€šè¿‡!&#39;)
else:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
```

&gt; å°ç»“ï¼š

ä¸€ä¸ªå‡½æ•°å¯ä»¥è¿”å›žä¸€ä¸ªè®¡ç®—ç»“æžœï¼Œä¹Ÿå¯ä»¥è¿”å›žä¸€ä¸ªå‡½æ•°ã€‚

è¿”å›žä¸€ä¸ªå‡½æ•°æ—¶ï¼Œç‰¢è®°è¯¥å‡½æ•°å¹¶æœªæ‰§è¡Œï¼Œè¿”å›žå‡½æ•°ä¸­ä¸è¦å¼•ç”¨ä»»ä½•å¯èƒ½ä¼šå˜åŒ–çš„å˜é‡ã€‚

## 4.4 åŒ¿åå‡½æ•°

å½“æˆ‘ä»¬åœ¨ä¼ å…¥å‡½æ•°æ—¶ï¼Œæœ‰äº›æ—¶å€™ï¼Œä¸éœ€è¦æ˜¾å¼åœ°å®šä¹‰å‡½æ•°ï¼Œç›´æŽ¥ä¼ å…¥åŒ¿åå‡½æ•°æ›´æ–¹ä¾¿ã€‚

åœ¨ Python ä¸­ï¼Œå¯¹åŒ¿åå‡½æ•°æä¾›äº†æœ‰é™æ”¯æŒã€‚è¿˜æ˜¯ä»¥`map()`å‡½æ•°ä¸ºä¾‹ï¼Œè®¡ç®— $f(x)=x^2$ æ—¶ï¼Œé™¤äº†å®šä¹‰ä¸€ä¸ª`f(x)`çš„å‡½æ•°å¤–ï¼Œè¿˜å¯ä»¥ç›´æŽ¥ä¼ å…¥åŒ¿åå‡½æ•°ï¼š

```python
list(map(lambda x: x * x, [1, 2, 3, 4, 5, 6, 7, 8, 9]))
```

é€šè¿‡å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼ŒåŒ¿åå‡½æ•°`lambda x: x * x`å®žé™…ä¸Šå°±æ˜¯ï¼š

```python
def f(x):
    return x * x
```

å…³é”®å­—`lambda`è¡¨ç¤ºåŒ¿åå‡½æ•°ï¼Œå†’å·å‰é¢çš„`x`è¡¨ç¤ºå‡½æ•°å‚æ•°ã€‚

åŒ¿åå‡½æ•°æœ‰ä¸ªé™åˆ¶ï¼Œå°±æ˜¯åªèƒ½æœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸ç”¨å†™`return`ï¼Œè¿”å›žå€¼å°±æ˜¯è¯¥è¡¨è¾¾å¼çš„ç»“æžœã€‚

ç”¨åŒ¿åå‡½æ•°æœ‰ä¸ªå¥½å¤„ï¼Œå› ä¸ºå‡½æ•°æ²¡æœ‰åå­—ï¼Œä¸å¿…æ‹…å¿ƒå‡½æ•°åå†²çªã€‚æ­¤å¤–ï¼ŒåŒ¿åå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŠŠåŒ¿åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œå†åˆ©ç”¨å˜é‡æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼š

```python
&gt;&gt;&gt; f = lambda x: x * x
&gt;&gt;&gt; f
&lt;function &lt;lambda&gt; at 0x101c6ef28&gt;
&gt;&gt;&gt; f(5)
25
```

åŒæ ·ï¼Œä¹Ÿå¯ä»¥æŠŠåŒ¿åå‡½æ•°ä½œä¸ºè¿”å›žå€¼è¿”å›žï¼Œæ¯”å¦‚ï¼š

```python
def build(x, y):
    return lambda: x * x &#43; y * y
```

&gt; ç»ƒä¹ é¢˜ï¼š

è¯·ç”¨åŒ¿åå‡½æ•°æ”¹é€ ä¸‹é¢çš„ä»£ç ï¼š

```python
def is_odd(n):
    return n % 2 == 1

L = list(filter(is_odd, range(1, 20)))
print(L)
```

ç”¨åŒ¿åå‡½æ•°æ”¹é€ ï¼š

```python
L = list(filter(lambda x: x %2 == 1, range(1, 20)))
print(L)
```

é‚£å¦‚æžœç”¨åˆ—è¡¨ç”Ÿæˆå¼æ”¹é€ å‘¢ï¼Ÿ

```python
L = [x for x in range(1,20) if x % 2 == 1]
print(L)
```



&gt; å°ç»“ï¼š

Python å¯¹åŒ¿åå‡½æ•°çš„æ”¯æŒæœ‰é™ï¼Œåªæœ‰ä¸€äº›ç®€å•çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚

## 4.5 è£…é¥°å™¨

ç”±äºŽå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”å‡½æ•°å¯¹è±¡å¯ä»¥è¢«èµ‹å€¼ç»™å˜é‡ï¼Œæ‰€ä»¥ï¼Œé€šè¿‡å˜é‡ä¹Ÿèƒ½è°ƒç”¨è¯¥å‡½æ•°ã€‚

```python
def now():
    print(&#39;2020-07-19&#39;)
f = now
f() # ç»“æžœï¼š2020-07-19
```

å‡½æ•°å¯¹è±¡æœ‰ä¸€ä¸ª`__name__`å±žæ€§ï¼Œå¯ä»¥æ‹¿åˆ°å‡½æ•°çš„åå­—ï¼š

```python
&gt;&gt;&gt; now.__name__
&#39;now&#39;
&gt;&gt;&gt; f.__name__
&#39;now&#39;
```

çŽ°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬è¦å¢žå¼º`now()`å‡½æ•°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œåœ¨å‡½æ•°è°ƒç”¨å‰åŽè‡ªåŠ¨æ‰“å°æ—¥å¿—ï¼Œä½†åˆä¸å¸Œæœ›ä¿®æ”¹`now()`å‡½æ•°çš„å®šä¹‰ï¼Œè¿™ç§åœ¨ä»£ç è¿è¡ŒæœŸé—´åŠ¨æ€å¢žåŠ åŠŸèƒ½çš„æ–¹å¼ï¼Œç§°ä¹‹ä¸ºâ€œè£…é¥°å™¨â€ï¼ˆDecoratorï¼‰ã€‚

æœ¬è´¨ä¸Šï¼Œdecorator å°±æ˜¯ä¸€ä¸ªè¿”å›žå‡½æ•°çš„é«˜é˜¶å‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªèƒ½æ‰“å°æ—¥å¿—çš„ decoratorï¼Œå¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š

```python
def log(func):
    def wrapper(*args, **kw):
        print(&#39;call %s():&#39; % func.__name__)
        return func(*args, **kw)
    return wrapper
```

è§‚å¯Ÿä¸Šé¢çš„`log`ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª decoratorï¼Œæ‰€ä»¥æŽ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›žä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬è¦å€ŸåŠ© Python çš„ @ è¯­æ³•ï¼ŒæŠŠ decorator ç½®äºŽå‡½æ•°çš„å®šä¹‰å¤„ï¼š

```python
@log
def now():
    print(&#39;2020-07-19&#39;)
```

è°ƒç”¨`now()`å‡½æ•°ï¼Œä¸ä»…ä¼šè¿è¡Œ`now()`å‡½æ•°æœ¬èº«ï¼Œè¿˜ä¼šåœ¨è¿è¡Œ`now()`å‡½æ•°å‰æ‰“å°ä¸€è¡Œæ—¥å¿—ï¼š

![image-20200719083104800](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719083113.png)



æŠŠ`@log`æ”¾åˆ°`now()`å‡½æ•°çš„å®šä¹‰å¤„ï¼Œç›¸å½“äºŽæ‰§è¡Œäº†è¯­å¥ï¼š

```python
now = log(now)
```

ç”±äºŽ`log()`æ˜¯ä¸€ä¸ª decoratorï¼Œè¿”å›žä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ï¼ŒåŽŸæ¥çš„`now()`å‡½æ•°ä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯çŽ°åœ¨åŒåçš„`now`å˜é‡æŒ‡å‘äº†æ–°çš„å‡½æ•°ï¼ŒäºŽæ˜¯è°ƒç”¨`now()`å°†æ‰§è¡Œæ–°å‡½æ•°ï¼Œå³åœ¨`log()`å‡½æ•°ä¸­è¿”å›žçš„`wrapper()`å‡½æ•°ã€‚

`wrapper()`å‡½æ•°çš„å‚æ•°å®šä¹‰æ˜¯`(*args, **kw)`ï¼Œå› æ­¤ï¼Œ`wrapper()`å‡½æ•°å¯ä»¥æŽ¥å—ä»»æ„å‚æ•°çš„è°ƒç”¨ã€‚åœ¨`wrapper()`å‡½æ•°å†…ï¼Œé¦–å…ˆæ‰“å°æ—¥å¿—ï¼Œå†ç´§æŽ¥ç€è°ƒç”¨åŽŸå§‹å‡½æ•°ã€‚

å¦‚æžœ decorator æœ¬èº«éœ€è¦ä¼ å…¥å‚æ•°ï¼Œé‚£å°±éœ€è¦ç¼–å†™ä¸€ä¸ªè¿”å›ž decorator çš„é«˜é˜¶å‡½æ•°ï¼Œå†™å‡ºæ¥ä¼šæ›´å¤æ‚ã€‚æ¯”å¦‚ï¼Œè¦è‡ªå®šä¹‰ log çš„æ–‡æœ¬ï¼š

```python
def log(text):
    def decorator(func):
        def wrapper(*args, **kw):
            print(&#39;%s %s():&#39; % (text, func.__name__))
            return func(*args, **kw)
        return wrapper
    return decorator
```

è¿™ä¸ª 3 å±‚åµŒå¥—çš„ decorator ç”¨æ³•å¦‚ä¸‹ï¼š

```python
@log(&#39;execute&#39;)
def now():
    print(&#39;2020-07-19&#39;)
```

æ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š

![image-20200719084700178](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719084715.png)

å’Œä¸¤å±‚åµŒå¥—çš„ decorator ç›¸æ¯”ï¼Œ3 å±‚åµŒå¥—çš„æ•ˆæžœæ˜¯è¿™æ ·çš„ï¼š

```python
&gt;&gt;&gt; now = log(&#39;execute&#39;)(now)
```

æˆ‘ä»¬æ¥å‰–æžä¸Šé¢çš„è¯­å¥ï¼Œé¦–å…ˆæ‰§è¡Œ`log(&#39;execute&#39;)`ï¼Œè¿”å›žçš„æ˜¯`decorator`å‡½æ•°ï¼Œå†è°ƒç”¨è¿”å›žçš„å‡½æ•°ï¼Œå‚æ•°æ˜¯`now`å‡½æ•°ï¼Œè¿”å›žå€¼æœ€ç»ˆæ˜¯`wrapper`å‡½æ•°ã€‚

ä»¥ä¸Šä¸¤ç§ decorator çš„å®šä¹‰éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†è¿˜å·®æœ€åŽä¸€æ­¥ã€‚å› ä¸ºæˆ‘ä»¬è®²äº†å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒæœ‰`__name__`ç­‰å±žæ€§ï¼Œä½†ä½ åŽ»çœ‹ç»è¿‡ decorator è£…é¥°ä¹‹åŽçš„å‡½æ•°ï¼Œå®ƒä»¬çš„`__name__`å·²ç»ä»ŽåŽŸæ¥çš„`&#39;now&#39;`å˜æˆäº†`&#39;wrapper&#39;`ï¼š

```python
&gt;&gt;&gt; now.__name__
&#39;wrapper&#39;
```

å› ä¸ºè¿”å›žçš„é‚£ä¸ª`wrapper()`å‡½æ•°åå­—å°±æ˜¯`&#39;wrapper&#39;`ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æŠŠåŽŸå§‹å‡½æ•°çš„`__name__`ç­‰å±žæ€§å¤åˆ¶åˆ°`wrapper()`å‡½æ•°ä¸­ï¼Œå¦åˆ™ï¼Œæœ‰äº›ä¾èµ–å‡½æ•°ç­¾åçš„ä»£ç æ‰§è¡Œå°±ä¼šå‡ºé”™ã€‚

ä¸éœ€è¦ç¼–å†™`wrapper.__name__ = func.__name__`è¿™æ ·çš„ä»£ç ï¼ŒPython å†…ç½®çš„`functools.wraps`å°±æ˜¯å¹²è¿™ä¸ªäº‹çš„ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå®Œæ•´çš„ decorator çš„å†™æ³•å¦‚ä¸‹ï¼š

```python
import functools

def log(func):
    @functools.wraps(func)
    def wrapper(*args, **kw):
        print(&#39;call %s():&#39; % func.__name__)
        return func(*args, **kw)
    return wrapper
```

æˆ–è€…é’ˆå¯¹å¸¦å‚æ•°çš„ decoratorï¼š

```python
import functools

def log(text):
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kw):
            print(&#39;%s %s():&#39; % (text, func.__name__))
            return func(*args, **kw)
        return wrapper
    return decorator
```

`import functools`æ˜¯å¯¼å…¥`functools`æ¨¡å—ã€‚æ¨¡å—çš„æ¦‚å¿µç¨å€™è®²è§£ã€‚çŽ°åœ¨ï¼Œåªéœ€è®°ä½åœ¨å®šä¹‰`wrapper()`çš„å‰é¢åŠ ä¸Š`@functools.wraps(func)`å³å¯ã€‚

&gt; ç»ƒä¹ é¢˜ï¼š

è¯·è®¾è®¡ä¸€ä¸ª decoratorï¼Œå®ƒå¯ä½œç”¨äºŽä»»ä½•å‡½æ•°ä¸Šï¼Œå¹¶æ‰“å°è¯¥å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼š

```python
import time, functools
def metric(fn):
    @functools.wraps(fn)
    def wrapper(*args, **kw):
        start_time = time.time()
        e = fn(*args, **kw)
        end_time = time.time()
        print(&#39;%s executed in %s ms&#39; % (fn.__name__, end_time - start_time))
        return e
    return wrapper
```

æµ‹è¯•ï¼š

```python
# æµ‹è¯•
@metric
def fast(x, y):
    time.sleep(0.0012)
    return x &#43; y;

@metric
def slow(x, y, z):
    time.sleep(0.1234)
    return x * y * z;

f = fast(11, 22)
s = slow(11, 22, 33)
if f != 33:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
elif s != 7986:
    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)
```

![image-20200719091357306](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719091405.png)



&gt; å°ç»“ï¼š

åœ¨é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰çš„è®¾è®¡æ¨¡å¼ä¸­ï¼Œdecorator è¢«ç§°ä¸ºè£…é¥°æ¨¡å¼ã€‚OOP çš„è£…é¥°æ¨¡å¼éœ€è¦é€šè¿‡ç»§æ‰¿å’Œç»„åˆæ¥å®žçŽ°ï¼Œè€Œ Python é™¤äº†èƒ½æ”¯æŒ OOP çš„ decorator å¤–ï¼Œç›´æŽ¥ä»Žè¯­æ³•å±‚æ¬¡æ”¯æŒ decoratorã€‚Python çš„ decorator å¯ä»¥ç”¨å‡½æ•°å®žçŽ°ï¼Œä¹Ÿå¯ä»¥ç”¨ç±»å®žçŽ°ã€‚

decorator å¯ä»¥å¢žå¼ºå‡½æ•°çš„åŠŸèƒ½ï¼Œå®šä¹‰èµ·æ¥è™½ç„¶æœ‰ç‚¹å¤æ‚ï¼Œä½†ä½¿ç”¨èµ·æ¥éžå¸¸çµæ´»å’Œæ–¹ä¾¿ã€‚

å†æ€è€ƒä¸€ä¸‹èƒ½å¦å†™å‡ºä¸€ä¸ª`@log`çš„ decoratorï¼Œä½¿å®ƒæ—¢æ”¯æŒï¼š

```python
@log
def f():
    pass
```

åˆæ”¯æŒï¼š

```python
@log(&#39;execute&#39;)
def f():
    pass
```

eg.

```python
def log(text):
    if isinstance(text, str):
        def decorator(func):
            @functools.wraps(func)
            def wrapper(*args, **kw):
                print(&#39;%s %s(): &#39; % (text, func.__name__))
                return func(*args, **kw)
            return wrapper
        return decorator
    def wrapper(*args, **kw):
        print(&#39;%s %s(): &#39; % (text, func.__name__))
        return func(*args, **kw)
    return wrapper
```



## 4.6 åå‡½æ•°

Python çš„`functools`æ¨¡å—æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯åå‡½æ•°ï¼ˆPartial functionï¼‰ã€‚è¦æ³¨æ„ï¼Œè¿™é‡Œçš„åå‡½æ•°å’Œæ•°å­¦æ„ä¹‰ä¸Šçš„åå‡½æ•°ä¸ä¸€æ ·ã€‚

åœ¨ä»‹ç»å‡½æ•°å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®²åˆ°ï¼Œé€šè¿‡è®¾å®šå‚æ•°çš„é»˜è®¤å€¼ï¼Œå¯ä»¥é™ä½Žå‡½æ•°è°ƒç”¨çš„éš¾åº¦ã€‚è€Œåå‡½æ•°ä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š

`int()`å‡½æ•°å¯ä»¥æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œå½“ä»…ä¼ å…¥å­—ç¬¦ä¸²æ—¶ï¼Œ`int()`å‡½æ•°é»˜è®¤æŒ‰åè¿›åˆ¶è½¬æ¢ï¼š

```python
&gt;&gt;&gt; int(&#39;12345&#39;)
12345
```

ä½†`int()`å‡½æ•°è¿˜æä¾›é¢å¤–çš„`base`å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º`10`ã€‚å¦‚æžœä¼ å…¥`base`å‚æ•°ï¼Œå°±å¯ä»¥åš N è¿›åˆ¶çš„è½¬æ¢ï¼š

```python
&gt;&gt;&gt; int(&#39;12345&#39;, base=8)
5349
&gt;&gt;&gt; int(&#39;12345&#39;, 16)
74565
```

å‡è®¾è¦è½¬æ¢å¤§é‡çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œæ¯æ¬¡éƒ½ä¼ å…¥`int(x, base=2)`éžå¸¸éº»çƒ¦ï¼ŒäºŽæ˜¯ï¼Œæˆ‘ä»¬æƒ³åˆ°ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ª`int2()`çš„å‡½æ•°ï¼Œé»˜è®¤æŠŠ`base=2`ä¼ è¿›åŽ»ï¼š

```python
def int2(x, base=2):
    return int(x, base)
```

è¿™æ ·ï¼Œæˆ‘ä»¬è½¬æ¢äºŒè¿›åˆ¶å°±éžå¸¸æ–¹ä¾¿äº†ï¼š

```python
&gt;&gt;&gt; int2(&#39;1000000&#39;)
64
&gt;&gt;&gt; int2(&#39;1010101&#39;)
85
```

`functools.partial`å°±æ˜¯å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåå‡½æ•°çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰`int2()`ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°`int2`ï¼š

```python
&gt;&gt;&gt; import functools
&gt;&gt;&gt; int2 = functools.partial(int, base=2)
&gt;&gt;&gt; int2(&#39;1000000&#39;)
64
&gt;&gt;&gt; int2(&#39;1010101&#39;)
85
```

æ‰€ä»¥ï¼Œç®€å•æ€»ç»“`functools.partial`çš„ä½œç”¨å°±æ˜¯ï¼ŒæŠŠä¸€ä¸ªå‡½æ•°çš„æŸäº›å‚æ•°ç»™å›ºå®šä½ï¼ˆä¹Ÿå°±æ˜¯è®¾ç½®é»˜è®¤å€¼ï¼‰ï¼Œè¿”å›žä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªæ–°å‡½æ•°ä¼šæ›´ç®€å•ã€‚

æ³¨æ„åˆ°ä¸Šé¢çš„æ–°çš„`int2`å‡½æ•°ï¼Œä»…ä»…æ˜¯æŠŠ`base`å‚æ•°é‡æ–°è®¾å®šé»˜è®¤å€¼ä¸º`2`ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥å…¶ä»–å€¼ï¼š

```python
&gt;&gt;&gt; int2(&#39;1000000&#39;, base=10)
1000000
```

æœ€åŽï¼Œåˆ›å»ºåå‡½æ•°æ—¶ï¼Œå®žé™…ä¸Šå¯ä»¥æŽ¥æ”¶å‡½æ•°å¯¹è±¡ã€`*args`å’Œ`**kw`è¿™ 3 ä¸ªå‚æ•°ï¼Œå½“ä¼ å…¥ï¼š

```python
int2 = functools.partial(int, base=2)
```

å®žé™…ä¸Šå›ºå®šäº† int() å‡½æ•°çš„å…³é”®å­—å‚æ•°`base`ï¼Œä¹Ÿå°±æ˜¯ï¼š

```python
int2(&#39;10010&#39;)
```

ç›¸å½“äºŽï¼š

```python
kw = { &#39;base&#39;: 2 }
int(&#39;10010&#39;, **kw)
```

å½“ä¼ å…¥ï¼š

```python
max2 = functools.partial(max, 10)
```

å®žé™…ä¸Šä¼šæŠŠ`10`ä½œä¸º`*args`çš„ä¸€éƒ¨åˆ†è‡ªåŠ¨åŠ åˆ°å·¦è¾¹ï¼Œä¹Ÿå°±æ˜¯ï¼š

```python
max2(5, 6, 7)
```

ç›¸å½“äºŽï¼š

```python
args = (10, 5, 6, 7)
max(*args)
```

ç»“æžœä¸º`10`ã€‚

![image-20200719101140248](https://gitee.com/wugenqiang/PictureBed/raw/master/images01/20200719101153.png)

&gt; å°ç»“ï¼š

å½“å‡½æ•°çš„å‚æ•°ä¸ªæ•°å¤ªå¤šï¼Œéœ€è¦ç®€åŒ–æ—¶ï¼Œä½¿ç”¨`functools.partial`å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°å¯ä»¥å›ºå®šä½åŽŸå‡½æ•°çš„éƒ¨åˆ†å‚æ•°ï¼Œä»Žè€Œåœ¨è°ƒç”¨æ—¶æ›´ç®€å•ã€‚

## 4.7 å‚è€ƒèµ„æ–™

* [å»–é›ªå³° - Python 3.x - å‡½æ•°å¼ç¼–ç¨‹](https://www.liaoxuefeng.com/wiki/1016959663602400/1017328525009056)
* [é˜®ä¸€å³° - å‡½æ•°å¼ç¼–ç¨‹åˆæŽ¢](http://www.ruanyifeng.com/blog/2012/04/functional_programming.html)





---

> ä½œè€…:   
> URL: http://richfan.site/%E7%A8%8B%E6%8A%80/python/python%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ch4-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/  

